<!doctype html>
<html>

<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width initial-scale=1'>
    <title>corpus</title>
    <link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext'
        rel='stylesheet' type='text/css' />
    <style type='text/css'>
        html {
            overflow-x: initial !important;
        }

        :root {
            --bg-color: #ffffff;
            --text-color: #333333;
            --select-text-bg-color: #B5D6FC;
            --select-text-font-color: auto;
            --monospace: "Lucida Console", Consolas, "Courier", monospace;
        }

        html {
            font-size: 14px;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        body {
            margin: 0px;
            padding: 0px;
            height: auto;
            bottom: 0px;
            top: 0px;
            left: 0px;
            right: 0px;
            font-size: 1rem;
            line-height: 1.42857;
            overflow-x: hidden;
            background: inherit;
        }

        iframe {
            margin: auto;
        }

        a.url {
            word-break: break-all;
        }

        a:active,
        a:hover {
            outline: 0px;
        }

        .in-text-selection,
        ::selection {
            text-shadow: none;
            background: var(--select-text-bg-color);
            color: var(--select-text-font-color);
        }

        #write {
            margin: 0px auto;
            height: auto;
            width: inherit;
            word-break: normal;
            word-wrap: break-word;
            position: relative;
            white-space: normal;
            overflow-x: visible;
            padding-top: 40px;
        }

        #write.first-line-indent p {
            text-indent: 2em;
        }

        #write.first-line-indent li p,
        #write.first-line-indent p * {
            text-indent: 0px;
        }

        #write.first-line-indent li {
            margin-left: 2em;
        }

        .for-image #write {
            padding-left: 8px;
            padding-right: 8px;
        }

        body.typora-export {
            padding-left: 30px;
            padding-right: 30px;
        }

        .typora-export .footnote-line,
        .typora-export li,
        .typora-export p {
            white-space: pre-wrap;
        }

        @media screen and (max-width: 500px) {
            body.typora-export {
                padding-left: 0px;
                padding-right: 0px;
            }

            #write {
                padding-left: 20px;
                padding-right: 20px;
            }

            .CodeMirror-sizer {
                margin-left: 0px !important;
            }

            .CodeMirror-gutters {
                display: none !important;
            }
        }

        #write li>figure:first-child {
            margin-top: -20px;
        }

        #write ol,
        #write ul {
            position: relative;
        }

        img {
            max-width: 100%;
            vertical-align: middle;
        }

        button,
        input,
        select,
        textarea {
            color: inherit;
            font-style: inherit;
            font-variant: inherit;
            font-weight: inherit;
            font-stretch: inherit;
            font-size: inherit;
            line-height: inherit;
            font-family: inherit;
        }

        input[type="checkbox"],
        input[type="radio"] {
            line-height: normal;
            padding: 0px;
        }

        *,
        ::after,
        ::before {
            box-sizing: border-box;
        }

        #write h1,
        #write h2,
        #write h3,
        #write h4,
        #write h5,
        #write h6,
        #write p,
        #write pre {
            width: inherit;
        }

        #write h1,
        #write h2,
        #write h3,
        #write h4,
        #write h5,
        #write h6,
        #write p {
            position: relative;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            break-after: avoid-page;
            break-inside: avoid;
            orphans: 2;
        }

        p {
            orphans: 4;
        }

        h1 {
            font-size: 2rem;
        }

        h2 {
            font-size: 1.8rem;
        }

        h3 {
            font-size: 1.6rem;
        }

        h4 {
            font-size: 1.4rem;
        }

        h5 {
            font-size: 1.2rem;
        }

        h6 {
            font-size: 1rem;
        }

        .md-math-block,
        .md-rawblock,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        p {
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .hidden {
            display: none;
        }

        .md-blockmeta {
            color: rgb(204, 204, 204);
            font-weight: 700;
            font-style: italic;
        }

        a {
            cursor: pointer;
        }

        sup.md-footnote {
            padding: 2px 4px;
            background-color: rgba(238, 238, 238, 0.7);
            color: rgb(85, 85, 85);
            border-radius: 4px;
            cursor: pointer;
        }

        sup.md-footnote a,
        sup.md-footnote a:hover {
            color: inherit;
            text-transform: inherit;
            text-decoration: inherit;
        }

        #write input[type="checkbox"] {
            cursor: pointer;
            width: inherit;
            height: inherit;
        }

        figure {
            overflow-x: auto;
            margin: 1.2em 0px;
            max-width: calc(100% + 16px);
            padding: 0px;
        }

        figure>table {
            margin: 0px !important;
        }

        tr {
            break-inside: avoid;
            break-after: auto;
        }

        thead {
            display: table-header-group;
        }

        table {
            border-collapse: collapse;
            border-spacing: 0px;
            width: 100%;
            overflow: auto;
            break-inside: auto;
            text-align: left;
        }

        table.md-table td {
            min-width: 32px;
        }

        .CodeMirror-gutters {
            border-right: 0px;
            background-color: inherit;
        }

        .CodeMirror {
            text-align: left;
        }

        .CodeMirror-placeholder {
            opacity: 0.3;
        }

        .CodeMirror pre {
            padding: 0px 4px;
        }

        .CodeMirror-lines {
            padding: 0px;
        }

        div.hr:focus {
            cursor: none;
        }

        #write pre {
            white-space: pre-wrap;
        }

        #write.fences-no-line-wrapping pre {
            white-space: pre;
        }

        #write pre.ty-contain-cm {
            white-space: normal;
        }

        .CodeMirror-gutters {
            margin-right: 4px;
        }

        .md-fences {
            font-size: 0.9rem;
            display: block;
            break-inside: avoid;
            text-align: left;
            overflow: visible;
            white-space: pre;
            background: inherit;
            position: relative !important;
        }

        .md-diagram-panel {
            width: 100%;
            margin-top: 10px;
            text-align: center;
            padding-top: 0px;
            padding-bottom: 8px;
            overflow-x: auto;
        }

        #write .md-fences.mock-cm {
            white-space: pre-wrap;
        }

        .md-fences.md-fences-with-lineno {
            padding-left: 0px;
        }

        #write.fences-no-line-wrapping .md-fences.mock-cm {
            white-space: pre;
            overflow-x: auto;
        }

        .md-fences.mock-cm.md-fences-with-lineno {
            padding-left: 8px;
        }

        .CodeMirror-line,
        twitterwidget {
            break-inside: avoid;
        }

        .footnotes {
            opacity: 0.8;
            font-size: 0.9rem;
            margin-top: 1em;
            margin-bottom: 1em;
        }

        .footnotes+.footnotes {
            margin-top: 0px;
        }

        .md-reset {
            margin: 0px;
            padding: 0px;
            border: 0px;
            outline: 0px;
            vertical-align: top;
            background: 0px 0px;
            text-decoration: none;
            text-shadow: none;
            float: none;
            position: static;
            width: auto;
            height: auto;
            white-space: nowrap;
            cursor: inherit;
            -webkit-tap-highlight-color: transparent;
            line-height: normal;
            font-weight: 400;
            text-align: left;
            box-sizing: content-box;
            direction: ltr;
        }

        li div {
            padding-top: 0px;
        }

        blockquote {
            margin: 1rem 0px;
        }

        li .mathjax-block,
        li p {
            margin: 0.5rem 0px;
        }

        li {
            margin: 0px;
            position: relative;
        }

        blockquote> :last-child {
            margin-bottom: 0px;
        }

        blockquote> :first-child,
        li> :first-child {
            margin-top: 0px;
        }

        .footnotes-area {
            color: rgb(136, 136, 136);
            margin-top: 0.714rem;
            padding-bottom: 0.143rem;
            white-space: normal;
        }

        #write .footnote-line {
            white-space: pre-wrap;
        }

        @media print {

            body,
            html {
                border: 1px solid transparent;
                height: 99%;
                break-after: avoid;
                break-before: avoid;
            }

            #write {
                margin-top: 0px;
                padding-top: 0px;
                border-color: transparent !important;
            }

            .typora-export * {
                -webkit-print-color-adjust: exact;
            }

            html.blink-to-pdf {
                font-size: 13px;
            }

            .typora-export #write {
                padding-left: 32px;
                padding-right: 32px;
                padding-bottom: 0px;
                break-after: avoid;
            }

            .typora-export #write::after {
                height: 0px;
            }

            @page {
                margin: 20mm 0px;
            }
        }

        .footnote-line {
            margin-top: 0.714em;
            font-size: 0.7em;
        }

        a img,
        img a {
            cursor: pointer;
        }

        pre.md-meta-block {
            font-size: 0.8rem;
            min-height: 0.8rem;
            white-space: pre-wrap;
            background: rgb(204, 204, 204);
            display: block;
            overflow-x: hidden;
        }

        p>.md-image:only-child:not(.md-img-error) img,
        p>img:only-child {
            display: block;
            margin: auto;
        }

        p>.md-image:only-child {
            display: inline-block;
            width: 100%;
        }

        #write .MathJax_Display {
            margin: 0.8em 0px 0px;
        }

        .md-math-block {
            width: 100%;
        }

        .md-math-block:not(:empty)::after {
            display: none;
        }

        [contenteditable="true"]:active,
        [contenteditable="true"]:focus {
            outline: 0px;
            box-shadow: none;
        }

        .md-task-list-item {
            position: relative;
            list-style-type: none;
        }

        .task-list-item.md-task-list-item {
            padding-left: 0px;
        }

        .md-task-list-item>input {
            position: absolute;
            top: 0px;
            left: 0px;
            margin-left: -1.2em;
            margin-top: calc(1em - 10px);
            border: none;
        }

        .math {
            font-size: 1rem;
        }

        .md-toc {
            min-height: 3.58rem;
            position: relative;
            font-size: 0.9rem;
            border-radius: 10px;
        }

        .md-toc-content {
            position: relative;
            margin-left: 0px;
        }

        .md-toc-content::after,
        .md-toc::after {
            display: none;
        }

        .md-toc-item {
            display: block;
            color: rgb(65, 131, 196);
        }

        .md-toc-item a {
            text-decoration: none;
        }

        .md-toc-inner:hover {
            text-decoration: underline;
        }

        .md-toc-inner {
            display: inline-block;
            cursor: pointer;
        }

        .md-toc-h1 .md-toc-inner {
            margin-left: 0px;
            font-weight: 700;
        }

        .md-toc-h2 .md-toc-inner {
            margin-left: 2em;
        }

        .md-toc-h3 .md-toc-inner {
            margin-left: 4em;
        }

        .md-toc-h4 .md-toc-inner {
            margin-left: 6em;
        }

        .md-toc-h5 .md-toc-inner {
            margin-left: 8em;
        }

        .md-toc-h6 .md-toc-inner {
            margin-left: 10em;
        }

        @media screen and (max-width: 48em) {
            .md-toc-h3 .md-toc-inner {
                margin-left: 3.5em;
            }

            .md-toc-h4 .md-toc-inner {
                margin-left: 5em;
            }

            .md-toc-h5 .md-toc-inner {
                margin-left: 6.5em;
            }

            .md-toc-h6 .md-toc-inner {
                margin-left: 8em;
            }
        }

        a.md-toc-inner {
            font-size: inherit;
            font-style: inherit;
            font-weight: inherit;
            line-height: inherit;
        }

        .footnote-line a:not(.reversefootnote) {
            color: inherit;
        }

        .md-attr {
            display: none;
        }

        .md-fn-count::after {
            content: ".";
        }

        code,
        pre,
        samp,
        tt {
            font-family: var(--monospace);
        }

        kbd {
            margin: 0px 0.1em;
            padding: 0.1em 0.6em;
            font-size: 0.8em;
            color: rgb(36, 39, 41);
            background: rgb(255, 255, 255);
            border: 1px solid rgb(173, 179, 185);
            border-radius: 3px;
            box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset;
            white-space: nowrap;
            vertical-align: middle;
        }

        .md-comment {
            color: rgb(162, 127, 3);
            opacity: 0.8;
            font-family: var(--monospace);
        }

        code {
            text-align: left;
            vertical-align: initial;
        }

        a.md-print-anchor {
            white-space: pre !important;
            border-width: initial !important;
            border-style: none !important;
            border-color: initial !important;
            display: inline-block !important;
            position: absolute !important;
            width: 1px !important;
            right: 0px !important;
            outline: 0px !important;
            background: 0px 0px !important;
            text-decoration: initial !important;
            text-shadow: initial !important;
        }

        .md-inline-math .MathJax_SVG .noError {
            display: none !important;
        }

        .html-for-mac .inline-math-svg .MathJax_SVG {
            vertical-align: 0.2px;
        }

        .md-math-block .MathJax_SVG_Display {
            text-align: center;
            margin: 0px;
            position: relative;
            text-indent: 0px;
            max-width: none;
            max-height: none;
            min-height: 0px;
            min-width: 100%;
            width: auto;
            overflow-y: hidden;
            display: block !important;
        }

        .MathJax_SVG_Display,
        .md-inline-math .MathJax_SVG_Display {
            width: auto;
            margin: inherit;
            display: inline-block !important;
        }

        .MathJax_SVG .MJX-monospace {
            font-family: var(--monospace);
        }

        .MathJax_SVG .MJX-sans-serif {
            font-family: sans-serif;
        }

        .MathJax_SVG {
            display: inline;
            font-style: normal;
            font-weight: 400;
            line-height: normal;
            zoom: 90%;
            text-indent: 0px;
            text-align: left;
            text-transform: none;
            letter-spacing: normal;
            word-spacing: normal;
            word-wrap: normal;
            white-space: nowrap;
            float: none;
            direction: ltr;
            max-width: none;
            max-height: none;
            min-width: 0px;
            min-height: 0px;
            border: 0px;
            padding: 0px;
            margin: 0px;
        }

        .MathJax_SVG * {
            transition: none;
        }

        .MathJax_SVG_Display svg {
            vertical-align: middle !important;
            margin-bottom: 0px !important;
        }

        .os-windows.monocolor-emoji .md-emoji {
            font-family: "Segoe UI Symbol", sans-serif;
        }

        .md-diagram-panel>svg {
            max-width: 100%;
        }

        [lang="mermaid"] svg,
        [lang="flow"] svg {
            max-width: 100%;
        }

        [lang="mermaid"] .node text {
            font-size: 1rem;
        }

        table tr th {
            border-bottom: 0px;
        }

        video {
            max-width: 100%;
            display: block;
            margin: 0px auto;
        }

        iframe {
            max-width: 100%;
            width: 100%;
            border: none;
        }

        .highlight td,
        .highlight tr {
            border: 0px;
        }


        .CodeMirror {
            height: auto;
        }

        .CodeMirror.cm-s-inner {
            background: inherit;
        }

        .CodeMirror-scroll {
            overflow-y: hidden;
            overflow-x: auto;
            z-index: 3;
        }

        .CodeMirror-gutter-filler,
        .CodeMirror-scrollbar-filler {
            background-color: rgb(255, 255, 255);
        }

        .CodeMirror-gutters {
            border-right: 1px solid rgb(221, 221, 221);
            background: inherit;
            white-space: nowrap;
        }

        .CodeMirror-linenumber {
            padding: 0px 3px 0px 5px;
            text-align: right;
            color: rgb(153, 153, 153);
        }

        .cm-s-inner .cm-keyword {
            color: rgb(119, 0, 136);
        }

        .cm-s-inner .cm-atom,
        .cm-s-inner.cm-atom {
            color: rgb(34, 17, 153);
        }

        .cm-s-inner .cm-number {
            color: rgb(17, 102, 68);
        }

        .cm-s-inner .cm-def {
            color: rgb(0, 0, 255);
        }

        .cm-s-inner .cm-variable {
            color: rgb(0, 0, 0);
        }

        .cm-s-inner .cm-variable-2 {
            color: rgb(0, 85, 170);
        }

        .cm-s-inner .cm-variable-3 {
            color: rgb(0, 136, 85);
        }

        .cm-s-inner .cm-string {
            color: rgb(170, 17, 17);
        }

        .cm-s-inner .cm-property {
            color: rgb(0, 0, 0);
        }

        .cm-s-inner .cm-operator {
            color: rgb(152, 26, 26);
        }

        .cm-s-inner .cm-comment,
        .cm-s-inner.cm-comment {
            color: rgb(170, 85, 0);
        }

        .cm-s-inner .cm-string-2 {
            color: rgb(255, 85, 0);
        }

        .cm-s-inner .cm-meta {
            color: rgb(85, 85, 85);
        }

        .cm-s-inner .cm-qualifier {
            color: rgb(85, 85, 85);
        }

        .cm-s-inner .cm-builtin {
            color: rgb(51, 0, 170);
        }

        .cm-s-inner .cm-bracket {
            color: rgb(153, 153, 119);
        }

        .cm-s-inner .cm-tag {
            color: rgb(17, 119, 0);
        }

        .cm-s-inner .cm-attribute {
            color: rgb(0, 0, 204);
        }

        .cm-s-inner .cm-header,
        .cm-s-inner.cm-header {
            color: rgb(0, 0, 255);
        }

        .cm-s-inner .cm-quote,
        .cm-s-inner.cm-quote {
            color: rgb(0, 153, 0);
        }

        .cm-s-inner .cm-hr,
        .cm-s-inner.cm-hr {
            color: rgb(153, 153, 153);
        }

        .cm-s-inner .cm-link,
        .cm-s-inner.cm-link {
            color: rgb(0, 0, 204);
        }

        .cm-negative {
            color: rgb(221, 68, 68);
        }

        .cm-positive {
            color: rgb(34, 153, 34);
        }

        .cm-header,
        .cm-strong {
            font-weight: 700;
        }

        .cm-del {
            text-decoration: line-through;
        }

        .cm-em {
            font-style: italic;
        }

        .cm-link {
            text-decoration: underline;
        }

        .cm-error {
            color: red;
        }

        .cm-invalidchar {
            color: red;
        }

        .cm-constant {
            color: rgb(38, 139, 210);
        }

        .cm-defined {
            color: rgb(181, 137, 0);
        }

        div.CodeMirror span.CodeMirror-matchingbracket {
            color: rgb(0, 255, 0);
        }

        div.CodeMirror span.CodeMirror-nonmatchingbracket {
            color: rgb(255, 34, 34);
        }

        .cm-s-inner .CodeMirror-activeline-background {
            background: inherit;
        }

        .CodeMirror {
            position: relative;
            overflow: hidden;
        }

        .CodeMirror-scroll {
            height: 100%;
            outline: 0px;
            position: relative;
            box-sizing: content-box;
            background: inherit;
        }

        .CodeMirror-sizer {
            position: relative;
        }

        .CodeMirror-gutter-filler,
        .CodeMirror-hscrollbar,
        .CodeMirror-scrollbar-filler,
        .CodeMirror-vscrollbar {
            position: absolute;
            z-index: 6;
            display: none;
        }

        .CodeMirror-vscrollbar {
            right: 0px;
            top: 0px;
            overflow: hidden;
        }

        .CodeMirror-hscrollbar {
            bottom: 0px;
            left: 0px;
            overflow: hidden;
        }

        .CodeMirror-scrollbar-filler {
            right: 0px;
            bottom: 0px;
        }

        .CodeMirror-gutter-filler {
            left: 0px;
            bottom: 0px;
        }

        .CodeMirror-gutters {
            position: absolute;
            left: 0px;
            top: 0px;
            padding-bottom: 30px;
            z-index: 3;
        }

        .CodeMirror-gutter {
            white-space: normal;
            height: 100%;
            box-sizing: content-box;
            padding-bottom: 30px;
            margin-bottom: -32px;
            display: inline-block;
        }

        .CodeMirror-gutter-wrapper {
            position: absolute;
            z-index: 4;
            background: 0px 0px !important;
            border: none !important;
        }

        .CodeMirror-gutter-background {
            position: absolute;
            top: 0px;
            bottom: 0px;
            z-index: 4;
        }

        .CodeMirror-gutter-elt {
            position: absolute;
            cursor: default;
            z-index: 4;
        }

        .CodeMirror-lines {
            cursor: text;
        }

        .CodeMirror pre {
            border-radius: 0px;
            border-width: 0px;
            background: 0px 0px;
            font-family: inherit;
            font-size: inherit;
            margin: 0px;
            white-space: pre;
            word-wrap: normal;
            color: inherit;
            z-index: 2;
            position: relative;
            overflow: visible;
        }

        .CodeMirror-wrap pre {
            word-wrap: break-word;
            white-space: pre-wrap;
            word-break: normal;
        }

        .CodeMirror-code pre {
            border-right: 30px solid transparent;
            width: fit-content;
        }

        .CodeMirror-wrap .CodeMirror-code pre {
            border-right: none;
            width: auto;
        }

        .CodeMirror-linebackground {
            position: absolute;
            left: 0px;
            right: 0px;
            top: 0px;
            bottom: 0px;
            z-index: 0;
        }

        .CodeMirror-linewidget {
            position: relative;
            z-index: 2;
            overflow: auto;
        }

        .CodeMirror-wrap .CodeMirror-scroll {
            overflow-x: hidden;
        }

        .CodeMirror-measure {
            position: absolute;
            width: 100%;
            height: 0px;
            overflow: hidden;
            visibility: hidden;
        }

        .CodeMirror-measure pre {
            position: static;
        }

        .CodeMirror div.CodeMirror-cursor {
            position: absolute;
            visibility: hidden;
            border-right: none;
            width: 0px;
        }

        .CodeMirror div.CodeMirror-cursor {
            visibility: hidden;
        }

        .CodeMirror-focused div.CodeMirror-cursor {
            visibility: inherit;
        }

        .cm-searching {
            background: rgba(255, 255, 0, 0.4);
        }

        @media print {
            .CodeMirror div.CodeMirror-cursor {
                visibility: hidden;
            }
        }


        :root {
            --side-bar-bg-color: #fafafa;
            --control-text-color: #777;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
            color: rgb(51, 51, 51);
            line-height: 1.6;
        }

        #write {
            max-width: 860px;
            margin: 0px auto;
            padding: 30px 30px 100px;
        }

        #write>ul:first-child,
        #write>ol:first-child {
            margin-top: 30px;
        }

        a {
            color: rgb(65, 131, 196);
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            position: relative;
            margin-top: 1rem;
            margin-bottom: 1rem;
            font-weight: bold;
            line-height: 1.4;
            cursor: text;
        }

        h1:hover a.anchor,
        h2:hover a.anchor,
        h3:hover a.anchor,
        h4:hover a.anchor,
        h5:hover a.anchor,
        h6:hover a.anchor {
            text-decoration: none;
        }

        h1 tt,
        h1 code {
            font-size: inherit;
        }

        h2 tt,
        h2 code {
            font-size: inherit;
        }

        h3 tt,
        h3 code {
            font-size: inherit;
        }

        h4 tt,
        h4 code {
            font-size: inherit;
        }

        h5 tt,
        h5 code {
            font-size: inherit;
        }

        h6 tt,
        h6 code {
            font-size: inherit;
        }

        h1 {
            padding-bottom: 0.3em;
            font-size: 2.25em;
            line-height: 1.2;
            border-bottom: 1px solid rgb(238, 238, 238);
        }

        h2 {
            padding-bottom: 0.3em;
            font-size: 1.75em;
            line-height: 1.225;
            border-bottom: 1px solid rgb(238, 238, 238);
        }

        h3 {
            font-size: 1.5em;
            line-height: 1.43;
        }

        h4 {
            font-size: 1.25em;
        }

        h5 {
            font-size: 1em;
        }

        h6 {
            font-size: 1em;
            color: rgb(119, 119, 119);
        }

        p,
        blockquote,
        ul,
        ol,
        dl,
        table {
            margin: 0.8em 0px;
        }

        li>ol,
        li>ul {
            margin: 0px;
        }

        hr {
            height: 2px;
            padding: 0px;
            margin: 16px 0px;
            background-color: rgb(231, 231, 231);
            border: 0px none;
            overflow: hidden;
            box-sizing: content-box;
        }

        li p.first {
            display: inline-block;
        }

        ul,
        ol {
            padding-left: 30px;
        }

        ul:first-child,
        ol:first-child {
            margin-top: 0px;
        }

        ul:last-child,
        ol:last-child {
            margin-bottom: 0px;
        }

        blockquote {
            border-left: 4px solid rgb(223, 226, 229);
            padding: 0px 15px;
            color: rgb(119, 119, 119);
        }

        blockquote blockquote {
            padding-right: 0px;
        }

        table {
            padding: 0px;
            word-break: initial;
        }

        table tr {
            border-top: 1px solid rgb(223, 226, 229);
            margin: 0px;
            padding: 0px;
        }

        table tr:nth-child(2n),
        thead {
            background-color: rgb(248, 248, 248);
        }

        table tr th {
            font-weight: bold;
            border-width: 1px 1px 0px;
            border-top-style: solid;
            border-right-style: solid;
            border-left-style: solid;
            border-top-color: rgb(223, 226, 229);
            border-right-color: rgb(223, 226, 229);
            border-left-color: rgb(223, 226, 229);
            border-image: initial;
            border-bottom-style: initial;
            border-bottom-color: initial;
            text-align: left;
            margin: 0px;
            padding: 6px 13px;
        }

        table tr td {
            border: 1px solid rgb(223, 226, 229);
            text-align: left;
            margin: 0px;
            padding: 6px 13px;
        }

        table tr th:first-child,
        table tr td:first-child {
            margin-top: 0px;
        }

        table tr th:last-child,
        table tr td:last-child {
            margin-bottom: 0px;
        }

        .CodeMirror-lines {
            padding-left: 4px;
        }

        .code-tooltip {
            box-shadow: rgba(0, 28, 36, 0.3) 0px 1px 1px 0px;
            border-top: 1px solid rgb(238, 242, 242);
        }

        .md-fences,
        code,
        tt {
            border: 1px solid rgb(231, 234, 237);
            background-color: rgb(248, 248, 248);
            border-radius: 3px;
            padding: 2px 4px 0px;
            font-size: 0.9em;
        }

        code {
            background-color: rgb(243, 244, 244);
            padding: 0px 2px;
        }

        .md-fences {
            margin-bottom: 15px;
            margin-top: 15px;
            padding-top: 8px;
            padding-bottom: 6px;
        }

        .md-task-list-item>input {
            margin-left: -1.3em;
        }

        @media print {
            html {
                font-size: 13px;
            }

            table,
            pre {
                break-inside: avoid;
            }

            pre {
                word-wrap: break-word;
            }
        }

        .md-fences {
            background-color: rgb(248, 248, 248);
        }

        #write pre.md-meta-block {
            padding: 1rem;
            font-size: 85%;
            line-height: 1.45;
            background-color: rgb(247, 247, 247);
            border: 0px;
            border-radius: 3px;
            color: rgb(119, 119, 119);
            margin-top: 0px !important;
        }

        .mathjax-block>.code-tooltip {
            bottom: 0.375rem;
        }

        .md-mathjax-midline {
            background: rgb(250, 250, 250);
        }

        #write>h3.md-focus::before {
            left: -1.5625rem;
            top: 0.375rem;
        }

        #write>h4.md-focus::before {
            left: -1.5625rem;
            top: 0.285714rem;
        }

        #write>h5.md-focus::before {
            left: -1.5625rem;
            top: 0.285714rem;
        }

        #write>h6.md-focus::before {
            left: -1.5625rem;
            top: 0.285714rem;
        }

        .md-image>.md-meta {
            border-radius: 3px;
            padding: 2px 0px 0px 4px;
            font-size: 0.9em;
            color: inherit;
        }

        .md-tag {
            color: rgb(167, 167, 167);
            opacity: 1;
        }

        .md-toc {
            margin-top: 20px;
            padding-bottom: 20px;
        }

        .sidebar-tabs {
            border-bottom: none;
        }

        #typora-quick-open {
            border: 1px solid rgb(221, 221, 221);
            background-color: rgb(248, 248, 248);
        }

        #typora-quick-open-item {
            background-color: rgb(250, 250, 250);
            border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238);
            border-style: solid;
            border-width: 1px;
        }

        .on-focus-mode blockquote {
            border-left-color: rgba(85, 85, 85, 0.12);
        }

        header,
        .context-menu,
        .megamenu-content,
        footer {
            font-family: "Segoe UI", Arial, sans-serif;
        }

        .file-node-content:hover .file-node-icon,
        .file-node-content:hover .file-node-open-state {
            visibility: visible;
        }

        .mac-seamless-mode #typora-sidebar {
            background-color: var(--side-bar-bg-color);
        }

        .md-lang {
            color: rgb(180, 101, 77);
        }

        .html-for-mac .context-menu {
            --item-hover-bg-color: #E6F0FE;
        }

        #md-notification .btn {
            border: 0px;
        }

        .dropdown-menu .divider {
            border-color: rgb(229, 229, 229);
        }





        .typora-export li,
        .typora-export p,
        .typora-export,
        .footnote-line {
            white-space: normal;
        }
    </style>
</head>

<body class='typora-export os-windows'>
    <div id='write' class='is-node'>
        <div style="position:fixed; top:0; left:0; margin:10px;">
            <div><a href="#contents">Back to contents</a></div>
            <div><a href="./code/source_code.html">Go to source</a></div>
        </div>
        <p>&nbsp;</p>
        <script>document.querySelector('html').style.scrollBehavior = "auto";</script>
        <div>
            <center>
                <h1 style="font-size: 2.5rem;">Coop Control</h1>
            </center>
            <center>
                <h5 style="opacity: 0.8;">Damon Sweeney &amp; Joanna Zhang</h5>
            </center>
        </div>
        <p>&nbsp;</p>
        <p><img src='images/title-image.png' alt='Coop Control Image' referrerPolicy='no-referrer' /></p>
        <p><a name="contents" class="contents" id="contents"></a></p>
        <p>
            <!-- START doctoc generated TOC please keep comment here to allow auto update -->
            <strong>Table of Contents</strong></p>
        <ul>
            <li>
                <p><a href='#header-n405'>Introduction</a></p>
                <ul>
                    <li>
                        <p><a href='#header-n407'>Problem Description</a></p>
                    </li>
                    <li>
                        <p><a href='#header-n412'>The Solution</a></p>
                        <ul>
                            <li>
                                <p><a href='#header-n418'>Modular network</a></p>
                                <ul>
                                    <li><a href='#header-n420'>Control Hub</a></li>
                                    <li><a href='#header-n422'>Drinker Level Monitor</a></li>
                                    <li><a href='#header-n424'>Air Condition Monitor</a></li>
                                    <li><a href='#header-n426'>Egg Identification</a></li>
                                    <li><a href='#header-n429'>Automated Coop Door</a></li>
                                    <li><a href='#header-n431'>Domain Specific Language</a></li>
                                </ul>
                            </li>
                            <li>
                                <p><a href='#header-n434'>Web Application</a></p>
                                <ul>
                                    <li><a href='#header-n435'>Control Hub Interface</a></li>
                                    <li><a href='#header-n437'>Current Data Display</a></li>
                                    <li><a href='#header-n439'>Historical Data Visualization</a></li>
                                    <li><a href='#header-n442'>Hub Code Editor</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <p><a href='#header-n446'>Timeline</a></p>
                    </li>
                    <li>
                        <p><a href='#header-n449'>Authors</a></p>
                    </li>
                    <li>
                        <p><a href='#header-n458'>Learning Experiences</a></p>
                    </li>
                    <li>
                        <p><a href='#header-n482'>Acknowledgements</a></p>
                    </li>
                </ul>
            </li>
            <li>
                <p><a href='#header-n516'>Project Retrospective</a></p>
                <ul>
                    <li>
                        <p><a href='#header-n518'>Roles Taken</a></p>
                        <ul>
                            <li><a href='#header-n521'>Research stage</a></li>
                            <li><a href='#header-n524'>Product development stage</a></li>
                            <li><a href='#header-n549'>Poster creation</a></li>
                            <li><a href='#header-n553'>Video creation</a></li>
                            <li><a href='#header-n556'>Technical report author</a></li>
                        </ul>
                    </li>
                    <li>
                        <p><a href='#header-n559'>Project Fair</a></p>
                    </li>
                    <li>
                        <p><a href='#header-n583'>Future Work</a></p>
                    </li>
                </ul>
            </li>
            <li>
                <p><a href='#header-n620'>Technical Details</a></p>
                <ul>
                    <li><a href='#header-n622'>Acronyms &amp; Keywords</a></li>
                    <li><a href='#header-n708'>Hard Technologies</a></li>
                    <li><a href='#header-n768'>Soft Technologies</a></li>
                </ul>
            </li>
            <li>
                <p><a href='#header-n825'>Software Engineering</a></p>
                <ul>
                    <li>
                        <p><a href='#header-n826'>Programming Methodology</a></p>
                        <ul>
                            <li><a href='#header-n828'>Paradigms and models</a></li>
                            <li><a href='#header-n856'>Methodologies</a></li>
                            <li><a href='#header-n887'>Practices</a></li>
                            <li><a href='#header-n892'>Our Methodology</a></li>
                            <li><a href='#header-n899'>Version Control</a></li>
                            <li><a href='#header-n904'>Documentation</a></li>
                        </ul>
                    </li>
                    <li>
                        <p><a href='#header-n907'>Testing</a></p>
                        <ul>
                            <li><a href='#header-n913'>Testing Plan</a></li>
                            <li><a href='#header-n962'>Future Work</a></li>
                        </ul>
                    </li>
                    <li>
                        <p><a href='#header-n972'>Animal Welfare</a></p>
                    </li>
                    <li>
                        <p><a href='#header-n975'>Minutes</a></p>
                        <ul>
                            <li><a href='#header-n977'>Date: 21/09/2018</a></li>
                            <li><a href='#header-n1040'>Date: 28/09/2018</a></li>
                            <li><a href='#header-n1075'>Date 02/10/2018</a></li>
                            <li><a href='#header-n1130'>Date 12/10/2018 ; 12:00 - 13:00</a></li>
                            <li><a href='#header-n1163'>Date 12/10/2018 ; 13:00 - 14:00</a></li>
                            <li><a href='#header-n1204'>Date 20/10/2018</a></li>
                            <li><a href='#header-n1219'>Date 26/10/2018</a></li>
                            <li><a href='#header-n1291'>Date 02/11/2018</a></li>
                            <li><a href='#header-n1387'>Date 04/11/2019 ; Emergency Meeting</a></li>
                            <li><a href='#header-n1423'>Date 09/11/2018</a></li>
                            <li><a href='#header-n1469'>Date 15/11/2018</a></li>
                            <li><a href='#header-n1484'>Date 16/11/2018</a></li>
                            <li><a href='#header-n1532'>Date 18/11/2018</a></li>
                            <li><a href='#header-n1547'>Date 22/11/2018</a></li>
                            <li><a href='#header-n1562'>Date 23/11/2018</a></li>
                            <li><a href='#header-n1620'>Date 29/11/2018</a></li>
                            <li><a href='#header-n1633'>Date 30/11/2018</a></li>
                            <li><a href='#header-n1668'>Date 07/12/2018 ; Cancelled</a></li>
                            <li><a href='#header-n1677'>Date 12/12/2018</a></li>
                            <li><a href='#header-n1690'>Date 13/12/2018</a></li>
                            <li><a href='#header-n1759'>Date 19/12/2018</a></li>
                            <li><a href='#header-n1800'>Date 23/12/2018 ; Over Instant Messenger</a></li>
                            <li><a href='#header-n1831'>Date 12/01/2019</a></li>
                            <li><a href='#header-n1853'>Date 18/01/2019</a></li>
                            <li><a href='#header-n1911'>Date 25/01/2019 ; Cancelled</a></li>
                            <li><a href='#header-n1916'>Date 31/01/2019</a></li>
                            <li><a href='#header-n1933'>Date 01/02/2019</a></li>
                            <li><a href='#header-n1971'>Date 07/02/2019</a></li>
                            <li><a href='#header-n1986'>Date 08/02/2019</a></li>
                            <li><a href='#header-n2070'>Date 15/02/2019 ; Cancelled</a></li>
                            <li><a href='#header-n2099'>Date 21/02/2019</a></li>
                            <li><a href='#header-n2116'>Date 22/02/2019</a></li>
                            <li><a href='#header-n2156'>Date 17/11/2019</a></li>
                            <li><a href='#header-n2171'>Date 01/03/2019</a></li>
                            <li><a href='#header-n2216'>Date 08/03/2019</a></li>
                            <li><a href='#header-n2239'>Date 13/03/2019</a></li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>
                <p><a href='#header-n2260'>Field Research</a></p>
                <ul>
                    <li><a href='#header-n2262'>Client Research</a></li>
                    <li><a href='#header-n2292'>Smallholder Interviews</a></li>
                    <li><a href='#header-n2377'>Interview Analysis</a></li>
                    <li><a href='#header-n2386'>Data Analysis</a></li>
                    <li><a href='#header-n2436'>Requirements</a></li>
                </ul>
            </li>
            <li>
                <p><a href='#header-n2481'>System Design Concepts</a></p>
            </li>
            <li>
                <p><a href='#header-n2516'>Modules</a></p>
                <ul>
                    <li>
                        <p><a href='#header-n2518'>Coop Door</a></p>
                        <ul>
                            <li><a href='#header-n2519'>Premise</a></li>
                            <li><a href='#header-n2526'>Final Iteration Overview</a></li>
                            <li><a href='#header-n2552'>Iteration 1 (Research)</a></li>
                            <li><a href='#header-n2630'>Iteration 2</a></li>
                            <li><a href='#header-n2713'>Iteration 3</a></li>
                            <li><a href='#header-n2754'>Iteration 4</a></li>
                            <li><a href='#header-n2772'>Final Iteration</a></li>
                            <li><a href='#header-n2808'>Known Issues</a></li>
                            <li><a href='#header-n583'>Future work</a></li>
                        </ul>
                    </li>
                    <li>
                        <p><a href='#header-n2847'>Coop Air Condition Sensors</a></p>
                        <ul>
                            <li><a href='#header-n2848'>Premise</a></li>
                            <li><a href='#header-n2854'>Final Iteration Overview</a></li>
                            <li><a href='#header-n2871'>Iteration 1 (Research)</a></li>
                            <li><a href='#header-n2879'>Iteration 2</a></li>
                            <li><a href='#header-n2890'>Iteration 3</a></li>
                            <li><a href='#header-n2895'>Final Iteration</a></li>
                            <li><a href='#header-n2913'>Known Issues</a></li>
                            <li><a href='#header-n2918'>Future Work</a></li>
                        </ul>
                    </li>
                    <li>
                        <p><a href='#header-n2921'>Egg Identification</a></p>
                        <ul>
                            <li><a href='#header-n2922'>Premise</a></li>
                            <li><a href='#header-n2926'>Final Iteration Overview</a></li>
                            <li><a href='#header-n2937'>Iteration 1 (Research)</a></li>
                            <li><a href='#header-n2945'>Iteration 2 (Building the NN)</a></li>
                            <li><a href='#header-n2960'>Iteration 3 (Training the Network)</a></li>
                            <li><a href='#header-n2988'>Iteration 4 (Client-server Architecture)</a>
                            </li>
                            <li><a href='#header-n3008'>Known Issues</a></li>
                            <li><a href='#header-n3012'>Future Work</a></li>
                        </ul>
                    </li>
                    <li>
                        <p><a href='#header-n3029'>Water Drinker Monitoring</a></p>
                        <ul>
                            <li><a href='#header-n3030'>Premise</a></li>
                            <li><a href='#header-n3034'>Final Iteration Overview</a></li>
                            <li><a href='#header-n3042'>Iteration 1 (Research)</a></li>
                            <li><a href='#header-n3051'>Iteration 2 (Implementation)</a></li>
                        </ul>
                    </li>
                    <li>
                        <p><a href='#header-n3058'>Chicken Location Tracking</a></p>
                        <ul>
                            <li><a href='#header-n3059'>Premise</a></li>
                            <li><a href='#header-n3063'>Final Iteration Overview</a></li>
                            <li><a href='#header-n3067'>Iteration 1 (Research)</a></li>
                            <li><a href='#header-n3087'>Iteration 2 - Using 4 Boards</a></li>
                            <li><a href='#header-n3091'>Iteration 3 - Final Solution</a></li>
                            <li><a href='#header-n3097'>Known Issues</a></li>
                            <li><a href='#header-n3101'>Future work</a></li>
                        </ul>
                    </li>
                    <li>
                        <p><a href='#header-n3105'>Control Hub</a></p>
                        <ul>
                            <li><a href='#header-n3106'>Premise</a></li>
                            <li><a href='#header-n3112'>Final Iteration Overview</a></li>
                            <li><a href='#header-n3122'>Iteration 1 (Research)</a></li>
                            <li><a href='#header-n3176'>Iteration 2 (Module Architecture)</a></li>
                            <li><a href='#header-n3187'>Iteration 3 (System Logger)</a></li>
                            <li><a href='#header-n3201'>Iteration 4 (CAN Interface)</a></li>
                            <li><a href='#header-n3224'>Iteration 5 (MQTT Interface)</a></li>
                            <li><a href='#header-n3232'>Iteration 6 (Network Devices)</a></li>
                            <li><a href='#header-n3283'>Iteration 7 (Database Service)</a></li>
                            <li><a href='#header-n3297'>Iteration 8 (REST Server)</a></li>
                            <li><a href='#header-n3317'>Iteration 9 (Main Controller)</a></li>
                            <li><a href='#header-n3322'>Iteration 10 (Language &amp; Actions)</a></li>
                            <li><a href='#header-n3339'>Known Issues</a></li>
                            <li><a href='#header-n3345'>Future Work</a></li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>
                <p><a href='#header-n3356'>System Database</a></p>
                <ul>
                    <li><a href='#header-n3358'>Research</a></li>
                    <li><a href='#header-n3362'>Structure</a></li>
                    <li><a href='#header-n3511'>Future Work</a></li>
                </ul>
            </li>
            <li>
                <p><a href='#header-n3541'>Networking</a></p>
                <ul>
                    <li><a href='#header-n3543'>Premise</a></li>
                    <li><a href='#header-n3548'>Final Iteration Overview</a></li>
                    <li><a href='#header-n3556'>Networking Requirements</a></li>
                    <li><a href='#header-n3564'>Module Networking</a></li>
                    <li><a href='#header-n3613'>ZigBee Networking</a></li>
                    <li><a href='#header-n3618'>CAN Bus Networking</a></li>
                    <li><a href='#header-n3750'>Hub Interface</a></li>
                    <li><a href='#header-n3758'>Known Issues</a></li>
                    <li><a href='#header-n3768'>Future Work</a></li>
                </ul>
            </li>
            <li>
                <p><a href='#header-n3778'>Domain Specific Language</a></p>
                <ul>
                    <li><a href='#header-n3780'>Premise</a></li>
                    <li><a href='#header-n3783'>Final Iteration Overview</a></li>
                    <li><a href='#header-n3788'>Iteration 1 (Research)</a></li>
                    <li><a href='#header-n3838'>Iteration 2 (Language Design)</a></li>
                    <li><a href='#header-n4052'>Iteration 3 (Implementation)</a></li>
                    <li><a href='#header-n4347'>Known Issues</a></li>
                    <li><a href='#header-n4356'>Future Work</a></li>
                </ul>
            </li>
            <li>
                <p><a href='#header-n4366'>Visualisation</a></p>
                <ul>
                    <li>
                        <p><a href='#header-n4368'>Web Server</a></p>
                        <p><a href='#header-n4423'>User Interface Design</a></p>
                        <ul>
                            <li><a href='#header-n4430'>Iteration 1 (Research)</a></li>
                            <li><a href='#header-n4524'>Iteration 2 (Mockups)</a></li>
                            <li><a href='#header-n4547'>Iteration 2</a></li>
                            <li><a href='#header-n4566'>Iteration 3</a></li>
                            <li><a href='#header-n4593'>Iteration 4</a></li>
                            <li><a href='#header-n4610'>Iteration 5</a></li>
                            <li><a href='#header-n4649'>Iteration 6</a></li>
                            <li><a href='#header-n4660'>Final Iteration</a></li>
                        </ul>
                    </li>
                    <li>
                        <p><a href='#header-n4695'>Historical Data</a></p>
                        <ul>
                            <li><a href='#header-n4701'>Line Graphs</a></li>
                            <li><a href='#header-n4717'>Timeline graphs</a></li>
                        </ul>
                    </li>
                    <li>
                        <p><a href='#header-n4729'>Role Based Authorization</a></p>
                    </li>
                    <li>
                        <p><a href='#header-n4761'>Language Interface</a></p>
                    </li>
                    <li>
                        <p><a href='#header-n4837'>Future Work</a></p>
                    </li>
                </ul>
            </li>
        </ul>
        <p>
            <!-- END doctoc generated TOC please keep comment here to allow auto update -->
            <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
        </p>
        <h2><a name='header-n405' class='md-header-anchor '></a>Introduction</h2>
        <h3><a name='header-n407' class='md-header-anchor '></a>Problem Description</h3>
        <p>Initially we were approached by the father of Kent alumni who was in search of a simplistic technical
            solution to automating the door of a chicken coop, his intentions were to use this to help guarantee the
            safety of the coop. To fully understand the problem domain we proceeded to conduct some background research
            into how other smallholders manage their poultry and concluded that a lot face hardships related to keeping
            them.</p>
        <p>From our research we found that the main problem smallholders face was still this act of ensuring that the
            chickens were let out in the morning and locked up at night, however we did note that a variety of other
            issues were faced. The issues described included: knowing if the flock had access to victuals, if eggs were
            present, ensuring that the air conditions inside the coop were optimal for the chickens&#39; health, among
            others.</p>
        <p>After performing market research into existing products we came to the conclusion that a gap existed for a
            new system or service that encompassed solutions to many of these problems. As such we have a built a modern
            technical solution that helps alleviate some of these burdens.</p>
        <h3><a name='header-n412' class='md-header-anchor '></a>The Solution</h3>
        <p>As the problems varied between each smallholder that we spoke with we decided it was best to build an
            extensible modular system, such that the solution could be later tailored to any given end user. </p>
        <p>Though we have built this system with expansion in mind, the scope of this project remains specifically built
            for the original client who approached us to build an automated door, Steve. After speaking with him about
            the research we had conducted with the other smallholders we came to the conclusion that he held interest in
            a system which incorporates an automated door, victual monitoring, air quality monitoring, electric fence
            voltage readings and egg presence detection.</p>
        <p>Out of the initial requirements Steve had for the project, we have managed to produce devices to monitor
            water drinker levels and air conditions, automate the coop door and to detect the presence of eggs. In
            relation to the monitoring of feed levels, Steve decided that this was not necessary as he preferred to feed
            them himself, stating &quot;I think it&#39;s important you need to interact with them&quot;. As for the
            electric fence voltage readings, we were unable to produce this device due to the health and safety concerns
            related to working with high voltages (3000v).</p>
        <p>The solution we have developed can be divided into two main components, the modular network of devices itself
            and the modern web application used to interface with it. The modular network is responsible for aggregating
            the data from the sensors and directly interacting with the coop itself. </p>
        <p>&nbsp;</p>
        <h4><a name='header-n418' class='md-header-anchor '></a>Modular network</h4>
        <h5><a name='header-n420' class='md-header-anchor '></a>Control Hub</h5>
        <p>The main device in this modular network is the control hub and its responsibility is to orchestrate the
            control of the other devices and insert received data into the database. This device provides a REST
            interface to allow other parts of the system to interact with it. As it stands the hub supports two types of
            device, those directly connected via CAN bus, and those connected wirelessly over Zigbee2MQTT.</p>
        <h5><a name='header-n422' class='md-header-anchor '></a>Drinker Level Monitor</h5>
        <p>The drinker monitor is a simple standalone device produced by Xiaomi. In normal operation it requires a
            Xiaomi proprietary bridge to see received data, however using a Node library we are able to extract this
            information and receive it using MQTT. This device reports when water level changes from high to low or vice
            versa. </p>
        <h5><a name='header-n424' class='md-header-anchor '></a>Air Condition Monitor</h5>
        <p>This sensor monitors temperature, humidity, pressure and dust particulate levels inside the coop. This device
            was custom built using an ATmega328P and off-the-shelf components for detecting conditions. This device is
            connected to the main hub via the CAN bus.</p>
        <h5><a name='header-n426' class='md-header-anchor '></a>Egg Identification</h5>
        <p>This device uses neural net image classification to detect the presence of eggs inside the coop. Due to the
            processing power required to predict this classification, a client server model has been produced. The
            device inside the coop captures an image of the nest box, and sends this to an authenticated REST server for
            processing. The REST server runs the neural net and uses GPU CUDA cores to speed up the processing. Once
            classification is complete the result is returned to the device in the coop in which proceeds to transmit
            this result to the main hub via the CAN bus.</p>
        <h5><a name='header-n429' class='md-header-anchor '></a>Automated Coop Door</h5>
        <p>The automated coop door can be controlled via three individual methods: automation, physical button presses
            and via the web application. The construction of this device consists of an ATmega328P, a photodiode and a
            real time clock (RTC). In automation mode, using these sensors, this device can detect when to open or close
            the coop door automatically. As for the button presses, when a physical button press is received, the door
            performs the action and sends the information about the state change to the hub. Alternatively, when a
            request is sent via the web application the hub acts as proxy and forwards this message to the door. All
            communication between the hub and the door is performed over the CAN bus. </p>
        <h5><a name='header-n431' class='md-header-anchor '></a>Domain Specific Language</h5>
        <p>A language has been created to allow the user more specific control of the network so that they are able to
            configure the system to their specific needs. This language provides three top level constructs: execute
            code on a given event (ON), execute code at a specific time of day (AT), or execute code at a fixed time
            interval (EVERY). As it stands, the actions the user is able to perform include controlling the automated
            door, sending email and sending SMS messages.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n434' class='md-header-anchor '></a>Web Application</h4>
        <h5><a name='header-n435' class='md-header-anchor '></a>Control Hub Interface</h5>
        <p>As a whole, the web application mainly acts as an interface to the main control hub and by proxy the modular
            network of sensors and devices. The user is able to see the operation of the network by viewing the system
            logs and interact with it through the means outlined below.</p>
        <h5><a name='header-n437' class='md-header-anchor '></a>Current Data Display</h5>
        <p>The main page of the web application displays the current state of the modular network, it shows readings
            from the automated door, water drinker monitor, air condition monitor and the egg identification module.
            This data is refreshed automatically every 30s or can be force refreshed by the user. </p>
        <h5><a name='header-n439' class='md-header-anchor '></a>Historical Data Visualization</h5>
        <p>This web application is a portal for viewing historical data stored within the database. The data for each
            sensor is displayed in corresponding graphs, such that the design is dependant on the kind of data being
            displayed.</p>
        <h5><a name='header-n442' class='md-header-anchor '></a>Hub Code Editor</h5>
        <p>The user is able to manage and edit multiple code snippets for the domain specific programmable language of
            the hub. The user can set an active snippet and maintain a set of alternative, inactive code snippets. </p>
        <p>&nbsp;</p>
        <h3><a name='header-n446' class='md-header-anchor '></a>Timeline</h3>
        <p><img src='images/introduction/timeline.png' alt='Timeline of project' referrerPolicy='no-referrer' /></p>
        <p>&nbsp;</p>
        <h3><a name='header-n449' class='md-header-anchor '></a>Authors</h3>
        <p>Damon and Joanna are two third year Computer Scientists interested in the Internet of Things with a focus on
            the communication between low level devices. They both started studying at the University of Kent at the
            start of the academic year in 2015, and both have a year worth of industry experience.</p>
        <p>&nbsp;</p>
        <blockquote>
            <p><em>My name is Damon Sweeney and I am an undergraduate Computer Scientist at the University of Kent. My
                    career in Computing started whilst I was at sixth form college and since then I have completed two
                    thirds of my degree, conducted research in the security of encrypted traffic of Internet of things
                    devices, and spent a year in industry. Whilst in industry I worked as a developer for a block-chain
                    startup called Arweave where I primarily programmed back-end system code in Erlang. In January of
                    2018 the company joined Techstars, one of the largest start up accelerator programs worldwide, and
                    as such I spent half a year living in Berlin connecting with the growing tech community.</em></p>
        </blockquote>
        <p>&nbsp;</p>
        <blockquote>
            <p><em>My name is Joanna Zhang and I am a final year student at the University of Kent. I am on the
                    committee for TinkerSoc and I have a years worth experience working in a small sized corporation
                    focusing on Web Development. During this placement I created an Angular application built on Umbraco
                    from scratch alongside creating Node applications to help display customer data. I learnt a wide
                    range of web skills, ranging from learning how to make web applications mobile responsive to writing
                    maintainable back-end code in C#. I am currently aiming to beat Budi, one of my lecturers, at
                    badminton before I finish my degree.</em></p>
        </blockquote>
        <p>&nbsp;</p>
        <h3><a name='header-n458' class='md-header-anchor '></a>Learning Experiences</h3>
        <p>This project provided many opportunities to learn new skills in areas that our degree does not explicitly
            cover, as well as reinforce some that it does. Below is a list of the key learning experiences we feel we
            have had throughout the duration of this project.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n461' class='md-header-anchor '></a>Building and debugging electronics</h4>
        <p>Though not directly Computer Science it was really interesting to gain insight into electronics and how to
            piece together a system from components. This is an area our degree does not cover in depth and we believe
            for this reason a lot of people are hesitant to pursue these types of projects.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n464' class='md-header-anchor '></a>Interfacing with low level hardware</h4>
        <p>Covered within the Internet of Things module, this project allowed us to continue to interact with low level
            hardware using C/C++. It&#39;s interesting to program in an environment where as a programmer you house a
            much greater list of concerns.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n467' class='md-header-anchor '></a>Building a Control Area Network (CAN)</h4>
        <p>Learning how to build a network using a robust communication protocol designed for cars, CAN bus. Setting up
            this network was one of the more difficult/time consuming tasks of the project, this was due to personal
            lack of experience as well as the sparse documentation available for interfacing a CAN module with a SOC.
        </p>
        <p>&nbsp;</p>
        <h4><a name='header-n470' class='md-header-anchor '></a>Role based authorisation using JWT</h4>
        <p>Learning how to communicate between client and server with role based authorisation using JSON web tokens
            (JWT).</p>
        <p>&nbsp;</p>
        <h4><a name='header-n473' class='md-header-anchor '></a>Designing and implementating a primitive language</h4>
        <p>Designing and implementing a simple language. This ranged from definining the syntax, that is the set of
            valid tokens, and the semantics, the rules for valid sentences within the language.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n476' class='md-header-anchor '></a>Performing image classification with AI</h4>
        <p>Using a pretrained neural net to perform image classification on a given set of classifiers.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n479' class='md-header-anchor '></a>Creating relevant data visualisations</h4>
        <p>Creating relevant data visualisations using modern web graphing libraries.</p>
        <p>&nbsp;</p>
        <h3><a name='header-n482' class='md-header-anchor '></a>Acknowledgements</h3>
        <p><strong>Daniel Knox</strong></p>
        <blockquote>
            <p><em>Thanks to Daniel Knox for providing support and excellent week to week discussion to keep us on
                    track. The advice given at the end of first term really helped us put the project into perspective
                    and push us towards achieving our goals.</em></p>
        </blockquote>
        <p>&nbsp;</p>
        <p><strong>Sally Fincher</strong></p>
        <blockquote>
            <p><em>Thanks to Sally Fincher for discussing the initial research and helping to frame the scope of the
                    project. In hindsight we are glad we took this advice on-board as we may have been a little too
                    ambitious in the early stages.</em></p>
        </blockquote>
        <p>&nbsp;</p>
        <p><strong>Keith Greenhow</strong></p>
        <blockquote>
            <p><em>A big thanks to Keith Greenhow for helping with the physical construction of all things pertaining to
                    the project as well as coming in to the Shed during his Christmas break. All it cost us was taking
                    him out to lunch!</em></p>
        </blockquote>
        <p>&nbsp;</p>
        <p><strong>Daniel Andrews</strong></p>
        <blockquote>
            <p><em>Massive thanks to Daniel Andrews for helping with electronics design and implementation, as well as
                    the continuous encouragement throughout the year.</em></p>
        </blockquote>
        <p>&nbsp;</p>
        <p><strong>Scott Owens</strong></p>
        <blockquote>
            <p><em>Thanks to Scott Owens for briefly discussing the intermediate representation of the domain specific
                    language of the system, ChickenLang, the advice given was sound and worked flawlessly.</em></p>
        </blockquote>
        <p>&nbsp;</p>
        <p><strong>Michael Berry</strong></p>
        <blockquote>
            <p><em>Thank you to Mike Berry who made himself available at all hours providing a variety of electronic
                    components and helping debug erroneous circuits, he did all this even with a child right around the
                    corner.</em></p>
        </blockquote>
        <p>&nbsp;</p>
        <p><strong>Elliot Carr</strong></p>
        <blockquote>
            <p><em>Thank you to Elliot Carr for discussing ideas related to the automated door and providing equipment
                    to get this implemented.</em></p>
        </blockquote>
        <p>&nbsp;</p>
        <p><strong>Simon Cooksey</strong></p>
        <blockquote>
            <p><em>Thank you to Simon Cooksey for helping attempt to debug the early demo implementation of the CAN bus
                    network as well as being available for discussion regarding the language implementation. It took far
                    too long to debug that CAN!</em></p>
        </blockquote>
        <p>&nbsp;</p>
        <p><strong>Drone Shepherd Group</strong></p>
        <blockquote>
            <p><em>We would to thank Marielle Valdez, Nicholas Bailey and Finlay Shepherd for providing healthy competition and
                motiviation throughout this project. 
            </em></p>
        </blockquote>
        <p>&nbsp;</p>
        <h2><a name='header-n516' class='md-header-anchor '></a>Project Retrospective</h2>
        <h3><a name='header-n518' class='md-header-anchor '></a>Roles Taken</h3>
        <p>Having a small development team to see this project through until fruition the line between fixed roles is
            somewhat blurred as resource was put towards what was required at the time. Though this was the case the
            next section will briefly outline who took lead on the specific sections of the project.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n521' class='md-header-anchor '></a>Research stage</h4>
        <p>At this stage as we were defining the scope and actual problem in which we were tackling, both of us made
            full effort to be part of this preliminary research. We both visited smallholders within the area and
            outlined the project together.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n524' class='md-header-anchor '></a>Product development stage</h4>
        <ul>
            <li>
                <p><strong>Automated coop door</strong></p>
                <p>The design of the physical hardware and frame used for the automated coop door was produced by Joanna
                    with help from Damon and a variety of different people outlined in the <a
                        href='#header-n482'>acknowledgements</a> of this document.</p>
                <p>Once the hardware was complete Joanna implemented the code behind the control of the automated door.
                </p>
            </li>
            <li>
                <p><strong>Air condition sensors</strong></p>
                <p>The air condition module was built and implemented by Joanna.</p>
            </li>
            <li>
                <p><strong>Egg identification module</strong></p>
                <p>The egg identification module was built and implemented by Damon.</p>
            </li>
            <li>
                <p><strong>Water level sensors</strong></p>
                <p>Both Damon and Joanna helped to implement the water level sensor, Joanna created the initial demo of
                    the device working and Damon attached it to the existing system.</p>
            </li>
            <li>
                <p><strong>Control hub</strong></p>
                <p>Damon took lead on the design and implementation of the main control hub due to his experience with
                    the creation of bespoke systems obtained from his placement.</p>
            </li>
            <li>
                <p><strong>Domain specific language</strong></p>
                <p>Being an extension, and quite closely tied, to the main control hub Damon took lead on the
                    development of the domain specific language, ChickenLang.</p>
            </li>
            <li>
                <p><strong>Web interface</strong></p>
                <p>The web interface was divided into two segments, initial design and implementation. In relation to
                    the initial design both Damon and Joanna helped define what content was required for the website and
                    what design methodologies were to be abided during its development. As for implementation this was
                    entirely performed by Joanna for her strong skills in development of modern web applications.</p>
            </li>
        </ul>
        <p>&nbsp;</p>
        <h4><a name='header-n549' class='md-header-anchor '></a>Poster creation</h4>
        <p>The bulk of the poster design was primarily done by Damon due to his background in graphic design and
            advertising, however inspiration was obtained from existing work in the school of computing. Iterations were
            produced with feedback from Joanna Zhang, Daniel Knox and Keith Greenhow.</p>
        <p>The content was written in tandem by both Damon and Joanna and critical feedback provided by Daniel Knox. The
            design was made using Adobe Photoshop.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n553' class='md-header-anchor '></a>Video creation</h4>
        <p>Joanna took the helm of creating the demonstrational video due to her past experience of using Sony Vegas
            video editing software. Damon assisted with the recording of the different segments and helped to story
            board the content being shown.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n556' class='md-header-anchor '></a>Technical report author</h4>
        <p>As this report is a technical overview of the entire system implementation it was written by both Damon and
            Joanna.</p>
        <p>&nbsp;</p>
        <h3><a name='header-n559' class='md-header-anchor '></a>Project Fair</h3>
        <p>At project fair we demonstrated what we had produced with a demo of the prototype hardware, a live feed of
            the partially implemented automated door at the clients premises, and an informational poster. We were
            presented with the prize of best at fair awarded by the Computer Science faculty; votes were given to
            lecturers, special guests and alumni. It was engaging to interact with colleagues and other bystanders who
            showed interest in our work, and it was inspiring to see the other projects presented.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n562' class='md-header-anchor '></a>Poster &amp; Display</h4>
        <p><img src='images/poster_fair/poster_compressed.png' alt='Coop Control Poster' referrerPolicy='no-referrer' />
        </p>
        <p><img src='images/poster_fair/table_setup.JPEG' alt='Display setup' referrerPolicy='no-referrer' /></p>
        <p><img src='images/poster_fair/team_photo.JPG' alt='Team Photo' referrerPolicy='no-referrer' /></p>
        <p><img src='images/poster_fair/device_placard.jpeg' alt='Placards for system devices'
                referrerPolicy='no-referrer' /></p>
        <p>&nbsp;</p>
        <h4><a name='header-n568' class='md-header-anchor '></a>Discussion &amp; Advice Received</h4>
        <p>Having a chance to speak to a lot of interesting people at the fair, many had ideas on how if we were to
            continue with this project it could be improved or potentially commercialized. A few of the major ideas
            discussed are listed below.</p>
        <p>&nbsp;</p>
        <ul>
            <li>
                <p><strong>Generalize the system</strong></p>
                <p>One gentleman presented the idea of instead of having a domain specific product, like chicken
                    management, generalize the underlying architecture and provide a platform for a range of different
                    ideas. He suggested making the language easily extensible and having defined packet structure for
                    the ZigBee and CAN bus devices, allowing for other developers to provide the application layer.</p>
            </li>
            <li>
                <p><strong>Improving Image Analysis</strong></p>
                <p>Discussed with one attendee was the idea of improving the image analysis module to not only recognise
                    the presence of an egg within the image, but also the number. We spoke about how this could be done
                    by either adding another post processing step after the neural net classification, or by retraining
                    the neural net to classify N number of eggs. With the retraining approach we did note that each
                    count would require a unique classification and as such a large quantity of training data would need
                    to be produced and a maximum bound set.</p>
            </li>
            <li>
                <p><strong>Automatic device identification</strong></p>
                <p>An idea we had already had was that of automatic device pairing and we spoke with an attendee about
                    how we could potentially implement this to the control hub. We spoke about how this could be done
                    easily with the CAN devices by updating the packet structure and adding a custom discovery protocol
                    to them; though we a had a little more issue with the wireless ZigBee devices. Due to the use of an
                    off-shelf solution for these wireless devices we are tied to their given output, as such to make
                    this improvement we would be required to produce our own hardware and then implement a similar
                    discovery protocol.</p>
            </li>
        </ul>
        <p>&nbsp;</p>
        <h3><a name='header-n583' class='md-header-anchor '></a>Future Work</h3>
        <p>Due to time constraints, and being a two man group, there were a few tasks that we would have liked to
            develop and explore if we had more time and resources.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n586' class='md-header-anchor '></a>Low Powered Solution</h4>
        <p>As our system was tailored to our client, we built a solution that did not take power consumption into
            consideration as our client had access to mains power within the coop. In contrary, the majority of
            smallholders we interviewed did not have access to mains power, therefore, research needs to be conducted
            into low powered solutions which would be run on batteries, if we want to tailor our system to the general
            smallholder market.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n589' class='md-header-anchor '></a>Integrate Emails with the Language</h4>
        <p>Currently, emails entered into the system are only stored in the database, nothing else is done with them.
            For future work, we would like to integrate the emails in the database with the language. For example, the
            code can specify a username to send emails to, and an email is then sent to the email addresses contained in
            the database pertaining to that user.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n592' class='md-header-anchor '></a>Power Cut Warning</h4>
        <p>As our solution is running off mains power, if there is a power cut, monitoring data will not be stored in
            the database, and the door will be unable to open or close. We thought up a solution that would be running
            on mains power with a backup battery. If the mains power went out, the module will still be able to send a
            text message to the client, notifying them of the power cut. </p>
        <p>&nbsp;</p>
        <h4><a name='header-n595' class='md-header-anchor '></a>Sensors</h4>
        <p>There were a few more sensors we would have liked to implement into our system if time and health and safety
            allowed.</p>
        <p>&nbsp;</p>
        <h5><a name='header-n598' class='md-header-anchor '></a>Electric Fence Monitor</h5>
        <p>The client asked for an electric fence monitor to detect when the voltage dropped below a certain threshold.
            Unfortunately, as this involved working with high voltages, we were unable to develop or prototype an idea
            for this solution due to health and safety.</p>
        <p>&nbsp;</p>
        <h5><a name='header-n601' class='md-header-anchor '></a>Live Camera Feed</h5>
        <p>A live camera feed could be added to the web interface so the client could double check the status of the
            door and keep an eye on their chickens remotely. </p>
        <p>&nbsp;</p>
        <h4><a name='header-n604' class='md-header-anchor '></a>Image Analysis</h4>
        <p>For future work, the image analysis of eggs can be improved in multiple ways. </p>
        <p>&nbsp;</p>
        <h5><a name='header-n607' class='md-header-anchor '></a>Count Eggs</h5>
        <p>During project fair, we were asked if our neural net would be able to count the number of eggs. At that time,
            our egg analyser was only able to detect the presence of eggs, not the quantity. Work would have to be done
            to add more classifications for each count of eggs, or another post processing step would need to be added
            to perform this operation. </p>
        <p>&nbsp;</p>
        <h5><a name='header-n610' class='md-header-anchor '></a>More Robust Image Analysis Classification</h5>
        <p>For future work, we would like to train the neural net with more data, allowing it to become more robust.
            During project fair, we realised our classification recognised foil wrapped chocolate eggs, luckily these
            are unlikely to be found inside the coop. For the scope of this project, we used approximately 400 training
            images: 200 containing eggs and 200 without. Before deploying this in the field, we would need to add more
            training data to ensure only eggs are recognised. </p>
        <p>&nbsp;</p>
        <h4><a name='header-n613' class='md-header-anchor '></a>Remove Zigbee2mqtt</h4>
        <p>Due to time constraints, we used a Node.js library named Zigbee2mqtt which allowed us to retrieve data from a
            Xiaomi Aqara Water sensor and publish it to a MQTT broker. In the future, we would like to have this code
            directly integrated into the hub. This could be done by either deconstructing the Xiaomi Aqara zigbee packet
            ourselves, or by building a bespoke, but equivalent sensor. </p>
        <p>&nbsp;</p>
        <h4><a name='header-n616' class='md-header-anchor '></a>Sensor pairing mechanism</h4>
        <p>To accommodate the smallholder market, we would need to have multiple devices which can be switched in and
            out to the needs of the user. To do this, we will need to develop a sensor pairing mechanism which will
            require changes to our packet structure. A custom discovery protocol will also need to be implemented,
            alongside changes to the web interface and the database to support this. The language will also require
            modification, so that the user can specify the specific device.</p>
        <p>&nbsp;</p>
        <h2><a name='header-n620' class='md-header-anchor '></a>Technical Details</h2>
        <h3><a name='header-n622' class='md-header-anchor '></a>Acronyms &amp; Keywords</h3>
        <p>Below is a list of the acronyms used within this document, please refer here for clarification.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n625' class='md-header-anchor '></a>CAN</h4>
        <p>Control Area Network: A robust vehicle communication standard.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n628' class='md-header-anchor '></a>MQTT</h4>
        <p>Message Queuing Telemetry Transport: A publish-subscribe message protocol.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n631' class='md-header-anchor '></a>GPIO</h4>
        <p>General Purpose Input/Output: A standard interface used to connect microcontroller to other hardware.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n634' class='md-header-anchor '></a>SPI</h4>
        <p>Serial Peripheral Interface: A synchronous serial communication interface bus. Used to send short distance
            data between devices.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n637' class='md-header-anchor '></a>RTC</h4>
        <p>Realtime Clock: A piece of hardwarae that keeps relatively accurate track of current time, often powered via
            an external battery as to keep time whilst the system is off.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n640' class='md-header-anchor '></a>SOC</h4>
        <p>System On a Chip: A small device in which incorporates all the components of a full computer onto a single
            PCB board.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n643' class='md-header-anchor '></a>BLE</h4>
        <p>Bluetooth Low Energy: A low powered variant of Bluetooth technology.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n646' class='md-header-anchor '></a>IEEE</h4>
        <p>Institute of Electrical and Electronics Engineers: Organization founded in 1963 comprised of students,
            working professionals and academics.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n649' class='md-header-anchor '></a>WiFI</h4>
        <p>Wireless Fidelity: Technology designed to allow for the &#39;internet&#39; to communicate without wires,
            incorporated by the IEEE.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n652' class='md-header-anchor '></a>RPM</h4>
        <p>Revolutions Per Minute: Total &#39;spins&#39; a motor spindle makes within a minute (within the context of
            the project).</p>
        <p>&nbsp;</p>
        <h4><a name='header-n655' class='md-header-anchor '></a>STD</h4>
        <p>Standard Library: A set of functions and classes which are part of the ISO standard for C++.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n658' class='md-header-anchor '></a>DAC</h4>
        <p>Digital-Analog Converter: Converts digital signal into analog signal.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n661' class='md-header-anchor '></a>ADC</h4>
        <p>Analog-Digital Converter: The reverse of DAC, this converts analog signal to digital signal. </p>
        <p>&nbsp;</p>
        <h4><a name='header-n664' class='md-header-anchor '></a>IDE</h4>
        <p>Integrated Development Environment: A piece of software that aids a programmer in software development,
            providing functionality such as a code editor, alongside build automation tools.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n667' class='md-header-anchor '></a>EEPROM</h4>
        <p>Electronically Erasable Programmable Read-Only Memory: A type of non-volatile memory which allows data to be
            erased reprogrammed. This has a limited number of times it can be rewritten.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n671' class='md-header-anchor '></a>DC</h4>
        <p>Direct Current: Provides a constant voltage or current, in contrast to alternating current which periodically
            reverses direction. Batteries are a good example of a direct current power supply.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n674' class='md-header-anchor '></a>IP Rating</h4>
        <p>International Protection Marking: This is a standard which classifies the degree of protection provided
            against solid particles such as dust and water. The first digit describes the degree of protection against
            solid particles, and the second against water. For example, IP68 means it is dust resistant and it can be
            &quot;immersed in 1.5 meters of freshwater for up to 30 minutes&quot;.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n678' class='md-header-anchor '></a>COTS</h4>
        <p>Commercial off-the-shelf: This is an adjective that describes hardware, or software, that is available to be
            purchased by the general public.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n682' class='md-header-anchor '></a>PCB</h4>
        <p>Printed Circuit Board: These are boards that have connections between electronical components using
            conductive tracks. </p>
        <p>&nbsp;</p>
        <h4><a name='header-n686' class='md-header-anchor '></a>UI</h4>
        <p>User Interface: This is place where interaction occurs between a user and a machine. </p>
        <p>&nbsp;</p>
        <h4><a name='header-n690' class='md-header-anchor '></a>PLC</h4>
        <p>Programmable Logic Controller: A solid state computer that monitors inputs and outputs and makes logic based
            decision dependent on these.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n693' class='md-header-anchor '></a>DSL</h4>
        <p>Domain Specific Language: A language built to solve a specific problem or operate within a given domain.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n696' class='md-header-anchor '></a>CFG</h4>
        <p>Context-free Grammar: A type of formal grammar that consists of a set of replacement production rules, the
            grammar describes a specific language via these.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n699' class='md-header-anchor '></a>RBAC</h4>
        <p>Role-based access control: This is a way to restrict access to certain parts of a system to specific
            authorized users. </p>
        <p>&nbsp;</p>
        <h4><a name='header-n702' class='md-header-anchor '></a>JWT</h4>
        <p>JSON Web Tokens: A standard for generating access tokens which declare a number of claims which are signed by
            one party. </p>
        <p>&nbsp;</p>
        <h4><a name='header-n705' class='md-header-anchor '></a>SQL</h4>
        <p>Structured Query Language: A domain specific language used for managing data stored in a database. </p>
        <p>&nbsp;</p>
        <h3><a name='header-n708' class='md-header-anchor '></a>Hard Technologies</h3>
        <p>Below is an abridged list of main hardware used within our project.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n711' class='md-header-anchor '></a>Arduino Uno</h4>
        <p>The Arduino Uno is a simple development board that allows easy interfacing with an ATmega238P
            microcontroller. Within our project we used Ardunio Uno to develop prototypes for both the automated door
            and air condition module.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n714' class='md-header-anchor '></a>Raspberry Pi 3 Model B</h4>
        <p>Originally intended to be Odroid C2, we opted to use a Raspberry Pi 3 Model B for the main control hub. Both
            these devices are small single-board computers with General Purpose Input-Output (GPIO) pins that allowed us
            to interface with other hardware.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n717' class='md-header-anchor '></a>Raspberry Pi Zero W</h4>
        <p>We chose to use Pi Zero W for the Water Sensor ZigBee receiver and the image analysis module. These are
            another single-board computer and we chose this specific device due to the cheap price point, the built in
            wireless capabilities and the fact we did not require high processing speed (1GHz).</p>
        <p>&nbsp;</p>
        <h4><a name='header-n720' class='md-header-anchor '></a>H-Bridge driver (L298N)</h4>
        <p>Used to help control the automated door, a H-Bridge driver was required to switch the polarity of the voltage
            applied allowing the motor to rotate clockwise or anticlockwise.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n723' class='md-header-anchor '></a>Stepper Motor driver (a4988)</h4>
        <p>Initially used in the early iterations of the coop door module, this driver is commonly found in 3D printers
            and is a favourite among driving stepper motors of various degrees. </p>
        <p>&nbsp;</p>
        <h4><a name='header-n726' class='md-header-anchor '></a>CAN Interface (MCP2515)</h4>
        <p>The MCP2515 CAN module was used within our system to interface with our physical CAN. The device itself can
            communicate across the CAN and speaks to the connected parent device over SPI. The devices that use the
            MCP2515 are: the automated door, the air condition monitor module, the main control hub and the image
            analysis module.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n729' class='md-header-anchor '></a>Air Condition Sensor (BME280)</h4>
        <p>The BME280 is an environmental sensor that reports temperature, humidity and pressure. It was used for the
            air condition monitoring module within the system.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n732' class='md-header-anchor '></a>Sharp Dust Sensor (GP2Y1010AU0F)</h4>
        <p>This device is an optical dust sensor developed by Sharp, it reports an estimate of the amount of
            particulates within the air. This sensor was used for the air condition monitoring module within the system.
        </p>
        <p>&nbsp;</p>
        <h4><a name='header-n735' class='md-header-anchor '></a>USB ZigBee Receiver (CC2531)</h4>
        <p>This device is a USB dongle that allows a PC to interface with 802.15.4 compliant devices, this includes
            ZigBee. Within our system we use this to receive messages from the external water sensor.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n738' class='md-header-anchor '></a>Xiaomi Aqara Smart Water Sensor</h4>
        <p>The Aqara Smart Water Sensor is a small wireless device that when in contact with water creates a connection
            between two pins and transmits a messages over ZigBee. This message states whether water is present or not;
            we use this device within the system to report when the water drinker level is low.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n741' class='md-header-anchor '></a>Logic Level Shifter Converter (3.3V - 5V)</h4>
        <p>This logic level converter is a simple device that either steps up a 3.3v input to a 5v output or vice versa.
            Within the system this device is used to connect the Raspberry Pi for the main control hub and the egg
            identification module to an MCP2515 CAN interface. This is required as a middleman between these devices as
            the Pi GPIO can tolerate up to 3.3v whereas the MCP2515 requires 5v for the transmitter.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n744' class='md-header-anchor '></a>Generic USB camera (5MP)</h4>
        <p>This generic USB camera appears on a Unix machine as a video device when connected. It is used within the
            system as the camera responsible for taking the picture of the coop for the egg identification module to
            handle.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n747' class='md-header-anchor '></a>Worm Gear Motor (Hilitand CKTMGB4Q2R-04 40RPM)</h4>
        <p>A worm gear motor is an electric motor that uses a screw gear to operate. A threaded screw is used and gear
            placed at a perpendicular angle on top of this, the motor turns the screw and this in turn rotates the gear.
            Due to sitting on a threaded screw if power is lost the gear itself cannot rotate backwards without the
            screw rotating. We have used this motor within the automated door.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n750' class='md-header-anchor '></a>NEMA17 Stepper Motor</h4>
        <p>Initially used in early iterations for the coop door module, commonly found in 3D printers and sporting a
            large thread extending from the spindle. Not all models are inclusive of this and various NEMAs exist, for
            the project we utilised the 17 variant.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n753' class='md-header-anchor '></a>Realtime Clock Module (DS1307)</h4>
        <p>Within the system a DS1307 real-time clock (RTC) module has been used to keep accurate time for the automated
            door. </p>
        <p>&nbsp;</p>
        <h4><a name='header-n756' class='md-header-anchor '></a>Hall Effect Sensor (KY-003)</h4>
        <p>A hall effect sensor is used to detect a magnetic field. Within the system this sensor in combination with
            neodymium magnets have been used to detect the position of the automated door; there is a hall effect sensor
            at the fully opened position and the fully closed.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n759' class='md-header-anchor '></a>Monolithic Photodiode (OTP101)</h4>
        <p>A photodiode is used to detect and report light levels. Within the system this sensor is used to detect this
            such that the automated door does not open through automation whilst still night time.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n762' class='md-header-anchor '></a>ESP32 Development Board</h4>
        <p>A low cost System On a Chip (SOC) used to prototype. Though not used in the produced product, these boards
            were used to create prototypes testing the feasability of tracking the rough location of chickens.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n765' class='md-header-anchor '></a>BLE Proximity Beacon (iBeacon compatible)</h4>
        <p>A simplistic Bluetooth Low Energy (BLE) Beacon that broadcasts a signal. These beacons can be used to detect
            approximate location and were used when prototyping chicken location tracking.</p>
        <p>&nbsp;</p>
        <h3><a name='header-n768' class='md-header-anchor '></a>Soft Technologies</h3>
        <p>Below is an abridged list of the main software used within our project.</p>
        <p>&nbsp;</p>
        <h4><a name='header-n771' class='md-header-anchor '></a>Python3</h4>
        <p>Python3 was the main language used to write the main control hub of the system, the corresponding REST web
            server and the image analysis module. A selection of libraries were used however the major ones are outlined
            below.</p>
        <p>&nbsp;</p>
        <h5><a name='header-n774' class='md-header-anchor '></a>Asyncio</h5>
        <p>One of the core libraries that dictated the architecture of the codebase for the given modules was asyncio,
            this module allows Python code to be written in asynchronous manner using the standard async/await syntax.
            Unlike modern languages like Erlang or Scala, Python is not inherently concurrent and as such requires a
            library to mimic this behavior. Asyncio provides a global event loop in which tasks, referred to as
            co-routines, can be added and executed. These tasks when being executed take hold of the python global
            interpreter and yield it upon completion or when a yielding call is made like an await or sleep. If the task
            yields its execution context is switched to another process for some amount of time.</p>
        <p>&nbsp;</p>
        <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"
            style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Asyncio control yielding example.</span></span></pre>
    </div>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Output:</span></span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &gt; "Finished print routine."</span></span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &gt; "Finished await routine."</span></span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &gt; "Finished sleep routine."</span></span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">asyncio</span>.<span class="cm-property">run</span>(<span class="cm-variable">await_routine</span>())</span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">async</span> <span class="cm-keyword">def</span> <span class="cm-def">await_routine</span>():</span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">asyncio</span>.<span class="cm-property">create_task</span>(<span class="cm-variable">sleep_routine</span>())</span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">await</span> <span class="cm-variable">print_routine</span>()</span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-builtin">print</span>(<span class="cm-string">"Finished await routine"</span>)</span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">async</span> <span class="cm-keyword">def</span> <span class="cm-def">sleep_routine</span>():</span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">await</span> <span class="cm-variable">asyncio</span>.<span class="cm-property">sleep</span>(<span class="cm-number">3</span>)</span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-builtin">print</span>(<span class="cm-string">"Finished sleep routine"</span>)</span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">async</span> <span class="cm-keyword">def</span> <span class="cm-def">print_routine</span>():</span></pre>
    <pre class=" CodeMirror-line "
        role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-builtin">print</span>(<span class="cm-string">"Finished print routine."</span>)</span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 460px;"></div>
    <div class="CodeMirror-gutters" style="display: none; height: 460px;"></div>
    </div>
    </div>
    </pre>
    <p>&nbsp;</p>
    <h5><a name='header-n779' class='md-header-anchor '></a>AIOHTTP</h5>
    <p>AIOHTTP was the library used to build the REST web server for the main hub, it is an asynchronous HTTP
        Client/Server built on top of the asyncio library. Though lightweight AIOHTTP has a host of useful features like
        middleware implementation and support for standard Python Web Server Gateway Interfaces (WSGI) like Gunicorn.
        Gunicorn is a top-level master thread that spins up N number of workers to handle incoming web requests.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n782' class='md-header-anchor '></a>HBMQTT</h5>
    <p>HBMQTT is an asyncio compliant MQTT client and broker library for python, it was used to interface with the
        Zigbee2MQTT water reading device.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n785' class='md-header-anchor '></a>Torch</h5>
    <p>Torch is an open-source machine learning library that was used for image classification within the system. The
        vgg16 pretrained neural net was used as a basis for the classifier and the last layers retrained to the specific
        requirements of the system.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n788' class='md-header-anchor '></a>Angular7</h4>
    <p>The web interface uses the JavaScript framework, Angular. Written in TypeScript, this component-based framework
        provides support for two-way data binding, observables, routing and guards. This framework has access to a wide
        variety of useful libraries, ranging from Angular Material for UI components to Google Charts.</p>
    <p>&nbsp;</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="typescript"
        style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="typescript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre>
    </div>
    <div class="CodeMirror-measure"></div>
    <div style="position: relative; z-index: 1;"></div>
    <div class="CodeMirror-code" role="presentation" style="">
        <div class="CodeMirror-activeline" style="position: relative;">
            <div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
            <div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
            <pre class=" CodeMirror-line "
                role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">* Example of Angular retrieving data from a service and displaying the object on the</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">* DOM via two-way binding.</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">*/</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> { <span class="cm-def">Component</span>, <span class="cm-def">OnInit</span>, <span class="cm-def">Input</span> } <span class="cm-keyword">from</span> <span class="cm-string">'@angular/core'</span>;</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> { <span class="cm-def">Data</span> } <span class="cm-keyword">from</span> <span class="cm-string">'../data'</span>;</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> { <span class="cm-def">DataService</span> } <span class="cm-keyword">from</span> <span class="cm-string">'../data.service'</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">@</span><span class="cm-variable">Component</span>({</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-property">selector</span>: <span class="cm-string">'example'</span>,</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-property">templateUrl</span>: <span class="cm-string">'./example.component.html'</span>,</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-property">styleUrls</span>: [<span class="cm-string">'./example.component.css'</span>]</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">export</span> <span class="cm-keyword">class</span> <span class="cm-def">ExampleComponent</span> <span class="cm-keyword">implements</span> <span class="cm-type">OnInit</span> {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-property">data</span>: <span class="cm-type">Data</span>;</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-property">constructor</span>(<span class="cm-keyword">private</span> <span class="cm-def">dataService</span>: <span class="cm-type">DataService</span>) { }</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/**</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-comment"><span class="cm-tab" role="presentation" cm-text="	">    </span>* This method is run when this component is created</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-comment"><span class="cm-tab" role="presentation" cm-text="	">    </span>* as it is implemented from OnInit.</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-comment"><span class="cm-tab" role="presentation" cm-text="	">    </span>*/</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-property">ngOnInit</span>() : <span class="cm-type">void</span> {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// Get data from the service.</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-property">dataService</span>.<span class="cm-property">getData</span>().<span class="cm-property">subscribe</span>(<span class="cm-def">result</span> <span class="cm-operator">=&gt;</span> {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-property">data</span> <span class="cm-operator">=</span> <span class="cm-variable-2">result</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  })</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 690px;"></div>
    <div class="CodeMirror-gutters" style="display: none; height: 690px;"></div>
    </div>
    </div>
    </pre>
    <p>&nbsp;</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded"
        lang="html"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="html"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre>
    </div>
    <div class="CodeMirror-measure"></div>
    <div style="position: relative; z-index: 1;"></div>
    <div class="CodeMirror-code" role="presentation" style="">
        <div class="CodeMirror-activeline" style="position: relative;">
            <div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
            <div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
            <pre class=" CodeMirror-line "
                role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">&lt;!-- Only show this section if data is defined --&gt;</span></span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">*ngIf</span>=<span class="cm-string">"data"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">&lt;!-- Display the property value of the data object --&gt;</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">h2</span><span class="cm-tag cm-bracket">&gt;</span>{{data.value}} is the value.<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">h2</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 161px;"></div>
    <div class="CodeMirror-gutters" style="display: none; height: 161px;"></div>
    </div>
    </div>
    </pre>
    <p>&nbsp;</p>
    <h5><a name='header-n795' class='md-header-anchor '></a>Angular Material</h5>
    <p>Angular Material is a library for Material Design components. Used throughout our application, this
        multifunctional, useful library provides UI elements that range from simple buttons, to the implementation of
        the sidenav.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n798' class='md-header-anchor '></a>Google Charts and Chart.js</h5>
    <p>Both these libraries are native JavaScript charting libraries, however, Open Source developers have provided
        Angular wrappers around these for easy integrations with Angular applications. Within our system these libraries
        are used for the visualization of historical data.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n801' class='md-header-anchor '></a>Node</h4>
    <p>Node is a modern JavaScript run-time environment that can operate outside of the scope of a browser. This allows
        us to leverage JavaScript as a server side language and as such we have used it to host the REST server of our
        web application.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n804' class='md-header-anchor '></a>Express.js</h5>
    <p>Express is a framework for Node.js and is used as the backend of our web interface. This fast framework provides
        support for middleware and database integration, allowing the front end to retrieve live real-time data.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n807' class='md-header-anchor '></a>JSON Web Tokens</h5>
    <p>JSON Web Tokens (JWT) are used to authenticate the user. Using a signed secret, this provides a means to securely
        share JSON between the backend and frontend. This is used to transfer sensitive data such as user role and name.
        All endpoints on our backend server that contain sensitive information require a valid up to date JWT to
        provided with each request.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n810' class='md-header-anchor '></a>PostgreSQL</h4>
    <p>PostgreSQL was chosen as the Database Management System (DBMS) for the project as it was easily available to use
        via the Computing departments hosted database server &#39;penguin&#39;. It should be noted that this could
        easily be swapped out to any reasonably SQL compliant DBMS.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n813' class='md-header-anchor '></a>Zigbee2MQTT</h4>
    <p>ZigBee2MQTT is an open-source software that bridges proprietary ZigBee devices like the Xiaomi range of smart
        home sensors to a standard MQTT interface. This allows us to use these off-the-shelf sensors within our project
        without having to build a complex interface to receive and parse their output.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n816' class='md-header-anchor '></a>Blender</h4>
    <p>Blender was used to produce the spindle model in which was 3D printed and used on the automated door.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n819' class='md-header-anchor '></a>Arduino IDE</h4>
    <p>The Arduino IDE was used to write the C/C++ code present on the automated door and air condition sensor due to
        its effortless integration with the Arduino hardware, as well as its simple debugging tools like the built-in
        serial monitor.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n822' class='md-header-anchor '></a>VS code</h4>
    <p>Due to the advanced shortcuts, integrated terminal and the wealth of available packages VS code was used as the
        editor of choice for developing the majority of the project. All languages used had syntax highlighting support
        and linters available.</p>
    <p>&nbsp;</p>
    <h2><a name='header-n825' class='md-header-anchor '></a>Software Engineering</h2>
    <h3><a name='header-n826' class='md-header-anchor '></a>Programming Methodology</h3>
    <h4><a name='header-n828' class='md-header-anchor '></a>Paradigms and models</h4>
    <h5><a name='header-n829' class='md-header-anchor '></a>Agile</h5>
    <p>Agile software development is a model. It is not a methodology, nor a framework or process, but rather a set of
        values and principles in which a team follow to develop software. The term was spread by the Manifesto for Agile
        Software Development. </p>
    <p>The manifesto claimed that it values:</p>
    <p>&nbsp;</p>
    <p><img src='images/software_engineering/agile.png' alt='agile manifesto' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>These values mean that processes and tools are noteworthy, however, it is more significant to have capable people
        working effectively together. Good documentation is also useful in understanding how the software works, yet the
        point of software development is to produce software, rather than documentation. In the industry, a contract is
        important, though working with your client as the requirements change is better for both parties. Finally, a
        good plan can be important, however, it should allow time to accommodate changes to the requirements,
        technologies or any other unexpected changes.</p>
    <p>Owing to the above, the Agile approach follows twelve core principles, which include continuous delivery,
        simplicity, short iterations and collaboration with the client.</p>
    <p>The drawbacks of this development style usually include a lack of predictability as requirements and technologies
        can change at any time. By embracing the Agile approach, developers will have to accept uncertainty in their
        methods over following a plan.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n839' class='md-header-anchor '></a>Waterfall Model</h5>
    <p>The Waterfall Model is a linear, sequential model and is one of the most traditional software development models.
        Rather than having an iterative or flexible approach, this model only allows progress in a single direction, and
        developers must complete one stage before moving onto the next. </p>
    <p>The model roughly follows six phases: requirement analysis, system design, implementation, testing, deployment
        and maintenance. Some variations diverge by adding or removing phases or returning to the design phase if the
        downstream phases were insufficient.</p>
    <p>This model is best used when there are no unclear requirements, and these are well documented and will not be
        changed in the future, these often involve small projects. The pitfalls are that it is very difficult to change
        something done in a previous stage and no working software is produced until late in the project timeline.</p>
    <p>&nbsp;</p>
    <p><img src='images/software_engineering/waterfall.png' alt='waterfall model' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <h5><a name='header-n846' class='md-header-anchor '></a>Spiral Model</h5>
    <p>The Spiral Model is a risk-driven complex model that aims to map and reduce the risks of the project early on.
        The model aims to combine iterative development with aspects of the waterfall model, which means prototypes will
        be created at each stage and requirements will be refined through each increment of the spiral. Each phase will
        be reviewed by the client in the end and developers should make decisions based on the level of risk and aim to
        lower this as much as possible.</p>
    <p>There are four main phases to the spiral model, which can vary depending on the project, but most include
        planning, risk analysis, engineering and evaluation.</p>
    <p>&nbsp;</p>
    <p><img src='images/software_engineering/spiral.png' alt='spiral model' referrerPolicy='no-referrer' /></p>
    <center><i>Spiral Model, Boehm 1988. Source:
            https://commons.wikimedia.org/wiki/File:Spiral_model_(Boehm,_1988).png</i></center>
    <p>&nbsp;</p>
    <p>This method is used when there is a budget constraint or for high risk projects. The advantages are that shifting
        requirements can be accommodated, and clients are able to see a wide variety of prototypes to feedback to.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n856' class='md-header-anchor '></a>Methodologies</h4>
    <h5><a name='header-n857' class='md-header-anchor '></a>Scrum Development</h5>
    <p>SCRUM is a popular agile framework which divides large projects into short two week “sprints”. At the start of
        the sprint, the team will hold a planning event which will help them agree on the tasks set out for them during
        the sprint and set up a backlog.</p>
    <p>There are three roles that a team member could be when using this methodology. </p>
    <p>The product owner embodies the stakeholders and clients. They manage the backlog and are focused on increasing
        the value of the software. They maintain a dialogue with the stakeholders and therefore focuses on the business
        aspect of the team. They usually produce user stories to aid the development team in the design of the software.
    </p>
    <p>The development team oversee delivering iterations at the end of every sprint. The size of this team varies on
        the complexity of the project but is usually three to nine members who focus on design, development and testing.
    </p>
    <p>Finally, we have the scrum master, who oversees the team. This can range from helping the team reach a consensus
        in the daily scrum, removing obstacles which impedes the team, to helping the team stay focused.</p>
    <p>During the sprint, the team will hold daily scrum meetings with specific guidelines. This means that the daily
        scrum will have to start precisely on time, even if some members are missing. The location and date cannot be
        changed at all, and the timeframe is limited to fifteen minutes. The team members will have to discuss their
        progress yesterday and the tasks needed to be done today. They should also point out any obstacle that could
        stop the team from achieving the sprint goal.</p>
    <p>At the end of the sprint, the entire team will review and hold a retrospective of the sprint. This entails
        reviewing the finished and incomplete work and demoing the completed work to the stakeholders. </p>
    <p>This methodology is cost and time effective and allows large projects to be split into manageable sprints,
        however, it can also lead to “scope creep” as there is no definite completion date. </p>
    <p>&nbsp;</p>
    <h5><a name='header-n867' class='md-header-anchor '></a>Kanban</h5>
    <p>Kanban is another agile methodology in which uses a tabularised approach to task management. The entire team
        share a common board (be it physical or online) of all the tasks required within the project. The tasks are
        organised under different categories that show their current state; the overarching categories are commonly
        backlog, active or complete, though each team will adapt this dependent on need, for example ‘In code review’ or
        other categories may be added. </p>
    <p>This approach is much looser than other forms of agile development and has a much smaller overhead. Work is
        pulled through in single piece flow unlike the specified fixed batches within SCRUM sprints. As work is
        considered in single file, changes can be made any time and continuous delivery can occur.</p>
    <p>Developers ‘pull’ in work when free and ‘push’ tasks through stages, this allows developers to work at their own
        pace on the tasks they feel comfortable completing. This approach though seeming ideal for adaptation and strong
        development does have some downsides, task starvation can occur if developers are not required to pop from the
        backlog in any given order and without common progress checks the timeline for the project can begin to drift.
    </p>
    <p>&nbsp;</p>
    <p><img src='images/software_engineering/kanban.png' alt='kanban board' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <center><i>Basic Kanban task board, Bossarro 2014. Source:
            https://commons.wikimedia.org/wiki/File:Basic-kanban-board.png</i></center>
    <p>&nbsp;</p>
    <h5><a name='header-n877' class='md-header-anchor '></a>Extreme Programming (XP)</h5>
    <p>Extreme programming is an agile methodology which hinges on the idea of short development cycles with constant
        deliveries. These methods are used to help aid productivity and allow room for the requirements to adapt between
        releases. Dependent on the stage of the project the release can be made available to the client to help ensure
        that their requirements are being met and that none had been missed from the initial specification.</p>
    <p>This methodology often relies heavily on pair programming, an agile practice, which has two developers working in
        tandem to write and review code simultaneously. The developer pair will take turns in acting as the driver, the
        coder, and the navigator, the reviewer. This pushes code quality, helps keep the system in a clean state and
        helps motivate the developers. </p>
    <p>Unfortunately, extreme programming does have downsides, firstly it is code centric, and it can be argued that the
        design of the software is largely ignored unless vigorous planning is done. Secondly as the methodology relies
        on quick iterations and potentially rapidly changing constraints it is not unlikely that initial releases of the
        software will contain bugs. For the reasons stated above this practice can require a lot of refactoring and
        therefore has the potential to be largely time consuming. </p>
    <p>If the extreme programming methodology is used extra care should be taken to ensure that the system built not
        only matches the initial and new requirements specified by the client but performs in a stable and reliable
        manner. This can be assured via a relatively verbose testing regime.</p>
    <p>&nbsp;</p>
    <p><img src='images/software_engineering/XP.png' alt='extreme programming' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <center><i>Extreme Programming, DonWells 2013. Source:
            https://commons.wikimedia.org/wiki/File:Extreme_Programming.svg </i></center>
    <p>&nbsp;</p>
    <h4><a name='header-n887' class='md-header-anchor '></a>Practices</h4>
    <h5><a name='header-n888' class='md-header-anchor '></a>Test-Driven Development (TDD)</h5>
    <p>Test-driven development is related to agile and extreme programming. This practice means that developers will
        need to write failing tests before writing production code. They will then need to write the code to pass these
        tests and repeat the process again.</p>
    <p>The benefits of following this practice will make the code more modular. This is because small tests are written
        each time and code will be written around these. This can also provide better documentation for your code as the
        tests are constantly running and changing, whereas documentation can be neglected and could go stale. Drawbacks
        include maintaining the test suite and some tests can be hard to write. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n892' class='md-header-anchor '></a>Our Methodology</h4>
    <p>We have decided to approach the solution with an agile methodology, using aspects from Extreme programming and
        Kanban. As the team is small, with two group members, methodologies such as scrum and waterfall have too much
        overhead. The waterfall model is catered to an engineering project where the requirements are very strict and
        only allow for very slight fluctuations in the requirements, whereas the requirements for this project could
        very well change. </p>
    <p>However, due to the size of the project and team, we will not use the pair programming approach found in Extreme
        Programming, instead we will use code reviews. This will be more time efficient as both members can concentrate
        efforts on different parts of the project whilst reducing the chance of bugs within our code. From Kanban, we
        will be using task boards to track work. These will be shared between team members.</p>
    <p>This approach will allow the team to embrace the changing requirements of the client, alongside producing rapid
        iterations and prototypes which means there is a fast proof of concept for the client.</p>
    <p>&nbsp;</p>
    <p><img src='images/software_engineering/code_review.png' alt='code review' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <h4><a name='header-n899' class='md-header-anchor '></a>Version Control</h4>
    <p>For our project, we have opted to use GitHub to keep track of our source code. We will work in separate branches
        and only code that has been reviewed is able to be merged into the master branch. Below is a list of our working
        branches:</p>
    <p>&nbsp;</p>
    <p><img src='images/software_engineering/branches.png' alt='branches' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <h4><a name='header-n904' class='md-header-anchor '></a>Documentation</h4>
    <p>We have both agreed to document our code where appropriate. The relevant documentation API should be used
        pertaining to the language. For example, PyDoc for Python and JSDoc for JavaScript.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n907' class='md-header-anchor '></a>Testing</h3>
    <p>Throughout the project, manual and regression testing was conducted to aim to minimize the defects and errors in
        our code. </p>
    <p>Black box testing was conducted on the REST endpoints of the hub, making sure that the value received is correct,
        alongside only allowing authorized access to information.</p>
    <p>Due to time limitations and limited man power, manual testing was conducted on the web interface rather than
        setting up an automated testing framework such as Nightwatch.js using Selenium.</p>
    <p>After we designed the architecture of our system, we created a testing plan of affected components. This plan is
        then used if a major changed happened to any component.</p>
    <h4><a name='header-n913' class='md-header-anchor '></a>Testing Plan</h4>
    <p><strong>Changes made on Hub</strong></p>
    <ul>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled' />
            <p>Check data received on all modules</p>
        </li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled' />
            <p>Check REST endpoints</p>
        </li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled' />
            <p>Check Web Interface displays correct data</p>
        </li>
    </ul>
    <p>&nbsp;</p>
    <p><strong>Air Condition Sensors</strong></p>
    <ul>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled' />
            <p>Check if hub receives correctly formatted data</p>
        </li>
    </ul>
    <p>&nbsp;</p>
    <p><strong>Door</strong></p>
    <ul>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled' />
            <p>Check if hub receives correctly formatted data</p>
        </li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled' />
            <p>Check if hub can still control door</p>
        </li>
    </ul>
    <p>&nbsp;</p>
    <p><strong>Water Sensor</strong></p>
    <ul>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled' />
            <p>Check if hub receives correctly formatted data</p>
        </li>
    </ul>
    <p>&nbsp;</p>
    <p><strong>Interpreted Language</strong></p>
    <ul>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled' />
            <p>Check integration with hub</p>
        </li>
    </ul>
    <p>&nbsp;</p>
    <p><strong>Database</strong></p>
    <ul>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled' />
            <p>Check if Hub can successfully add data</p>
        </li>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled' />
            <p>Check if Web Interface can successfully retrieve and manipulate data</p>
        </li>
    </ul>
    <p>&nbsp;</p>
    <p><strong>Networking</strong></p>
    <ul>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled' />
            <p>Check if hub receives correctly formatted data</p>
        </li>
    </ul>
    <p>&nbsp;</p>
    <p><strong>Web Interface</strong></p>
    <ul>
        <li class='md-task-list-item task-list-item task-list-not-done'><input type='checkbox' disabled='disabled' />
            <p>Manual testing of the specific component changed on the web interface</p>
        </li>
    </ul>
    <p>&nbsp;</p>
    <h4><a name='header-n962' class='md-header-anchor '></a>Future Work</h4>
    <p>There are many improvements that can be made to our testing strategy. </p>
    <p>&nbsp;</p>
    <h5><a name='header-n965' class='md-header-anchor '></a>Unit Tests</h5>
    <p>Owing to the limitation of the team size, and the client not explicitly specifying a testing scheme, we opted not
        to go down the unit testing route due to time constraints. Had we had more team members or time, we would have
        opted to do more thorough testing, which includes using a Unit test framework. The reason this approach would
        have been so time consuming is due to the fact that the majority of our code base is network code, mocks would
        have had to be created for each module.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n969' class='md-header-anchor '></a>Automated Testing</h5>
    <p>Future work will need to be done to automate testing of the web interface. This could involve using testing
        frameworks such as Nightwatch.js to achieve this.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n972' class='md-header-anchor '></a>Animal Welfare</h3>
    <p>Due to the scope of this project requiring interaction with poultry we have made ourselves aware of the potential
        legislation pertaining to working with or around animals. As the project involves no direct participation from
        the animals themselves the only act directly applicable to us is the &#39;<a
            href='http://www.legislation.gov.uk/ukpga/2006/45/contents'>Animal Welfare Act 2006</a>&#39;. The premise of
        this legislation is to guarantee that all reasonable steps are taken whilst we are in contact with the animals
        to ensure that their needs are met. In regards to chickens these needs include, access to victuals such us food
        and water, not being subject to unnecessary distress, and not being put in danger.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n975' class='md-header-anchor '></a>Minutes</h3>
    <h4><a name='header-n977' class='md-header-anchor '></a>Date: 21/09/2018</h4>
    <h5><a name='header-n978' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Daniel Knox</li>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
        <li>Keith Greenhow</li>
    </ul>
    <h5><a name='header-n988' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>No previous meeting.</p>
    <h5><a name='header-n990' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Joanna + Damon:</p>
    <ul>
        <li>Write client questions</li>
        <li>Research into Systems Engineering</li>
        <li>Set Up GitHub</li>
        <li>Research background of owning chickens</li>
    </ul>
    <h5><a name='header-n1001' class='md-header-anchor '></a>Further Discussion:</h5>
    <p>Discussed software engineering strategies to use in this project</p>
    <ul>
        <li>Extreme Programming</li>
        <li>Pair Programming</li>
        <li>SCRUM</li>
        <li>Waterfall --&gt; System of hardware</li>
    </ul>
    <p>Briefly discussed the Viva, and how they are going to assess us</p>
    <p>Document ALL major design decisions</p>
    <p>Will probably use GitHub for version control</p>
    <p>Discussed client questions:</p>
    <ul>
        <li>Overview of poultry - Daily/Weekly/Monthly (times)</li>
        <li>Risks associated</li>
        <li>Research background of owning chickens (YouTube)</li>
        <li>Prompts</li>
        <li>Location</li>
        <li>Process</li>
        <li>What makes life easier (conduct on site)</li>
        <li>Asks similar clients (ducks, geese, etc)</li>
        <li>Modifications available</li>
        <li>Features &amp; risk proposal (don&#39;t commit to client)</li>
    </ul>
    <p>Discuss set date to meet every week (Fridays 1-2)</p>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1040' class='md-header-anchor '></a>Date: 28/09/2018</h4>
    <h5><a name='header-n1041' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Daniel Knox</li>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
        <li>Keith Greenhow</li>
    </ul>
    <h5><a name='header-n1051' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Joanna + Damon:</p>
    <ul>
        <li>Finished and showed client questions to Dan Knox</li>
    </ul>
    <h5><a name='header-n1056' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Joanna + Damon:</p>
    <ul>
        <li>Conduct client and smallholder interview</li>
    </ul>
    <h5><a name='header-n1061' class='md-header-anchor '></a>Further Discussion:</h5>
    <ul>
        <li>Talked through client questions - do not use leading questions</li>
        <li>Take lots of pictures in the interview</li>
        <li>Make sure to do WiFi/Cellular tests</li>
        <li>Talked about the complexity of the project</li>
        <li>Potentially another group member so hadn&#39;t decided on programming methodology</li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1075' class='md-header-anchor '></a>Date 02/10/2018</h4>
    <h5><a name='header-n1076' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Daniel Knox</li>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
        <li>Keith Greenhow</li>
    </ul>
    <h5><a name='header-n1086' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Joanna + Damon:</p>
    <ul>
        <li>Client and smallholder interview done</li>
    </ul>
    <h5><a name='header-n1091' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Joanna + Damon:</p>
    <ul>
        <li>Type up transcripts from all 5 interviews</li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>Start creating backlog</li>
    </ul>
    <p>Joanna:</p>
    <ul>
        <li>Start looking at existing solutions</li>
        <li>Screenshots of interesting things at the interview annotated</li>
    </ul>
    <h5><a name='header-n1106' class='md-header-anchor '></a>Further Discussion:</h5>
    <p>Client is a hobbyist but needs vary dependent on the location, people need sudo bespoke solutions hence a modular
        system might be the best route to go.</p>
    <p>Talked about:</p>
    <ul>
        <li>Beehive automated modular systems</li>
        <li>Smart homes</li>
        <li>Central coordinator to system</li>
        <li>Heat, Doors, Light, Temperature</li>
        <li>APEX fusion coral reefing (ladder logic type programming)</li>
        <li>Power consumption issues</li>
        <li>MQTT</li>
        <li>IFTTT</li>
        <li>Wizards to building conditional logic</li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1130' class='md-header-anchor '></a>Date 12/10/2018 ; 12:00 - 13:00</h4>
    <h5><a name='header-n1131' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
        <li>Sally Fincher</li>
    </ul>
    <h5><a name='header-n1139' class='md-header-anchor '></a>Discussion:</h5>
    <ul>
        <li>
            <p>Interviewing techniques and recommended reading:</p>
            <ul>
                <li>Interviewing Users: How to uncover compelling insights: Steve Portigal</li>
            </ul>
        </li>
        <li>
            <p>Discussed process for mapping multiple interviews into single dataset</p>
            <ul>
                <li>Bucket / Matrix analysis</li>
            </ul>
        </li>
        <li>
            <p>Recommended to stick with hobbyists/enthusiasts, avoiding commercial farms. Completely different
                ballpark, one lost chicken does not matter in a commercial farm. </p>
        </li>
        <li>
            <p>Focus on chickens instead of other poultry (i.e. ducks) as they have very different behaviours and
                requirements</p>
        </li>
        <li>
            <p>&quot;Hobbyists know their chickens one by one &quot; - Sally Fincher</p>
        </li>
        <li>
            <p>&quot;Hobbyists care more so for the welfare of their livestock, consider looking into illness, injury
                etc.&quot; - Sally Fincher</p>
        </li>
        <li>
            <p>Research using heat sensors to monitor chickens (Sally kept chickens and were told they generated a lot
                of heat, even in the winter.)</p>
        </li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1163' class='md-header-anchor '></a>Date 12/10/2018 ; 13:00 - 14:00</h4>
    <h5><a name='header-n1164' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
        <li>Daniel Knox</li>
    </ul>
    <h5><a name='header-n1172' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Joanna:</p>
    <ul>
        <li>Researched into existing products</li>
        <li>Wrote up some transcripts</li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>Created backlog on Trello</li>
        <li>Wrote up some transcripts</li>
    </ul>
    <h5><a name='header-n1185' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Joanna + Damon:</p>
    <ul>
        <li>Continue writing up the last of the transcripts</li>
        <li>Create rough plan of system</li>
    </ul>
    <h5><a name='header-n1192' class='md-header-anchor '></a>Further Discussion:</h5>
    <ul>
        <li>Discussed minutes mentioned with Sally Fincher</li>
        <li>Talked about fail safes in our system</li>
        <li>Showed Dan Knox our Trello Board</li>
        <li>Discussed similar products</li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1204' class='md-header-anchor '></a>Date 20/10/2018</h4>
    <h5><a name='header-n1205' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <h5><a name='header-n1211' class='md-header-anchor '></a>Discussion:</h5>
    <ul>
        <li>Discussed rough plan of system as no requirements have been solidified yet</li>
        <li>Draw up rough plan of system as no requirements have been solidified yet</li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1219' class='md-header-anchor '></a>Date 26/10/2018</h4>
    <h5><a name='header-n1220' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
        <li>Daniel Knox</li>
    </ul>
    <h5><a name='header-n1228' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Joanna + Damon:</p>
    <ul>
        <li>Rough plan of potential system as no requirements have been solidified yet</li>
    </ul>
    <p>Joanna:</p>
    <ul>
        <li>Conclusive Analysis of interviews</li>
    </ul>
    <h5><a name='header-n1237' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Joanna + Damon:</p>
    <ul>
        <li>Research into CONOPS</li>
    </ul>
    <p>Joanna:</p>
    <ul>
        <li>Conclusive Analysis</li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>Tabulating research data</li>
    </ul>
    <h5><a name='header-n1250' class='md-header-anchor '></a>Further Discussion:</h5>
    <ul>
        <li>
            <p>Specifically look into the V model</p>
        </li>
        <li>
            <p>Rough plan of system:</p>
            <ul>
                <li>
                    <p>More of a breakdown</p>
                    <ul>
                        <li>Add failsafe</li>
                        <li>APEX has failsafe</li>
                        <li>then what technologies meet these needs</li>
                    </ul>
                </li>
            </ul>
        </li>
        <li>
            <p>Weatherproofing:</p>
            <ul>
                <li>IP rating</li>
                <li>cases</li>
                <li>What about if a user wants to hosepipe the run to get rid of mites?</li>
                <li>Driploop</li>
            </ul>
        </li>
        <li>
            <p>Power issue:</p>
            <ul>
                <li>
                    <p>User requirements, electric fence / big batteries</p>
                    <ul>
                        <li>Normally run on AA</li>
                        <li>additional things might need to take external battery source</li>
                        <li>APEX documentation says, if you want to do x, then you need to do y</li>
                    </ul>
                    <p>&nbsp;</p>
                </li>
            </ul>
        </li>
    </ul>
    <hr />
    <h4><a name='header-n1291' class='md-header-anchor '></a>Date 02/11/2018</h4>
    <h5><a name='header-n1292' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
        <li>Daniel Knox</li>
    </ul>
    <h5><a name='header-n1300' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Damon + Joanna:</p>
    <ul>
        <li>Finished Programming Methodology Documentation</li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>Tabularized research data</li>
    </ul>
    <p>Joanna:</p>
    <ul>
        <li>Finish conclusive analysis</li>
    </ul>
    <h5><a name='header-n1313' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Damon + Joanna:</p>
    <ul>
        <li>Requirements document</li>
        <li>Building these components and evaluating against other components</li>
    </ul>
    <h5><a name='header-n1320' class='md-header-anchor '></a>Further Discussion:</h5>
    <p>Discussed the project end goals.</p>
    <p>Discussed CONOPS stakeholder document: who are the people who express an interest in this system and what their
        interests are.</p>
    <ul>
        <li>Stakeholder is the customer but can also be someone managing the system for them</li>
    </ul>
    <p>Overall constraints of the system:</p>
    <ul>
        <li>Agreement from people for this is what they expect to resolve the conflict. e.g. A doesn&#39;t want B, but B
            doesn&#39;t want A.</li>
        <li>What policies exist - field testing before they accept it. Need to know policy ahead.</li>
        <li>Wireless technologies - laws of what the device can do? Laws that affect the upkeep of chickens. (e.g
            Automated slaughter 5000, if not killed in a way specified by the environmental agency, you will get in
            trouble)</li>
        <li>What different things can affect your system?</li>
    </ul>
    <p>Responsibilities - who maintains this thing and what parts of these things. Is it all on Dan&#39;s parents or is
        there continued support?</p>
    <p>Functional Requirements: </p>
    <ul>
        <li>What do they want to monitor and check what things are realistic and not realistic (timeframe) setting out
            with client or clients, is it of use. If they don&#39;t have this thing, will they reject it?</li>
        <li>Battleship needs to float, have cannons, anti-aircraft/submarine, communications and radar. Don&#39;t end up
            in a situation where it&#39;s &quot;that&#39;s not what I wanted&quot;. </li>
        <li>Would the user even care for this requirement?</li>
        <li>Negotiate which modular attachments are most popular. Get them to agree on paper - a real contract.</li>
    </ul>
    <p>CONOPS: Who is responsible for the different bits?</p>
    <p>These are the features we are going to implement. Next stage is prototyping small bits on their own. Prototype
        opening doors and mechanisms. Regardless of software and communication. Prototype all different bits, then we
        know if this and that works.</p>
    <p>Testing out and evaluating different solutions that meet functional requirements.</p>
    <p>Functional requirement -</p>
    <ul>
        <li>open and close door at dawn and dusk</li>
        <li>Monitor humidity in enclosure</li>
        <li>state of battery suppling an electric fence</li>
    </ul>
    <p>Door:</p>
    <ul>
        <li>Understand different doors out there and different ways to open them</li>
        <li>2 different classes of door we found that will open and close</li>
        <li>Doesn&#39;t do anything based on dawn and dusk, just open and close</li>
    </ul>
    <p>Then, we want to:</p>
    <ul>
        <li>Evaluate different sensors that can detect dusk</li>
        <li>Software? (clock)</li>
        <li>Can we be certain of dusk? - building nearby casting shadow etc.</li>
        <li>Time may or may not work</li>
        <li>Combine clock and light sensor?</li>
    </ul>
    <p>Communication Systems:</p>
    <ul>
        <li>None of these have been combined - just evaluating particular problems.</li>
        <li>Then we know which is the best tech for the job - then we build the system.</li>
    </ul>
    <p>We define the scope of the product. Dan decides what is technical and is good for CO600. If we are doing more
        research, we need to ask ourselves why we are doing that research and what would it contribute. We need to have
        a clear idea of what we&#39;re building and prototype these ideas to build it. Then focus on integrating it into
        the system.</p>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1387' class='md-header-anchor '></a>Date 04/11/2019 ; Emergency Meeting</h4>
    <h5><a name='header-n1388' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <p>Emergency Meeting</p>
    <h5><a name='header-n1395' class='md-header-anchor '></a>Discussion:</h5>
    <ul>
        <li>
            <p>Organising Workflow</p>
            <ul>
                <li>List out all of our current documents in chronological order</li>
                <li>Assign work to each other to do or finish off existing documents that need touching up so that we
                    can move into the prototyping stage</li>
                <li>Discussion regarding the movement of all documentation to Google Drive instead of hosting them on
                    GitHub, as our current system makes it difficult to resolve merge conflicts on Word Documents and
                    does not provide easy viewing.</li>
            </ul>
        </li>
        <li>
            <p>Discussion regarding communication and weekly meetings.</p>
        </li>
        <li>
            <p>Agreed to have more meetings each week:</p>
            <ul>
                <li>Monday evening @ 8pm.</li>
                <li>Thursday evening standup @ 8pm in preparation for supervisor meetings on Fridays</li>
                <li>Continue weekly meetings every Friday with project supervisor @ 1pm (Dan Knox)</li>
            </ul>
        </li>
        <li>
            <p>Agreed to move all documentation to Google Drive</p>
        </li>
        <li>
            <p>Compile list of assigned work required for next supervisor meeting (9/11/2018)</p>
            <p>&nbsp;</p>
        </li>
    </ul>
    <hr />
    <h4><a name='header-n1423' class='md-header-anchor '></a>Date 09/11/2018</h4>
    <h5><a name='header-n1424' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Daniel Knox</li>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <h5><a name='header-n1432' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Joanna + Damon:</p>
    <ul>
        <li>Functional Requirements</li>
    </ul>
    <h5><a name='header-n1437' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Joanna + Damon:</p>
    <ul>
        <li>Start prototyping</li>
        <li>Look into main hub architecture</li>
        <li>Look into motors</li>
        <li>Purchase ODroid (~£70)</li>
    </ul>
    <h5><a name='header-n1448' class='md-header-anchor '></a>Further Discussion:</h5>
    <ul>
        <li>
            <p>Discussed functional requirements</p>
            <ul>
                <li>Steve will respond to requirements by Monday</li>
            </ul>
        </li>
        <li>
            <p>Discussed main hub architecture (ladder logic + ODroid as the main board)</p>
        </li>
        <li>
            <p>Spoke about beginning prototyping the following week</p>
        </li>
        <li>
            <p>Start with hub move onto components later</p>
        </li>
        <li>
            <p>Talked about cloud vs local solution</p>
        </li>
        <li>
            <p>Dan Knox suggested we use an SMS solution connected to a reserve battery for emergency notifications</p>
        </li>
        <li>
            <p>Dan Knox said he will look into potentially working with high voltage electric fence</p>
        </li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1469' class='md-header-anchor '></a>Date 15/11/2018</h4>
    <h5><a name='header-n1470' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <h5><a name='header-n1476' class='md-header-anchor '></a>Discussion:</h5>
    <ul>
        <li>Discussed the motor research and both agreed to use stepper motors</li>
        <li>Damon purchased ODroid and is currently waiting for it to arrive.</li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1484' class='md-header-anchor '></a>Date 16/11/2018</h4>
    <h5><a name='header-n1485' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Daniel Knox</li>
        <li>Keith Greenhow</li>
        <li>Joanna Zhang</li>
        <li>Damon Sweeney</li>
    </ul>
    <h5><a name='header-n1495' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Joanna:</p>
    <ul>
        <li>Motor Research</li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>Purchased ODroid - waiting to arrive</li>
    </ul>
    <h5><a name='header-n1504' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Damon:</p>
    <ul>
        <li>Language research and try to define language grammar</li>
    </ul>
    <p>Joanna:</p>
    <ul>
        <li>Purchase Hall Effect Sensor and Reed Switches (~£8)</li>
    </ul>
    <h5><a name='header-n1513' class='md-header-anchor '></a>Further Discussion:</h5>
    <ul>
        <li>
            <p>Decided to use stepper motors for the door as they were DC and precise.</p>
        </li>
        <li>
            <p>Dan suggested to buy a NEMA14 or above with lead screw attached.</p>
        </li>
        <li>
            <p>Dan suggested to grab an A4988 stepper motor driver to control this motor, this driver is easily
                controlled using an Arduino. </p>
        </li>
        <li>
            <p>Dan suggested to write an interpreter and simple programmable scripting language for our system to allow
                the end user to have more control over its operation. He referenced an existing system he owns named
                APEX Fusion.</p>
        </li>
        <li>
            <p>Dan suggested using a Hall Effect sensor for detecting the position of the door. As an alternative, Keith
                suggested Reed switches, though he mentioned that they were rather brittle and care would be needed to
                work with them.</p>
        </li>
        <li>
            <p>Seeked clarification via instant messenger from Dan about the interpreter language:</p>
            <ul>
                <li>“The user probably wants to “program” there device to their needs (if this and that do x). To make
                    this easy you will need a language that is simple for them to write and interpret that to a real
                    language that actuates or senses with real hardware”</li>
            </ul>
            <p>&nbsp;</p>
        </li>
    </ul>
    <hr />
    <h4><a name='header-n1532' class='md-header-anchor '></a>Date 18/11/2018</h4>
    <h5><a name='header-n1533' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <h5><a name='header-n1539' class='md-header-anchor '></a>Discussion:</h5>
    <ul>
        <li>Both tested Hull Effect sensors and reed switches together</li>
        <li>Came to the conclusion that Hall Effect sensors worked a lot better.</li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1547' class='md-header-anchor '></a>Date 22/11/2018</h4>
    <h5><a name='header-n1548' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <h5><a name='header-n1554' class='md-header-anchor '></a>Discussion:</h5>
    <ul>
        <li>Damon mentioned he was having difficulty with the interpreted language - knowing which tokens to use and
            which not to have.</li>
        <li>Joanna showed Damon her simple serial communication protocol. </li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1562' class='md-header-anchor '></a>Date 23/11/2018</h4>
    <h5><a name='header-n1563' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Daniel Knox</li>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <h5><a name='header-n1571' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Joanna + Damon:</p>
    <ul>
        <li>Tested Hull Effect sensors and Reed switches on the door</li>
        <li>Collected door metal</li>
    </ul>
    <p>Joanna:</p>
    <ul>
        <li>
            <p>Spoke about her initial implementation of serial as a means of wired communication between devices in the
                chicken coop. Showed a naïve prototype that works.</p>
            <ul>
                <li>Dan suggested we look into CAN bus instead. The reason for this was that CAN bus had high noise
                    resilience, allowed master-slave implementations and had priority messages.</li>
            </ul>
        </li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>
            <p>Spoke about the language grammar and showed a naïve prototype of the lexical analyser in relation to that
                grammar. Asked for advice on how to represent the intermediary state within code.</p>
            <ul>
                <li>Dan stated this wasn&#39;t his area of expertise and suggested speaking to Scott Owens or other
                    lecturers/students from PLAS. </li>
            </ul>
        </li>
    </ul>
    <h5><a name='header-n1592' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Joanna:</p>
    <ul>
        <li>Start building door prototype</li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>Carry on with the language</li>
    </ul>
    <h5><a name='header-n1601' class='md-header-anchor '></a>Further Discussion:</h5>
    <ul>
        <li>
            <p>Joanna asked for advice on specific sensors for our system in which meet the client&#39;s required
                functionality and stated that the Hull Effect sensors worked perfectly and Reed switches exploded under
                slight pressure.</p>
        </li>
        <li>
            <p>Dan: Get another Hull effect sensor so you can detect the door in both locations (open/close). Suggested
                BME680/BME280 for the temperature and humidity sensor. This communicates via I2C and SPI. Suggested
                looking at getting a GP2Y1010AU0F for the dust sensor or a SDS011 which are more reliable which outputs
                serial. Water Sensor: look into DS18B20. Could look into having an ultrasonic sensor or a float switch.
                Maxbotixs-MB7389 HRxL which compensates for temperature / MB7060 for temperature probe at base of the
                water tank.</p>
        </li>
        <li>
            <p>Discussed failsafe for the door, in the situation that the hub went down, the door can still operate.</p>
            <ul>
                <li>Dan suggested getting a real time clock (RTC), using the Arduino controlling the door, develop a
                    backup system that could take control should the hub fail.</li>
            </ul>
        </li>
        <li>
            <p>Dan provided us with a GP2Y1010AU0F dust sensor, BME280 air temperature / humidity sensor. </p>
        </li>
        <li>
            <p>Dan provided 2 CAN bus modules to experiment with to see whether this was a better solution than using
                serial. </p>
        </li>
        <li>
            <p>Damon and Joanna spoke to Simon Cooksey for advice regarding the grammar and designing an interpreter.
                Simon helped clarify some sticking points with the grammar definition and how to define the system
                tokens. </p>
        </li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1620' class='md-header-anchor '></a>Date 29/11/2018</h4>
    <h5><a name='header-n1621' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <h5><a name='header-n1627' class='md-header-anchor '></a>Discussion:</h5>
    <ul>
        <li>
            <p>Both tested the door</p>
            <p>&nbsp;</p>
        </li>
    </ul>
    <hr />
    <h4><a name='header-n1633' class='md-header-anchor '></a>Date 30/11/2018</h4>
    <h5><a name='header-n1634' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Daniel Knox</li>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
        <li>Keith Greenhow</li>
    </ul>
    <h5><a name='header-n1644' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Joanna + Damon:</p>
    <ul>
        <li>Showed the door working</li>
    </ul>
    <h5><a name='header-n1649' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Joanna:</p>
    <ul>
        <li>Look into implementing CAN bus</li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>Continue to work on language</li>
    </ul>
    <h5><a name='header-n1658' class='md-header-anchor '></a>Further Discussion:</h5>
    <ul>
        <li>Dan Knox was unavailable due to annual leave, however, he did video call in to discuss progress. </li>
        <li>Damon + Joanna discussed their work on an initial prototype of the door and showed it opening and closing
            via an Arduino.</li>
        <li>Dan stated that the work on the door was good but focus needs to be moved towards programming.</li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1668' class='md-header-anchor '></a>Date 07/12/2018 ; Cancelled</h4>
    <h5><a name='header-n1669' class='md-header-anchor '></a>Attendees:</h5>
    <p>N/A</p>
    <h5><a name='header-n1671' class='md-header-anchor '></a>Reason:</h5>
    <ul>
        <li>
            <p>Damon and Joanna cancelled the meeting due to very little progress being made with the reason being a
                large focus on the final IoT assessment which had an approaching deadline.</p>
            <p>&nbsp;</p>
        </li>
    </ul>
    <hr />
    <h4><a name='header-n1677' class='md-header-anchor '></a>Date 12/12/2018</h4>
    <h5><a name='header-n1678' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <h5><a name='header-n1684' class='md-header-anchor '></a>Discussion:</h5>
    <ul>
        <li>Realized that the stepper motor is not the correct motor for the job. Bought a worm drive motor to use
            instead.</li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1690' class='md-header-anchor '></a>Date 13/12/2018</h4>
    <h5><a name='header-n1691' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Daniel Knox</li>
        <li>Joanna Zhang</li>
        <li>Damon Sweeney</li>
    </ul>
    <h5><a name='header-n1699' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Damon:</p>
    <ul>
        <li>Discussed progress in regards to the language and had got a base implementation of the intermediate
            representation done but did not have his work on hand to show Dan. </li>
    </ul>
    <p>Joanna + Damon:</p>
    <ul>
        <li>
            <p>Issues were noticed in regards to the door prototype:</p>
        </li>
        <li>
            <ul>
                <li>A stepper motor required constant power to hold a load and as such if the system failed or if power
                    was lost, the metal door will drop down at a rapid rate.</li>
                <li>As a result of this, the motor also heated up to high temperatures (70C+) after operating for
                    approximately 1 hour. </li>
                <li>Another issue in regards to the motor, though believing to be wired correctly, was that we had 3
                    motors fail due to a presumed loss of magnetism. </li>
            </ul>
        </li>
        <li>
            <p>As such, a decision was made to switch to a worm gear motor (£~12), which rectified these 3 problems.
            </p>
        </li>
        <li>
            <ul>
                <li>We bought one of these and an H-Bridge driver and implemented this into the prototype and proved
                    this worked as a proof of concept. </li>
                <li>The worm gear mechanically locks in place and as such, no power is required to hold it. This meant
                    the motor did not need continuous power and as a result did not heat up. As it stands, we have not
                    had our worm gear motor fail on us. </li>
            </ul>
        </li>
    </ul>
    <h5><a name='header-n1724' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Joanna:</p>
    <ul>
        <li>Finish Coop Condition Monitor</li>
        <li>Get CAN bus working between Arduinos</li>
        <li>Develop a logger for the hub</li>
        <li>Implement automated fail safe for the door.</li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>Flesh our the implementation of the interpreter so that it encompasses all sensors currently used in the
            network.</li>
        <li>Start development of system&#39;s main hub.</li>
        <li>Develop a logger for the hub</li>
        <li>Start investigating how to track chickens.</li>
    </ul>
    <h5><a name='header-n1745' class='md-header-anchor '></a>Further Discussion:</h5>
    <ul>
        <li>Asked about implementing just the door as a system at the client’s premises this Christmas break but was
            told to hold off for now. </li>
        <li>Discussed slow progress in relation to the project. Dan mentioned he was worried we had too high a focus on
            electronics and less on the software in which we were graded on. He said if we continue at this rate, he was
            worried we will fail our project or obtain a low mark. </li>
        <li>For the reason given above, Dan said he would look into purchasing xbee2mqtt enabled devices so that we
            could shift focus from hardware to software. This was because both Joanna and Damon had not shown Dan their
            code, so he was concerned that nothing was being done. </li>
        <li>Damon and Joanna both stated that they will work over Christmas to try to rectify the little progress made.
            Dan stated he heard this before but was worried as often students promise this but little deliver. </li>
        <li>Dan Knox mentioned that Sally Fincher wanted us to look into Chicken location. </li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1759' class='md-header-anchor '></a>Date 19/12/2018</h4>
    <h5><a name='header-n1760' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <h5><a name='header-n1766' class='md-header-anchor '></a>Discussion:</h5>
    <ul>
        <li>
            <p>We discussed our leaving dates for the holiday period. </p>
        </li>
        <li>
            <ul>
                <li>Both Joanna and Damon are leaving on the evening of Thursday 20th. </li>
                <li>Damon is available to work during the festive period, up until the 27th December in which he goes to
                    Germany for 5 days. He will be back in Canterbury on 3rd January.</li>
                <li>Joanna is available to work during the festive period, outside of national holidays. She will be
                    back in Canterbury on 4th January.</li>
            </ul>
        </li>
        <li>
            <p>Joanna: Implemented the BME280 and the dust sensor. Got this talking to the Arduino and sending data to
                another Arduino over CAN Bus. </p>
        </li>
        <li>
            <p>Damon: Completed the system logger, and started looking into python-can, integrating a CAN bus network
                with a linux machine. </p>
        </li>
        <li>
            <p>Damon: Tried to use RSSI values of both WiFi and Bluetooth LE using an ESP32, however, the RSSI values
                fluctuates too widely and cannot be used to perform trilateration. Further research was done into
                potentially using RFID instead, however, this was a costly solution due to the high price of UHF RFID
                readers. </p>
        </li>
        <li>
            <p>Damon realized as the MCP2515 CAN bus transceiver requires a 5v input, the output will also be 5v. This
                value is too high for the GPIO pins on the Odroid/Raspberry Pi and as such a method was needed for
                lowering the voltage.</p>
        </li>
        <li>
            <ul>
                <li>Joanna and Damon attempted to make a voltage divider to drop the 5v signal to 3.3v, however had
                    little success.</li>
                <li>Researching online, people have modified the MCP2515 board itself, by cutting into the PCB and
                    soldering on a capacitor amongst other components. However, we did no feel competent to follow this
                    modification as well as the CAN Bus component belonging to the Shed.</li>
                <li>We messaged Keith Greenhow as he worked with this device before for a project. He suggested we get
                    some Logic Level converters and connect this to the MCP2515. He offered to come into the Shed on
                    Monday (17/12) to help us with this. </li>
                <li>Following this, Keith connected up the logic level converters to the MCP2515, however, as we were
                    unaware, the INT pin is needed for the Linux SocketCAN implementation (they were not needed on the
                    Arduinos). As we needed this to work in our system, Joanna and Damon soldered a new PCB which
                    connected 2 logic level converters together to work with all the pins on the MCP2515. </li>
            </ul>
        </li>
        <li>
            <p>Once this circuit was complete, both Joanna and Damon could not get CAN Bus to talk to a Raspberry
                Pi/Odroid for a long period, but eventually solved the issue. The issue is believed to be differences in
                Linux Kernel version compared to the guides online.</p>
        </li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1800' class='md-header-anchor '></a>Date 23/12/2018 ; Over Instant Messenger</h4>
    <h5><a name='header-n1801' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Joanna Zhang</li>
        <li>Damon Sweeney</li>
        <li>Daniel Knox</li>
    </ul>
    <h5><a name='header-n1809' class='md-header-anchor '></a>Discussion:</h5>
    <ul>
        <li>Damon and Joanna let Dan know of the progress made over the Christmas break. </li>
    </ul>
    <p>Joanna:</p>
    <ul>
        <li>Temperature, Dust, Humidity, Pressure sensor works and is interfaced with CAN bus.</li>
        <li>Door is automated too in accordance with the RTC and light levels.</li>
    </ul>
    <p>Damon + Joanna:</p>
    <ul>
        <li>Interfaced CAN bus with the Linux kernel. This took a lot of time as the guides followed were outdated.</li>
        <li>Sensor network language.</li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>Logger working on Hub.</li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1831' class='md-header-anchor '></a>Date 12/01/2019</h4>
    <h5><a name='header-n1832' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Joanna Zhang</li>
        <li>Damon Sweeney</li>
    </ul>
    <h5><a name='header-n1838' class='md-header-anchor '></a>Discussion:</h5>
    <p>Damon:</p>
    <ul>
        <li>
            <p>Looked into locating a chicken with an ESP32 and a Bluetooth Beacon</p>
            <ul>
                <li>The RSSI values of both Bluetooth and Wi-Fi had too low a fidelity to work with to try and
                    triangulate a position.</li>
            </ul>
        </li>
    </ul>
    <p>Joanna:</p>
    <ul>
        <li>Refactor CAN bus code into a separate CAN bus library to be used across multiple devices.</li>
        <li>Joanna showed Damon her initial designs of the Angular application. Damon noted some changes that needed to
            be made, especially concerning the door section.</li>
    </ul>
    <hr />
    <h4><a name='header-n1853' class='md-header-anchor '></a>Date 18/01/2019</h4>
    <h5><a name='header-n1854' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Daniel Knox</li>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <h5><a name='header-n1862' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Joanna:</p>
    <ul>
        <li>Interfaced door with CAN bus</li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>Debugging CAN bus on Linux</li>
    </ul>
    <h5><a name='header-n1871' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Joanna + Damon:</p>
    <ul>
        <li>Debugging CAN bus on Linux</li>
    </ul>
    <p>Joanna:</p>
    <ul>
        <li>Start on the web interface</li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>Start on the poster</li>
    </ul>
    <h5><a name='header-n1884' class='md-header-anchor '></a>Further Discussion:</h5>
    <ul>
        <li>
            <p>Discussion pertaining to integrating CAN bus with Linux. It was not as simple as initially thought out.
                Dan advised:</p>
            <ul>
                <li>
                    <p>SPI is running half duplex instead of full duplex with sending and receiving. </p>
                </li>
                <li>
                    <p>He had the same issue with <code>ifconfig</code> and <code>sudo ip set uplink</code></p>
                    <ul>
                        <li>
                            <p>To fix this, he wrote a script that did all the steps he was doing in the terminal</p>
                        </li>
                        <li>
                            <p>Told ipconfig it was a network boot script</p>
                            <ul>
                                <li>ipconfig boot up handled the configuration</li>
                            </ul>
                        </li>
                        <li>
                            <p>Patched the Linux kernel as there was some issue with CAN bus and it.</p>
                        </li>
                        <li>
                            <p>Network where you can specify in the network interfaces, specify a script to run for up
                                and down.</p>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
        <li>
            <p>Discussion regarding the design of the website:</p>
            <ul>
                <li>Dan suggested due to time constraints that we do not do the 5-sketches method and LoFi prototyping,
                    instead he stated we should follow a design principle such as Material Design.</li>
            </ul>
        </li>
    </ul>
    <hr />
    <h4><a name='header-n1911' class='md-header-anchor '></a>Date 25/01/2019 ; Cancelled</h4>
    <h5><a name='header-n1912' class='md-header-anchor '></a>Reason:</h5>
    <p>Damon is ill.</p>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1916' class='md-header-anchor '></a>Date 31/01/2019</h4>
    <h5><a name='header-n1917' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <h5><a name='header-n1923' class='md-header-anchor '></a>Discussion:</h5>
    <ul>
        <li>Both were very happy that CAN bus was finally working. </li>
        <li>Joanna showed Damon the DB schema</li>
        <li>Damon showed Joanna a graphic he was designing for the poster and a primitive poster design - Joanna stated
            she didn&#39;t like the background picture and Damon changed it to a gradient. </li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1933' class='md-header-anchor '></a>Date 01/02/2019</h4>
    <h5><a name='header-n1934' class='md-header-anchor '></a>Attendees:</h5>
    <h5><a name='header-n1935' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Damon:</p>
    <ul>
        <li>
            <p>Started on the poster</p>
            <ul>
                <li>Designing the graphic for the coop</li>
            </ul>
        </li>
        <li>
            <p>CANbus</p>
            <ul>
                <li>Fixed CAN bus on the Raspberry Pi 3.</li>
            </ul>
        </li>
    </ul>
    <p>Joanna: </p>
    <ul>
        <li>Initial scaffold of Angular Application</li>
        <li>Express.js backend, authenticating users using JWT tokens to Angular frontend</li>
        <li>Database design</li>
    </ul>
    <h5><a name='header-n1956' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Joanna:</p>
    <ul>
        <li>Carry on implementing features for the website.</li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>Carry on with the language and poster.</li>
    </ul>
    <h5><a name='header-n1965' class='md-header-anchor '></a>Further Discussion:</h5>
    <ul>
        <li>CAN bus is now fixed, Damon spent 4 days working nonstop. The issue was the default SPI speed on the
            Raspberry Pi Model 3 was much higher than the max speed of the MCP2515 CAN module. This masqueraded itself
            as erroneous CAN messages. </li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n1971' class='md-header-anchor '></a>Date 07/02/2019</h4>
    <h5><a name='header-n1972' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <h5><a name='header-n1978' class='md-header-anchor '></a>Discussion:</h5>
    <ul>
        <li>
            <p>Showed Damon the main page. Damon said the main door image really needs a redesign. Joanna agreed.</p>
        </li>
        <li>
            <p>Damon told Joanna about the Egg Analysis he was working on and how it detects Planes and Eggs pretty
                well. </p>
            <p>&nbsp;</p>
        </li>
    </ul>
    <hr />
    <h4><a name='header-n1986' class='md-header-anchor '></a>Date 08/02/2019</h4>
    <h5><a name='header-n1987' class='md-header-anchor '></a>Attendees:</h5>
    <h5><a name='header-n1988' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Joanna:</p>
    <ul>
        <li>
            <p>Web Interface</p>
            <ul>
                <li>Material Design</li>
                <li>Main Page </li>
                <li>System page done.</li>
            </ul>
        </li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>Started implementing egg image analysis </li>
        <li>Handling events and executing the corresponding code blocks in the language</li>
    </ul>
    <h5><a name='header-n2006' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Damon:</p>
    <ul>
        <li>Add rest server endpoints to interact from the main hub. Code is now run from the database.</li>
        <li>Changes to poster after Dan Knox&#39;s feedback.</li>
    </ul>
    <p>Joanna:</p>
    <ul>
        <li>
            <p>Main Page:</p>
            <ul>
                <li>
                    <p>Tweaks: </p>
                    <ul>
                        <li>Top door section goes against the design of the material cards</li>
                        <li>Current info is not actually current info so label it correctly</li>
                        <li>Show the state of the door.</li>
                        <li>Image is burning up a load of room for little again -- text or icon could convey the same
                            thing</li>
                        <li>Card opens up main card for conveying door information?</li>
                        <li>Actuate door functionality</li>
                        <li>Make clicking cards take you to the historical information?</li>
                        <li>Rename admin to system -- Make it incredibly explicitly that it is not a user and is the
                            system itself, make him a completely different entity.</li>
                        <li>Separate out the code panel from the global settings</li>
                        <li>Google map marker</li>
                        <li>Make it so that you can have multiple saved versions of code that the user can load in and
                            out.</li>
                        <li>Systems table information should be stored in the settings tab.</li>
                        <li>Flag for the wizard so that first time boot can be run.</li>
                        <li>Rerun wizard option in the system account that allows you to reset all devices?</li>
                        <li>Timers on devices is unimportant information, move to downtime sensor. </li>
                    </ul>
                </li>
            </ul>
        </li>
        <li>
            <p>First time setup wizard </p>
        </li>
    </ul>
    <h5><a name='header-n2053' class='md-header-anchor '></a>Further Discussion:</h5>
    <p>Poster:</p>
    <ul>
        <li>Dan likes the poster</li>
        <li>Nudge the Kent logo in to justify it to the text</li>
        <li>Bottom text might be difficult to see - do some test prints</li>
        <li>Contrast at the bottom is problematic - also check this in the test prints</li>
        <li>White is not going to be as clear as monitors are backlit, posters are not.</li>
        <li>Keep nice alignment</li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n2070' class='md-header-anchor '></a>Date 15/02/2019 ; Cancelled</h4>
    <h5><a name='header-n2071' class='md-header-anchor '></a>Reason:</h5>
    <p>Joanna&#39;s car needed to be MOT&#39;d.</p>
    <h5><a name='header-n2073' class='md-header-anchor '></a>Discussion:</h5>
    <p>We let Dan Knox know our progress over Instant Messenger. </p>
    <p>Joanna:</p>
    <ul>
        <li>Redesigned front page</li>
        <li>Logs are being served from the hub</li>
        <li>Historical data being displayed as graphs</li>
        <li>Registration is done</li>
        <li>Refactored front page for system - map to click to change location.</li>
        <li>Adding save states for the code</li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>Carried on with poster design and putting it all together</li>
        <li>Finished language</li>
        <li>Log endpoint on hub</li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n2099' class='md-header-anchor '></a>Date 21/02/2019</h4>
    <h5><a name='header-n2100' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <h5><a name='header-n2106' class='md-header-anchor '></a>Discussion:</h5>
    <ul>
        <li>
            <p>Both Damon and Joanna went over abstract that was done together earlier on in the week.</p>
        </li>
        <li>
            <p>Damon showed Joanna progress on poster and both revised the text. </p>
        </li>
        <li>
            <p>Joanna showed Damon the progress on the website.</p>
            <p>&nbsp;</p>
        </li>
    </ul>
    <hr />
    <h4><a name='header-n2116' class='md-header-anchor '></a>Date 22/02/2019</h4>
    <h5><a name='header-n2117' class='md-header-anchor '></a>Attendees:</h5>
    <h5><a name='header-n2118' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Joanna + Damon:</p>
    <ul>
        <li>Abstract done</li>
    </ul>
    <p>Joanna:</p>
    <ul>
        <li>
            <p>Programmer tab for system to interface with the programmable language</p>
            <ul>
                <li>Code mirror as JS code editor</li>
                <li>Tabulated for multiple snippets</li>
                <li>Functions to set code to be active / inactive</li>
                <li>Functions to add new code and delete code</li>
                <li>Settings page</li>
            </ul>
        </li>
    </ul>
    <p>Damon:</p>
    <ul>
        <li>Add endpoint to check if the code can successfully be run with no syntax error.</li>
        <li>Continued with poster </li>
    </ul>
    <h5><a name='header-n2144' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Damon:</p>
    <ul>
        <li>Carry on with poster.</li>
    </ul>
    <p>Joanna:</p>
    <ul>
        <li>Carry on with website.</li>
    </ul>
    <h5><a name='header-n2153' class='md-header-anchor '></a>Further Discussion:</h5>
    <p>N/A</p>
    <hr />
    <h4><a name='header-n2156' class='md-header-anchor '></a>Date 17/11/2019</h4>
    <h5><a name='header-n2157' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <h5><a name='header-n2163' class='md-header-anchor '></a>Discussion:</h5>
    <ul>
        <li>To get Egg Analysis working remotely, Damon tried to run PyTorch on the Pi Zero. The library itself had no
            support for ARM chips so had to compile from source and that took forever. Damon then realised that the CPU
            on the Pi Zero was not strong enough, so he changed the device to be a client-server model, whereby the
            device only takes a picture and sends it off to a more powerful device (Damon&#39;s PC) to be analysed, and
            the result is returned quicker.</li>
        <li>Joanna showed Damon more progress on the website and showed it integrating with the hub&#39;s endpoints.
        </li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n2171' class='md-header-anchor '></a>Date 01/03/2019</h4>
    <h5><a name='header-n2172' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Joanna Zhang</li>
        <li>Damon Sweeney</li>
        <li>Daniel Knox</li>
    </ul>
    <h5><a name='header-n2180' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Damon:</p>
    <ul>
        <li>Egg Analysis - refactored and changed to a client server model as Torch cannot run on a Pi Zero. It is not a
            CAN bus module which calls the API running on Damon&#39;s PC.</li>
    </ul>
    <p>Joanna:</p>
    <ul>
        <li>Wizard first time setup.</li>
        <li>Redesign Settings page</li>
        <li>User can upload own profile picture</li>
        <li>Change button text to be CAPS in accordance with Material UI design</li>
        <li>Fix memory leaks due to Angular subscriptions.</li>
        <li>Code UI on the website - can now check if it compiles.</li>
    </ul>
    <h5><a name='header-n2199' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Joanna + Damon:</p>
    <ul>
        <li>Make sure demo works for project fair. Dan suggests we get it all set up nicely so it plugs and plays.</li>
    </ul>
    <p>Joanna:</p>
    <ul>
        <li>Dan mentioned to have JS libraries downloaded locally</li>
        <li>Implement Door Control and redesign that section</li>
        <li>Use a timeline approach to display door data and water data</li>
    </ul>
    <h5><a name='header-n2212' class='md-header-anchor '></a>Further Discussion:</h5>
    <p>N/A</p>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n2216' class='md-header-anchor '></a>Date 08/03/2019</h4>
    <h5><a name='header-n2217' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Joanna Zhang</li>
        <li>Damon Sweeney</li>
    </ul>
    <h5><a name='header-n2223' class='md-header-anchor '></a>What&#39;s Been Done since the Previous Meeting:</h5>
    <p>Damon + Joanna:</p>
    <ul>
        <li>Finished integrating zigbee2MQTT water sensor into the main hub.</li>
    </ul>
    <h5><a name='header-n2228' class='md-header-anchor '></a>What&#39;s Being Done:</h5>
    <p>Damon + Joanna:</p>
    <ul>
        <li>Prep for poster fair</li>
    </ul>
    <h5><a name='header-n2233' class='md-header-anchor '></a>Further Discussion:</h5>
    <ul>
        <li>We didn&#39;t have a meeting with Dan as we already had direction on what we needed to do from the week
            prior, so had a meeting between ourselves.</li>
    </ul>
    <p>&nbsp;</p>
    <hr />
    <h4><a name='header-n2239' class='md-header-anchor '></a>Date 13/03/2019</h4>
    <h5><a name='header-n2240' class='md-header-anchor '></a>Attendees:</h5>
    <ul>
        <li>Damon Sweeney</li>
        <li>Joanna Zhang</li>
    </ul>
    <h5><a name='header-n2246' class='md-header-anchor '></a>Discussion:</h5>
    <p>Damon + Joanna:</p>
    <ul>
        <li>Bought a router for project fair.</li>
        <li>Both agreed to get to the project fair early to set up in case of networking issues.</li>
        <li>Joanna agreed to supervise the stand and Damon agreed to supervise the poster.</li>
        <li>Discussed language feature to demonstrate (text messages)</li>
        <li>Tested system all worked fine on our network.</li>
    </ul>
    <p>&nbsp;</p>
    <h2><a name='header-n2260' class='md-header-anchor '></a>Field Research</h2>
    <h3><a name='header-n2262' class='md-header-anchor '></a>Client Research</h3>
    <p>We were initially approached by the father of a Kent alumni, Steve, who wanted to automate his chicken coop door.
        We arranged an interview with Steve to gain more insight into his situation. After conducting an interview with
        him, we also arranged interviews with other smallholders to gain an insight into how they manage their chickens.
    </p>
    <p>&nbsp;</p>
    <h4><a name='header-n2265' class='md-header-anchor '></a>Initial Client Interview</h4>
    <p>We conducted an interview on our client&#39;s premises in Surrey to gain better insight into their situation.
    </p>
    <p><a href='transcripts/andrews/28-09-2018_andrews_transcripts_1.pdf'>Steve Transcript</a></p>
    <p><a href='transcripts/andrews/28-09-2018_andrews_location.pdf'>Steve Location</a></p>
    <p>&nbsp;</p>
    <h5><a name='header-n2270' class='md-header-anchor '></a>Images</h5>
    <p>After moving out into the garden to see their chickens, they mentioned they suffer from rats stealing food and
        badgers have been around in the past. They&#39;re thinking of breeding chickens in the arcs and incubating the
        eggs. </p>
    <p><img src='transcripts\andrews\images\mother_hen2.JPG' alt='mother_hen2' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p><img src='transcripts\andrews\images\nest_box.JPG' alt='nest_box' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p><img src='transcripts\andrews\images\arc.JPG' alt='arc' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p><img src='transcripts\andrews\images\main_chicken_coop.JPG' alt='main_chicken_coop'
            referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p><img src='transcripts\andrews\images\main_coop_door.JPG' alt='main_coop_door' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p><img src='transcripts\andrews\images\main_coop_door_inside.JPG' alt='main_coop_door_inside'
            referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p><img src='transcripts\andrews\images\mother hen.JPG' alt='mother hen' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p><img src='transcripts\andrews\images\mother_hen_door.JPG' alt='mother_hen_door' referrerPolicy='no-referrer' />
    </p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <h5><a name='header-n2289' class='md-header-anchor '></a>Conclusion</h5>
    <p>From this interview, we gained a better insight into the daily life of our client. Steve explained that it is a
        rush in the morning to feed the animals, ranging from dogs to horses to the chickens. Steve mentioned that
        automating the control of the door would help him - &quot;It&#39;s one less thing to worry about&quot;. However,
        when approached with the idea of automating feed, Steve seemed reluctant, stating &quot;it&#39;s important you
        need to interact with [the chickens]&quot;.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n2292' class='md-header-anchor '></a>Smallholder Interviews</h3>
    <p>To gain a further understanding in how other smallholders manage their chickens, we conducted interviews with 4
        other smallholders. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n2295' class='md-header-anchor '></a>Sue Coombe-Tennant</h4>
    <p>Sally, wife of Steve, kindly arranged an interview for us to visit her friend Sue who also owned chickens. The
        transcripts and location can be found below:</p>
    <p><a href='transcripts/coombe_tennant/29-09-2018_coombe_tennant_transcripts.pdf'>Coombe Tennant Transcript</a></p>
    <p><a href='transcripts/coombe_tennant/29-09-2018_coombe_tennant_location.pdf'>Coombe Tennant Location</a></p>
    <p>&nbsp;</p>
    <h5><a name='header-n2300' class='md-header-anchor '></a>Conclusion</h5>
    <p>For Sue, one of the major issues with owning chickens is the fox. She mentions that they come at any point during
        the day and will kill the whole flock. She has defences in place such as an electric fence and makes sure they
        are shut in at night. She finds it difficult to be away for long periods of time, such as going on holiday, as
        there has to be someone there to look after them.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2303' class='md-header-anchor '></a>Sue Moorhouse</h4>
    <p>Sally, also kindly arranged an interview for us to visit her friend, also named Sue and owns chickens.</p>
    <p><a href='transcripts/moorhouse/29-09-2018_moorhouse_transcript.pdf'>Moorhouse Transcript</a></p>
    <p><a href='transcripts/moorhouse/29-09-2018_moorhouse_location.pdf'>Moorhouse Location</a></p>
    <p>&nbsp;</p>
    <p>After we finished recording for our transcript, Sue mentioned she also suffers from rats, and that they steal the
        food off the chickens. She tries to set rat traps but is concerned if a chicken or dog gets caught in the trap
        instead. She has seen badgers around her farm, but so far they haven&#39;t attacked her poultry.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n2310' class='md-header-anchor '></a>Images</h5>
    <p><img src='transcripts/moorhouse/images/IMG_0112.JPG' alt='door to moorhouse chicken coop'
            referrerPolicy='no-referrer' /></p>
    <p><img src='transcripts/moorhouse/images/IMG_0114.JPG' alt='zoomed in door to coop' referrerPolicy='no-referrer' />
    </p>
    <p><img src='transcripts/moorhouse/images/IMG_0115.JPG' alt='chickens taking shelter'
            referrerPolicy='no-referrer' /></p>
    <p><img src='transcripts/moorhouse/images/IMG_0116.JPG' alt='pano shot of the chicken area'
            referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <h5><a name='header-n2316' class='md-header-anchor '></a>Conclusion</h5>
    <p>Sue Moorhouse owns both ducks and chickens, and they would both fall prey to foxes if managed incorrectly. They
        would prefer to have their poultry roam around the fields but incidents have happened in the past where the fox
        has killed their flock. They have opted to use an electric fence to deter foxes which is doing the job as long
        as they remember to charge the battery powering it. Another interesting issue they have is with crows.
        They&#39;re one of their biggest issues as they will &quot;come take the eggs in the house when the barn
        door&#39;s open&quot;. Sue is now using a smaller cut out door instead of the full sized door and finds it a
        chore to shut it up at night when the weather is miserable.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2320' class='md-header-anchor '></a>Suzie Sparrowhawk</h4>
    <p>Dan Andrews, son of Steve, helped us arrange an interview with his cousin&#39;s parents who are smallholders of
        two chickens. </p>
    <p><a href='transcripts/sparrowhawk/30-09-2018_sparrowhawk_transcript.pdf'>Sparrowhawk Transcript</a></p>
    <p><a href='transcripts/sparrowhawk/30-09-2018_sparrowhawk_location.pdf'>Sparrowhawk Location</a></p>
    <h5><a name='header-n2324' class='md-header-anchor '></a>Images</h5>
    <p><img src='transcripts/sparrowhawk/images/IMG_0118.JPG' alt='outer coop door' referrerPolicy='no-referrer' /></p>
    <p><img src='transcripts/sparrowhawk/images/IMG_0119.JPG' alt='red mites' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <h5><a name='header-n2328' class='md-header-anchor '></a>Conclusion</h5>
    <p>As per the above, Suzie has issues with foxes as well as red mites. She mentioned that the fox was able to nose
        the lock open and destroy her flock in the past. Because of these past incidents, she now has built an new
        enclosure which is completely contained. Suzie mentioned that she woke up in the middle of the night and thought
        she did not shut the chickens up. She got dressed and went in the garden just to find them already shut up. She
        stated that &quot;it would have been nice to have known that the chickens were in and safe without having to get
        out of bed.&quot;</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2332' class='md-header-anchor '></a>Will Threlfall</h4>
    <p>Will Threlfall, a friend from University who recently completed his Year in Computing, owned three Rhode Island
        red chickens. Him and his parents didn&#39;t mind us coming around to have a chat with them about their
        chickens, however they preferred not to be recorded. As such, we only have images and notes for this visit.</p>
    <p><a href='transcripts/coombe_tennant/30-09-2018_threllfall_location.pdf'>Threlfall Location</a></p>
    <h5><a name='header-n2335' class='md-header-anchor '></a>Notes</h5>
    <ul>
        <li>Very tight on security as neighbours feed wildlife - foxes near them all the time.</li>
        <li>Rats also a major issue - they get through the wire, or dig underneath and eat the food.</li>
        <li>Have an outer run that is never opened but secure so foxes cannot get in.</li>
        <li>Very caring towards their chickens - takes them to the vets if ill.</li>
        <li>Three Rhode Island Reds.</li>
        <li>Take chickens on holiday with them to the Isle of Wight</li>
        <li>Uses cider vinegar in the water drinker to stop worms</li>
        <li>Would like to know when the water is low and needs topping up</li>
        <li>Encountered red mites before</li>
        <li>Uses Verm-X </li>
        <li>Feeds chickens meal worms as treats</li>
    </ul>
    <p>&nbsp;</p>
    <h5><a name='header-n2360' class='md-header-anchor '></a>Images</h5>
    <p><img src='transcripts/threlfall/IMG_0120.JPG' alt='image of outer run' referrerPolicy='no-referrer' /></p>
    <p><img src='transcripts/threlfall/IMG_0121.JPG' alt='inner coop' referrerPolicy='no-referrer' /></p>
    <p><img src='transcripts/threlfall/IMG_0122.JPG' alt='water drinkers' referrerPolicy='no-referrer' /></p>
    <p><img src='transcripts/threlfall/IMG_0123.JPG' alt='small chicken perch' referrerPolicy='no-referrer' /></p>
    <p><img src='transcripts/threlfall/IMG_0124.JPG' alt='chicken carrier' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <h4><a name='header-n2367' class='md-header-anchor '></a>Liam Richards</h4>
    <p>Liam is a friend met through the Andrews&#39; family who owns a flock of ducks. This interview was done over the
        phone as Liam was visiting his parents on the Isle of Wight. </p>
    <h5><a name='header-n2369' class='md-header-anchor '></a>Conclusion</h5>
    <p>From our phone call, Liam mentioned he had 10 ducks and used to have a few chickens though they died of old age
        recently. Unlike his previous chickens, he has to lure the ducks back to the coop with feed and shut them up.
        Though they all follow each other, the process is quite tedious, especially in the winter. He has found that the
        water sometimes freezes during the winter and so he has to constantly refill the drinker. He also utilizes an
        electric fence to deter foxes and mains power can be found inside the coop.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2372' class='md-header-anchor '></a>Christine Sparrowhawk</h4>
    <p>The sister of the client&#39;s wife, Sally Andrews, owned chickens and did not mind having a discussion with us
        over the phone about her flock. Christine lives in Cheddar, Somerset. </p>
    <h5><a name='header-n2374' class='md-header-anchor '></a>Conclusion</h5>
    <p>Christine owns around 8 chickens which free roam in the secured run to keep the foxes out. Their main chicken
        coop solution utilizes a COTS solution to automate the door - ChickenGuard. She has mentioned that it has been
        reliable, however, there was a time where it failed due to the batteries running out. Previously, when the outer
        run was not built, she has suffered attacks by foxes and badgers, wiping out the majority of her flock during
        the day. Rats are also an issue but since getting this new run, they have been kept out.</p>
    <h3><a name='header-n2377' class='md-header-anchor '></a>Interview Analysis</h3>
    <p>This section summarizes the main points of research that was carried out for this project. </p>
    <h4><a name='header-n2380' class='md-header-anchor '></a>Overview</h4>
    <p>We interviewed 7 smallholders from various parts of South East England (Kent, Surrey and Sussex) with one
        exception being a holder from Somerset. We will refer to them collectively as “the target group” for this
        analysis and utilise their data to collectively identify common functionality provided in their fowl hosting. We
        categorised the group based on location and land owned, expressing that owning above 5 acres of land can be
        considered ‘Farm’ worthy, while anything between 0.5 acres and 5 can be considered rural; finally anything below
        0.5 acres is regarded as suburban. All members in the target group had common but often consistent problems
        varying from predators to going on holiday, with each member handling the problem in a different manner.</p>
    <p>There is a clear problem that a lot of the target group cannot leave their poultry alone for extensive periods,
        effectively citing them as 24/7 jobs. All of the group suffered from previous cullings from attacks with
        predators while also dealing with vermin such as rats; interestingly one member had severe issues with crows who
        would break and eat any laid eggs. All members had to feed, water and enclose their poultry every day for safety
        and wellbeing. As such leaving this responsibility behind for a period of time required a solution such as
        chicken boarding, a neighbour looking after them or even taking them on holiday with them to ensure they were
        being well kept. Forgetting or losing interest in the fowl was not an option lest they suffer mistreatment,
        injury or worse - death. Every member when asked whether they could have some form of automation had positive
        feedback to this. One member already had an automated solution running on AA batteries (that would enclose the
        fowl) but conferred their concerns that no feedback was available considering their system had failed previously
        (batteries died, and one time jammed). Another member had considered buying an automated solution but confessed
        that they were not comfortable trusting a machine that offered no feedback. </p>
    <p>Our client had expressed considerable concern over the various pens that they owned for their fowl. Stating that
        forgetting to “shut them in was a death sentence” and while an automated solution would be pleasant - it might
        not be feasible when you have many automated systems working independently across multiple pens, things are more
        likely to go wrong and require maintenance. </p>
    <p>Knowing this, it was clear that a solution could be derived that would inform the client (and others) of the
        state of the fowl housing. We considered branching out the system to accommodate other forms of fowl, such as
        ducks and geese. However, from the information gathered, the majority of the target group interviewed had
        chickens, with one member saying that the ducks returned to the stable when the chickens returned at dusk. Owing
        to this and the behavioural differences between chickens and other types of fowl we’ve decided for the purpose
        of this project (and in the interest of our client) to focus on chickens specifically; including their behaviour
        and routines.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n2386' class='md-header-anchor '></a>Data Analysis</h3>
    <h4><a name='header-n2387' class='md-header-anchor '></a>Fowl </h4>
    <p><img src='images/field_research/fowl.png' alt='Graph showing number of fowl owned per small holder'
            referrerPolicy='no-referrer' /></p>
    <p>Only one member of the target group had exclusively ducks with no chickens. Another member had 3 ducks around ~20
        hens but otherwise all members had exclusively chickens. The inclusions of ducks did not add much more
        complexity to the living arrangements for the fowl, instead they appeared to cohabit pleasantly.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2391' class='md-header-anchor '></a>Fowl Pen/Run</h4>
    <p><img src='images/field_research/defence.png' alt='Pie chart showing types of defence used'
            referrerPolicy='no-referrer' /></p>
    <p>Based on the location the pen for housing fowl changed. 37.5% of the target group had completely sealed runs
        which often meshed across the top, bottom and sides of the run to encase it entirely - this was a sure proof
        manner to stop any predators from getting in and limiting the fowl from escaping. On farms and rural errors,
        37.5% utilised electric fences to limit the fowls area as well providing security with 25% of the group only
        using basic fencing to keep their fowl inside a pen (that often offered very little security from predators).
        Our client who utilised an electric fence did mention an interest in whether it was possible to receive feedback
        on the condition of the fence, had it failed or grounded itself anywhere along the line.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2395' class='md-header-anchor '></a>Housing</h4>
    <p><img src='images/field_research/run.png' alt='Bar graph showing types of run used'
            referrerPolicy='no-referrer' /></p>
    <p>There was a larger divide here than expected. 28% of the group who resided on farms and rural areas had converted
        sheds or stables for their fowl while all those in suburban environments (42%) had commercial housing provided.
        Another 28% owned bespoke crafted housing such as converted wagons which could now house chickens. Most of the
        group we interviewed utilised a raising hatch on runners as shown below. </p>
    <p>&nbsp;</p>
    <p>Sliding chicken coop door seen at client&#39;s:</p>
    <p><img src='images/field_research/client_door.jpg' alt='Sliding door seen at clients place'
            referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>Chicken coop door at Sue Moorhouse:</p>
    <p><img src='images/field_research/moorhouse_door.png' alt='Sliding door seen at the Moorhouse&#39;s place'
            referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>Chicken coop door at Sue Coombe-Tennant</p>
    <p><img src='images/field_research/coombe_tennant.png' alt='Sliding door seen at the Coombe-Tennant&#39;s place'
            referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>They all used a pulley system to raise and lower the hatch to enclose or free the fowl. However, the chicken
        housing at the suburban areas were more varied, some had doors on which opened on a hinge, whilst others had
        doors that slide left to right.</p>
    <p>Chicken coop door at Suzie Sparrowhawk’s. The main door lifts up and the hutch itself slides left and right.</p>
    <p><img src='images/field_research/sue_sparrow_door.jpg' alt='Chicken coop door seen at Suzie Sparrowhawk&#39;s'
            referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <h4><a name='header-n2412' class='md-header-anchor '></a>Predators and Pests</h4>
    <p><img src='images/field_research/pests.png' alt='Bar graph showing pests' referrerPolicy='no-referrer' /></p>
    <p>Every member had concerns, issues and nightmare scenarios involving badgers, foxes and rats - with one member
        suffering frequent crow attacks. The attack frequency had no impact on whether ducks or chickens were housed.
        28% of the target group suffered from red mites, parasites which cause a variety of issues ranging from egg
        production to even death. Dealing with mites normally involves purifying the housing if made of wood, or
        utilising specialist sprays and earth to cull mite populations. Detecting these would prove rather difficult
        given to their size and behaviour but still provides a valid point. Those who suffered from red mites tended to
        be suburban landowners while those who owned an acre or more filed no reports on mites infesting their fowl.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2416' class='md-header-anchor '></a>Power</h4>
    <p><img src='images/field_research/power.png' alt='Tabularized data on power' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>57% of the target group had mains power, with one person without mains power planning on installing it. Existing
        products that focus specifically on individual components for automation (see ATX automated feeding and
        enclosing system) focus on delivery without consistent mains power, opting for a portable but limiting battery
        solution. Some members (especially our client) were reluctant to use ATXs work as it would not notify them if
        something had failed, opting for an old-fashioned hands on approach.</p>
    <p>An automated &#39;hop door&#39; and &#39;feeder&#39; system, together values at around €300.</p>
    <p><img src='images/field_research/atx.png' alt='ATX' referrerPolicy='no-referrer' /></p>
    <center><i>ATX Automated Door and Feeder. Source: https://gb.axt-electronic.org/</i></center>
    <p>&nbsp;</p>
    <h4><a name='header-n2426' class='md-header-anchor '></a>Wi-Fi</h4>
    <p>72% of our target group had a wireless network (Wi-Fi) within reach of their pen, although 40% of those who had
        Wi-Fi suffered from extremely poor reception that was not potentially viable for use in a solution; whereas
        another 40% had adequate Wi-Fi capabilities and 20% had perfect Wi-Fi capabilities. All of the target group had
        access to a mobile network (3G/4G) at their poultry housing. No clients had a wired ethernet option. This
        illustrates that a solution cannot rely on Wi-Fi to accomodate all smallholders. Should the WiFi reception go
        down, the system would be isolated and similar to a pre-purchased solution. Pertaining to our main client Steve,
        we were lucky that WiFi was available, with the potential for Ethernet in the future. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n2429' class='md-header-anchor '></a>Summary</h4>
    <p>Whether ducks or chickens, an issue exists in offering protection and affordance to the end user. Users cannot
        travel away without fear of an automated isolated system failing, boarding their chickens or relying on a sitter
        to maintain their wellbeing. Predators will be ready regardless of the time or season and are persistent in
        attacks. Our target group utilises various solutions for housing fowl, whether it’s bespoke or guarded by an
        electric fence. All of them utilise some form of enclosed structure to protect and limit the roaming space of
        their fowl, constricting them to a safe boundary. At night they manually shut them in aside one member who
        utilised an existing automated solution known as ‘Chicken Guard’, which they stated had failed previously. </p>
    <p>There are a few existing solutions on the market all of which operate on either a timer system, light sensor
        system or both. As mentioned the target group had a member who owned an existing solution but was not happy with
        the outcome; having it fail previously on them. Nearly all solutions exist focusing on automated doors with some
        focusing on automated feeders. </p>
    <p>Our project aims to focus on a broader spectrum that falls within the realm of our client and other smallholders
        interviewed, this includes feeding, hydrating and securing their chickens. One company (ATX) offered an
        automated feeder but this offered very little feedback, opting for a LCD display that you would manually read
        for verifying its current state. Every single solution offered no remote feedback that you could read away from
        home or the pen - knowing this we need to design a solution that can offer what these systems provide but battle
        any issues they may introduce; notably a lack of feedback.</p>
    <p>With this information ready we are able to suggest an implementation to our initial client, Steve. The system our
        client requires (and those who may desire such a system) will need to be modular to adapt to various changes in
        environment. As Steve had mains power within the coop, we did not need to build a system which requires low
        power consumption, although if we were to push this to a wider market, we would.</p>
    <p>Conclusively the system must be modular as Steve is unsure how the coop structure is going to change in the
        upcoming years. Therefore, it must support various arrangements and allow Steve to plug and play different
        components when needed. If any of these devices are powered by battery the life should be expected to last as
        long as possible without inconveniencing the end user. Within this system if the devices are able to be powered
        by fixed mains, they should be. This will allow for more processing heavy modules and toolsets to be used
        without fear of diminishing battery life of the system.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n2436' class='md-header-anchor '></a>Requirements</h3>
    <p>After conducting interview analysis, we drafted up some ideas and a potential feature set of modules for the
        system. We reviewed this list with Steve, our client.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2439' class='md-header-anchor '></a>Proposed Functionality</h4>
    <p><strong>Automated Door</strong></p>
    <p>Every smallholder interviewed face issues with safe guarding their chicken coop against the fox. One of the ways
        they do this is to shut the coop at night. However, this ties the owner down to a certain time every evening to
        do this. We will research and implement a solution which will automate this and provide feedback, displaying the
        state of the door.</p>
    <p>&nbsp;</p>
    <p><strong>Food Monitor</strong></p>
    <p>Many smallholders face issues with chicken feed attracting rats and mice into the coop. A solution we thought up
        involved an automated feeder or monitor which will alert the user when food needs to be added, or an automated
        solution which dispenses food.</p>
    <p>&nbsp;</p>
    <p><strong>Water Monitor</strong></p>
    <p>On the same page as the food monitor, this will monitor when the water level in the drinker is low. After a
        certain threshold the user will be notified.</p>
    <p>&nbsp;</p>
    <p><strong>Temperature Monitor</strong></p>
    <p>This will manage temperature inside the coop. From previous research, chickens are known to get &quot;heat
        stress&quot; which will decrease the production of eggs. By providing a monitor, a user could understand why a
        chicken has stopped laying eggs.</p>
    <p>&nbsp;</p>
    <p><strong>Humidity Monitor</strong></p>
    <p>Previous research shows that chickens can experience respiratory issues if humidity levels are high, as this
        increases the chance of mould growing in their bedding. The mould can then release spores which affects their
        immune system. By providing a monitor, a user can maintain optimal humidity levels ensuring the health of the
        flock.</p>
    <p>&nbsp;</p>
    <p><strong>Dust Monitor</strong></p>
    <p>Dust levels inside the coop must be minimal as both chickens and humans can get respiratory issues when breathing
        in more than 10mg/m³ over an 8 hour period.</p>
    <p>&nbsp;</p>
    <p><strong>Electric Fence Monitor</strong></p>
    <p>Smallholders utilize electric fences to deter predators, but some often forget to charge or swap out the battery
        powering it. By providing an electric fence monitor, the voltage can be calculated to determine if the battery
        needs replacing.</p>
    <p>&nbsp;</p>
    <p><strong>Egg Presence Detection</strong></p>
    <p>Inspired by Sue Moorhouse story of the egg thief, a device could be created that alerts the user when an egg has
        been laid, minimising the chance that a user goes to collect the eggs but none have been laid.</p>
    <p>&nbsp;</p>
    <p><strong>Interface to display monitoring data</strong></p>
    <p>An interface can be created to display the data from the above sensors.</p>
    <p>&nbsp;</p>
    <p><strong>Live Camera Feed</strong></p>
    <p>A live camera feed could be implemented so the user can see what their chickens are up to throughout the day. It
        also allows them a peace of mind that a fox has not infiltrated the coop.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2471' class='md-header-anchor '></a>Client Feedback</h4>
    <p>We spoke about these ideas to the client. Steve mentioned he&#39;s onboard for most of these ideas, stating that
        they will help ease the burden on keeping chickens and making sure his flock is healthy. He feels that the food
        monitor is not needed as he believes you owe some level of care and interation to your pets. As such, he would
        like to continue manually feeding them twice a day so he knows the chickens are getting enough food. He
        mentioned there is already a live camera feed of the chicken coop set up by his son so that functionality is not
        needed either.</p>
    <p>With this feedback in mind, we drafted out a requirements document.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2475' class='md-header-anchor '></a>Requirements</h4>
    <p>Please see the <a href='transcripts/requirements.pdf'>requirements document</a></p>
    <p>&nbsp;</p>
    <h4><a name='header-n2478' class='md-header-anchor '></a>Amendments</h4>
    <p>We were advised to not work with electric fence monitors as working with high-voltages can pose health and safety
        risks, especially as we&#39;re not experts in electronics. As for the rest of the requirements, Steve signed off
        on the list giving us the green light to proceed.</p>
    <p>&nbsp;</p>
    <h2><a name='header-n2481' class='md-header-anchor '></a>System Design Concepts</h2>
    <h3><a name='header-n2483' class='md-header-anchor '></a>Design </h3>
    <p>After reviewing and agreeing with the client on our requirements, we concepted some ideas which could fit the
        system.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2486' class='md-header-anchor '></a>Design Idea 1</h4>
    <p>A system was envisioned where each sensor operates on their own accord. These sensors will record information at
        a fixed interval and add the data to a database. </p>
    <p><img src='images/design_concepts/designidea1.png' alt='designidea1' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The visualisation will be able to control the automated door correctly through a means of a web request.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2492' class='md-header-anchor '></a>Design Idea 2</h4>
    <p>Another idea we developed was where a main hub controls the actions of each individual sensor by querying for
        information at certain intervals. The sensors will simply listen for this request. Once the hub retrieves this
        information, it will input the data into the database. </p>
    <p>&nbsp;</p>
    <p><img src='images/design_concepts/designidea2.png' alt='designidea2' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The visualisation will query data from this database and query the hub for door control. The hub will have
        endpoints to allow this to happen.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2499' class='md-header-anchor '></a>Visualisation Choice</h4>
    <p>As the client wanted to view the system on their phone, tablet and desktop, we opted for a web based solution for
        the visualisation aspect. Creating iPhone and Android apps (native apps) allow a better integrated user
        interface to match the design principles of each, integration with the phone&#39;s hardware (such as GPS).
        However, due to the time constraints of learning how to develop Android apps and learning Swift for iOS apps, we
        came to the conclusion that a web based solution will offer compatibility across all devices whilst minimising
        research and development time. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n2502' class='md-header-anchor '></a>Selected Design</h4>
    <p>We have opted to use Design Idea 2 where there is a central control hub which controls the actions of the modular
        network of sensors and devices. This means the individual sensors will not need internet network access, thus
        reducing the power requirement. The hub will solicit messages and add these values directly into the database.
        This also creates a layer of abstraction between the visualisation and the sensors. The visualisation aspect
        will only need to access the database and query information about the sensors via the hub. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n2505' class='md-header-anchor '></a>Wireless vs Wired</h4>
    <p>With the above in mind, we sketched up the placement of all sensors in the client&#39;s chicken coop. The client
        had moved their chicken coop at this point so we asked the client for new measurements, however, the overall aim
        stays the same.</p>
    <p>&nbsp;</p>
    <p><img src='images/design_concepts/sensor_sketchup.png' alt='Sketch of client chicken run'
            referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>From the above, we realised the water and electric fence monitors needed to be wireless as trailing cables
        outside are not desirable. Inside the coop, we can use either wireless or wired, however, we opted to use wired
        as these protocols are cheaper and more reliable. We were unsure whether to host the webserver on the cloud,
        however, the client clarified they would like this to be hosted onsite. </p>
    <p>&nbsp;</p>
    <p><img src='images/design_concepts/finished_high_level_design.png' alt='Finished high level design'
            referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The above is a diagram of our finished conceptual design. With the system divided into modular parts, we then
        started working on each of these individual components.</p>
    <p>&nbsp;</p>
    <h2><a name='header-n2516' class='md-header-anchor '></a>Modules</h2>
    <h3><a name='header-n2518' class='md-header-anchor '></a>Coop Door</h3>
    <h4><a name='header-n2519' class='md-header-anchor '></a>Premise</h4>
    <p>A core concept for chickens is the the need to roost and seek shelter, not only for protection against the
        elements but natural predators. As such, a flock of chickens require an established shelter (known as a coop) to
        house them. Unfortunately, this means that there is a point of entry into the chicken coop that needs to be
        actively managed. Naturally predators such as foxes, make quick work of a weakness like this and will happily
        slaughter an entire entire flock; regarded as &#39;surplus killing&#39; or &#39;henhouse syndrome&#39;. </p>
    <p>Knowing this, it is critical that a proprietor of chickens afford them protection, less their lives be at risk.
        Through our research we have identified various means of security utilised in coops, from sliding doors to
        hatches and even existing automated solutions; albeit rather crude implementations.</p>
    <p>This requirement forces the owner of the flock to be available at certain points of the day, ensuring the flock
        is kept safe. Holidays, family events or even a working lifestyle become harder to routinely provide for as an
        owner will always be at the whim of time. Owing to this major constraint our client was keen on this particular
        module&#39;s introduction. As such we aimed to deliver.</p>
    <p>The client had a simple request - automate the door. However this task itself is not as simple as closing/opening
        when the sun goes down. Chickens can exhibit various behaviours individually and as such vary their modus
        operandi on &#39;bed-time&#39;; some may simply go to sleep later than others. The module would need to afford
        this and much more. </p>
    <p>Researching and speaking to clients, we discovered that chickens will naturally roost when the weather drops,
        light decreases and time progresses into evening. As the daylight expands and the sun provides lighter evenings,
        chickens often stay out later - we could not just assume the same bedtime was always the case. Knowing this, the
        module had to adapt to the various seasons of the year. It could not fail and if an error occurred or an event
        triggered then the module must be able to alert the client of such.</p>
    <p>We planned an initial design that would utilise light and time to calculate the perfect time to secure the coop,
        this would ensure that a minor mishap (such as a firework, eclipse etc) would not trick the module into acting
        unexpectedly. </p>
    <h4><a name='header-n2526' class='md-header-anchor '></a>Final Iteration Overview</h4>
    <p>The door was a physical frame that could operate remotely and locally with sensors to indicate whether it was
        open or closed. It was built for display purposes and utilised various technologies to reach its final
        iteration.</p>
    <p><img src='images/modules/door/door.jpeg' alt='image of completed door' referrerPolicy='no-referrer' /></p>
    <center><i>Finished Door Prototype</i></center>
    <p>Overall the module consisted of various parts:</p>
    <ul>
        <li>Physical mechanism was operated using a worm drive motor and L298N H-Bridge driver.</li>
        <li>DS1307 RTC and OTP101 Monolithic photodiode provided sensory information.</li>
        <li>Position of the door was tracked using the KY-003 Hall effect sensors.</li>
        <li>The door frame was comprised of plywood with the physical door being aluminium.</li>
        <li>CAN bus was utilised for communication control.</li>
        <li>2 separate physical buttons allowed for opening/closing control of the door. </li>
        <li>A 12V AA battery pack was provided to power the motor remotely without mains for demonstration purposes.
        </li>
        <li>The brain of the system was an Arduino Uno programmed in C/C++ (STDx03). </li>
    </ul>
    <p>The electronic schematic was designed as such:</p>
    <p><img src='images/modules/door/schematic.png' alt='schematic of door electronics' referrerPolicy='no-referrer' />
    </p>
    <p>Authors note: We are not electronic engineering students and received help with the design and implementation of
        this circuitry, it may be lacking or not up to standards with conventional commercial grade design and as such
        we ask for discretion when reviewing the technical aspects of it.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2552' class='md-header-anchor '></a>Iteration 1 (Research)</h4>
    <p>As seen in the premise, we knew prior to developing this module the constraints that chickens would need;
        furthermore we knew that the client would want remote control and feedback of the system. The following details
        our research behind finding a suitable microcontroller and whether we could incorporate an existing solution
        into our system. </p>
    <h5><a name='header-n2554' class='md-header-anchor '></a>Existing Solutions</h5>
    <h6><a name='header-n2555' class='md-header-anchor '></a>Automatic Door Opener</h6>
    <p>Automatic door opener is made by Backyard Chicken Coops, based in Australia. The company mainly sell a wide range
        chicken coops which can withstand the harsh climate of Australia, alongside chicken coop accessories such as our
        product of interest - Automatic Door Opener and a Solar Electric Fence Energiser.</p>
    <p><img src='images/modules/door/existing_research/auto_door_open.png' alt='automatic door opener'
            referrerPolicy='no-referrer' /></p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>Property</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Price</td>
                    <td>$199 AUD (~£110)</td>
                </tr>
                <tr>
                    <td>Website</td>
                    <td><a
                            href='https://www.backyardchickencoops.com.au/coop-accessories/automatic-chicken-door-opener/'>link</a>
                    </td>
                </tr>
                <tr>
                    <td>Power</td>
                    <td>4x Duracell batteries (type not mentioned)</td>
                </tr>
                <tr>
                    <td>Conditions to close</td>
                    <td>Timer</td>
                </tr>
                <tr>
                    <td>Weatherproof</td>
                    <td>&quot;Waterproof to withstand our harsh climate conditions&quot;</td>
                </tr>
                <tr>
                    <td>Notes</td>
                    <td>Will open and close the coop at set times programmed by the owner The website does not mention
                        if it will automatically close at dusk when not programmed Interface looks like an alarm clock
                        Door can be opened in multiple ways using an optional pulley system Optional pulley system
                        available shown below</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>The system is able to open and close the coop door at set times programmed by the owner, however, the website
        does not mention that this system will open at dawn or close at dusk, therefore we can assume this system does
        not have a light sensor. </p>
    <h6><a name='header-n2581' class='md-header-anchor '></a>Chicken Guard</h6>
    <p>ChickenGuard have multiple products with variable prices available to purchase. </p>
    <p><img src='images/modules/door/existing_research/chicken_guard.png' alt='chicken_guard'
            referrerPolicy='no-referrer' /></p>
    <p>Looking at their &#39;standard&#39; release:</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>Property</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Price</td>
                    <td>£114.99</td>
                </tr>
                <tr>
                    <td>Website</td>
                    <td><a href='https://www.chickenguard.com/product/standard/'>link</a></td>
                </tr>
                <tr>
                    <td>Power</td>
                    <td>4 x AA or Mains powered via USB</td>
                </tr>
                <tr>
                    <td>Conditions to close</td>
                    <td>Timer</td>
                </tr>
                <tr>
                    <td>Weatherproof</td>
                    <td>&quot;Weather proof casing&quot;</td>
                </tr>
                <tr>
                    <td>Notes</td>
                    <td>Expensive, provides battery warning, visible from 100m</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>The overall implementation while secure lacks any major feedback remotely. One of our biggest desires is to
        introduce remote monitoring that a client can take full advantage of.</p>
    <h5><a name='header-n2608' class='md-header-anchor '></a>Hardware Available</h5>
    <p>Various boards, SOC and microcontrollers exist that would be suitable, however given the nature of the project we
        desired a prototyping board; one that could be supportive of our requirements. The board needed to provide
        various outputs to support our light, time and physical control over the module. The following lists our
        research into the various boards available.</p>
    <h6><a name='header-n2610' class='md-header-anchor '></a>ATMEL-Boards</h6>
    <p>The Arduino family of boards are arguably the most common with newcomers to computing and electronics. The boards
        have a fully functioning IDE which integrates seamlessly with the hardware. The Uno is not alone in the family
        of Arduino boards, the option to use various others exists such as the Nano, Micro or even Mega (supporting
        various advanced elaborate features) but the context remains the same fundamentally. </p>
    <p>&nbsp;</p>
    <p><strong>Arduino Uno</strong></p>
    <p><img src='images/modules/door/uno.jpg' alt='Image of Arduino Uno' referrerPolicy='no-referrer' /></p>
    <p>The forerunner for Arduino is the Arduino Uno, a primitive but advanced microcontroller, supporting an ATmega328P
        microcontroller, a voltage regulator and additional DAC/ADC support with exterior pinouts. If anything majorly
        goes wrong with the microprocessor, it is simple to pop out and replace with a new one. </p>
    <p><strong>Arduino Micro</strong></p>
    <p><img src='images/modules/door/micro.jpg' alt='Image of Arduino Micro' referrerPolicy='no-referrer' /></p>
    <p>The Arduino Micro is designed to fit on a breadboard and runs on the same microprocessor, ATmega32u4, as another
        Arduino model, the Leonardo. The main difference in this model is the size, the Micro is one of the smallest
        boards available in the Arduino family. As the same with the Leonardo, this board has built-in USB
        communication.</p>
    <p><strong>Arduino Nano</strong></p>
    <p><img src='images/modules/door/nano.jpg' alt='Image of Arduino Nano' referrerPolicy='no-referrer' /></p>
    <p>The Nano is the smaller variant of the Arduino Uno - they both use the ATmega328 and has more RAM than the Micro
        due to the smaller bootloader on the microprocessor. </p>
    <p><span> </span></p>
    <h6><a name='header-n2623' class='md-header-anchor '></a>ARM-Boards</h6>
    <p>The option to use more sophisticated ARM boards existed, specifically common off the shelf boards such as the
        Raspberry Pi, ODroid or even ASUS Tinker board. Price and evaluation aside, a lot of these boards provided a
        comprehensive fledged operating system (Linux) and the perks along with it. The complexity afforded to this was
        beyond what was required, furthermore we lacked the requirement of advanced specifications that came with these
        boards.</p>
    <p><img src='images/modules/door/pi.jpg' alt='schematic of door electronics' referrerPolicy='no-referrer' /></p>
    <p>However, these boards would come into their own in the future; especially in the realm of the hub. While this
        option was readily available to us, if we planned to expand into a modular system with remotely powered systems
        it was not a feature presented on these systems. </p>
    <h5><a name='header-n2627' class='md-header-anchor '></a>Conclusion - Arduino Uno</h5>
    <p>Without a doubt, the easiest option for prototyping a proof of concept was the Arduino Uno. A board used for a
        lot of hobbyist projects, with easy integration with a wide range of sensors. Not only does it boast an advanced
        but easy-to-use system, it provides a well guided IDE for us to develop on. This board was readily available for
        us to use, and for future work, we could remove the microcontroller itself and attach it to the electronics
        board itself. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n2630' class='md-header-anchor '></a>Iteration 2</h4>
    <p>This iteration focused on the interface (buttons mostly), the motor to enable the module and how to determine
        whether the door is moving, open or closed. </p>
    <h5><a name='header-n2632' class='md-header-anchor '></a>Interface Design</h5>
    <p>The client requested we provide a form of input physically as well as remotely for the module, lest some part of
        the system failed - it could be operated individually. </p>
    <h5><a name='header-n2634' class='md-header-anchor '></a>Motor Research</h5>
    <p>Deciding upon a motor was difficult. Initially neither of us understood the physical components of a motor, nor
        what the various styles of motor that were commercially available. As such - we researched the various motors
        used in systems in general. </p>
    <p><strong><em>Actuators &amp; Drivers</em></strong></p>
    <p>Most smallholders have vertical doors on rails that slide back and forth, with nearly all existing solutions
        relying on these door types to provide their capabilities. We focused on the same door designs and looked at
        potential solutions for securing the chicken coop.</p>
    <p>Nearly all systems that exist on pulling and pushing require gravity and a form of actuator that reels in the
        component in question. Some systems may utilise magnets, pneumatics, hydraulics and most commonly motors. In the
        case of our system it was unlikely that we would be using hydraulics or pneumatics, as the expense of
        maintaining and implementing these was beyond the scope of our clients needs. Similarly, magnets (especially
        those of electro magnets) would require large power sources to lift and sustain the weight of the door. Ideally
        utilising a motor (which are also commonly used in existing solutions) was our best choice for both cost and
        implementation.</p>
    <p><strong><em>Motors</em></strong></p>
    <p>In general motors work on the principle of magnetics by inducing an electromagnet through either AC or DC power
        (we were working with batteries and mains power - through a transformer at 13 amps, as such we focused on DC
        power). They utilise a stator, rotor and commuter to perform their rotary capabilities. By wrapping a large coil
        of wire (stator) around the spindle (rotor) and passing current into the motor’s terminals, the motor will
        induce a permanent magnet onto the stator and cause the rotor to act as a electromagnet that induces a rotary
        effect – the commuter aims to keep the rotary effect in the same direction by switching the direction of the
        current whenever half a turn is made with the motor. Knowing this we could utilise a motor to leverage the
        mechanism behind opening and closing the door. There are various types of motors that exist and needed to decide
        which motor best suited our requirements of reeling the door up and down. This task had to allow for precision
        and control as a mistake could cause the door to fail. Several motors existed that we could have potentially
        utilised:</p>
    <ul>
        <li>Conventional DC Motors</li>
        <li>Hub Motors</li>
        <li>Induction Motors</li>
        <li>Linear Motors</li>
        <li>Stepper Motors</li>
    </ul>
    <p><strong><em>Conventional DC Motors</em></strong></p>
    <p>There are 3 types of DC motor that we wanted to investigate, each having various advantages and disadvantages:
    </p>
    <ul>
        <li>Brushed Motor</li>
        <li>Brushless Motor</li>
        <li>Servo Motor</li>
    </ul>
    <p><strong><em>Brushed Motor</em></strong></p>
    <p>A very common motor utilised in cheap circuitry – utilises permanent magnets to provide a linear speed and torque
        owed to the strong magnetic field. Recommended in robotics and servos. They’re efficient and cheap - although
        suffer from problems involving the brushes inside the motor (which are designed to work with the commuter).
        These brushes can ‘spark’ and clash with the stator which will wear out and eventually cause more internal
        resistance (requiring more power over time) and excessive heat. These motors are notorious for being effective
        but lacking a long lifespan.</p>
    <p><img src='images/modules/door/brushed_motor.jpg' alt='brushed motor diagram' referrerPolicy='no-referrer' /></p>
    <center><i>Source:
            https://www.wonkeedonkeetools.co.uk/media/wysiwyg/CID-Cordless-Impact-Drivers-Ruth/CID25/CID-25-2.jpg</i>
    </center>
    <p>&nbsp;</p>
    <p><strong><em>Brushless Motor</em></strong></p>
    <p>Brushless motors were invented to overcome common issues with brushed motors. In these motors the brushes are
        replaced with a complex drive circuit which allows for precise synchronisation; in turn allowing for better
        speed and torque control. It’s conventionally more expensive but is considered a significant improvement over
        brushed motor. Benefits of this motor include synchronisation to digital clock signals from pole sensors (hall
        effect or optical sensors). While they’re more complex and expensive they provide higher efficiency, reliability
        and defined good speed control. </p>
    <p><img src='images/modules/door/brushless_motor.gif' alt='brushless motor diagram' referrerPolicy='no-referrer' />
    </p>
    <center><i>Source: https://www.renesas.com/eu/en/img/misc/engineer-school/fig3-a-bldc-monitor-en.gif</i></center>
    <p>&nbsp;</p>
    <p><strong><em>Servo Motor</em></strong></p>
    <p>Capable of delivering high torque directly through a built-in gearbox which can calibrated for different speeds –
        this causes the rotary shaft of the motor to not freely spin seen in brushless/brushed motors owing to the
        gearbox. These motors often contain a collection of tools within them for error handling and precision, these
        include a gearbox and positional feedback device. They’re unable to continually rotate at high speeds like
        conventional DC motors unless modified but can rotate 180 degrees in either direction allowing for accurate
        angular positioning. </p>
    <p>&nbsp;</p>
    <p><strong><em>Hub Motors</em></strong></p>
    <p>Conventionally like a normal DC motor except the inverse operation happens, whereas normally a DC motor has a
        rotary spindle in its rotor with a static stator on the outside – a hub motor has a static rotor in the central
        with the outside stator being the rotating element. Essentially the outer component rotates rather than the
        internal spindle. These inverse motors are commonly used in electric cars and have many benefits for such
        designs. For the purpose of our project they would not necessarily be any more useful than a traditional DC
        motor and actually have issues involving torque. These issues exist due to their design in which they are used
        in wheels on cars or bikes. The issue with torque is resolved by increasing the size of the stator and rotor
        however this is overkill for our project which does not intend to drive wheels in revolutions and aims to simply
        lift a door about 30cm.</p>
    <p><strong><em>Induction Motors</em></strong></p>
    <p>These motors are driven by AC as opposed to DC, they’re technically a lot more sophisticated than a conventional
        DC motor as they encompass a ring of electromagnets around the outside which compromises the stator. By powering
        the stator, we can induce Lenz’ law and Faradays law which encourages the rotor to spin endlessly trying to
        reduce the difference between the two potentials of the stator and rotor. While incredibly simple with one
        moving part (very low-cost) they are not useful to us in our project as we intend to utilise DC instead of AC.
    </p>
    <p><strong><em>Linear Motors</em></strong></p>
    <p>These motors induce an electric current that forces motion into a linear context. The stator which usually
        appears on the outside on a conventional motor now focuses on a single straight below the rotor. This pulls the
        motor forward along the stator. Since a linear motor utilises induction which relies on AC power - we can’t
        consider this for our project although they are incredibly powerful and fascinating motors.</p>
    <p><strong><em>Stepper Motors</em></strong></p>
    <p>A staple in 3D printing, stepper motors have absolute precision owing to their quadrable magnets aligned to
        present a near perfect rotational field of power. Two pairs are provided that alternate their polar magnetism to
        force the rotor to rotate around the physical magnetic field. As such, a lock and hold is present. These motors
        are commonly used in systems that require precise precision. </p>
    <p><strong><em>Conclusion - Stepper Motors</em></strong></p>
    <p>We felt that this style of motor would best suit our intended design as it allowed for exact steps to be
        recorded. Furthermore we could utilise this to vary the style of door produced. Whether it was a standing or
        sliding door.</p>
    <p>However - while in our infancy we decided this choice would suit the requirements of the module, we later
        discovered several serious flaws that undermined the design and posed a serious risk to the structure of the
        system. The motor design choice was retrofitted in iteration 5, while this is much later than we would have
        anticipated, it&#39;s purely a point of ignorance - we did not realise the flaw even existed until then.</p>
    <p>We decided to uitlise the A4988 stepper driver motor to support our decision, accompanied with a NEMA 17 as the
        motor itself. Both of these are powerful, relatively cheap and commonly supported stepper motors that would
        integrate with our module design.</p>
    <h5><a name='header-n2686' class='md-header-anchor '></a>Sensor Research</h5>
    <p>We had to guarantee that the door was closed, open or moving - assuming the latter, it may have been stuck even.
        The design choice behind this was to provide the end-user precise and exact information rather than assumptions;
        knowing the position would be critical for feedback.</p>
    <h6><a name='header-n2688' class='md-header-anchor '></a>Micro Switches</h6>
    <p>Initially, we came up with a simple mechanism for interpreting the modules &#39;closed&#39; state. When the
        weight of the door fell upon these switches, they would close and send a high signal to whichever device needed
        it. </p>
    <p><img src='images/modules/door/microswitches.jpeg' alt='micro switch solution' referrerPolicy='no-referrer' /></p>
    <p>This design while simple and cheap, affords several problems:</p>
    <ul>
        <li>Corrosion, water and environmental damage - these switches could be interfered with from nature and lead to
            a false positive on the door position.</li>
        <li>One-sided information - we only know if the door is closed, while we could provide a ceiling set of
            switches, practically this is bad design and a poor choice.</li>
        <li>Subject to fault - The potential for these to go wrong is high, we could receive false positives because of
            this.</li>
    </ul>
    <p>After speaking Dan and Keith, they suggested we look into reed switches and Hall Effect sensors.</p>
    <h6><a name='header-n2700' class='md-header-anchor '></a>Reed Switches</h6>
    <p>A reed switch is a magnetic switch that simply opens or closes a circuit based on the nearby magnetic field
        present. Laymen terms, provide a magnet near the sensor to trigger it&#39;s behaviour. </p>
    <p><img src='images/modules/door/reed_switch.jpg' alt='reed switch diagram' referrerPolicy='no-referrer' /></p>
    <center><i> Source: http://www.chicagosensor.com/images/HowItWorksReed.jpg </i></center>
    <p>&nbsp;</p>
    <p>Unfortunately reed switches while cheap and simple suffer from damage easily, being made out of glass. Simply
        mishandling can break them entirely - especially under vibration and with motor involved this could cause severe
        issues. Given their mechanical nature, they can also naturally &#39;seize&#39; and lock into position severely
        limiting their lifespan.</p>
    <h6><a name='header-n2706' class='md-header-anchor '></a>Hall Effect Sensors</h6>
    <p>A similar component to a reed switch, operating on magnetism and providing a clear open/close circuits. Their
        range is limited to no more than 10mm and requires a fairly strong magnetic field to switch. These sensors have
        a positive and negative connection alongside a 3rd connection for signal. Compared to the reed switches, more
        industrial weatherproof sensors are readily available that can withstand severe conditions.</p>
    <h6><a name='header-n2708' class='md-header-anchor '></a>EEPROM</h6>
    <p>Arguably, one could utilise the EEPROM to store the current position of the motor in increments. EEPROM provides
        a store of memory that can be accessed regardless of memory state. Whether the device has since restarted or
        operated for days, the values stored in EEPROM are verbose and persistent. Utilising EEPROM is costly, not only
        is there a possibility for transistor lock but the current cost required in ampere can be severe in the long
        run; especially if we designed a battery powered system. </p>
    <h6><a name='header-n2710' class='md-header-anchor '></a>Conclusion - Hall Effect/Reed Switches</h6>
    <p>Owing to a proof of concept we decided to utilise Hall Effect sensors due to their capability to withstand harsh
        climates. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n2713' class='md-header-anchor '></a>Iteration 3</h4>
    <p>Having agreed on the motor and sensors required, we pursued our interests into modular and standalone design. The
        module needed to operate alone upon a potential network failure, it was critical the door functioned as intended
        regardless of the state of the door. The module had to provide a clear individual set of sensors to work within
        the boundary of a standalone system. </p>
    <h5><a name='header-n2715' class='md-header-anchor '></a>Self Sufficiency</h5>
    <p><strong><em>Light Sensor</em></strong></p>
    <p>Given our lack of knowledge in the field, we spent a portion of time dedicated to understanding and researching
        various light related sensors. Cheap and commercially available ones are on demand and the two that caught our
        attention the most were photodiodes and light-dependent-resistors. In the intended system either would have
        sufficed. Given the materials available to us we utilised a photodiode chip to work on our behalf.</p>
    <p><strong><em>Real-time clock (RTC)</em></strong></p>
    <p>Unfortunately, the Uno did not provide a native clock to keep track of time, as such we provided a RTC component
        to handle this for us. Various RTC modules exist but the simplest one is the RTC DS1307 which while limited
        provides the core functionality necessary for the module to operate. Various other clocks exist and could have
        provided slightly better alternatives see the <a href="#header-n2817">future work</a> section. As the module had to know the relevant
        time in order to operate, it was imperative we had a mechanism to keep track of time.</p>
    <p>This RTC in particular was readily available in the Shed for a project like this and saved us the time and
        resources on gathering one ourselves.</p>
    <p><strong><em>Power</em></strong></p>
    <p>Simple but effective - our main client had mains power at the ready. We took full advantage of this as utilising
        batteries and other features would have drawn our attention elsewhere.</p>
    <p>We acknowledge that many smallholders do not have this luxury but under our circumstances, due to being a small
        team, we wanted to produce a working door first. After, if time allowed, we would like to research and develop a
        low powered solution which accommodates the needs of all smallholders. We did utilise a battery pack for our
        module motor in future designs though, albeit this was purely to distance ourselves from requiring a 12v power
        supply to test and operate the door.</p>
    <h5><a name='header-n2724' class='md-header-anchor '></a>Door Design</h5>
    <p>The primitive design was modelled of all existing client solutions. A door that could be raised/lowered upon
        command or event. The door itself had to be sufficiently sturdy and resistance to warping, a command feature of
        wooden doors that vary their structure based on weather. </p>
    <p>We utilised plywood to build a frame, an aluminium door itself to replicate the existing structures (and avoid
        aforementioned warping). </p>
    <p><img src='images/modules/door/basic_door.JPEG' alt='initial door design' referrerPolicy='no-referrer' /></p>
    <p>When constructing the frame of the door, we joked that the device looked like a guillotine, so we engraved the
        text on. In hindsight, we felt this was not professional and proceeded to cover it up for future demonstrations.
    </p>
    <p>&nbsp;</p>
    <h5><a name='header-n2730' class='md-header-anchor '></a>CAN Bus integration</h5>
    <p>When initially prototyping the door, we opted to use Serial as a way of communicating between devices. </p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"
        style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre>
    </div>
    <div class="CodeMirror-measure"></div>
    <div style="position: relative; z-index: 1;"></div>
    <div class="CodeMirror-code" role="presentation" style="">
        <div class="CodeMirror-activeline" style="position: relative;">
            <div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
            <div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
            <pre class=" CodeMirror-line "
                role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">Serial</span>.<span class="cm-variable">available</span>()) {</span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">availableBytes</span> <span class="cm-operator">=</span> <span class="cm-variable">Serial</span>.<span class="cm-variable">available</span>();</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable">command</span>[<span class="cm-variable">availableBytes</span>];</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//retrieve data from serial and turn into char array</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">availableBytes</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>)</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable">c</span> <span class="cm-operator">=</span> <span class="cm-variable">Serial</span>.<span class="cm-variable">read</span>();</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">c</span> <span class="cm-operator">!=</span> <span class="cm-string">'\n'</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">c</span> <span class="cm-operator">!=</span> <span class="cm-string">'\r'</span>){</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">command</span>[<span class="cm-variable">i</span>] <span class="cm-operator">=</span> <span class="cm-variable">c</span>;</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  }<span class="cm-keyword">else</span>{</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//send of char array denotes \0 character</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">command</span>[<span class="cm-variable">i</span>] <span class="cm-operator">=</span> <span class="cm-string">'\0'</span>;</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">strcmp</span>(<span class="cm-variable">command</span>,<span class="cm-variable">DOOR_STATUS</span>) <span class="cm-operator">==</span> <span class="cm-number">0</span>) {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">Serial</span>.<span class="cm-variable">println</span>(<span class="cm-variable">get_door_status</span>());</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">strcmp</span>(<span class="cm-variable">command</span>,<span class="cm-variable">OPEN_DOOR</span>) <span class="cm-operator">==</span> <span class="cm-number">0</span>) {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">Serial</span>.<span class="cm-variable">println</span>(<span class="cm-variable">open_door_response</span>());</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">strcmp</span>(<span class="cm-variable">command</span>,<span class="cm-variable">CLOSE_DOOR</span>) <span class="cm-operator">==</span> <span class="cm-number">0</span>) {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">Serial</span>.<span class="cm-variable">println</span>(<span class="cm-variable">close_door_response</span>());</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span> {</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">Serial</span>.<span class="cm-variable">println</span>(<span class="cm-variable">DOOR_ERROR</span>);</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 690px;"></div>
    <div class="CodeMirror-gutters" style="display: none; height: 690px;"></div>
    </div>
    </div>
    </pre>
    <p>&nbsp;</p>
    <p>Whilst this worked primitively, Dan Knox suggested we look into CAN bus and other communication protocols. He
        suggested CAN bus as it is more robust and allows solicited messages. For more information about this, please
        see the networking section.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n2736' class='md-header-anchor '></a>Code design</h5>
    <p>Using C and C++ as individuals from a Java taught environment posed a slight challenge, although we quickly rose
        above this. The bulk of the source can be found <a href='code/modules/door'>here</a>. We designed the system
        with the intention of abstracting low-level logic away from maths based decision making, i.e. when to operate
        the door, consider the network and act as a host. </p>
    <p>We designed several handlers to operate as managers for the module:</p>
    <ul>
        <li>DoorHandler: providing functionality to the physical door itself.</li>
        <li>ControlHandler: allowing simplistic calls to retrieve data regarding the actuators.</li>
        <li>CANBusHandler: abstracting the network control.</li>
    </ul>
    <h6><a name='header-n2746' class='md-header-anchor '></a>MotorHandler</h6>
    <p>The premise of the motor handler class was to maintain the relationship between hall effects sensors and motor.
        The handler would provide as much feedback as plausible while restricting the door if a decision was made that
        may damage or impact its performance (such as requesting a closure when its already reporting closed). The main
        operating loop of the microcontroller could poll the status of the door and if necessary open, close and
        retrieve the state of the door.</p>
    <h6><a name='header-n2748' class='md-header-anchor '></a>ControlHandler</h6>
    <p>The control handler needed to be able to support the RTC and photodiode, providing abstracted functionality such
        as <code>get_light_level()</code> without much complaint. It would also need to allow for an updating measure
        provided to the RTC given the nature that it may &#39;skip&#39; time by a second or so a week. Eventually over a
        period of months, the RTC would become more and more out of sync, as such a mandatory update of its
        time-reference was necessary to avoid this.</p>
    <h6><a name='header-n2750' class='md-header-anchor '></a>CANBusHandler</h6>
    <p>A library was already present for the CAN bus integration on Arduino, however to simplify matters we introduced a
        wrapper that would sit between our network design and the hardware interface.</p>
    <p>The handler would provide addressing schemes and message objects to easily wrap the contents in. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n2754' class='md-header-anchor '></a>Iteration 4</h4>
    <h5><a name='header-n2755' class='md-header-anchor '></a>Motor change</h5>
    <p>An issue arose during development of the board involving the motor. We consistently found stepper motors failing
        on us, with 3 in total failing. We could not decipher as to why this issue arose - arguably it could have been a
        current draw, short or possibly worse. However for hours on end the motor would operate consistently as expected
        until it looses it&#39;s torque. </p>
    <p>Another issue we encountered with the stepper motor was the need to be constantly powered to maintain its
        position, meaning that if the door was in the open state, the stepper motor would heat up considerably. </p>
    <p>Another minor issue arose when we discovered that the motor would slowly slip over time, lowering itself from the
        hall effect sensors and awarding a false negative to its location. </p>
    <p>While a stepper motor offers consistent accuracy and consistency over modern motors it lacks any sufficient
        locking mechanism and as such if a power failure or fault occurred could drop the coop door like a guillotine;
        harming or sealing the chickens from access. With this in mind we had to discover a new motor or electronic
        alternative that could rectify this problem. </p>
    <p>Through research we discovered what is known as a worm drive motor, a motor powered by a unique gearbox mechanism
        that provides a self-locking design. If the power fails or a wire disconnects, the coop door does not change
        position rather locking itself in place. However with change comes disadvantage. We found that the RPM was
        slower, heat was produced faster and the pure cost was higher than anticipated. Regardless - the change was a
        successfully changeover. </p>
    <p>We incorporated our new DC motor with supported worm drive gearbox into the module design and found immediate
        success. The door design itself had to change, with the original motor taking a large thread and spanning across
        the top frame. The worm drive simply adhered with M4 screws into the top frame. </p>
    <p>Along with the new motor, the original A4988 stepper driver motor had to be changed. It only supported stepper
        motors and a conventional DC motor was not going to make the cut. Fortunately a well supported standard known as
        a H-Bridge driver was available to us with various development boards readily available. The L298N development
        supported dual motors, a voltage regulator, speed control and polarity. </p>
    <p>Diagram of the completed door schematic:</p>
    <p>&nbsp;</p>
    <p><img src='images/modules/door/schematic.png' alt='initial door design' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <h5><a name='header-n2767' class='md-header-anchor '></a>Portable Power</h5>
    <p>With the intention of displaying this at the project fair, it was neither safe nor predictable whether we could
        provide consistent mains power to operate the board and motor. We decided to utilise a set of standardised AA
        batteries (operating at 1.5v) in series to provide ~12v to power the system. </p>
    <h5><a name='header-n2769' class='md-header-anchor '></a>Buttons</h5>
    <p>The client had requested some physical control on the module itself, we could not purely rely on a networked
        solution encase the door suffered a network failure. We utilised two buttons in coordination with a pulldown
        resistor to operate on interrupts within our code. Concern was raised as to whether the chickens may
        accidentally peck these buttons, as such we incorporated a rapid triple touch feature to overcome this concern.
    </p>
    <p>&nbsp;</p>
    <h4><a name='header-n2772' class='md-header-anchor '></a>Final Iteration</h4>
    <h5><a name='header-n2773' class='md-header-anchor '></a>Code Snippets &amp; Source</h5>
    <p>The entire source can be found <a href='code/modules/door'>here</a>.</p>
    <p>As mentioned prior, the door was designed to be modular and this extends to the code implementation which offered
        abstracted handlers for various roles. By breaking down the core responsibilities into singletons, we managed to
        simplify our testing arrangements and design procedures.</p>
    <p>It also allowed the code to flourish in readability and presentation, a simple no-nonsense command could be
        issued with little requirement of impact or knowledge of the backend; a black box. </p>
    <p>Below are examples of such confined but rewarding functionality.</p>
    <p><strong><em>ControlHandler</em></strong></p>
    <p>Get the current time as a 32bit integer and the light level averaged.</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded"
        lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre>
    </div>
    <div class="CodeMirror-measure"></div>
    <div style="position: relative; z-index: 1;"></div>
    <div class="CodeMirror-code" role="presentation" style="">
        <div class="CodeMirror-activeline" style="position: relative;">
            <div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
            <div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
            <pre class=" CodeMirror-line "
                role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uint8_t</span> <span class="cm-variable">average_light</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span>(<span class="cm-variable">uint8_t</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">100</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>)</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">average_light</span> <span class="cm-operator">+=</span> <span class="cm-variable">controlHandler</span>.<span class="cm-variable">get_light_level</span>();</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">average_light</span> <span class="cm-operator">/=</span> <span class="cm-number">100</span>;</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uint32_t</span> <span class="cm-variable">unix_time</span> <span class="cm-operator">=</span> <span class="cm-variable">controlHandler</span>.<span class="cm-variable">get_date_unix</span>();</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printf</span>(<span class="cm-string">"Unix time: %d, Avg Light: %d\n"</span>, <span class="cm-variable">unix_time</span>, <span class="cm-variable">average_light</span>);</span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 230px;"></div>
    <div class="CodeMirror-gutters" style="display: none; height: 230px;"></div>
    </div>
    </div>
    </pre>
    <p>&nbsp;</p>
    <p><strong><em>MotorHandler</em></strong></p>
    <p>Move door and validate:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"
        style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre>
    </div>
    <div class="CodeMirror-measure"></div>
    <div style="position: relative; z-index: 1;"></div>
    <div class="CodeMirror-code" role="presentation" style="">
        <div class="CodeMirror-activeline" style="position: relative;">
            <div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
            <div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
            <pre class=" CodeMirror-line "
                role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uint8_t</span> <span class="cm-variable">state</span> <span class="cm-operator">=</span> <span class="cm-variable">motor_handler</span>.<span class="cm-variable">get_door_state</span>();</span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">bool</span> <span class="cm-variable">success</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/* Is the door closed? */</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> &nbsp; &nbsp; ( <span class="cm-variable">state</span> <span class="cm-operator">==</span> <span class="cm-number">1</span> )</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">success</span> <span class="cm-operator">=</span> <span class="cm-variable">motor_handler</span>.<span class="cm-variable">open_door</span>();</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/* What about open? */</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">state</span> <span class="cm-operator">==</span> <span class="cm-number">2</span>)</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">success</span> <span class="cm-operator">=</span> <span class="cm-variable">motor_handler</span>.<span class="cm-variable">close_door</span>();</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">else</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// Oh no! The door is stuck or moving!</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>(<span class="cm-variable">success</span>)</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// We moved the door successfully!</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">else</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// Oh no! Something went wrong!</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 598px;"></div>
    <div class="CodeMirror-gutters" style="display: none; height: 598px;"></div>
    </div>
    </div>
    </pre>
    <p>&nbsp;</p>
    <p>Status may return 6 possible values:</p>
    <ul>
        <li>1 - Door closed.</li>
        <li>2 - Door open.</li>
        <li>3 - Door no sensors active.</li>
        <li>4 - Door both sensors active.</li>
        <li>5 - Door is moving.</li>
        <li>6 - Door is switching states after moving.</li>
    </ul>
    <p>&nbsp;</p>
    <p><strong><em>CanbusHandler</em></strong></p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded"
        lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre>
    </div>
    <div class="CodeMirror-measure"></div>
    <div style="position: relative; z-index: 1;"></div>
    <div class="CodeMirror-code" role="presentation" style="">
        <div class="CodeMirror-activeline" style="position: relative;">
            <div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
            <div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
            <pre class=" CodeMirror-line "
                role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/* Receive any messages available to us */</span></span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">CanbusMessage</span> <span class="cm-variable">cm</span> <span class="cm-operator">=</span> <span class="cm-variable">canbusHandler</span>.<span class="cm-variable">poll</span>();</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-operator">!</span> <span class="cm-variable">cm</span>.<span class="cm-variable">is_empty</span>())</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uint8_t</span> <span class="cm-variable">sender</span> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-operator">=</span> <span class="cm-variable">cm</span>.<span class="cm-variable">get_sender</span>();</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">uint8_t</span> <span class="cm-variable">destination</span> <span class="cm-operator">=</span> <span class="cm-variable">cm</span>.<span class="cm-variable">get_destination</span>();</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// response, read etc</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">canbusHandler</span>.<span class="cm-variable">send_message</span>(<span class="cm-variable">sender</span>, <span class="cm-number">0x01</span>, <span class="cm-string">"Hello world!"</span>);</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">else</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// error!</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 299px;"></div>
    <div class="CodeMirror-gutters" style="display: none; height: 299px;"></div>
    </div>
    </div>
    </pre>
    <p>&nbsp;</p>
    <h5><a name='header-n2804' class='md-header-anchor '></a>Client Installation</h5>
    <p>At this point in the project timeline we approached Christmas of 2018, our prototype system was working as
        intended and designed to operate within the boundaries of the client. We did not install the system directly,
        rather providing all resources (hardware and software) for the client. They would not have the CAN bus
        integration provided but a individual module operating solely. The client was pleased with the solution provided
        but did note feedback for future design.</p>
    <p>Note: the client owns various &#39;runs&#39; for their chickens and the initially prototype deployed was in a
        secure run that was monitored remotely, if a serious fault occurred it was dealt with immediately. The client
        secured the device within a IP rated box to the the side of their desired coop and handled issues we had not
        delved into (owing mostly to time constraints) such as weather proofing the system. As of this report (March,
        2019), the module is still operating as intended.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2808' class='md-header-anchor '></a>Known Issues</h4>
    <p>Below are various issues that we noted throughout the modules life experience. </p>
    <h6><a name='header-n2810' class='md-header-anchor '></a>Power drain</h6>
    <p>The current solution is lacking a consistent power source. Most smallholders do not have power onsite or within
        range of the coop and as such opt for battery operated solutions. Our system, while a prototype would not
        accommodate this. COTS solutions often operate on batteries and we should look to emulate this design in future.
    </p>
    <h6><a name='header-n2812' class='md-header-anchor '></a>Floating buttons</h6>
    <p>Unfortunately, our buttons suffered a side-effect known within electronics as a &#39;floating voltage&#39;, a
        voltage that without a grounded connection will arc and ground where possible; often to a unwarranted GPIO.
        While we tried to handle this problem with pull-down resistors it appears to have not be incorporated correctly.
        Even with the triple-click feature interrupt, there is a chance that the door will close/open itself. </p>
    <h6><a name='header-n2814' class='md-header-anchor '></a>Material, Design and Use</h6>
    <p>While the prototype was not intended for the deployment, it is in theory a poor choice. Wood has the potential of
        swelling under rain and adjusting its dimensions; jamming the door. We did opt to utilise an aluminium door to
        hinder this but never tested our system within a real environment (outside the clients coop, who had their own
        door). </p>
    <p>&nbsp;</p>
    <h4><a name='header-n2817' class='md-header-anchor '></a>Future work</h4>
    <p>The door was a major pinnacle for the system, it could not fail and had to be self-sufficent upon a network
        failure. While we provided a concise module, there were improvements if given the time that would have worked to
        improve the module design.</p>
    <h6><a name='header-n2819' class='md-header-anchor '></a>EEPROM Management</h6>
    <p>We could have utilised the internal EEPROM to save information regarding the door state if a network failure
        occurred. EEPROM does have a limited lifespan but this would most likely outweigh the life of the physical
        electronic components. Information that could have been saved would have been data such as:</p>
    <ul>
        <li>Door closing time</li>
        <li>Door opening time</li>
        <li>Current position of door (with 0 being the bottom and N being the top)</li>
        <li>Sensor information</li>
        <li>Whether automation was enabled</li>
        <li>Whether physical input was enabled</li>
        <li>The max &#39;input&#39; required to trigger a button, in case a chicken &#39;pecked&#39; them. </li>
        <li>The required light level to close or open</li>
        <li>Whether the door utilised light, time, both or neither (purely remotely/physically controlled)</li>
    </ul>
    <h6><a name='header-n2840' class='md-header-anchor '></a>Battery Powered, Relays and RTCs</h6>
    <p>The RTC used was a DS1307, it lacks true sophistication when compared to the DS3231; an RTC with alarms and more.
        Had we utilised an alarm operating RTC with relays for power management and sleep parameters on the board then
        its very plausible that the door could have truly been remotely powered without mains. Given our client provided
        mains power onsite this was not a direct requirement and would have drained our resources further.</p>
    <p>The Arduino Uno while an excellent prototyping board is limited to just that, a prototype. In true deployment we
        could not have utilised this for major management of a implementation. A different board, SOC or even PCB could
        have been designed for further management - then utilising an interrupt on said system with an RTC and Relay to
        operate power to the motor. </p>
    <h6><a name='header-n2843' class='md-header-anchor '></a>Update Hard-coded Door Cutoff Time</h6>
    <p>As it stands the door has a hard-coded cutoff time, that is a time at which it will open or close irregardless of
        the other settings within this system. At present this value is the nearest hour after dawn or dusk and updates
        month to month. In the future it would be nice to provide the end-user the capability of editing these values
        themselves and updating the door accordingly. </p>
    <p>&nbsp;</p>
    <h3><a name='header-n2847' class='md-header-anchor '></a>Coop Air Condition Sensors</h3>
    <h4><a name='header-n2848' class='md-header-anchor '></a>Premise</h4>
    <p>From the research conducted, it was noted that a high humidity content inside the coop are bad for the health of
        the flock. When roosting at night, the chickens release moisture from their breath, increasing the humidity in
        the coop. This is unhealthy for the flock as this can lead to an abundance of mould growing in their bedding.
        The mould then releases spores which the flock inhale and leads to sickness. Humidity above 75% will also
        decrease egg production. </p>
    <p>It is also noted that low temperatures will decrease egg production as the energy that went towards producing
        eggs is now spent warming themselves up. High temperatures will result in the birds suffering from heat stress
        which causes a lower growth rate and reduced egg production. </p>
    <p>Poultry dust is also a major concern in the industry as this can cause respiratory issues such as asthma in
        humans and regulations state that for the health of the poultry, inhalable dust must not exceed 10mg/m³ over an
        8 hour period. </p>
    <p>With the above health concerns in mind, we have created a device which monitors temperature, pressure, humidity
        and dust levels inside the coop itself. This should allow the smallholder to recognise these issues occurring
        and act accordingly.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2854' class='md-header-anchor '></a>Final Iteration Overview</h4>
    <p><img src='images/modules/air/air_sensor.jpg' alt='Image of completed air sensor' referrerPolicy='no-referrer' />
    </p>
    <p>This device was a simple monitoring solution which transmits data to our main hub by utilizing the CAN bus. The
        data transmitted consists of temperature, humidity, pressure and dust levels from inside the coop.</p>
    <p>Overall, the specific parts of this module consist of:</p>
    <ul>
        <li>BME280 Pressure, Temperature and Humidity sensor</li>
        <li>Sharp GP2Y1010AU0F Dust Density sensor</li>
        <li>MCP2515 was used to integrate this onto the CAN network.</li>
        <li>Arduino Uno, programmed in C/C++ (STDx03)</li>
    </ul>
    <p>&nbsp;</p>
    <p>Here is a Fritzing diagram of the complete circuit. </p>
    <p><img src='images/modules/air/air_sensor.png' alt='Wire diagram of air sensor' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <h4><a name='header-n2871' class='md-header-anchor '></a>Iteration 1 (Research)</h4>
    <p>From the initial premise, we knew we needed sensors to monitor temperature, humidty and dust levels. Dan Knox
        recommended we look into the BME280 which has sensors for temperature, humidity and pressure, alongisde thte
        DHT11/DHT12 sensors. </p>
    <p>From our research, it is noted that the DHTxx range require pull-up resistors and values can only be retrieved
        every 2s whereas the BME280 sensors had more accurancy in readings in regards to the humidity. As both these
        sensors suited our requirements, we opted for the BME280 sensor as this was readily available in the Shed and
        required less electronics knowledge.</p>
    <p>When we approached Dan for guidance on sensors, he mentioned he had some GP2Y1010AU0F available in the Shed. We
        found that this sensor is one of the more common dust detectors available. </p>
    <p>There is a newer model named GP2Y1014AU0F which operates in the same way as the one we are using but has improved
        accuracy (± 15% vs ± 30%). We decided to use the older version as this is what was available in the Shed and it
        would take more time we did not have to order the newer model in. </p>
    <p>These sensors work by having a photo-detector and a LED emitter inside the unit. When dust enters the hole, the
        light scatters, which means the more dust there is, the greater the intensity of the scattered light. The
        circuit we need to build will need a capacitor and a resistor, which allows the LED to pulse on an off, rather
        than having it constantly on. This is because the LED&#39;s intensity decreases as it ages, and therefore
        pulsing will help extend its lifetime. </p>
    <p>We decided to use the Arduino Uno due to the reason outlined in the door module section.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2879' class='md-header-anchor '></a>Iteration 2</h4>
    <p>Once we decided which sensors to use, we researched how to interface these separately with the Arduino. There
        were libraries provided by Adafruit for the BME280 available on the Arduino library manager which allowed easy
        integration with this sensor and guides which helped us wire the sensor up. We opted for the I2C Wiring as the
        instructions used less pins on the Arduino.</p>
    <p>We had more issues with the GP2Y1010AU0F dust sensor as there were more connections compared to the BME280 and
        resistors and capacitors needed to be added, however, we found a diagram displayed below, which helped us wire
        the system up. </p>
    <p><img src='images/modules/air/dust_diagram.png' alt='circuit diagram of sharp dust sensor'
            referrerPolicy='no-referrer' /></p>
    <p><a
            href='https://github.com/sharpsensoruser/sharp-sensor-demos/wiki/Application-Guide-for-Sharp-GP2Y1014AU0F-Dust-Sensor'>Source</a>
    </p>
    <p>&nbsp;</p>
    <p>The example code provided by Sharp was difficult to understand as it reads voltage levels as an input and
        converts it into a reading with the unit µg/m<sup>3 </sup>. The formula is as follows:</p>
    <pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded"
        lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre>
    </div>
    <div class="CodeMirror-measure"></div>
    <div style="position: relative; z-index: 1;"></div>
    <div class="CodeMirror-code" role="presentation" style="">
        <div class="CodeMirror-activeline" style="position: relative;">
            <div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
            <div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
            <pre class=" CodeMirror-line "
                role="presentation"><span role="presentation" style="padding-right: 0.1px;">Dust Density (µg/m3) = (ΔV /K) x 100</span></pre>
        </div>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>ΔV = Vout - Voc</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>Voc = Output when there is no dust</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>Vout = Output when measuring dust</span></pre>
        <pre class=" CodeMirror-line "
            role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>K = Sensitivity</span></pre>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div>
    <div class="CodeMirror-gutters" style="display: none; height: 138px;"></div>
    </div>
    </div>
    </pre>
    <p>&nbsp;</p>
    <p>Once we proved that both these sensors worked separately, we started work on integrating them into the same
        circuit. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n2890' class='md-header-anchor '></a>Iteration 3</h4>
    <p>Integrating both into the same circuit and combining the code together was relatively simple, however, we
        realised that the functionality of the dust sensor can be moved into a custom library to keep the main Arduino
        sketch neat and easy to read. Therefore, instead of doing the calculation for the dust levels inside the main
        sketch, a simple call to <code>dustSensor.get_dust_density()</code> was all that is needed to return the value.
    </p>
    <p>&nbsp;</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="c++" contenteditable="false" cid="n2893"
        mdtype="fences">/*
* Example showing the dustSensor library - a call to get_dust_density()
*/
uint16_t get_dust_readings() {
  float dd = dustSensor.get_dust_density();
  uint16_t dustDensity = (uint16_t)(dd);
  debug("Raw dust: ");
  debugln(dustDensity);
  return dustDensity;
}
</pre>
    <p>&nbsp;</p>
    <h4><a name='header-n2895' class='md-header-anchor '></a>Final Iteration</h4>
    <p><img src='images/modules/air/air_canbus.jpg' alt='picture of two arduinos connected via CAN bus'
            referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>After cleaning up the main sketch, we started to implement CAN bus into the system. Using the aforementioned
        CANBusHandler library we created, we were able to send data between two Arduinos, with the packet structure
        detailed more in the networking section. </p>
    <p>&nbsp;</p>
    <p><img src='images/modules/air/recv_air.png' alt='serial monitor displaying received data on CAN bus'
            referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>Once we were certain that the circuit works as expected, we soldered the components to a strip board with the
        help from Keith Greenhow and Mike Berry. The code for this component can be found below:</p>
    <p><a href='code/modules/air/air_tester.ino'>air_tester.ino</a></p>
    <p><a href='code/modules/air/coop_condition_monitor.ino'>coop_condition_monitor.ino</a></p>
    <p>&nbsp;</p>
    <p>Dust sensor library:</p>
    <ul>
        <li><a href='code/modules/air/dust_sensor_library/dust_sensor.h'>dust_sensor.h</a></li>
        <li><a href='code/modules/air/dust_sensor_library/dust_sensor.cpp'>dust_sensor.cpp</a></li>
    </ul>
    <p>&nbsp;</p>
    <h4><a name='header-n2913' class='md-header-anchor '></a>Known Issues</h4>
    <p>There is currently one known issue with this device:</p>
    <p>As the device operates using a fixed period (5s) loop, if the hub solicits readings from all sensors on this
        device at the same time, only the last solicited message of that period is recognised, this results in only one
        of the requested values being returned. In the current implementation the workaround for this is staggering the
        requests made from the hub such that it is guaranteed that only one request is present per period. In the future
        it would be ideal to remove this artificial delay and buffer the requests received from the CAN bus on the
        device.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2918' class='md-header-anchor '></a>Future Work</h4>
    <p>Future work could be done by researching if it is possible to make this system low powered to accommodate the
        requirements for all smallholders, not just our client. </p>
    <p>&nbsp;</p>
    <h3><a name='header-n2921' class='md-header-anchor '></a>Egg Identification</h3>
    <h4><a name='header-n2922' class='md-header-anchor '></a>Premise</h4>
    <p>Unlike some of the other issues looked into, like automation of the coop door and air condition monitoring, egg
        identification does not provide any benefit directly to the chickens, it&#39;s more so an ease of life feature
        for the smallholder. Lots of the smallholders that we spoke to stated that one of the benefits to owning
        chickens is that you don&#39;t just give them a decent loving life, but you also obtain responsibly sourced,
        free range eggs.</p>
    <p>That being said, the idea behind this feature is to provide a system that would inform the smallholder should any
        eggs be available within their coop to collect. It&#39;s not so much of a problem to check whilst the weather is
        nice but come rain and snow we could see it becoming tedious if when you do go to check, nothing is available.
        As such we thought this would be an interesting problem to tackle.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2926' class='md-header-anchor '></a>Final Iteration Overview</h4>
    <p>Though definitely still in the prototyping stage, we have developed software to train and classify images of eggs
        using a classification neural net. We have developed a client-server architecture such that a simple client
        device takes an image and sends it to an authenticated REST endpoint on the server for processing. The decision
        to use this architecture was not by choice, but necessity. The time required to predict the category of an image
        is just not feasible on a standard CPU and requires offloading to a compatible GPU. For our solution we opted to
        use the open source deep learning library <a href='https://pytorch.org/'>PyTorch</a>, alongside an Nvidia <a
            href='https://blogs.nvidia.com/blog/2012/09/10/what-is-cuda-2/'>CUDA core</a> supported GPU, a GTX 1060.
    </p>
    <p>A simple device in the coop, currently built using a Raspberry Pi Zero W, has an attached camera that points at
        the nest box. When a request is received from the control hub over the CAN, this device takes an image and sends
        it off for external processing. When a classification is received back from the server this is returned to the
        control hub.</p>
    <p>As for the current accuracy of our solution we have achieved a result of around 85 - 90%. This however, should be
        taken with a bit of caution, as these results were achieved in testing within a controlled environment. The
        training data used contains around 300-400 images, with approximately 75% taken by us and the other 25% obtained
        via Google image search. An interesting revelation that we noticed whilst at project fair was that it seems the
        network trained heavily on the shape features of the eggs and not colours, this was realised when it accurately
        identified a foil wrapped chocolate Easter egg.</p>
    <p>&nbsp;</p>
    <p>Here is in image showing five cycles of retraining the neural net against the training data and then checking
        against the testing images. As can be seen we achieve the results of: 0.861.., 0.875, 0.814.., 0.840.. and
        0.871.. against the testing images. This gives us a mean accuracy of approximately 0.852 or 85%.</p>
    <p><img src='images/modules/egg/retraining.png' alt='Training NN results' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>Below is an image of our test environment nest box; we tried for some level of accuracy on replicating the inside
        of an actual coop. The walls are wooden and the floor coated with straw.</p>
    <p><img src='images/modules/egg/egg_identifier_nestbox.jpg' alt='Egg identifier nestbox'
            referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <h4><a name='header-n2937' class='md-header-anchor '></a>Iteration 1 (Research)</h4>
    <p>Before setting out to build this device we need to look into what tools are available for performing this kind of
        task. From having looked into this field in the past, after seeing an article about a <a
            href='https://cloud.google.com/blog/products/gcp/how-a-japanese-cucumber-farmer-is-using-deep-learning-and-tensorflow'>Japanese
            cucumber farmer classifying cucumber types</a>, we know that these types of tasks can be solved using
        machine learning. So that&#39;s where we will begin.</p>
    <p>&nbsp;</p>
    <p>Looking into the available tools the two main machine learning frameworks we could find were, TensorFlow and
        PyTorch. TensorFlow is a machine learning platform developed primarily by Google and is the most popular
        framework available for this kind of task. TensorFlow has a huge community and an equally large learning curve.
        It is a complex tool that allows you to perform incredibly complex operations. On the other hand PyTorch is open
        source software developed primarily by Facebook, it is somewhat smaller than TensorFlow. PyTorch is still able
        to perform complex machine learning tasks but it does lack some of the features available for fine tuning neural
        nets that can be found in TensorFlow. </p>
    <p>Reading a blog post written by Yashvardhan Jain, he concluded that TensorFlow is much better for production
        models and scalability whereas PyTorch is easier to learn and lends itself better to creating simple prototypes,
        passion project and proofs of concept. He states the smaller learning curve in PyTorch compared to TensorFlow is
        down to the more intuitive pythonic style of programming. His blog post can be found <a
            href='https://medium.com/@UdacityINDIA/tensorflow-or-pytorch-the-force-is-strong-with-which-one-68226bb7dab4'>here</a>.
    </p>
    <p>To get some experience with how these different frameworks performed example classifiers were looked into for
        each. For TensorFlow a <a
            href='https://github.com/RaghavPrabhu/Deep-Learning/tree/master/dogs_breed_classification'>dog breed
            identifier</a> was used, as for PyTorch a <a
            href='https://github.com/rajesh-iiith/AIPND-ImageClassifier/blob/master/train.py'>flower classifier</a>.
        Both performed well and had quite good accuracy when identifying their respective types. As for code
        comprehension, fitting with what Yashvarhan said, the more pythonic style of PyTorch made it much simpler to
        understand. </p>
    <p>In the end we decided to go with PyTorch as our framework of choice, though the community is smaller, the more
        python like syntax and ability to quickly prototype sold it as the better choice for our current purpose. When
        we have created a working prototype and proven that the concept works, then we should consider swapping out to
        TensorFlow for production.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n2945' class='md-header-anchor '></a>Iteration 2 (Building the NN)</h4>
    <p>Now that we have decided what we are going to use to construct the classifier we should start looking into how to
        implement it, for the initial stages this will simply be seeing if we can train and predict from our own neural
        network.</p>
    <p>&nbsp;</p>
    <p>Using <a href='https://pytorch.org/tutorials/beginner/blitz/cifar10_tutorial.html'>PyTorch&#39;s beginners
            tutorial on image classification</a> we were able to create a simple network that returned the probabilistic
        likelihood that an image was either an egg or a plane. This approach uses a pretrained neural net as the base
        and as such only the last N layers are retrained to classify our desired images. We chose the comparison of
        plane and egg to convince ourselves that some level of identification was happening. Using a classification
        neural net trained on two images so dissimilar to one another it had to provide somewhat accurate results. If it
        did not the likelihood was that we must have done something drastically wrong within our code. It turns out that
        this classification worked.</p>
    <p>We got an average of around 97-98% training accuracy and here are some of the results our classification neural
        net produced. For the below images Index 0 was the egg training set and index 1 the planes set. </p>
    <p>&nbsp;</p>
    <p><img src='images/modules/egg/early_egg_classification.jpg' alt='Early egg classification results'
            referrerPolicy='no-referrer' /></p>
    <center>
        <i>
            [Index 0.0, Classification: 1.0]<br>
            [Index 1.0, Classification: 3.7954744902535253e-10]
        </i>
    </center>
    <p>&nbsp;</p>
    <p><img src='images/modules/egg/early_plane_classification.jpg' alt='Early plane classification results'
            referrerPolicy='no-referrer' /></p>
    <center>
        <i>
            [Index 0.0, Classification: 0.0006500619929283857]<br>
            [Index 1.0, Classification: 0.9993497729301453]
        </i>
    </center>
    <p>&nbsp;</p>
    <p>The first image was successfully classified as containing eggs with a 100% prediction rating. The probability of
        being a plane was less than one billionth. As for the second image it was recognised as being a plane, index
        1.0, with 99% certainty. The egg receiving a prediction rating of 0.06%.</p>
    <p>As can be seen from the above results we had achieved a somewhat working solution, ignoring the fact it
        recognises planes and eggs. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n2960' class='md-header-anchor '></a>Iteration 3 (Training the Network)</h4>
    <p>Now that we had created a working demonstration of the neural net successfully classifying two distinct objects,
        the next step was to train to network to recognise the presence and absence of eggs within similar environments.
        To do this we are going to need to produce a set of training and testing data.</p>
    <p>&nbsp;</p>
    <p>We decided it would be best to setup an environment somewhat similar to the conditions that would be experienced
        if this system were to be deployed in real life. We built a small rig using a wooden basket and hay purchased
        from pets at home to mimic the inside of a coop. Using test data that shared this similar scenery we hoped to
        train the neural net on the features of the eggs themselves rather than the surroundings.</p>
    <p><img src='images/modules/egg/coop_mimic.jpg' alt='Fake coop' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>To avoid over classification of a certain size or colour we attempted to use a variety of different eggs
        alongside image preprocessing to help normalize the images. The range of eggs we had available to us during
        training can be seen below.</p>
    <p><img src='images/modules/egg/egg_variety.png' alt='Egg types' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>As for the image preprocessing this is performed on all images prior to classification, there are two reasons for
        doing this. The first is to avoid over classification when training, attributes like orientation and brightness
        are pseudo-randomly altered using rotation, mirroring, normalisation and other transformations. This helps avoid
        over-training on these variables features. As for the second reason, the neural net is setup to accept images of
        a certain size, as such cropping and scaling are done to assert that the images are in the correct format to be
        accepted.</p>
    <p>&nbsp;</p>
    <p>Below is the set of transformations that are applied to the training data. The parameters of the normalisation
        function, <code>Normalize([..], [..])</code>, as well as the resized crop, <code>RandomResizedCrop(224)</code>,
        are set as they are due to the pretrained neural net we used as a basis for our image identification, &#39;<a
            href='https://neurohive.io/en/popular-networks/vgg16/'>VGG16</a>&#39;.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n2972"
        mdtype="fences"># Transformations used on the training data.

data_transforms = transforms.Compose([
    transforms.RandomRotation(90),
    transforms.RandomResizedCrop(224),
    transforms.RandomHorizontalFlip(),
    transforms.RandomVerticalFlip(),
    transforms.ToTensor(),
    transforms.Normalize([0.485, 0.456, 0.406],[0.229, 0.224, 0.225])
])
return data_transforms
</pre>
    <p>When we are processing an image for prediction we simply centre crop it to the size accepted by the neural net
        and again apply normalisation.</p>
    <p>&nbsp;</p>
    <p>Below is a sample of the training data used for our neural net alongside the classification of an image with an
        egg present and another absent.</p>
    <p>&nbsp;</p>
    <p><img src='images/modules/egg/training_data.png' alt='Subset of training data' referrerPolicy='no-referrer' /></p>
    <center>
        <i>
            Subset of training data used within neural net.
        </i>
    </center>
    <p>&nbsp;</p>
    <p><img src='images/modules/egg/late_egg_classification.jpg' alt='Egg classification results'
            referrerPolicy='no-referrer' /></p>
    <center>
        <i>
            [Index 0.0, Classification: 0.8653683066368103]<br>
            [Index 1.0, Classification: 0.13463164865970612]
        </i>
    </center>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><img src='images/modules/egg/late_no_egg_classification.jpg' alt='No egg classification results'
            referrerPolicy='no-referrer' /></p>
    <center>
        <i>
            [Index 0.0, Classification: 0.04247020557522774]<br>
            [Index 1.0, Classification: 0.9575297236442566]
        </i>
    </center>
    <p>&nbsp;</p>
    <h4><a name='header-n2988' class='md-header-anchor '></a>Iteration 4 (Client-server Architecture)</h4>
    <p>Now that we have produced a working prototype of a neural net and it classifies the presence of eggs with
        reasonable success rates, we can start looking into how to integrate this into the wider system. We are going to
        need to build a harness that when a request is received to check for eggs within the coop it proceeds to capture
        an image, classifies it and returns the result.</p>
    <p>&nbsp;</p>
    <p>As the device is going to be based inside the coop itself it will be connected via CAN bus to the other modules.
        For now we simply need to know that it will use a logic level converter connected to an MCP2515 to communicate
        on this bus. To learn more about the integration of CAN visit the networking section <a
            href='#header-n3541'>here</a>.</p>
    <p>Knowing the device will be connected via CAN bus we need to write a simple CAN interface that allows the device
        to receive and send messages. The implementation of this is a slimmed down version of that found within the main
        control hub, it asynchronously listens to the bus for messages and passes these to the correct handlers when
        received.</p>
    <p>A single module has been created that is responsible for capturing the image, having it classified using the
        neural net, and then returning the result to the caller. When the saved image becomes stale a simple garbage
        collector will remove it. </p>
    <p>The implementation of the garbage collector and main function for classification can be seen below.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n2995"
        mdtype="fences" style="break-inside: unset;"># Function for taking picture, predicting result and responding to the hub.

async def main(self):
    """Check coop for egg presence and return result."""
    
    try:
        success = await self.take_picture()
        if success:
            class_idx = await self.predict()
            res = self.labels[str(class_idx)]
            print("Prediction result: {}".format(res))
            await self.send_to_hub(res)
        else:
            print("Failed to take picture.")
    except:
        print("Failed predicting if eggs or not.")
    
</pre>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n2996"
        mdtype="fences" style="break-inside: unset;"># Image garbage collector.

async def img_garbage():
    """Garbage collector for removing stale temp images from the filesystem."""
    
    while True:
        await asyncio.sleep(300)
        ts = await get_time()

        for f in glob.glob("temp/*.jpg"):
            mtime = os.path.getmtime(f)
            if ts - mtime &gt; 15:
                os.remove(f)
 
</pre>
    <p>&nbsp;</p>
    <p>When transferring this code from a desktop PC to the Raspberry Pi Zero we ran into a few issues getting PyTorch
        installed, it appears that not a lot of developers are running these frameworks on small SOC and as such there
        is little support for ARM-based devices. There were a couple of guides online but mostly unsuccessful, <a
            href='https://medium.com/hardware-interfacing/how-to-install-pytorch-v4-0-on-raspberry-pi-3b-odroids-and-other-arm-based-devices-91d62f2933c7'>this</a>
        solution from Amrit Das was well rated but we still were unable to get it work. In the end we ended up compiling
        from source, which on a Pi Zero, took an unbelievable amount of time.</p>
    <p>Once installed we started the software to make sure it functioned and we immediately ran into another issue. We
        were unable to get the network to perform adequately within our RAM limits or perform in any acceptable
        time-frame. In fact the behaviour we witnessed was simply waiting a long time for the software to crash; we
        never made a single working prediction. We quickly came to the realisation that this was not going to be
        feasible operating on a Pi Zero.</p>
    <p>&nbsp;</p>
    <p>We were determined not to let all this research and time go to waste, we just needed to come up with a solution
        that provided us the computing power to use the neural net. We decided on making the classification of images an
        external service. The device in the coop will only responsible for taking the picture and contacting this server
        with the image to be classified. The server will receive this image via POST request and perform classification
        on it, this classification response will then be returned to the client. Below is a simple diagram of the
        architecture we envisaged. This setup should allow us to use much more powerful hardware.</p>
    <p>&nbsp;</p>
    <p><img src='images/modules/egg/image_analysis_architecture.png' alt='Client-server architecture egg identifier'
            referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>Having just faced an issue with lack of computing power we looked into how well the neural network performed when
        only a CPU was present, we were surprised at how poor it was in comparison to when a GPU was utilised. We
        managed to find online some benchmarks of a Dual Xeon E5-2630 V3 CPU vs a standard Nvidia TITAN GPU, and the
        Xeon came in at just over 14x slower. This comparison can be found <a
            href='https://github.com/jcjohnson/cnn-benchmarks'>here</a>. We decided from this that the machine running
        this service will require an Nvidia GPU such that CUDA cores can be utilised, speeding up performance.</p>
    <p>This client server model was implemented and works well. The processing happens in reasonable time and the
        responses from the neural net are somewhat accurate. To view the code for this module click <a
            href='code/modules/egg_presence_detector/'>here</a>.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3008' class='md-header-anchor '></a>Known Issues</h4>
    <p>There are a couple of known issues with the current implementation, one is the scalability. As it stands there is
        no server infrastructure running the classifier. If we were to support and manage the egg classification servers
        ourselves we would require some sort of subscription fee to help support running costs as well as staff. Having
        a singular client, as we do for the scope of this project, this seems unreasonable. However, so does the
        alternative, having the client run and manage it themselves. One solution would be to look into how much it
        would cost per client to run the server(s) on Google Cloud.</p>
    <p>The other noted issue with the current implementation is that when using a high fidelity camera the post request
        is ignored due to image size. This is because the web server is configured for a max POST request of 5mb, this
        should be an easy fix however. Adding <code>client_max_size = custom_max_size</code> to the launch parameters of
        the web server should allow a custom upper limit to be set.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3012' class='md-header-anchor '></a>Future Work</h4>
    <p>There is a lot of future work that could be done to make this system more robust and accurate. As stated before
        this device is a proof of concept rather than a fully featured product. Below is list of some of the future work
        that could help to improve this software.</p>
    <p>&nbsp;</p>
    <ul>
        <li>Perform testing within a real environment and retrain the classifier if necessary. </li>
        <li>Add a validation data set of images to help fine tune the hyper parameters of the neural net.</li>
        <li>Expand the training and testing data sets to include more complex images like multiple chickens, broken
            eggs, etc. as to improve the accuracy.</li>
        <li>Refactor the hard-coded classifier model within the code so its easier to swap out different neural net
            hyper-parameters.</li>
        <li>Experiment with different pretrained neural nets outside of just the &#39;VGG16&#39; model currently used. A
            different base model may yield more accurate results.</li>
        <li>Port the existing classifier over to TensorFlow for better scalability and neural network tuning features.
        </li>
    </ul>
    <p>&nbsp;</p>
    <h3><a name='header-n3029' class='md-header-anchor '></a>Water Drinker Monitoring</h3>
    <h4><a name='header-n3030' class='md-header-anchor '></a>Premise</h4>
    <p>Like humans, Chickens require sustenance like food and water to survive, and again like humans, they can go much
        longer without food than water. A chicken without access to this necessity may start to decline in health within
        twenty four hours, and within a few days dependent on environmental conditions, may perish. As such it is
        paramount that this key resource to the Chickens health is readily available.</p>
    <p>In an attempt to help smallholders flocks from having to endure this potentially life threatening situation, we
        have set out to develop a device for our system that monitors the presence of water within a drinker.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3034' class='md-header-anchor '></a>Final Iteration Overview</h4>
    <p>Out of all the devices within the system this one is the most simple. Utilising an off-the-shelf device produced
        by Xiaomi for their Smart home suite of products, we are able to detect a change from the presence of water to
        no water. This small wireless device has a supposed battery life of two years and an IP67 rating.</p>
    <p>&nbsp;</p>
    <p>The wireless Xiaomi Aqara water sensor can be seen below:</p>
    <p><img src='images/modules/water/water_sensor.jpg' alt='Xiaomi Aqara water sensor' referrerPolicy='no-referrer' />
    </p>
    <p>&nbsp;</p>
    <p>This device functions via two small contacts on its reverse that when connected form a complete circuit. When
        this circuit transitions from being complete to broken or vice versa the device sends out a message over ZigBee.
        Using a ZigBee USB dongle we are able to receive this message and output it to MQTT using an open source
        library, <a href='https://github.com/Koenkk/zigbee2mqtt'>Zigbee2MQTT</a>. The MQTT topic published via this
        library is then subscribed to via the main hub of our system and voila, a notification system for low water
        levels has been built. To learn more about how this information is received via the hub please click <a
            href='#header-n3224'>here</a> to visit that section of the corpus.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3042' class='md-header-anchor '></a>Iteration 1 (Research)</h4>
    <p>Our first step was to look into whether there were any devices that could perform the task we required without us
        having to build a bespoke circuit. Speaking with our project supervisor he suggested looking into the Xiaomi
        Aqara water sensor as he had some personal experience using them within his own home. This is where our research
        began.</p>
    <p>&nbsp;</p>
    <p>We looked into the Xiaomi Aqara water sensor that was suggested by our project supervisor and found that by
        default this device requires access to the Xiaomi smart home bridge to function. The device outputs a data
        packet over ZigBee and this is decoded by the bridge before being accessible within the provided mobile app.
        This would have been a pain to deal with, however we found a library that is able to parse the Xiaomi ZigBee
        packet and output it to MQTT, that library can be found <a
            href='https://github.com/Koenkk/zigbee2mqtt'>here</a>. This product would only suffice as a proof of concept
        however as due to the IP67 certified rating it cannot be submerged for prolonged periods of time.</p>
    <p>Another similar device we looked into was the Samsung SmartThings water leak sensor. This sensor cannot be
        submerged at all and hence would not suffice for building a prototype for this project.</p>
    <p>The last sensor we looked into was the EZVIZ T10 Wireless water leak detector, again like the Xiaomi Aqara this
        device has been certified with an IP67 rating. It could be used for prototyping within this project but would
        not suffice for actual deployment. No information about how this device communicated could be found, but going
        by the fact it required connection to a central hub and had an estimated range of 100m, we are going to assume
        it uses ZigBee. No information could be found as to the whether the packet was encrypted, and if so, if there
        was any way to decrypt it.</p>
    <p>&nbsp;</p>
    <p>For the prototyping of this device we have opted to go with the Xiaomi Aqara. The Samsung device is an immediate
        no due to the fact it cannot be submerged and the EZVIZ T10 has very little available information about how it
        communicates, and as such may just end up being a waste of money.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3051' class='md-header-anchor '></a>Iteration 2 (Implementation)</h4>
    <p>As we have opted to go with the Xiaomi Aqara water sensor we simply need to follow the setup steps outlined on
        the ZigBee2MQTT library documentation. </p>
    <p>&nbsp;</p>
    <p>The first step of setting up this device was to flash the USB Zigbee Receiver (CC2531) with the appropriate
        firmware. As we did not have access to a CC debugger, our project supervisor did this for us. Once this was done
        it was simply a case of setting up a Raspberry Pi Zero with this receiver connected, and running the required
        Node project. On the Pi we installed Node, cloned down the project repository, installed the required
        dependencies and set the appropriate configurations. We installed and ran Eclipse Mosquitto which is used as the
        MQTT broker. The last step was to pair the device, this was simply a case of holding down the reset button until
        the blue light blinked three times. Once this was done the device was all setup and the main control hub should
        be able to subscribe to the configured topic.</p>
    <p>To learn more about how the hub works with this MQTT broker please click <a href='#header-n3224'>here</a> to visit that part
        of this corpus.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n3058' class='md-header-anchor '></a>Chicken Location Tracking</h3>
    <h4><a name='header-n3059' class='md-header-anchor '></a>Premise</h4>
    <p>Being able to locate any pet is a major task in its own regard, let alone a flock of them. If a client could
        accurately monitor the location of their flock they could provide ease of mind, especially when away from home.
        The mechanism to do so could vary in technicality and capability, from a simple flashing LED to sophisticated
        historical data gathering of behaviour and locale. </p>
    <p>The actual complexity of this module in its full encapsulation could have been a project in its own regard,
        however the simple but effective solution provided is often all the end user needs and in the end acts as a
        proof of concept and nothing else. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n3063' class='md-header-anchor '></a>Final Iteration Overview</h4>
    <p>While primitive, the work we present as our final overview is a standalone proof of concept, detached from the
        centralised hub. Effectively incorporating an ESP32 development board with a series of LEDs attached to various
        GPIOs, set high (or low) based on the location settings. Utilising a BLE beacon we simulated a &#39;ring&#39;
        that could be attached to a chickens foot that would broadcast its location. The beacon had a unique ID and
        could be identified by the module itself. We demonstrated the working concept at the project fair, a simple
        range test; whether it was identified or not displayed with LEDs. </p>
    <p>Visually the module would utilise LEDs to display the state of the chicken location, if it was within range then
        a blue LED would be switched on; else it would switch off. We did not incorporate this module into our network
        as it was a proof of concept we looked into, but never fully developed. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n3067' class='md-header-anchor '></a>Iteration 1 (Research)</h4>
    <h5><a name='header-n3068' class='md-header-anchor '></a>Wireless detection mechanisms</h5>
    <p>Using wired technology to locate a chicken was beyond the scope of reality and the project, an unfeasible
        solution. As such we opted to find a low powered, long lasting and cost efficient alternative. Obviously without
        wires we looked towards wireless alternatives. Immediately several came to mind.</p>
    <h6><a name='header-n3070' class='md-header-anchor '></a>BLE</h6>
    <p>Bluetooth Low Energy, a technology utilised in various systems across the world, from smartphones to microwaves
        was an optimal choice. Operating on the OFCOM free band of 2.4GHz but at a lower cost, it was a feasible choice
        for implementing a proof of concept. However the power and demand behind such a technology could vary and the
        likelihood of the potential beacon lasting longer than a month was questionable. </p>
    <p>We theorised that using multiple (towards 4) could allow for sophisticated tracking via signal strength and
        related Bluetooth receiver. It would in theory be optimal for primitive tracking. </p>
    <h6><a name='header-n3073' class='md-header-anchor '></a>ZigBee</h6>
    <p>At this stage we had familiarised ourselves with another 2.4GHz radio protocol known as ZigBee. ZigBee utilises
        an incredibly low powered and cost efficient solution often seen in smart home devices (such as light bulbs,
        smart switches etc.) </p>
    <p>However to utilise this correctly we would have to incorporate our own beacon of choice to ping it&#39;s location
        and potentially sync multiple beacons together if we planned on serious coordination narrowing. Feasibly while
        the idea was efficient, the implementation and existing timeframe was not.</p>
    <h6><a name='header-n3076' class='md-header-anchor '></a>RFID</h6>
    <p>Radio Frequency Identification, a solution utilising magnetism rather than radio waves and frequency was a choice
        we considered. Often as consumers we see industrial implementations in shops to deter thieves with tags applied
        to expensive goods for trade. The premise was that by applying a tag to a chicken we could utilise hotspots to
        ping their location back and forth. While we could not guarantee the precise location, we could estimate the
        nearest last known position that the chicken pinged from, giving a rough idea of position. </p>
    <h6><a name='header-n3078' class='md-header-anchor '></a>Conclusion - BLE</h6>
    <p>ZigBee required too much time and precision to build, design and introduce. RFID was expensive and not efficient
        enough for our desires, it would suffer based on distance therefore impeding the design we inferred. </p>
    <p>Owing to this we selected BLE and purchased 5 ESP32 development boards. These boards are generic ESP32 DOIT DEV
        v1 Kits clones from Amazon. </p>
    <p>&nbsp;</p>
    <p><img src='images/modules/location/doitesp32.jpg' alt='doitesp32' referrerPolicy='no-referrer' /></p>
    <center><i>Source: https://docs.zerynth.com/latest/_images/doitesp32.jpg</i></center>
    <p>&nbsp;</p>
    <p>We selected these boards as they provided easy to access interfaces, expansive developer pinouts and were far
        cheaper than alternative solutions we researched. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n3087' class='md-header-anchor '></a>Iteration 2 - Using 4 Boards</h4>
    <p>The initial plan was to utilise 4 boards to perform primitive location tracking based on signal strength, however
        this would require coordination and synchronisation; else falling out of sync and providing inaccurate data.</p>
    <p>However we soon encountered a problem. Not only would synchronisation cause concern but linking and maintaining 4
        receivers as well as providing accurate measurements was beyond a difficult task. Bluetooth signal strength was
        not nearly accurate enough, especially with competing bands on the same frequency. We placed this design on the
        back of our burn pile in order to focus on other modules as we assumed without consistent location accuracy, the
        purpose would fall short of anything useful.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3091' class='md-header-anchor '></a>Iteration 3 - Final Solution</h4>
    <p>At a later date, we once again confirmed our state of the system to the client; we mentioned the Chicken locator.
        The client to our surprise noted that just knowing whether a chicken was within 100m of the coop would be more
        than adequate. As it transpires chickens are likely to roost in the same location each night with their known
        flock regardless of their distance travelled that day. Therefore knowing whether the chicken has met a predator
        can be known if the tracker reports its locale. </p>
    <p>As such we utilised a single ESP32 board with an LED and wrote primitive code to handle the basic proof of
        concept. Owing to time constraints we could not risk incorporating it within our main system and opted to keep
        it standalone, hence using an LED in representation. </p>
    <p>A callback is provided within the code on the ESP32 that verifies the beacon identification.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="c++" contenteditable="false" cid="n3095"
        mdtype="fences">/*  Callback handler class, required for type cast */
class ChickenCallback: public BLEAdvertisedDeviceCallbacks
{
    void onResult(BLEAdvertisedDevice advertisedDevice)
    {
        // Check whether the address of the identified device matches the chicken beacon
        if(BLEAddress(id).equals(advertisedDevice.getAddress()))
        {
          digitalWrite(23, HIGH);
          chicken = 2;  
        }
    }
};
</pre>
    <p>As seen, while primitive it works as intended.</p>
    <h4><a name='header-n3097' class='md-header-anchor '></a>Known Issues</h4>
    <p>It&#39;s plausible that a chicken could suffer an illness, lose its tracker or somehow lose its claw. If any of
        these states occurred then we would suffer false positives endlessly with a beacon lost in the underbrush
        constantly reporting it&#39;s within 100m. </p>
    <p>Following such, we cannot accurately identify the precise range of the chicken or whether its signal is being
        blocked by brick of thick brush. </p>
    <p>The battery of the beacon is unknown, whether it would withstand a long period of time, harsh weather or even
        continue to operate correctly is entirely down the COTS beacon we purchased. Had we developed our own then
        several additions could be made.</p>
    <h4><a name='header-n3101' class='md-header-anchor '></a>Future work</h4>
    <p>We would adhere to implementing a visual representation on the main interface for the current status of chickens,
        potentially providing a heat map, GPS Google maps API and even historical data from the database. This could be
        incredibly useful tracking the behaviour of chickens, how they escape a pen or where they utilise space, etc.
        This requirement would absolutely need network access.</p>
    <p>If we could not use accurate position tracking, we could use multiple beacons to identify where a chicken is
        closest. This could be useful if the client has large land mass which extends beyond the range of beacons, or
        alternatively if signals are blocked.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n3105' class='md-header-anchor '></a>Control Hub</h3>
    <h4><a name='header-n3106' class='md-header-anchor '></a>Premise</h4>
    <p>The main premise behind the control hub is to have a device in which coordinates the network. We decided during
        the design phase that Instead of building automated behavior into each of the different modules, such that they
        could operate completely isolated from one another, we would use a single device in which controlled their
        behavior through sending requests. On the surface this may sound like a worse solution than isolating each,
        however, we have a few reasons to justify this design choice. </p>
    <p>The first reason as to why we have opted to build the system in this manner was that it allows us to slim down
        the other modules themselves to run on less powerful hardware. Most of the other devices connected via the CAN
        bus do not require any other form of network interface, this means we can use relatively inexpensive
        microcontrollers, like the ATmega328P, connected to a singular CAN bus interface (MCP2515) and the required
        sensors. If we opted for each device to operate in an isolated capacity they would all require access to the
        external database and as such an interface to communicate with this would be required.</p>
    <p>The next reason for our choice was that it makes adding a user programmable layer onto the network a much simpler
        process. Code or settings could be submitted to this main control hub and this would in turn make the external
        requests to the devices within the modular network.</p>
    <p>The last big reason as to why we chose to include a main control hub is that it provides a singular point of
        entry to the entire network of devices. This should make it easier to provide a way for external services, like
        the web application, to communicate with the system.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3112' class='md-header-anchor '></a>Final Iteration Overview</h4>
    <p>The final iteration of the control hub was implemented on a Raspberry Pi Model 3 B+, ideally though we wanted to
        use an Odroid C2. Having purchased one we were hesitant to connect a MCP2515 CAN interface due to it potentially
        putting an overvoltage of 5v into the Odroid&#39;s 3.3v rated GPIO pins. We faced the same issue with the
        Raspberry Pi but as the board was less than half the price we were more willing to take the risk. We developed
        small logic level converting circuits to step the 5v signal down to 3.3v and this is present on the final
        result. A picture of the main hub and the logic level converter can be seen below.</p>
    <p>&nbsp;</p>
    <p><img src='images/modules/hub/control_hub.jpg' alt='Main control hub' referrerPolicy='no-referrer' /></p>
    <p><img src='images/modules/hub/logic_level_converter.jpg' alt='Logic level converter'
            referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>As for functionality the main control hub orchestrates the devices on the network, it solicits updates from the
        sensors along the CAN bus and can issue requests to actionable devices like the automated door. Upon receipt of
        these updates from devices it adds this information to the external database. The hub listens to three different
        channels: its subscribed to the water sensor topic via MQTT, the door, air sensor and egg identifier over CAN
        bus, and lastly a REST server using TCP.</p>
    <p>The REST server provides authenticated endpoints that allow outside services to communicate with the main hub.
        These endpoints include functionality for forcing devices to update their readings, retrieving the latest
        reading stored on the hub, seeing the system logs, and more</p>
    <p>The last major feature of the main control hub is a programmable language, this language allows the end user to
        write programs for the system dictating its behaviour. Actions can be set to occur on specific events, at a
        given time of day, or if a sensor reading is greater than, less than or equal to a specific value. To learn more
        about this language a section of this corpus has been devoted to it, click <a href='#header-n3778'>here</a> to go there.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3122' class='md-header-anchor '></a>Iteration 1 (Research)</h4>
    <p>For the main hub, as the scope of what the device needs to do is quite well defined, we will conduct research
        into the best programming language suited to developing it and what single-board computer will be best tasked
        for the job.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n3125' class='md-header-anchor '></a>Single-board Computer Choice</h5>
    <p>For the main control hub we will look into three popular single-board computers as to decide on the best for the
        task. The three boards that will compare for their suitability are as follows:</p>
    <ul>
        <li>Raspberry Pi 3 Model B+</li>
        <li>Odroid C2</li>
        <li>Asus SBC Tinkerboard 2GB</li>
    </ul>
    <p>&nbsp;</p>
    <p><strong>Raspberry Pi 3 Model B+</strong></p>
    <p>One of the original single-board computers commercially available, this model of the Raspberry Pi boasts 1GB of
        RAM alongside a 4-core ARM Cortex-A53 clocked at 1.2GHz. Storage on the device is provided by a microSD card
        slot, and a standard GPIO 40-pin header alongside two USB 2.0 are available for connectivity. The device costs
        roughly ~£30 at the time of writing.</p>
    <p>&nbsp;</p>
    <p><strong>Odroid C2</strong></p>
    <p>The Odroid C2 has an 4-core Amlogic ARM Cortex-A53 clocked at 1.5Ghz, alongside a Mali-450 GPU and 2GB of system
        memory. Storage on the device can be provided by either a microSD card or an external eMMC flash storage module.
        As for connectivity the the Odroid has an IR receiver, a standard 40-pin GPIO header and 4-USB connections all
        operating on a unique bus. With shipping and tax included the rough price of an Odroid C2 is ~£65 at the time of
        writing.</p>
    <p>&nbsp;</p>
    <p><strong>Asus SBC Tinkerboard 2GB</strong></p>
    <p>The most expensive on our list is the premium Asus SBC Tinkerboard. This device comes with a 4-core ARM
        Cortex-A17 clocked at 1.8GHz, a Mali-T760 GPU, 2 GB of system memory and 16GB of on-board eMMC system storage.
        The design of the board closely resembles the initial Raspberry Pi and the set of available connections match; a
        40-pin GPIO header and two USB 2.0 are available. The cheapest version found of this board came in at
        approximately ~£85-90.</p>
    <p>&nbsp;</p>
    <p><strong>Conclusions</strong></p>
    <p>Comparing the three boards it was apparent that the Tinkerboard was the most powerful. The 1.8GHz processor is
        50% faster than that on the Raspberry Pi and 20% faster than that of the Odroid; though the price is paid for
        this speed. In terms of system memory the Odroid and the Tinkerboard both have 2GB of DDR3 memory available
        compared to the Raspberry Pi&#39;s 1GB. Alongside this they also both support eMMC storage unlike the Raspberry
        Pi, though 16GB comes default with the Tinkerboard. </p>
    <p>All of the devices compared have a good variety of connections available, all supporting the standard 40-pin GPIO
        header, however the Odroid takes the lead due to its 4-USB ports that all operate on their own bus. </p>
    <p>The Tinkerboard and Odroid offer a GPU, though due to the nature of the device being built this should not
        provide much of a benefit. The device will operate for the most part in a headless manner.</p>
    <p>In conclusion we have decided that the Odroid C2 offers the best trade-off between high specifications and price.
        Though the Tinkerboard was hands down the best of the three, we could not justify spending an extra £30 to get a
        slightly faster CPU clock speed and a better GPU that will be rarely utilized.</p>
    <p>&nbsp;</p>
    <p><img src='images/modules/hub/odroid.jpg' alt='Odroid C2' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <h5><a name='header-n3152' class='md-header-anchor '></a>Programming Language Choice</h5>
    <p>The next decision we need to make is to decide on the language to use to program the main control hub. The three
        major languages being considered are:</p>
    <ul>
        <li>Python</li>
        <li>Java</li>
        <li>Erlang</li>
    </ul>
    <p>Other languages may have been more suitable candidates, however due to being a two person development team and
        having only one primary developer working on the main hub we have opted to look into languages that we have some
        basic level of proficiency in. Within our language of choice we are searching for good support of asynchronous
        programming, a selection of useful libraries to help interface with given services, and good community support
        and documentation.</p>
    <p>&nbsp;</p>
    <p><strong>Python</strong></p>
    <p>Having picked up in popularity in the recent years due to the high level of use within the data science field,
        Python is a very respected language with a large community of developers. For this reason, Python has an
        abundance of high quality libraries for a host of tasks ranging from CAN bus interfacing, to lightweight REST
        server implementations. A caveat of using Python is the poor support for asynchronous code; threads are hard to
        manage and require a lot of architectural overhead and as such the go to solution is the Asyncio library. This
        library allows the programmer to write concurrent code as a set of co-routines in which are scheduled on a main
        event loop.</p>
    <p>&nbsp;</p>
    <p><strong>Java</strong></p>
    <p>Java has been a staple programming language for a long time now, and there is reason for this. It uses the
        respected objected orientated paradigm and provides a static type system that provides certain assurances to the
        robustness of given code. Being one of the most widely adopted programming languages, Java has a host of
        libraries available to perform a variety of tasks. As for asynchronous code support, Java provides a nice
        interface for thread management and libraries like EA Async offer a more JavaScript like promise structure.</p>
    <p>&nbsp;</p>
    <p><strong>Erlang</strong></p>
    <p>A functional language originally developed for telecoms systems, Erlang has started to become more prevalent as a
        general purpose programming language as of late. Erlang is inherently concurrent and can support thousands of
        lightweight spawned processes, each running in isolation with their own memory pool. Unfortunately as Erlang has
        not hit the mainstream heights of the other two languages it lacks library support for certain tasks, and the
        development community is somewhat of an in crowd with new information often shared via the Erlang mailing lists.
    </p>
    <p>&nbsp;</p>
    <p><strong>Conclusions</strong></p>
    <p>Considering our small development team we have opted to use Python as the language of choice for the main control
        hub. The reason behind picking Python is that we believe it will allow us to be able to develop more code within
        the fixed time frame we have. This is due to the dynamic type system provided, and the library support available
        for CAN bus, REST web servers, etc. </p>
    <p>Though not the best choice for asynchronous code we feel that the asyncio library, available in Python, is
        feature complete enough that it should not hinder our ability to complete the tasks we have set out to do.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3176' class='md-header-anchor '></a>Iteration 2 (Module Architecture)</h4>
    <p>Now that we have decided on the programming language and hardware that we will use to construct the main hub, we
        should now look into how we are going to structure the module and the features that it should implement.</p>
    <p>To communicate with the other sensors in the network the main hub is going to require two interfaces, one to
        listen to the CAN bus and another MQTT. The CAN interface will allow the hub to communicate with the automated
        door, air condition sensors, and egg identification module. The MQTT interface on the other hand allows
        communication from the drinker level monitor. The data received from these external devices within the modular
        network will need to be stored in long term store, as such a service for database access will be also be
        required.</p>
    <p>Next we need to consider how data is going to be received or explicitly sent to this device, as such a standard
        TCP/IP socket interface should allow for inbound or outbound communication. This socket should be authenticated
        to ensure nothing is triggered via malicious actors.</p>
    <p>The last consideration is that of the programmable language, the language should support controlling the
        automated door and sending notifications. It should be implemented as a separate module outside of the main hub
        that is able to request the execution of hub actions. This should simplify the integration of these two
        components as the hub should have no dependency on the language controller.</p>
    <p>&nbsp;</p>
    <p>From the above set of requirements we can build a model of the main control hub that looks somewhat similar to
        that expressed below.</p>
    <p><img src='images/modules/hub/hub_design.svg' alt='Hub module design' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The main controller has access to set of services and interfaces, these are responsible for the inbound and
        outbound data across the system boundary. The language controller exists as a separate entity but is able to
        communicate with the hub controller.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3187' class='md-header-anchor '></a>Iteration 3 (System Logger)</h4>
    <p>As we have now created a design for the main hub we can start looking into implementing given features. The first
        feature we will implement is a basic system logger so we can see the run-time execution. This logger should
        allow processes to be tracked through the application, and aid in the debugging later implemented features;
        especially due to the asynchronous nature of the code base.</p>
    <p>&nbsp;</p>
    <p>Within our implementation of this feature we used Pythons standard library logger and adapted it to our needs.
        The package supports defining custom loggers and their corresponding output streams, logs were setup to output
        to standard out and a run-time file. The source code for our logger can be found <a href='code/modules/hub_code/logger.py'>here</a>.</p>
    <p>Initially an instance of the logger class was instantiated per module, however this resulted in multiple log
        files being generated. For this reason the logger was converted to a singleton pattern, singletons within Python
        however are somewhat convoluted. </p>
    <p>As can be seen in the below code when instantiating an object the class dunder-function (double underscore
        function) <code>__new__()</code> is called first followed by the instance function <code>__init__()</code>. We
        can utilize this to implement singletons. By creating a class variable and setting its value to null,
        <code>_singleton = None</code>, we are able to check this on initial object creation and create the singleton if
        it is not defined. If we create a new object, before returning, we set the class variable
        <code>_singleton</code> to this. On all subsequent instantiations of objects of this type, that already created
        object, will now be returned. This is the premise behind the logger within our system.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n3193"
        mdtype="fences" style="break-inside: unset;"># Singleton design pattern within Python.

_singleton = None
def __new__(cls, *args, **kwargs):
    if not cls._singleton:
        # ...
        cls._singleton = super(Logger, cls).__new__(cls, *args, **kwargs)
        
    return cls._singleton


def __init__(self):
    self.logger = logging.getLogger('coop_logger')
    
</pre>
    <p>&nbsp;</p>
    <p>The last notable feature of our logger implementation is the option to output the caller of the function that
        resulted in the log entry being created. This is done via inspecting the call stack and traversing up it a fixed
        amount until the caller is retrieved. The implementation of this can be seen below.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n3196"
        mdtype="fences"># Function for retrieving calling module and function name.

def __getCaller(self):
    """Climb the execution stack to find the calling module.
    This naive implementation climbs the stack a fixed depth of four calls"""

    current_frame = inspect.currentframe()
    caller_frame = inspect.getouterframes(current_frame, 1)
    module_path = caller_frame[3][1]
    function_name = caller_frame[3][3]
    module_name = os.path.relpath(module_path, os.getcwd())
    return [module_name, function_name]

</pre>
    <p>This code climbs the call-stack for four frames due to there being four hops from the calling function that
        caused the log entry to be added, and the function that actually adds the log entry. The output from our log
        looks as follows:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="verilog" contenteditable="false" cid="n3198"
        mdtype="fences">10:14:35 ~ 03-23-19: INFO: canbus_interface.py_listen: Message received on CAN Interface: [arbitration_id: 0x0, dlc: 0x3, data: [16, 1, 1]]

10:14:35 ~ 03-23-19: INFO: devices.door.py_handle_data_resp: Handling AUTOMATED DOOR DATA message from CAN.

10:14:35 ~ 03-23-19: INFO: devices.door.py_handle_data_resp: The door reports as being in state: closed.

10:14:35 ~ 03-23-19: INFO: devices.door.py_add_record: Adding door status reading to the database.

10:14:35 ~ 03-23-19: INFO: database_conn.py_insert: Successfully added record to the database.

10:14:44 ~ 03-23-19: INFO: hub_controller.py_stop: Stopping application..
</pre>
    <p><img src='images/modules/hub/log.png' alt='Hub system log example' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <h4><a name='header-n3201' class='md-header-anchor '></a>Iteration 4 (CAN Interface)</h4>
    <p>The next feature to be implemented is the CAN interface, this Python module should allow communication between
        the devices on the CAN and the main hub. It should support two way communication such that the devices are able
        to send messages to the hub unsolicited and vice versa. This code should be non-blocking and accept incoming
        messages at any given point.</p>
    <p>&nbsp;</p>
    <p>To do this we have introduced a new module <a href='code/modules/hub_code/canbus_interface.py'>canbus_interface.py</a> that has two internal classes,
        <code>CANInterface</code> and <code>PacketBuilder</code>. Packet builder implements the builder design pattern
        and is used to construct well-formed CAN packets that abide our internal packet structure; more about this can
        be seen, <a href='#header-n3629'>here</a> in the networking section of this corpus. The CAN interface provides functionality
        to: subscribe devices to the CAN bus, listen and route received messages, and send CAN packets.</p>
    <p>Initially we implemented both of these classes using the Python library, <a
            href='https://python-can.readthedocs.io/en/2.1.0/'>python-can</a>. This library allowed a simple byte array
        to be generated and sent to the network by calling the <code>bus.Send()</code> method. This made integration
        quite easy, however, we noticed that whilst using this, some malformed packets were being put on the CAN bus.
        Attempting to debug this we were unable to grasp exactly what was causing this issue. Using the CAN inspecting
        tools available in Linux, namely <code>candump</code> from the <a
            href='https://github.com/linux-can/can-utils'>can-utils</a> package, we were able to see that the packet
        that was about to be transmitted onto the bus was already malformed and as such must be happening within our
        code. For this reason we decided to look into switching out python-can to native style sockets to see if this
        remedied the issue, low and behold it worked.</p>
    <p>This was done via researching the specific frame format used for CAN packets, <code>&quot;=IB3x8s&quot;</code>.
        This can be read as follows:</p>
    <ul>
        <li><code>=</code> : The packet uses native byte order with the standard size.</li>
        <li><code>B3</code> : The frame starts with three unsigned char.</li>
        <li><code>x</code> : Pad the previous input to the nearest byte.</li>
        <li><code>8s</code> : Followed by a char array of 8 bytes.</li>
    </ul>
    <p>Now that we knew this, the Packet Builder and the send and receive functions within the CAN Interface were
        refactored to use sockets instead of the python-can wrapper. The information about the the frame format was
        found <a href='https://docs.python.org/3/library/struct.html#struct-format-strings'>here</a> within the Python
        docs. Some snippets of the socket implementation can be seen below:</p>
    <p>&nbsp;</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n3218"
        mdtype="fences"># CAN Interface socket listener loop.

async def listen(self):
"""Start an asynchronous listener attached to the CAN bus waiting for messages"""

    while True:
        if self.shutdown_flag:
            break
        if select.select([self.socket], [], [], 0.0)[0]:
            # ...
        await asyncio.sleep(0)

</pre>
    <p>Points to note are that when querying the interface using <code>select.select( ... )</code> the time out is set
        to zero seconds and the first queued message is taken. Once this received message is handled the thread is
        yielded to other waiting tasks to ensure that this listener does not stall the asyncio event loop, this is done
        by calling the function <code>await asyncio.sleep(0)</code>. Once control returns to this method the queue is
        inspected for the next waiting message and the cycle continues. If no message is available the thread is
        immediately yielded.</p>
    <p>&nbsp;</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n3221"
        mdtype="fences" style="break-inside: unset;"># Construct method of the CAN packet builder class.

async def construct(self):
   """Construct and return the assembled CAN message.
   An error is thrown if not all required fields are populated."""

   try:
        # Generate the CAN packet.
        # self.frame_fmt = "=IB3x8s"
        host_byte   = ((self.source &lt;&lt; 4) | self.destination)
        data        = util.list_flatten([host_byte, self.type_code, self.payload])
        arb_id      = 0x000
        data_bytes  = bytearray(data)
        dlc         = len(data_bytes)
        raw_bytes   = bytes(data_bytes.ljust(8, b'\x00'))
        packet      = struct.pack(self.frame_fmt, arb_id, dlc, raw_bytes)

		# ...

        return packet

   except Exception as e:
            self.log.error("Failed to encode CAN packet, error: {0}".format(e))
            return None
</pre>
    <p>Within this snippet, if we ignore our application specific packet structure, the base CAN packet format can be
        seen. The variables <code>arb_id</code> and <code>dlc</code> make the initial padded three bytes, and
        <code>raw_bytes</code> the eight byte char array.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3224' class='md-header-anchor '></a>Iteration 5 (MQTT Interface)</h4>
    <p>We next looked at the MQTT interface. This module should allow communication from subscribed MQTT devices to be
        received. It does not need to support two-way communication therefore packet creation is not required, and as
        with the CAN interface, this code should be non-blocking and accept incoming messages at any given point.</p>
    <p>&nbsp;</p>
    <p>In comparison to the CAN Interface this device was quite simple to implement, we simply had to re-purpose a lot
        of the same code. Using the <a href='https://hbmqtt.readthedocs.io/en/latest/'>hbmqtt</a> python library it was
        a simple case of just redesigning the subscribe, listen and route functions such that they work with MQTT
        instead of CAN. The subscribe method still simply allows devices to subscribe to receive message for a given
        address, and route forwards these message to them. The only method where there is a little difference is the
        listen function, though the overall premise is still the same.</p>
    <p>&nbsp;</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n3229"
        mdtype="fences" style="break-inside: unset;"># Listen function for the MQTT interface.

async def listen(self):
    """Start an asynchronous MQTT subscriber waiting for messages."""

    topic_ids = [("{}{}".format(self.mqtt_prefix, dev.topic_id), 0) for dev in self.subscribed_devices]
    await self.client.connect(self.mqtt_addr)
    await self.client.subscribe(topic_ids)

    while True:
        if self.shutdown_flag:
            await self.client.unsubscribe(["zigbee2mqtt/+"])
            break
        try:
            message = await self.client.deliver_message(timeout = 0)
            self.loop.create_task(self.route_mqtt(message))
        except asyncio.TimeoutError:
            pass
        except ClientException as e:
            self.log.error("Error when receving MQTT packet: {}".format(e))

        await asyncio.sleep(0)
        
</pre>
    <p>As can be seen a similar infinite loop setup is present along with the thread yield at the end of each iteration.
        Using the hbmqtt library the code checks to see if a message is waiting to be received and if so it is routed,
        otherwise a TimeoutError is thrown and the code passes this.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3232' class='md-header-anchor '></a>Iteration 6 (Network Devices)</h4>
    <p>As the hub is the aggregator of all the data from the other devices in the network, it needs a means of being
        able to comprehend and understand what it receives from them. Each device encodes data differently and has a
        different set of actions available to it. For this reason each device will require some form of handler on the
        control hub.</p>
    <p>&nbsp;</p>
    <p>As of writing, our system has two different types of devices within its network, MQTT devices and CAN devices.
        The CAN devices support two-way communication, that is they can be queried and requested to perform specific
        actions, whereas the MQTT devices publish information but do not have any capability for handling inbound data.
    </p>
    <p>In the initial iteration of the control hub, code existed within the main module, <code>hub_controller.py</code>,
        to deal with all different devices. This quickly became unmanageable and code duplication started to become
        rampant. We decided to instead implement both device types as an abstract base class and then created specific
        sub-classes for each device within the network.</p>
    <p>Door, dust, humidity, temperature, pressure, and egg identifier were all children of the abstract class
        <code>CANDevice</code>. The water sensor was a child of the abstract class <code>MQTTDevice</code>. </p>
    <p>&nbsp;</p>
    <p><img src='images/modules/hub/devices.png' alt='Devices directory structure' referrerPolicy='no-referrer' /></p>
    <center><i>Device modules from source code</i></center>
    <p>&nbsp;</p>
    <p><strong>CAN Device</strong></p>
    <p>The <code>CANDevice</code> abstract class provided concrete implementations for:</p>
    <ul>
        <li>Receiving and processing the data received from the actual device on the network</li>
        <li>Updating the hubs internal state when a new device reading is received</li>
        <li>Performing a heartbeat protocol to ensure the device is still active</li>
        <li>Sending a status request to the device on the network</li>
    </ul>
    <p>Three abstract methods were also included that had to be implemented by the concrete children:</p>
    <ul>
        <li>A handler for a data response from the device on the network</li>
        <li>A handler for an event response from the device on the network</li>
        <li>Add record method to add a new reading to the database</li>
    </ul>
    <p>&nbsp;</p>
    <p><strong>MQTT Device</strong></p>
    <p>The <code>MQTTDevice</code> abstract class was a little less feature complete as it could not communicate with
        the device. As such the abstract class provides concrete implementations for:</p>
    <ul>
        <li>Updating the hubs internal state when a new device reading is received</li>
    </ul>
    <p>Two abstract methods are included that need to be implemented by the concrete children:</p>
    <ul>
        <li>A handler for when a message is received from the MQTT device on the network</li>
        <li>Add record method to add a new reading to the database</li>
    </ul>
    <p>&nbsp;</p>
    <p>Each device was created as an instance of its specific class and then was subscribed to the corresponding
        interface it required. This occurs in the main controller and can be seen below.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n3275"
        mdtype="fences" style="break-inside: unset;"># Demonstration of device creation and subscription to the respective interfaces.

def __init__(self, can_type, can_channel):
    # ...
    
    # Set CAN devices
    self.door 			= Door(hub = self, interface = self.can_interface)
    self.egg_id 		= EggIdentifier(hub = self, interface = self.can_interface)
    self.temperature 	= Temperature(hub = self, interface = self.can_interface)
    self.dust 			= Dust(hub = self, interface = self.can_interface)
    self.humidity 		= Humidity(hub = self, interface = self.can_interface)
    self.pressure 		= Pressure(hub = self, interface = self.can_interface)
    
    # Set MQTT devices.
    self.water_sensor 	= WaterSensor(hub = self, interface = self.mqtt_interface)

def start(self):
	# ...
    
    # Subscribe CAN devices.
    self.loop.create_task(self.can_interface.subscribe(self.door))
    self.loop.create_task(self.can_interface.subscribe(self.temperature))
    self.loop.create_task(self.can_interface.subscribe(self.dust))
    self.loop.create_task(self.can_interface.subscribe(self.humidity))
    self.loop.create_task(self.can_interface.subscribe(self.pressure))
    self.loop.create_task(self.can_interface.subscribe(self.egg_id))

    # Subscribe ZigbeeMQTT devices.
    self.loop.create_task(self.mqtt_interface.subscribe(self.water_sensor))

</pre>
    <p>With this implemented, on receipt of a message from a given interface the packet will attempt to be routed to the
        corresponding subscribed device. If the message is successfully routed to the device it will be deconstructed,
        processed and added to the database.</p>
    <p>&nbsp;</p>
    <p>The last feature to mention is that some of the CAN devices have device specific actionable functionality
        implemented. For instance the automated door has functions for sending open and close door packets. These
        functions simply construct a packet of the correct form and transmit it across the network.</p>
    <p>Here is the implementation of the open door function for the automated door device.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n3280"
        mdtype="fences" style="break-inside: unset;"># Automated door open door function.    
    
async def open_door(self):
    """Send open door packet via CAN"""

    # Packet data
    source = 0x00
    destination = self.can_address
    payload = [0x02]

    # Build the open door command packet.
    msg = ci.PacketBuilder()
    msg.set_source(source)
    msg.set_destination(destination)
    msg.set_type(ci.PacketBuilder.COMMAND)
    msg.set_payload(payload)
    packet = await msg.construct()

    # send via the CAN interface and wait a given timeout for a response
    # to be received, return 'timed_out' on failure, result on success.
    await self.interface.send_packet(packet)
    done, pending = await asyncio.wait(
        [self.fetch_event_resp(), util.async_timeout(5.0, None)],
        return_when = asyncio.FIRST_COMPLETED
    )
    for task in pending:
        task.cancel()
    for task in done:
        result = "timed_out" if task.result() == None else task.result()
     return result

</pre>
    <p>As can be seen the packet is constructed and then transmitted over the given interface. The confusing code at the
        end is simply a routine for setting up a timeout. Once the message has been sent the function will wait for up
        to five seconds for a response. This wait is non-blocking.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3283' class='md-header-anchor '></a>Iteration 7 (Database Service)</h4>
    <p>We have already stated the main control hub needs to act as an aggregator of data from the network. One aspect of
        this role is to store the data received within a database. As such a service is going to need to be created that
        allows us to do this. From the previous iteration based on the device types we have already concluded that each
        device will have the specifics of adding a record to the database, so we simply need to create an interface that
        they can utilise.</p>
    <p>&nbsp;</p>
    <p>The development of this service was quite simple due to the fact that we only needed to create an interface for
        adding records and reading records. When instantiated this module will connect to the database and then provide
        the required functionality.</p>
    <p>&nbsp;</p>
    <p>The database is connected to when the object is instantiated.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n3289"
        mdtype="fences"># Connection on instantiation.

def __init__(self):
    self.log = Logger()
    self.conn = pg.connect(
        host        = os.getenv('DB_HOST'),
        database    = os.getenv('DB_NAME'),
        user        = os.getenv('DB_USER'),
        password    = os.getenv('DB_PASS')
    )
    
</pre>
    <p>&nbsp;</p>
    <p>The insert function simply takes a formatted query and the tuple of parameters to bind.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n3292"
        mdtype="fences" style="break-inside: unset;"># Insert a record into the database.

async def insert(self, query, parameter_tuple):
    """Execute an insert query with the given parameters on the database"""

    try:
        cursor = self.conn.cursor()
        cursor.execute(query, parameter_tuple)
        self.conn.commit()
        cursor.close()
        self.log.info("Successfully added record to the database.")
        success = True
    except Exception as e:
        self.log.error("Unexpected database error whilst creating record: {}".format(e))
        success = False
    return success

</pre>
    <p>&nbsp;</p>
    <p>The read functionality takes a query and an optional tuple of parameters to bind and returns a list containing
        the rows of the result.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n3295"
        mdtype="fences" style="break-inside: unset;"># Read from the database.

async def read(self, query, parameter_tuple = ()):
    """Perform a read operation on the database with the given query and parameters"""
    
    try:
        cursor = self.conn.cursor()
        cursor.execute(query, parameter_tuple)
        self.conn.commit()
        rows = cursor.fetchall()
    except Exception as e:
        self.log.error("Error occurred whilst reading from database: {}".format(e))
        rows = None
    finally:
        cursor.close()
    return rows

</pre>
    <p>&nbsp;</p>
    <h4><a name='header-n3297' class='md-header-anchor '></a>Iteration 8 (REST Server)</h4>
    <p>The next consideration we need to make is how the web application is going to communicate with the hub, and by
        proxy the greater network. To make the integration of the web application as simple as possible we opted to
        provide an authenticated REST API to the hub. This should allow the web application to simply query the hub
        using standard web requests in whatever language is used for its development.</p>
    <p>&nbsp;</p>
    <p>For implementing this we considered a few different libraries that provide support for developing REST API. We
        looked into Flask-RESTful and aioHTTP. Flask is one of the more popular web frameworks available for Python and
        is quite widely used, alternatively aioHTTP is less known but has out of the box support for asyncio. Having
        looked into both, they shared all the features required to build a REST server so we opted to go with Flask as
        it had the greater community. </p>
    <p>Our first implementation launched the Flask web server at the same time as the hub, however, due to the blocking
        nature of the server this halted the main hubs execution; this was because they were using the same instance of
        the Python interpreter. We quickly refactored this to have the main control hub spawn the web server as a
        separate process. This fixed the issue of the hub being halted, but did require some extra architecture added to
        the system. To allow the devices to communicate as separate processes an interface for sockets needed to be
        added. This interface listens on a given port and handles TCP/IP requests. When an authenticated request is
        received from the web server, the hub handles it and returns a response.</p>
    <p>Unfortunately we quickly found ourselves facing a new problem, when a request was being handled by the Flask
        server we were unable to make an asynchronous call to the hub, wait on a response from the network, and then
        respond the waiting client; Flask simply returned None as it did not have support for co-routines. Below is a
        snippet of this web server.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n3303"
        mdtype="fences" style="break-inside: unset;"># Flask REST API.

class DoorAPI(Resource):

    def get(self, command):
        if command == "open":
            hub_cmd = {'command': "door_open"}

        elif command == "close":
            hub_cmd = {'command': "door_close"}

        _ipc = IPclient(hub_cmd)
        return hub_cmd


app = Flask(__name__)
api = Api(app)
api.add_resource(DoorAPI, '/door/&lt;string:command&gt;')
app.run(host = "0.0.0.0", port = 8000)

</pre>
    <p>As can be seen from the above code, the REST server was quite naive at this point. There was no authentication
        and only one endpoint existed for testing. As we were unable to await a response from the main hub the command
        was sent in a fire a forget fashion, <code>_ipc = IPClient(hub_cmd)</code>. The command itself was just returned
        to the client.</p>
    <p>We looked into multiple ways to get around this, however, we decided it would be quicker to create a demo using
        aioHTTP to see if this framework with default asyncio support would solve our issue. Luckily for us the aioHTTP
        web server worked. This was because each route handler for the web server was already a co-routine, therefore we
        were able to use await syntax immediately without issue.</p>
    <p>&nbsp;</p>
    <p>As we now have a working system using aioHTTP, we started to add the required functionality. We added middleware
        to support basic authentication and error handling and the set of required endpoints.</p>
    <p>The authentication middleware handles unauthorised requests returning them a 401 page.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n3309"
        mdtype="fences" style="break-inside: unset;">async def basic_auth_middleware(app, handler):
    """Middleware to perform password authentication to the REST service"""

    async def middleware(request):
        token = request.headers.get('authorization', None)
        api_auth = os.getenv('REST_AUTHKEY')

        if token != api_auth:
            return web.Response(text = "401: Unauthorized", status = 401)
        elif token == api_auth:
            return await handler(request)

    return middleware

</pre>
    <p>The error handling middleware deals with common issues, keeping the routes maintainable. On an endpoint error 404
        is returned, 522 on a hub connection issue, 503 on a communication issue, and 500 on all other generic server
        errors.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n3311"
        mdtype="fences" style="break-inside: unset;">async def error_handler_middleware(app, handler):
    """Middleware to handle errors thrown by handlers."""

    async def middleware(request):
        try:
            return await handler(request)

        # Query parameter error.
        except KeyError:
            return web.Response(text = "404: Endpoint Not Found", status = 404)

        # Socket error.
        except OSError:
            if errno.ECONNREFUSED:
                return web.Response(text = "522: Hub Connection Timed Out", status = 522)
            elif errno.ECOMM:
                return web.Response(text = "503: Service Unavailable", status = 503)

        # Uncaught server exception.
        except Exception as e:
            print(e)
            return web.Response(text = "500: Internal Server Error", status = 500)

    return middleware
</pre>
    <p>&nbsp;</p>
    <p>Endpoint routes are split per device and they are aimed to be as simple as possible. Here is an example of a
        couple of the available routes pertaining to the automated door.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n3314"
        mdtype="fences" style="break-inside: unset;"># Automated door main hub REST endpoints.

async def door_close(request):
    """Handle a request to the /door/open endpoint"""
    command = {'device': 'door', 'action': 'close'}
    response = await hub.request(command)
    return web.json_response(text = json.dumps(response), status = 200)

async def door_update(request):
    """Handle a request to the /door/update endpoint"""
    command = {'device': 'door', 'action': 'update'}
    response = await hub.request(command)
    return web.json_response(text = json.dumps(response), status = 200)

</pre>
    <p>As can be seen from the above code we are able to use the await syntax with aioHTTP and get a response from the
        hub, <code>response = await hub.request(command)</code>.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3317' class='md-header-anchor '></a>Iteration 9 (Main Controller)</h4>
    <p>Having developed most of the services and interfaces required for the hub to operate we need to write the main
        controller that instantiates and connects all the components. </p>
    <p>&nbsp;</p>
    <p>The logic for this component is quite simple: instantiate all the required devices, load the set of interfaces,
        subscribe the devices to their respective interfaces and schedule some the required automated behaviour. On
        instantiation the main controller creates an object for each of the aforementioned and when the start function
        is run the application begins to listen on the interfaces. A function is present for scheduling a periodic
        heartbeat to all the CAN devices as well as requesting a periodic status update.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3322' class='md-header-anchor '></a>Iteration 10 (Language &amp; Actions)</h4>
    <p>The final consideration for the main hub was that of the domain specific language, this should allow the user to
        customise their system to their needs. In order to keep the language as separate from the main hub as possible
        all the actions have been implemented hub side and all the language shall do is generate a list of actions that
        need to occur. </p>
    <p>&nbsp;</p>
    <p>Due to the complexity of explaining the language it has been dedicated its own section within this corpus. This
        section will instead only explain how the actions are implemented hub side. To visit the implementation of the
        language please click <a href='#header-n3778'>here</a>.</p>
    <p>Derived from the language section the feature set of actions that need to be implemented are:</p>
    <ul>
        <li>Automated coop door control</li>
        <li>Ability to send SMS notifications</li>
        <li>Ability to send email notifications</li>
    </ul>
    <p>&nbsp;</p>
    <p>An action for controlling the door has already been implemented within the device itself, so we will only need to
        implement the notification based actions, sending SMS and email. For this two new services have been created,
        <code>SMSInterface</code> and <code>EmailInterface</code>. These services simply provide a builder class to
        abstract the required formatting for creating an email or SMS message, and then a send function to post it.</p>
    <p>Below is the implementation of the <code>send_email()</code> function, a similar design is followed for
        <code>send_sms()</code>.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n3337"
        mdtype="fences" style="break-inside: unset;"># Send email function from EmailInterface class.

async def send_email(self, email_message):
    """Sends an Email using the environment credentials"""
    try:
        # Decompose the email into parts.
        to      = email_message['to']
        from_   = email_message['from_']
        body    = email_message['body']

        mail_server = smtplib.SMTP(self.smtp_addr, self.smtp_port)
        mail_server.ehlo()
        mail_server.starttls()
        mail_server.login(self.email_addr, self.email_pass)
        mail_server.sendmail(from_, to, body)
        mail_server.close()

    except KeyError as e:
        self.log.error("Malformed email message received: {0}".format(email_message))
    except Exception as e:
        self.log.error("Failed to transmit message to STMP server,error: {0}".format(e))
        
</pre>
    <p>&nbsp;</p>
    <h4><a name='header-n3339' class='md-header-anchor '></a>Known Issues</h4>
    <p>There is currently only one known issue with the main hub.</p>
    <ul>
        <li>As it stands, though heartbeats are implemented, performed and logged, nothing is done with this data as a
            result of a failed heartbeat.</li>
    </ul>
    <p>&nbsp;</p>
    <h4><a name='header-n3345' class='md-header-anchor '></a>Future Work</h4>
    <p>There is a host of future work that could be done to improve the main hub.</p>
    <ul>
        <li>The current method for responding to asynchronous web requests is clumsy. A wrapper function for this could
            be used to help mitigate the chance of error and clean up the code base.</li>
        <li>Python was chosen as the language of choice for the main hub due to the library support, however few of the
            libraries used to justify this were actually used. As such we feel rebuilding the main hub within Erlang
            would help clean up the code base due to the better support for asynchronous programming.</li>
        <li>The main hub should be updated to use the Odroid C2 instead of the Raspberry Pi Model 3 B+.</li>
    </ul>
    <p>&nbsp;</p>
    <h2><a name='header-n3356' class='md-header-anchor '></a>System Database</h2>
    <h3><a name='header-n3358' class='md-header-anchor '></a>Research</h3>
    <p>Our project needed a database to store the sensor data returned from the modular network. This data is then
        displayed in a graph format on the web interface.</p>
    <p>We looked into a few different types of databases available to use. However, as we use SQL queries, any
        reasonably SQL compliant relational database management system (RDBMS) will suffice. We opted to use PostgreSQL
        for our project as it was available to us at the University, however this can easily be switched out with MySQL
        or the like.</p>
    <h3><a name='header-n3362' class='md-header-anchor '></a>Structure</h3>
    <p>We designed the structure of our database with efficiency in mind. As we knew we were going to have one sensor of
        each type, we had one table per sensor. Whilst this is not optimal, future work needs to be done to rectify
        this.</p>
    <p>&nbsp;</p>
    <p>The tables of our database are found below:</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>system</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>id SERIAL NOT NULL UNIQUE {PK}</td>
                </tr>
                <tr>
                    <td>lat DECIMAL NOT NULL</td>
                </tr>
                <tr>
                    <td>long DECIMAL NOT NULL</td>
                </tr>
                <tr>
                    <td>close_time INTEGER</td>
                </tr>
                <tr>
                    <td>open_time INTEGER</td>
                </tr>
                <tr>
                    <td>first_time_setup BOOLEAN NOT NULL</td>
                </tr>
                <tr>
                    <td>hub_url VARCHAR(128) NOT NULL</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>The system table is used to store information pertaining to the system as a whole. There is only ever one row
        which is updated with the relevant values to change.</p>
    <p>&nbsp;</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>user_account</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>username VARCHAR(128) NOT NULL UNIQUE {PK}</td>
                </tr>
                <tr>
                    <td>name VARCHAR(256) NOT NULL</td>
                </tr>
                <tr>
                    <td>password CHAR(64) NOT NULL</td>
                </tr>
                <tr>
                    <td>salt CHAR(64) NOT NULL</td>
                </tr>
                <tr>
                    <td>admin BOOLEAN NOT NULL</td>
                </tr>
                <tr>
                    <td>verified BOOLEAN NOT NULL</td>
                </tr>
                <tr>
                    <td>door_control BOOLEAN NOT NULL</td>
                </tr>
                <tr>
                    <td>default_pic BOOLEAN NOT NULL</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>The user_account contains information pertaining to each individual user. It stores information such as the
        hashed password alongside if the user has permission to control the door via the web interface.</p>
    <p>&nbsp;</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>user_email</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>username VARCHAR(128) NOT NULL {PK, FK}</td>
                </tr>
                <tr>
                    <td>email VARCHAR(256) NOT NULL {PK}</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>This table stores user emails, with the username being the foreign key referencing the username in the
        user_account table. </p>
    <p>&nbsp;</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>source_code</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>id SERIAL NOT NULL {PK}</td>
                </tr>
                <tr>
                    <td>name VARCHAR(128) NOT NULL</td>
                </tr>
                <tr>
                    <td>code VARCHAR NOT NULL</td>
                </tr>
                <tr>
                    <td>date_created TIMESTAMP</td>
                </tr>
                <tr>
                    <td>last_modified TIMESTAMP</td>
                </tr>
                <tr>
                    <td>is_active BOOLEAN NOT NULL</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>The above table stores data pertaining to the user programmed code snippets. There is only ever one row which has
        the is_active flag set to true.</p>
    <p>&nbsp;</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>temperature_readings</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>reading_id SERIAL NOT NULL {PK}</td>
                </tr>
                <tr>
                    <td>date TIMESTAMP</td>
                </tr>
                <tr>
                    <td>value DECIMAL</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>Basic table to store information sent from the temperature sensor</p>
    <p>&nbsp;</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>dust_readings</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>reading_id SERIAL NOT NULL {PK}</td>
                </tr>
                <tr>
                    <td>date TIMESTAMP</td>
                </tr>
                <tr>
                    <td>value DECIMAL</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>Basic table to store information sent from the dust sensor</p>
    <p>&nbsp;</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>pressure_readings</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>reading_id SERIAL NOT NULL {PK}</td>
                </tr>
                <tr>
                    <td>date TIMESTAMP</td>
                </tr>
                <tr>
                    <td>value DECIMAL</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>Basic table to store information sent from the pressure sensor</p>
    <p>&nbsp;</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>water_readings</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>reading_id SERIAL NOT NULL {PK}</td>
                </tr>
                <tr>
                    <td>date TIMESTAMP</td>
                </tr>
                <tr>
                    <td>value BOOLEAN</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>Basic table to store information sent from the water sensor. Value contains true if there is water, and false if
        there is not.</p>
    <p>&nbsp;</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>humidity_readings</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>reading_id SERIAL NOT NULL {PK}</td>
                </tr>
                <tr>
                    <td>date TIMESTAMP NOT NULL</td>
                </tr>
                <tr>
                    <td>value DECIMAL NOT NULL</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>Basic table to store information sent from the humidity sensor</p>
    <p>&nbsp;</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>door_readings</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>reading_id SERIAL NOT NULL {PK}</td>
                </tr>
                <tr>
                    <td>date TIMESTAMP NOT NULL</td>
                </tr>
                <tr>
                    <td>value VARCHAR(128) NOT NULL</td>
                </tr>
                <tr>
                    <td>initiator VARCHAR(128) NOT NULL</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>Basic table to store information sent from the door. Values can be either &quot;open&quot;, &quot;close&quot; or
        &quot;error&quot;.</p>
    <p>&nbsp;</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>egg_detection_readings</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>reading_id SERIAL NOT NULL {PK}</td>
                </tr>
                <tr>
                    <td>date TIMESTAMP NOT NULL</td>
                </tr>
                <tr>
                    <td>value BOOLEAN NOT NULL</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>Table to store information pertaining to egg presence. Value will be true if an egg is detected.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n3511' class='md-header-anchor '></a>Future Work</h3>
    <p>Our current database design is not extensible - the user will not be able to add another temperature sensor for
        example without creating another table. Therefore the design will have to be restructured to allow for this. For
        example, the design could be something similar to the following:</p>
    <p>&nbsp;</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>sensors</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>sensor_id SERIAL NOT NULL {PK}</td>
                </tr>
                <tr>
                    <td>sensor_name VARCHAR(128) NOT NULL</td>
                </tr>
                <tr>
                    <td>sensor_type VARCHAR(128) NOT NULL</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>&nbsp;</p>
    <p>Tables for different types of sensors can then be created with reference to the exact sensor_id in the sensor
        table:</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>temperature_readings</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>reading_id SERIAL NOT NULL {PK}</td>
                </tr>
                <tr>
                    <td>date TIMESTAMP</td>
                </tr>
                <tr>
                    <td>value DECIMAL</td>
                </tr>
                <tr>
                    <td>sensor_id {FK}</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>&nbsp;</p>
    <p>Queries such as </p>
    <p><code>SELECT * FROM temperature_readings WHERE sensor_id = $1</code> </p>
    <p>can then be used to target a specific temperature sensor.</p>
    <p>&nbsp;</p>
    <h2><a name='header-n3541' class='md-header-anchor '></a>Networking</h2>
    <h3><a name='header-n3543' class='md-header-anchor '></a>Premise</h3>
    <p>Building a modular network of sensors, it is a given that we will require some form of networking. At minimum, a
        system that aggregates data from multiple isolated sources would require a connection from those source to the
        aggregator; this being said we cannot understate the importance of networking within our project. </p>
    <p>Having opted to go for an architecture using a central control hub we will need connections from each device to
        this. Within the system there will be devices inside the coop that are in close proximity to the main hub as
        well those outside the coop. The devices that are going to be inside may be wired, whereas those outside cannot
        be.</p>
    <p>Alongside the requirements for the sensor network we also need to consider how we are going to interface with
        this data such that we can display it to the end user.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n3548' class='md-header-anchor '></a>Final Iteration Overview</h3>
    <p>The solution we implemented for our final product can be split into two components, module networking and general
        networking. </p>
    <p>For the module networking, all the devices based inside the coop were connected via a Control Area Network (CAN)
        Bus. This bus allowed these devices to send their obtained readings to the hub for aggregation and database
        entry. The devices based outside the coop, namely the drinker level monitor, were connected to a ZigBee based
        Personal Area Network (PAN). The coordinator of this PAN was a Raspberry Pi Zero with a connected CC2531 USB
        Dongle. </p>
    <p>Due to the commercial off-the-shelf (COTS) nature of the water sensor we used, the Xiaomi Aqara, we were required
        to use an external open source library to deconstruct its ZigBee packets. This library outputted this data via
        MQTT, and as such the hub subscribed to this broker. Ideally we would have avoided the need for this middleman,
        however, without sinking resource into either building a bespoke water sensor or reverse engineering the
        Zigbee2MQTT library this did not seem feasible.</p>
    <p>For the module networking we chose this combination of technologies for a few reasons, abstractly those reasons
        were cost and reliability. For a full description of our decision please refer to the conclusion of the next
        section, <a href='#header-n3609'>Module Networking</a>.</p>
    <p>Being the means of traversing the system boundary, the main hub requires a connection to a local Internet
        connected LAN, however, as does the Egg Identification module. Ideally this would have only been the main hub
        but due to processing power constraints the egg identification module had to be split into a client-server
        model. Had time permitted we would have converted the egg identification client into a simple device that took a
        picture and transmitted this to the main hub over the CAN bus, the hub would have then called out to the
        external image identification service itself; doing this would have returned the hub to being the only device
        requiring Internet connectivity.</p>
    <p>As for general networking, the hub connects to an external database in which it records the information received
        from the devices within the network. This database is then accessed via the REST service held by the web
        application, and then this is utilized to display the contents.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n3556' class='md-header-anchor '></a>Networking Requirements</h3>
    <p>As our system can be divided into two parts, the sensor network and the visualization, we are going to need a
        means of passing data between the two. For this reason at least one of the devices within the sensor network is
        going to need to have external communication such that it can interact with the other components. In an attempt
        to keep costs down we have chosen to use a single device, the main control hub, as the only device that can
        cross the sensor network system boundary, that is it can access the internet. This device will be responsible
        for storing all the data in the external database and providing the set of other services required by the web
        application.</p>
    <p>Below is a slighty abstracted diagram of our envisaged architecture. The sensor network will be a self enclosed
        system that communicates to the outside world via the main control hub. This control hub will interface with the
        back end of the web server along with the external database.</p>
    <p>&nbsp;</p>
    <p><img src='images/networking/network_structure.svg' alt='Network Structure' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>As the general networking required to communicate between hosted databases, REST servers and web applications is
        quite well defined, that will be omitted from this document. Instead the scope will focus on the communication
        between the sensors within the sensor network, alongside a brief description of the external communication
        interface provided by the hub to the other services, namely the web applications REST server.</p>
    <h3><a name='header-n3564' class='md-header-anchor '></a>Module Networking</h3>
    <p>As we need to connect the devices of the coop in some manner, we will contrast and compare a variety of different
        communication protocols to use within our project. We will split these protocols into two categories, wired and
        wireless.</p>
    <p>&nbsp;</p>
    <p>The first step was to decide on the set of protocols to compare. As can be seen below we have selected some
        common choices and we will compare them for speed, reliability and cost. To conclude we will decide on the
        protocols that we are going to use within this project and state why we believe they are the best options.</p>
    <p>&nbsp;</p>
    <p>For wired communication protocols we will be looking at:</p>
    <ul>
        <li>Universal Serial Bus (USB)</li>
        <li>Inter-Integrated Circuit (I2C)</li>
        <li>Serial Peripheral Interface (SPI)</li>
        <li>Control Area Network (CAN) Bus</li>
    </ul>
    <p>For wireless communication protocols we will be looking at:</p>
    <ul>
        <li>Wi-Fi (IEEE 802.11n)</li>
        <li>Bluetooth Low Energy (BLE)</li>
        <li>ZigBee</li>
    </ul>
    <p>&nbsp;</p>
    <h5><a name='header-n3588' class='md-header-anchor '></a>USB Protocol</h5>
    <p>An asynchronous serial protocol, the USB standard was developed to set a common interface for peripherals. USB
        2.0 provides a master-slave connection between two machines, supports a throughput of up to 480Mbps, and can
        connect a host to up to 127 slave devices (2<sup>8</sup> - 1). The master-slave premise dictates that a slave
        device can only transmit data back to the host should it state its ready to receive. The protocol for USB is
        rather complex and has a lot of overhead, but comes with robust error detection and a guaranteed quality of
        service. As for pricing, a caveat of USB is that should the product be sold, a licensing fee may have to be
        paid. Alongside this, if a custom sensor is built, the simplest solution to adding USB support would be via an
        interface board like the CH340 (~£3-5). This board then in turn would simply communicate with the rest of the
        system via UART or similar.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n3591' class='md-header-anchor '></a>I2C Protocol</h5>
    <p>I2C is a serial multi-master &amp; multi-slave protocol that allows communication over a two-wire bus. This bus
        uses resistive pull-up, that is the line is held high, and this limits the potential speeds capable; I2C is able
        to communicate up to rates of 1Mbps. As for addressing, support is provided for 7-bit and 10-bit addresses; this
        allows up to just over 1000 devices to be uniquely identified. Querying is done via transmitting the slaves
        address and the read flag, followed by the internal address of the register being read, the slave will then
        respond with the contents. As for writing to the slave, the slaves address is sent along with the write flag,
        followed by the internal register address and then finally the data. I2C interface boards can be purchased
        incredibly cheaply, at around ~£1.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n3594' class='md-header-anchor '></a>SPI Protocol</h5>
    <p>Serial Peripheral Interface (SPI) is another master slave protocol. It supports a single master and an infinite
        number of slaves; though this will be capped by the limited number of pins available on the master. Within this
        setup the master is responsible for generating the clock signal along with initiating all data transfer. As SPI
        uses a separate connection for both the slave input and master input, data can be sent simultaneously, it is
        full-duplex. No error detection or recovery is present within this protocol and transfer rates of 10-20Mbps can
        be reached. Looking into the cost, most microcontroller come with SPI capabilities therefore outside of a few
        wires there is no extra cost.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n3597' class='md-header-anchor '></a>CAN Protocol</h5>
    <p>Unlike the other protocols looked into so far CAN bus does not follow the master slave architecture; all devices
        are able to communicate freely on the bus without solicitation from another node. The CAN bus can transmit data
        at 125kbps at 500m, 1Mbps at 40m and 15Mbps at 10m. Unlike the other protocols CAN has built in mechanisms for
        bus recovery on errors as well as priority messaging. The first feature of error recovery is if a transmitter
        experiences a fault and the bus is moved to a non-functional dominant state, the dominant timeout functionality
        will soon move it back to recessive. The second feature is that a CRC is transmitted with each frame, if a
        received frame does not match the CRC it is disregarded by all nodes and an error frame can be transmitted along
        the bus. As for the priority messaging each frame is transmitted with an arbitration ID, a 12-bit value that
        represent the priority of the message. If two nodes communicate the message of higher arbitration takes
        precedence and the other is made to wait. As for cost, each CAN bus interface is connected along the same two
        wire bus via a CAN interface, these interface cost around £1.75 each. If the device being connected to the
        module is only 3.3v tolerant on it&#39;s pins a logic level converter is required, these come in at another ~£1.
    </p>
    <p>&nbsp;</p>
    <h5><a name='header-n3600' class='md-header-anchor '></a>Wi-Fi (IEEE 802.11n) Protocol</h5>
    <p>Wi-Fi is the standard wireless transmission protocol used in most homes today. It has a high throughput reaching
        up to 450-600Mbps for 802.11n, and can operate in both the 2.4Ghz and 5Gz bands. As this wireless standard was
        developed for computing devices within the home and business environments it did not focus on low power, this
        being said it may not be suitable for IOT devices that require their battery to last some extended period of
        time. The monetary cost of adding Wi-Fi capabilities to a sensor is within the region of ~£2 for a transceiver.
    </p>
    <p>&nbsp;</p>
    <h5><a name='header-n3603' class='md-header-anchor '></a>BLE Protocol</h5>
    <p>Bluetooth Low Energy operates on a PAN network and is an energy efficient radio communication protocol which can
        be widely found in mobile phones. Android, OS X, Windows Phone, iOS, Linux and Windows all support this protocol
        allowing easy integration into these systems. Having a typical operating range of 2-5m, this technology has a
        upper transmit rate of 1Mbps. A device using this protocol can either be a peripheral device, a slave role, or
        take the master role; this master role can support and initiate multiple connections. Alongside this, a device
        can either be an observer or a broadcaster. A central device (master), will initiate a connection with a
        peripheral, transmit data, and both can then go back to sleep, conserving power. A BLE transceiver is around
        ~£4.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n3606' class='md-header-anchor '></a>ZigBee Protocol</h5>
    <p>ZigBee is a wireless technology that was purpose built for low power Personal Area Networks (PAN). The main use
        of this technology is for low data transfer, energy efficient, secure networking. Commonly ZigBee nodes are
        wireless and sleep for the majority of the time and upon waking quickly transmit data before going back to
        sleep. Devices implementing the ZigBee protocol often have a range of around 10 to 30 meters, require a line of
        sight, and can transmit data at up to 0.25Mbps. Commonly devices implementing this protocol will be battery
        powered, although most modules can be wired in. The security in ZigBee usually refers to the fact that symmetric
        encryption is used between the communicating nodes. The cost of an Xbee, a device implementing the ZigBee
        protocol, is around ~£20.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n3609' class='md-header-anchor '></a>Conclusion</h5>
    <p>For the devices within the coop we have opted to go with a Control Area Network (CAN) bus configuration. For
        price as well as reliability we were certain that we wanted to use a wired protocol and as such we considered
        USB, SPI, I2C and CAN. The process we used to decide the protocol was a simple recursive ruling out. The first
        protocol we crossed off was I2C, this was due to rigid read/write structure that it imposed. Only being able to
        read directly from registries within the other device did not seem like an ideal solution for our project. The
        next protocol we ruled out was USB, this choice was made because going with this option seemed like it would
        introduce a lot of unnecessary overhead to our communications. The last one we ruled out was SPI, and this one
        was a bit of a hard choice, on one hand we knew a lot more about this protocol and a lot more information was
        available online, but on the flip side it was a master slave setup without error detection or recovery. In the
        end we decided to go with the CAN bus protocol and face the learning curve. The priority messaging alongside the
        error detection and recovery were too valuable to turn down, especially at the cheap cost of CAN bus
        implementation.</p>
    <p>As for the wireless communication for the devices outside the coop we elected either ZigBee or BLE as the
        protocol we will employ. We ruled out Wi-Fi pretty quickly due to the power consumption that the devices using
        it would have required, especially as they would most likely be remote and battery powered. When comparing and
        contrasting ZigBee to BLE we came to the conclusion that both covered the needs of our system, and as such have
        decided to use whichever is easier to implement when required.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n3613' class='md-header-anchor '></a>ZigBee Networking</h3>
    <p>We decided that our remote water sensor which monitors water level will need to operate on a wireless network. We
        opted to use ZigBee for this over BLE as ZigBee offers longer range devices and lower power consumption as we
        did not know where this water drinker will be. However, due to time constraints, we used a COTS solution, a
        Xiaomi Aqara water sensor. </p>
    <p>We were pleasantly surprised that this module uses ZigBee to communicate with Xiaomi&#39;s propriety bridge,
        however, time needed to be spent deconstructing this ZigBee packet to read the information contained inside. Our
        project supervisor advised us of a Node library called zigbee2mqtt which deconstructs the ZigBee packet and
        publishes it to an MQTT broker. More information about the water sensor can be found <a
            href="#header-n3029">here</a>.</p>
    <p>Due to time constraints, we opted to use this library, however, for future work, we will opt to build our own
        sensor as there are limitations with the Xiaomi sensor. Firstly, it is only IP67 rated, meaning the sensor can
        only be submerged for 30 minutes in water with a depth of 1m. In a real life situation, the water sensor could
        be submerged for a whole day or two, therefore we would need to design a solution which accommodates for this.
        For this solution, we would use ZigBee. </p>
    <p>&nbsp;</p>
    <h3><a name='header-n3618' class='md-header-anchor '></a>CAN Bus Networking</h3>
    <h4><a name='header-n3619' class='md-header-anchor '></a>Implementing CAN bus</h4>
    <p>Implementing CAN bus within our system proved to be a bigger challenge than first anticipated. Using example code
        from GitHub we were able to get successful communication between two Arduinos, but adding a Raspberry Pi to the
        network proved painful. </p>
    <p>We managed to find a guide online that showed how to <a
            href='https://vimtut0r.com/2017/01/17/can-bus-with-raspberry-pi-howtoquickstart-mcp2515-kernel-4-4-x/'>connect
            an MCP2515 CAN interface to a Raspberry Pi</a> and to our surprise it involved cutting a track within the
        PCB and soldering a wire to the board. Reading into the problem this was because the MCP2515 CAN transceiver
        requires 5v power to transmit, the receiver only requires 3.3v. With the Arduino&#39;s we were able to plug the
        board directly into the CAN interface as the GPIO pins are 5v tolerant, this is not the case on the Pi. For this
        reason we had to look into how we could step down the voltage before it reached the Pi. We experimented with
        building some simple voltage dividers but to no avail, so instead we looked into logic level converters. These
        circuits allowed us to successfully step down the voltage such that it was safe to connect the Pi to the
        MCP2515, though this was not the end of our problems.</p>
    <p>&nbsp;</p>
    <p><img src='images/networking/logic_level_converter.jpg' alt='Logic level converter'
            referrerPolicy='no-referrer' /></p>
    <center><i>Logic Level Converter Connected to MCP2515 Interface</i>
        <center></center>
    </center>
    <p>&nbsp;</p>
    <p>Once this was done and we had successfully wired the two devices, the next problem to solve was how to setup the
        CAN interface within Linux. Reading around we found that the Linux Kernel currently contains an implementation
        of CANopen and as such it should have just been a job of configuring this. Setting the required parameters and
        building a simple demo program within Python, we managed to get a few messages passing over the network before
        the line went silent. This would be the same situation for the next four days and around 30 hours of our lives.
    </p>
    <p>Attempting to debug this we installed the can-utils tools and monitored the data being received on the bus. As
        before we saw the short burst of success, then silence. We decided to circumvent Python in case it was one of
        the libraries causing the issue, we simply sent raw CAN messages via the command line. This appeared to have a
        higher success rate. With this in mind we built a second demonstration program using Python, but instead of
        using the python-can library we opted for native sockets. Again a few successful packets then nothing. After
        hours of looking into different tools, statistics and page 10 Google results we were about to cut our losses and
        jump over to our backup plan of ZigBee or SPI. In a last ditch effort at around 2am we decided to sit down with
        a drink and read the 94-page <a
            href='http://ww1.microchip.com/downloads/en/DeviceDoc/MCP2515-Stand-Alone-CAN-Controller-with-SPI-20001801J.pdf'>MCP2515
            data sheet</a>, we came across the max SPI speed supported by the MCP2515, 10MHz. It turns out the for the
        Raspberry Pi Model 3 B+ it defaults above this at 15.6Mhz, this is not the case on the older models. Fixing this
        solved all the issues with CAN bus and it turns out it was actually the SPI controller silently crashing, not
        the bus at all. The witnessed behavior was all coincidence.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n3629' class='md-header-anchor '></a>Packet Structure</h4>
    <p>As we decided to use CAN bus as our main communication protocol for the devices in the coop we built a packet
        structure around the singular frame size. We could have performed buffering at the receiver but for the data we
        were required to send this seemed unnecessary. A payload of a standard CAN bus frame is 8 bytes in size and thus
        this was the space we had to work with.</p>
    <p>We split the data available to us into three top level sections, a host byte defining sender and receiver, a type
        byte stating the message type, and a six byte application specific payload.</p>
    <p>&nbsp;</p>
    <p><img src='images/networking/00_outer_frame.svg' alt='Outer frame' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><strong>Host Byte</strong></p>
    <p>The host byte of the packet was split into two components, 4-bits for the source address and 4-bits for receiver
        address, the structure of this can be seen below. This allowed us to have up to 16 addressable devices and for
        our purposes this is plenty enough.</p>
    <p>&nbsp;</p>
    <p><img src='images/networking/01_host_byte.svg' alt='Host byte' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><strong>Packet Type Byte</strong></p>
    <p>The next part of the packet we looked into was the types of message that we needed to be able to support. Using a
        bit flag approach we could cover 8 different packet types within our byte.</p>
    <p>We decided on the following set of types:</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>Packet Type</th>
                    <th>Explanation</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Data Response</td>
                    <td>A response containing device status data from client to hub.</td>
                </tr>
                <tr>
                    <td>Command</td>
                    <td>A command invoking an action from the hub to a client.</td>
                </tr>
                <tr>
                    <td>Update Request</td>
                    <td>A request from the hub to client asking it to update its information.</td>
                </tr>
                <tr>
                    <td>Heartbeat Response</td>
                    <td>A response to a heartbeat request from client to hub.</td>
                </tr>
                <tr>
                    <td>Heartbeat Request</td>
                    <td>A request from the hub to client asking it to acknowledge its alive.</td>
                </tr>
                <tr>
                    <td>Status Request</td>
                    <td>A request from the hub to client requesting device status.</td>
                </tr>
                <tr>
                    <td>Command Acknowledgement</td>
                    <td>An acknowledgement of a command from client to hub.</td>
                </tr>
                <tr>
                    <td>Reserved</td>
                    <td>-</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>&nbsp;</p>
    <p>This structure can be seen in diagrammatic form below.</p>
    <p><img src='images/networking/02_packet_types.svg' alt='Packet types' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><strong>Status Request</strong></p>
    <p>The next part we looked into was the structure of the status requests against our system. As each device is only
        in one given state at a time we opted to zero out the payload of this packet. A status request sent from hub to
        device simply requires correct addressing in the host byte and a status packet type, 0b00100000.</p>
    <p>&nbsp;</p>
    <p><img src='images/networking/03_status_request.svg' alt='Status request' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><strong>Heartbeat Request</strong></p>
    <p>Next was heartbeat request, another packet type sent from hub to device, this request has a type of 0b00010000
        and a randomly defined payload. The sent payload should be returned in the subsequent heartbeat response.</p>
    <p>&nbsp;</p>
    <p><img src='images/networking/04_heartbeat_request.svg' alt='Heartbeat request' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><strong>Heartbeat Response</strong></p>
    <p>The answer to a heartbeat request, the heartbeat response shares a similar structure. When a device receives a
        heartbeat request it strips the payload and returns this to the main control hub in a heartbeat response packet,
        the type of this packet is 0b00001000.</p>
    <p>&nbsp;</p>
    <p><img src='images/networking/05_heartbeat_response.svg' alt='Heartbeat response' referrerPolicy='no-referrer' />
    </p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><strong>Update Time (Hub to Automated Door)</strong></p>
    <p>An time update command from the hub to the door. As can be seen the packet type is 0b00000100. The first byte of
        the payload is used to specify the type of the update, this is done using bit flags. The subsequent bytes are
        used for the data. This given update is for time, therefore bytes 2, 3, 4, 5 of the packet contain a UNIX
        timestamp.</p>
    <p>&nbsp;</p>
    <p><img src='images/networking/06_update_to_door.svg' alt='Update to door' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><strong>Command (Hub to Automated Door)</strong></p>
    <p>This packet specifies an update command from the hub to the automated door, as can be seen the packet type is
        command, 0b00000010. The payload of this packet uses bitflags within the first byte to specify whether the door
        should open (0b10) or close (0b00). </p>
    <p>&nbsp;</p>
    <p><img src='images/networking/07_cmd_to_door.svg' alt='Command to door' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><strong>Data Response (Temperature to Hub)</strong></p>
    <p>This packet shows the format of a data response from the temperature sensor to the hub. This reading is split
        across four bytes with the first two being a 16-bit integral value and the lower 16-bit being the fractional
        value. For example, the temperature 20.25°C would be expressed as the following 4 bytes: 0x00140019.</p>
    <p>&nbsp;</p>
    <p><img src='images/networking/08_temp_data.svg' alt='Temperature data' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><strong>Data Response (Humidity to Hub)</strong></p>
    <p>This packet shows the format of a data response from the humidity sensor to the hub. This reading is split across
        four bytes with the first two being a 16-bit integral value and the lower 16-bit being the fractional value.
    </p>
    <p>&nbsp;</p>
    <p><img src='images/networking/09_humidity_data.svg' alt='Humidity data' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><strong>Data Response (Pressure to Hub)</strong></p>
    <p>This packet shows the format of a data response from the pressure sensor to the hub. This reading is split across
        two bytes that are combined to make a singular 16-bit integral value.</p>
    <p>&nbsp;</p>
    <p><img src='images/networking/10_pressure_data.svg' alt='Pressure data' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><strong>Data Response (Dust to Hub)</strong></p>
    <p>This packet shows the format of a data response from the dust sensor to the hub. This reading is split across two
        bytes that are combined to make a singular 16-bit integral value.</p>
    <p>&nbsp;</p>
    <p><img src='images/networking/11_dust_data.svg' alt='Dust data' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><strong>Data Response (Door to Hub)</strong></p>
    <p>This packet shows the format of a data response from the automated door to the hub. This reading uses bit flags
        within the first byte of the payload to express the doors current state, as well as the action that caused it to
        enter that state. The actions include Automated behavior and physical button press.</p>
    <p>&nbsp;</p>
    <p><img src='images/networking/12_door_data.svg' alt='Door data' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><strong>Data Response (Egg Identifier to Hub)</strong></p>
    <p>The egg identification unit uses bit flags within the first byte, though only one state exists. If the first byte
        is set to 0b00000001 an egg has been detected within the coop, otherwise nothing has.</p>
    <p>&nbsp;</p>
    <p><img src='images/networking/13_egg_identifier_data.svg' alt='Egg identifier data' referrerPolicy='no-referrer' />
    </p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><strong>Command Acknowledgement (Door to Hub)</strong></p>
    <p>This last example packet shows an acknowledgement from the door to hub. This packet has the type 0b01000000 and
        states the action the door is taking alongside the event that caused it to occur.</p>
    <p>&nbsp;</p>
    <p><img src='images/networking/14_door_event_ack.svg' alt='Door event ack' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <h3><a name='header-n3750' class='md-header-anchor '></a>Hub Interface</h3>
    <p>As the main control hub of the system acts as the bridge between the sensor network and the external web
        application, it needs to provide an interface that allows communication. As not to add a lot of implementation
        specific logic to the web application we have decided that the hub will host it&#39;s on local REST server. The
        back-end of the web application will simply be able to ping these authenticated endpoints using its native web
        requests and this should allow it to communicate with the sensor network. A diagram of this architecture can be
        seen below.</p>
    <p>&nbsp;</p>
    <p><img src='images/networking/hub_rest.svg' alt='Hub REST architecture' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>To learn more about the implementation of the hubs REST API click <a href='#header-n3297'>here</a> to visit the main control
        hub section of this corpus, alternatively to learn more about the web application REST API click <a
            href='#header-n4412'>here</a>.</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <h3><a name='header-n3758' class='md-header-anchor '></a>Known Issues</h3>
    <p>There are a few known issues with our current networking that should we have the chance to look into we would
        like to fix.</p>
    <ul>
        <li>The egg identification module currently communicates via Wi-Fi to the external image identification service,
            ideally only the hub should exit the sensor network boundary.</li>
        <li>The water sensor has a convoluted flow of data. ZigBee device to MQTT broker to main hub subscriber, it
            would be nice to remove the MQTT middleman; ZigBee sensor directly to main hub.</li>
        <li>The current packet structure only allows a maximum of 15 uniquely addressable devices on the CAN. Though not
            currently a problem, in hindsight we feel that if development continues this may bottleneck the system.</li>
    </ul>
    <p>&nbsp;</p>
    <h3><a name='header-n3768' class='md-header-anchor '></a>Future Work</h3>
    <p>As for future work we have a few suggestions as to how to improve the system.</p>
    <ul>
        <li>Create an automatic pairing mechanism between the main hub and new CAN modules being added to the network.
        </li>
        <li>Build a means to buffer data received via the CAN bus so packets are not limited to the current fixed CAN
            frame size (8 bytes).</li>
    </ul>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <h2><a name='header-n3778' class='md-header-anchor '></a>Domain Specific Language</h2>
    <h3><a name='header-n3780' class='md-header-anchor '></a>Premise</h3>
    <p>Having spoken to multiple smallholders it was apparent that though they shared some common problems or faced
        similar hardships they all had their own fixed routine to overseeing their coop. To create our system such that
        we do not dictate the end users process of managing their chickens Dan Knox suggested that we look into building
        a simplistic language that can be used to programmatically control the system; he mentioned looking into ladder
        logic.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n3783' class='md-header-anchor '></a>Final Iteration Overview</h3>
    <p>The final implemented solution was a departure from ladder logic and instead opted to use a custom domain
        specific language (DSL) to provide the user greater control over how the system operates. A DSL was chosen as it
        allowed the language to express more complex functionality outside of the standard &#39;if this then that&#39;
        capabilities offered by ladder logic.</p>
    <p>The event driven language produced includes three top level constructs, &#39;ON&#39;, &#39;AT&#39; and
        &#39;EVERY&#39;; these top level events dictate when the code inside is executed. The body of an &#39;ON&#39;
        code block is executed when a given event occurs, an &#39;AT&#39; code block when a specific time of day is
        reached, and an &#39;EVERY&#39; code block at a fixed period.</p>
    <p>The body of these top level constructs can contain two types of children, conditionals and actions. Conditionals
        are standard style &#39;if&#39; statements, for example, if the temperature in the coop is greater than this
        threshold then do this. Actions on the other hand are outputs from the system, these include opening and closing
        the coop door or sending custom SMS or email notifications.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n3788' class='md-header-anchor '></a>Iteration 1 (Research)</h3>
    <h4><a name='header-n3789' class='md-header-anchor '></a>Ladder Logic</h4>
    <p>Ladder logic is a programming language that is built on the notion of relays and switches. The inputs of the
        system are usually derived from the state of the devices and dependent on their configuration, N outputs are
        generated. At present ladder logic has evolved into a language that is used commonly to diagrammatically
        describe a program based on device state, and is often used as a basis to writing the code for a programmable
        logic controller (PLC). A simplistic example of ladder logic can be seen below.</p>
    <p>&nbsp;</p>
    <p><img src='images/language/ladder_logic.jpg' alt='Simple ladder logic example' referrerPolicy='no-referrer' /></p>
    <center><a
            href="http://www.edgefx.in/wp-content/uploads/2014/08/24.jpg">http://www.edgefx.in/wp-content/uploads/2014/08/24.jpg</a>
    </center>
    <p>&nbsp;</p>
    <p>The example above shows the premise of ladder logic, the left rail represents live and the right rail negative.
        Each rung represents a route to an output, if switch one or two are activated, the lamp is on.</p>
    <p>Within our system using the notion of ladder logic we could build a program that dependent on the state of given
        sensors and devices, performs some output. An example phrase in this ladder logic based language could be,
        &#39;If the door is open and the time is after 18:00 then close the door&#39;. Within this example there would
        be a single rung with two switches, one representing door state and the other current time, the output of this
        rung would be closing the coop door.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n3798' class='md-header-anchor '></a>Strengths of ladder logic approach</h5>
    <ul>
        <li>Simple syntax with little knowledge required from the end user to program.</li>
        <li>Easy to parse and interpret due to the &#39;if this then that&#39; language semantics.</li>
        <li>Simplistic to add additional state based devices.</li>
    </ul>
    <p>&nbsp;</p>
    <h5><a name='header-n3807' class='md-header-anchor '></a>Limitations of ladder logic approach</h5>
    <ul>
        <li>Difficult to express constructs outside of &#39;if this then that&#39;, such as execution at a fixed
            interval.</li>
        <li>Difficult to define variables or parameters without adding overhead to the language.</li>
        <li>Larger programs may become difficult to read and manage due to linear non-nested appearance.</li>
    </ul>
    <p>&nbsp;</p>
    <h4><a name='header-n3816' class='md-header-anchor '></a>Domain Specific Language (DSL)</h4>
    <p>Another approach to solving this problem would be to produce a domain specific language (DSL), this solution
        tends closer towards the standard general purpose programming languages we see today. This solution would allow
        constructs to be added to the language outside of the simple states present in ladder logic and as such would be
        easier to implement more complex functions, like loops, parameters or variables.</p>
    <p>This solution warrants a lot more development overhead but would allow the language to be more expressive,
        simpler to read large projects and scale better.</p>
    <p>&nbsp;</p>
    <p>The development of this kind of solution would include:</p>
    <ol start=''>
        <li>Deciding on the constructs and features within the language</li>
        <li>Designing a grammar that implements these features and can produce all valid programs</li>
        <li>Creating the set of valid tokens present within the system</li>
        <li>Developing a lexical analyzer to parse the input program into tokens (tokenizer)</li>
        <li>Developing an interpreter to check semantic correctness and build the internal representation</li>
        <li>Developing a system for executing the internal representation of the program</li>
    </ol>
    <p>&nbsp;</p>
    <h4><a name='header-n3835' class='md-header-anchor '></a>Chosen method</h4>
    <p>Though the simplicity of implementing the ladder logic approach is much greater than that of the DSL the extra
        capabilities afforded by the DSL outweighs this benefit. Having the ability to parse arbitrary self defined
        syntax provides much greater expressiveness, and should the situation arise that we need to expand the language,
        by choosing a DSL, we will not be put in the position that the language is unable to support the new construct.
        For these reasons we have chosen to implement a DSL.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n3838' class='md-header-anchor '></a>Iteration 2 (Language Design)</h3>
    <h4><a name='header-n3839' class='md-header-anchor '></a>Features</h4>
    <p>Now the architecture behind the language has been decided the next step is to define the functionality that the
        language will implement. Once this has been decided it should help to derive the best syntax and semantics to
        express it.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n3842' class='md-header-anchor '></a>Client requested features</h5>
    <ul>
        <li>Ability to setup SMS notifications</li>
        <li>Ability to setup email notifications</li>
        <li>Ability to control the automated coop door</li>
    </ul>
    <p>&nbsp;</p>
    <h5><a name='header-n3851' class='md-header-anchor '></a>Additional desired features</h5>
    <ul>
        <li>Ability to build conditional statements comparing the state of the current devices in the system</li>
        <li>Constructs for executing code at a given point within in a day</li>
        <li>Constructs for executing code when a given event occurs within the system</li>
        <li>Constructs for executing code at a fixed interval</li>
        <li>Ability to add comments to the source code</li>
        <li>Simplistic syntax that mimics the English language</li>
    </ul>
    <p>&nbsp;</p>
    <h4><a name='header-n3866' class='md-header-anchor '></a>Language Syntax</h4>
    <h5><a name='header-n3867' class='md-header-anchor '></a>Overview</h5>
    <p>This part of the document will describe the process for deriving the syntax of the language. The goal of this
        section is to decide on the valid constructs in the language, and define the tokens and ordering required to
        build these.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n3870' class='md-header-anchor '></a>Constructs</h5>
    <p>For the initial iteration the language will be quite lightweight, as per the list of previously defined features
        three top level constructs should be present: on a given event occurring, at a specific time of day and every
        fixed period.</p>
    <p>&nbsp;</p>
    <p>Aiming to replicate standard English, to improve readability, these top-level constructs will read as follows:
    </p>
    <p><strong>On event</strong>: <span> </span>ON &#39;event&#39; DO &#39;body&#39;</p>
    <p><strong>At time</strong>: <span> </span>AT &#39;time&#39; DO &#39;body&#39;</p>
    <p><strong>Each period</strong>: <span> </span>EVERY &#39;time&#39; DO &#39;body&#39;</p>
    <p>&nbsp;</p>
    <p>Now that we have defined top level constructs we can see that we need to be able to express events, time, and
        body constructs. The body of a piece of code should be able to perform two operations, execute conditionals and
        execute actions.</p>
    <p>&nbsp;</p>
    <p><strong>Events</strong>:<span> </span>Events will be atomic values within the language, similar to atoms in
        Erlang.</p>
    <p><strong>Time</strong>:<span> </span>For the ease of parsing time will be represented as a 24-hour clock (00:00).
    </p>
    <p><strong>Body</strong>:<span> </span>The body of a construct should be built of a set of actions and conditionals.
    </p>
    <p><strong>Conditional</strong>:<span> </span>IF &#39;condition&#39; THEN &#39;body&#39;</p>
    <p><strong>Actions</strong>:<span> </span>Actions will be defined commands within the language.</p>
    <p><strong>Condition</strong>:<span> </span>&#39;reading&#39; &#39;operator&#39; &#39;value&#39;</p>
    <p><strong>Reading</strong>:<span> </span>A reading will be the status of a specific device within the modular
        network.</p>
    <p><strong>Operator</strong>:<span> </span>Standard set of comparison operators.</p>
    <p><strong>Value</strong>:<span> </span>A numerical or string value.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n3890' class='md-header-anchor '></a>Defining Events</h5>
    <p>Events within the language will be derived from those raised by the devices within the modular network, the list
        is as follows:</p>
    <ul>
        <li>Automated door opening</li>
        <li>Automated door closing</li>
        <li>Automated door error</li>
        <li>Water drinker empty</li>
        <li>Egg detected</li>
    </ul>
    <p>&nbsp;</p>
    <h5><a name='header-n3904' class='md-header-anchor '></a>Defining Readings</h5>
    <p>Readings within the language will be derived from the status of given devices within the modular network, the
        list is as follows:</p>
    <ul>
        <li>Door state</li>
        <li>Drinker state</li>
        <li>Egg detection state</li>
        <li>Coop temperature</li>
        <li>Coop humidity</li>
        <li>Coop pressure</li>
        <li>Coop dust</li>
    </ul>
    <p>&nbsp;</p>
    <h5><a name='header-n3922' class='md-header-anchor '></a>Defining Actions</h5>
    <p>Actions within the language will be derived from the actionable features of the devices within the modular
        network alongside those defined by the client, sending SMS and sending email. The list is as follows:</p>
    <ul>
        <li>Open Door</li>
        <li>Close Door</li>
        <li>Send SMS</li>
        <li>Send Email</li>
    </ul>
    <p>&nbsp;</p>
    <h5><a name='header-n3934' class='md-header-anchor '></a>Language Grammar</h5>
    <p>Now that the set of requirements and the generalised structure of the language have been defined we can produce a
        grammar to ensure that the language is able to parse the set of programs intended.</p>
    <p>The following context-free grammar (CFG) is the result of that process. The start state is the non-terminal
        <code>&lt;program&gt;</code>.</p>
    <p>It should be noted that due to difficulties in parsing constructs within the language, that is ON, AT, EVERY and
        IF, they have all had an ending tag added to their definiton, this can be seen in the grammar below.</p>
    <p>&nbsp;</p>
    <figure>
        <table>
            <thead>
              <tr>
                <th>Production Rules</th>
                <th>Output</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>&lt;string&gt;</code></td>
                <td>\&quot;[^&quot;]*\&quot;</td>
              </tr>
              <tr>
                <td><code>&lt;number&gt;</code></td>
                <td>[0-9]+.?([0-9]{1,2})?</td>
              </tr>
              <tr>
                <td><code>&lt;time&gt;</code></td>
                <td>[0-9]{2} &#39;:&#39; [0-9]{2}</td>
              </tr>
              <tr>
                <td><code>&lt;phone_number&gt;</code></td>
                <td>\&quot;+?[0-9]{11-13}\&quot;</td>
              </tr>
              <tr>
                <td><code>&lt;email&gt;</code></td>
                <td>\&quot;[A-Za-z0-9!#$%&amp;&#39;*+-/=?^_]\&quot;</td>
              </tr>
              <tr>
                <td><code>&lt;operator&gt;</code></td>
                <td>&#39;&lt;&#39; |<br />&#39;&gt;&#39; |<br />&#39;&lt;=&#39; |<br />&#39;&gt;=&#39; |<br />&#39;=&#39;
                </td>
              </tr>
              <tr>
                <td><code>&lt;action&gt;</code></td>
                <td>&#39;open_door&#39; |<br />&#39;close_door&#39; |<br /><code>&lt;send_sms&gt;</code>
                  |<br /><code>&lt;send_email&gt;</code></td>
              </tr>
              <tr>
                <td><code>&lt;send_sms&gt;</code></td>
                <td>&#39;send_sms(&#39; <code>&lt;phone_number&gt;</code> &#39;,&#39; <code>&lt;string&gt;</code>
                  &#39;)&#39;</td>
              </tr>
              <tr>
                <td><code>&lt;send_email&gt;</code></td>
                <td>&#39;send_email(&#39; <code>&lt;email&gt;</code> &#39;,&#39; <code>&lt;string&gt;</code> &#39;,&#39;
                  <code>&lt;string&gt;</code> &#39;)&#39;</td>
              </tr>
              <tr>
                <td><code>&lt;actions&gt;</code></td>
                <td><code>&lt;action&gt;</code> |<br /><code>&lt;action&gt;</code> <code>&lt;actions&gt;</code></td>
              </tr>
              <tr>
                <td><code>&lt;event&gt;</code></td>
                <td>&#39;door_opening&#39; |<br />&#39;door_closing&#39; |<br />&#39;door_error&#39;
                  |<br />&#39;egg_detected&#39; |<br />&#39;drinker_empty&#39;</td>
              </tr>
              <tr>
                <td><code>&lt;reading&gt;</code></td>
                <td>&#39;door_status&#39; | <br />&#39;coop_humidity&#39; | <br />&#39;coop_pressure&#39; |
                  <br />&#39;coop_dust&#39; | <br />&#39;drinker_level&#39;</td>
              </tr>
              <tr>
                <td><code>&lt;condition&gt;</code></td>
                <td><code>&lt;reading&gt;</code> <code>&lt;operator&gt;</code> <code>&lt;string&gt;</code>
                  <br /><code>&lt;reading&gt;</code> <code>&lt;operator&gt;</code> <code>&lt;number&gt;</code></td>
              </tr>
              <tr>
                <td><code>&lt;conditions&gt;</code></td>
                <td><code>&lt;condition&gt;</code> |<br /><code>&lt;condition&gt;</code> &#39;and&#39;
                  <code>&lt;conditions&gt;</code> |<br /><code>&lt;condition&gt;</code> &#39;or&#39;
                  <code>&lt;conditions&gt;</code></td>
              </tr>
              <tr>
                <td><code>&lt;conditional&gt;</code></td>
                <td>&#39;if&#39; <code>&lt;conditions&gt;</code> &#39;then&#39; <code>&lt;body&gt;</code> &#39;end_if&#39;
                </td>
              </tr>
              <tr>
                <td><code>&lt;body&gt;</code></td>
                <td><code>&lt;actions&gt;</code> <code>&lt;body&gt;</code> |<br /><code>&lt;conditional&gt;</code>
                  <code>&lt;body&gt;</code> |<br />ε</td>
              </tr>
              <tr>
                <td><code>&lt;command&gt;</code></td>
                <td>&#39;on&#39; <code>&lt;event&gt;</code> &#39;do&#39; <code>&lt;body&gt;</code> &#39;end_on&#39;
                  |<br />&#39;at&#39; <code>&lt;time&gt;</code> &#39;do&#39; <code>&lt;body&gt;</code> &#39;end_at&#39;
                  |<br />&#39;every&#39; <code>&lt;time&gt;</code> &#39;do&#39; <code>&lt;body&gt;</code>
                  &#39;end_every&#39;</td>
              </tr>
              <tr>
                <td><code>&lt;commands&gt;</code></td>
                <td><code>&lt;command&gt;</code> |<br /><code>&lt;command&gt;</code> <code>&lt;commands&gt;</code></td>
              </tr>
              <tr>
                <td><code>&lt;program&gt;</code></td>
                <td><code>&lt;commands&gt;</code> |<br />ε</td>
              </tr>
            </tbody>
          </table>
    </figure>
    <p><em>N.B: Terminal characters are denoted by single quotes and non-terminals by angled bracket notation.</em></p>
    <p>&nbsp;</p>
    <h5><a name='header-n4035' class='md-header-anchor '></a>Grammar Derivations</h5>
    <p>Now the language has been defined a few example derivations will demonstrate what can be expressed.</p>
    <p>&nbsp;</p>
    <p><strong>Derivation #1</strong></p>
    <p>This first program describes a piece of code that executes on the event <code>&#39;door_opening&#39;</code>. When
        executed this code sends an SMS notification to the mobile number <code>&#39;07715967677&#39;</code> that reads
        <code>&#39;Opened&#39;</code>.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n4040"
        mdtype="fences" style="break-inside: unset;"># Derivation of program that executes on door opening and sends SMS notification.

&lt;program&gt; 
	--&gt; &lt;commands&gt;
	
	--&gt; &lt;command&gt;
	
	--&gt; 'ON' &lt;event&gt; 'DO' &lt;body&gt; 'END_ON'
	
	--&gt; 'ON' 'door_opening' 'DO' &lt;body&gt; 'END_ON'
	
	--&gt; 'ON' 'door_opening' 'DO' &lt;actions&gt; &lt;body&gt; 'END_ON'
	
	--&gt; 'ON' 'door_opening' 'DO' &lt;actions&gt; 'END_ON'
	
	--&gt; 'ON' 'door_opening' 'DO' &lt;action&gt; 'END_ON'
	
	--&gt; 'ON' 'door_opening' 'DO' &lt;send_sms&gt; 'END_ON'
	
	--&gt; 'ON' 'door_opening' 'DO' 'send_sms(' &lt;phone_number&gt; ',' &lt;string&gt; ')' 'END_ON'
	
	--&gt; 'ON' 'door_opening' 'DO' 'send_sms(' '"07715967677"' ',' &lt;string&gt; ')' 'END_ON'
	
	--&gt; 'ON' 'door_opening' 'DO'
			'send_sms(' '"07715967677"' ',' '"Opened."' ')'
        'END_ON'
	
</pre>
    <p>&nbsp;</p>
    <p><strong>Derivation #1 Tree</strong></p>
    <p><img src='images/language/simple_cfg_tree.svg' alt='Simple CFG derivation tree' referrerPolicy='no-referrer' />
    </p>
    <p>&nbsp;</p>
    <p><strong>Derivation #2</strong></p>
    <p>This second example demonstrates a program that executes every thirty minutes. The code checks the current status
        of the <code>&#39;coop_temperature&#39;</code> and sends a warning email to
        <code>&#39;ds576@kent.ac.uk&#39;</code> reading <code>&#39;Hot!&#39;</code> if the temperature at that time
        exceeds <code>&#39;35.0&#39;</code> degrees C.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n4047"
        mdtype="fences" style="break-inside: unset;"># Derivation of program that executes every half hour and sends a warning email if coop
# temperature gets too high.

&lt;program&gt;
	--&gt; &lt;commands&gt;
	
	--&gt; &lt;command&gt;
	
	--&gt; 'EVERY' &lt;time&gt; 'DO' &lt;body&gt; 'END_EVERY'
	
	--&gt; 'EVERY' '00:30' 'DO' &lt;body&gt; 'END_EVERY'
	
	--&gt; 'EVERY' '00:30' 'DO' &lt;conditional&gt; &lt;body&gt; 'END_EVERY'
	
	--&gt; 'EVERY' '00:30' 'DO' &lt;conditional&gt; 'END_EVERY'
	
	--&gt; 'EVERY' '00:30' 'DO' 'IF' &lt;conditions&gt; 'THEN' &lt;body&gt; 'END_IF' 'END_EVERY'
	
	--&gt; 'EVERY' '00:30' 'DO' 'IF' &lt;condition&gt; 'THEN' &lt;body&gt; 'END_IF' 'END_EVERY'
	
	--&gt; 'EVERY' '00:30' 'DO' 'IF' &lt;temp_condition&gt; 'THEN' &lt;body&gt; 'END_IF' 'END_EVERY'
	
	--&gt; 'EVERY' '00:30' 'DO'
			'IF' 'coop_temperature' '&gt;' &lt;temp_value&gt; 'THEN'
				&lt;body&gt; 
			'END_IF'
		'END_EVERY'
		
    --&gt; 'EVERY' '00:30' 'DO'
			'IF' 'coop_temperature' '&gt;' 35.0 'THEN'
				&lt;body&gt; 
			'END_IF'
		'END_EVERY'
		
	--&gt; 'EVERY' '00:30' 'DO'
			'IF' 'coop_temperature' '&gt;' 35.0 'THEN'
				&lt;actions&gt; &lt;body&gt;
			'END_IF'
		'END_EVERY'
		
	--&gt; 'EVERY' '00:30' 'DO'
			'IF' 'coop_temperature' '&gt;' 35.0 'THEN'
				&lt;actions&gt; 
			'END_IF'
		'END_EVERY'
		
	--&gt; 'EVERY' '00:30' 'DO'
			'IF' 'coop_temperature' '&gt;' 35.0 'THEN'
				&lt;action&gt; 
			'END_IF'
		'END_EVERY'
		
	--&gt; 'EVERY' '00:30' 'DO'
			'IF' 'coop_temperature' '&gt;' 35.0 'THEN'
				&lt;send_email&gt; 
			'END_IF'
		'END_EVERY'
		
	--&gt; 'EVERY' '00:30' 'DO'
			'IF' 'coop_temperature' '&gt;' 35.0 'THEN'
				'send_email(' &lt;email&gt; ',' &lt;string&gt; ',' &lt;string&gt; ')'
			'END_IF'
		'END_EVERY'
		
	--&gt; 'EVERY' '00:30' 'DO'
			'IF' 'coop_temperature' '&gt;' 35.0 'THEN'
				'send_email(' '"ds576@kent.ac.uk"' ',' &lt;string&gt; ',' &lt;string&gt; ')'
			'END_IF'
		'END_EVERY'
		
	--&gt; 'EVERY' '00:30' 'DO'
			'IF' 'coop_temperature' '&gt;' 35.0 'THEN'
				'send_email(' '"ds576@kent.ac.uk"' ',' '"Subject."' ',' &lt;string&gt; ')'
			'END_IF'
		'END_EVERY'
		
	--&gt; 'EVERY' '00:30' 'DO'
			'IF' 'coop_temperature' '&gt;' 35.0 'THEN'
				'send_email(' '"ds576@kent.ac.uk"' ',' '"Subject."' ',' '"Hot!"' ')'
			'END_IF'
		'END_EVERY'
	
</pre>
    <p>&nbsp;</p>
    <p><strong>Derivation #2 Tree</strong></p>
    <p><img src='images/language/complex_cfg_tree.svg' alt='Complex CFG derivation tree' referrerPolicy='no-referrer' />
    </p>
    <p>&nbsp;</p>
    <h3><a name='header-n4052' class='md-header-anchor '></a>Iteration 3 (Implementation)</h3>
    <h4><a name='header-n4053' class='md-header-anchor '></a>How to Implement</h4>
    <p>Having produced the grammar of the language to be implemented, the next step was to look into how this could be
        implemented in Python, and how it will integrate with the larger system.</p>
    <p>&nbsp;</p>
    <p>As mentioned prior implementing a language can be broken down into a few required steps.</p>
    <ol start=''>
        <li>Defining a valid set of tokens from the grammar</li>
        <li>Building a lexical analyzer to parse the source code into these tokens</li>
        <li>Defining an internal representation of the language in Python</li>
        <li>Building an interpreter to convert this token stream into this internal representation</li>
        <li>Building an environment or architecture to run the internal representation</li>
    </ol>
    <p>&nbsp;</p>
    <h4><a name='header-n4069' class='md-header-anchor '></a>Defining Tokens</h4>
    <p>Within a language a token is considered to be a single atomic element; they are often designed as a key value
        pair where the value may be null. Every valid input within a program must be able to be broken down into it a
        set of constituent tokens and this process must be deterministic. </p>
    <p>&nbsp;</p>
    <p>The common school of thought behind the design of standard tokens within a general purpose programming language
        is that their are five required token types, a sixth if you include comments. These tokens are as follows:</p>
    <p>&nbsp;</p>
    <ul>
        <li><strong>Identifier</strong> <span> </span>Definition of a variable or function</li>
        <li><strong>Keyword</strong><span> </span>Reserved words that have meaning within the language, e.g.
            <code>return</code></li>
        <li><strong>Separator</strong> <span> </span>Used to denote the end of a construct, e.g. <code>}</code> or
            <code>;</code></li>
        <li><strong>Operator</strong><span> </span>Symbols used for performing operations on arguments, e.g.
            <code>+=</code> or <code>!=</code></li>
        <li><strong>Literal</strong><span> </span>A fixed value, e.g. <code>True</code> or
            <code>&quot;hello world!&quot;</code></li>
        <li><strong>Comment</strong><span> </span>A token representing ignored input within the source, e.g.
            <code># Hello</code> or <code>/* example */</code></li>
    </ul>
    <p>&nbsp;</p>
    <p>Applying these types of tokens to our grammar we produce the following set:</p>
    <p>&nbsp;</p>
    <p><strong>Identifier Tokens</strong></p>
    <p>Due to the simplicity of this language no user defined identifiers are necessary.</p>
    <p>&nbsp;</p>
    <p><strong>Keyword Tokens</strong></p>
    <p>Construct tokens</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Source lexeme</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>AND</td>
                    <td>AND</td>
                    <td>Ø</td>
                </tr>
                <tr>
                    <td>OR</td>
                    <td>OR</td>
                    <td>Ø</td>
                </tr>
                <tr>
                    <td>IF</td>
                    <td>IF</td>
                    <td>Ø</td>
                </tr>
                <tr>
                    <td>THEN</td>
                    <td>THEN</td>
                    <td>Ø</td>
                </tr>
                <tr>
                    <td>END_IF</td>
                    <td>END_IF</td>
                    <td>Ø</td>
                </tr>
                <tr>
                    <td>ON</td>
                    <td>ON</td>
                    <td>Ø</td>
                </tr>
                <tr>
                    <td>END_ON</td>
                    <td>END_ON</td>
                    <td>Ø</td>
                </tr>
                <tr>
                    <td>AT</td>
                    <td>AT</td>
                    <td>Ø</td>
                </tr>
                <tr>
                    <td>END_AT</td>
                    <td>END_AT</td>
                    <td>Ø</td>
                </tr>
                <tr>
                    <td>EVERY</td>
                    <td>EVERY</td>
                    <td>Ø</td>
                </tr>
                <tr>
                    <td>END_EVERY</td>
                    <td>END_EVERY</td>
                    <td>Ø</td>
                </tr>
                <tr>
                    <td>EOF</td>
                    <td>-1</td>
                    <td>Ø</td>
                </tr>
                <tr>
                    <td>LBRACKET</td>
                    <td>(</td>
                    <td>Ø</td>
                </tr>
                <tr>
                    <td>RBRACKET</td>
                    <td>)</td>
                    <td>Ø</td>
                </tr>
                <tr>
                    <td>QUOTATION</td>
                    <td>&quot;</td>
                    <td>Ø</td>
                </tr>
                <tr>
                    <td>COMMA</td>
                    <td>,</td>
                    <td>Ø</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p><em>N.B. The character &#39;Ø&#39; denotes that a value is not required.</em></p>
    <p>&nbsp;</p>
    <p>Readings Tokens</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Source lexeme</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>READING</td>
                    <td>door_status<br />coop_temperature <br />coop_humidity <br />coop_pressure <br />coop_dust
                        <br />drinker_level</td>
                    <td>Source</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>&nbsp;</p>
    <p>Event Tokens</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Source lexeme</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>EVENT</td>
                    <td>door_opening <br />door_closing <br />door_error <br />egg_detected <br />drinker_empty</td>
                    <td>Source</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>&nbsp;</p>
    <p>Action Tokens</p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Source lexeme</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>ACTION</td>
                    <td>send_email <br />send_sms <br />close_door <br />open_door</td>
                    <td>Source</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>&nbsp;</p>
    <p><strong>Separator</strong></p>
    <p>Unique separators for language constructs have been implemented as keywords within the grammar; this makes
        reading nested constructs easier, but in turn, makes the language syntax more strict and increases the amount
        that is required to be remembered by the end user.</p>
    <p>&nbsp;</p>
    <p><strong>Operator</strong></p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Source lexeme</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>OPERATOR</td>
                    <td>&lt;<br />&gt;<br />&lt;=<br />&gt;=<br />=</td>
                    <td>Source</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>&nbsp;</p>
    <p><strong>Literal</strong></p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Source lexeme</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>EMAIL_ADDRESS</td>
                    <td>String matching the regular expression &quot;[A-Za-z0-9!#$%&amp;&#39;*+-/=?^_]&quot;</td>
                    <td>Source</td>
                </tr>
                <tr>
                    <td>PHONE_NUMBER</td>
                    <td>String matching the regular expression &quot;+?[0-9]{11-13}&quot;</td>
                    <td>Source</td>
                </tr>
                <tr>
                    <td>TIME</td>
                    <td>String matching the regular expression [0-9]{2} &#39;:&#39; [0-9]{2}</td>
                    <td>Source</td>
                </tr>
                <tr>
                    <td>NUMBER</td>
                    <td>String matching the regular expression [0-9]+.?([0-9]{1,2})?</td>
                    <td>Source</td>
                </tr>
                <tr>
                    <td>VALUE</td>
                    <td>door_open<br />door_closed<br />door_error<br />door_in_transition</td>
                    <td>Source</td>
                </tr>
                <tr>
                    <td>STRING</td>
                    <td>String matching the regular expression \&quot;[^&quot;]*\&quot;</td>
                    <td>Source</td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>&nbsp;</p>
    <p><strong>Comment</strong></p>
    <p>Comments have been implemented as the <code>#</code> character and function in the same manner as in Shell or
        Python. A comment character will cause the subsequent characters within the line of text to be ignored.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n4247' class='md-header-anchor '></a>Token Representation &amp; Parsing</h4>
    <p>Now that a set of defined tokens has been decided, the next step is to create the token representation within
        Python and write a lexical analyzer (parser) for it. This lexical analyzer will convert a stream of source code
        into the corresponding set of tokens.</p>
    <p>&nbsp;</p>
    <p>As stated before the structure of a token is often simply a key value pair; below is the implementation used
        within this project.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4251"
        mdtype="fences">def __init__(self, type, value, line, pos):
    # Token fields.
    self.type = type
    self.value = value
    self.line = line
    self.position = pos
</pre>
    <p><em>N.B. Line number and position within the line have been added to aid with debugging erroneous source
            code.</em></p>
    <p>&nbsp;</p>
    <p>The python class <a href='code/modules/hub_code/language/lexer.py'>Lexer</a> reads in the source code and converts this into an output stream of tokens.
        The main function within this class is the <code>get_next_token(self)</code> method, which, on each subsequent
        call, returns the next token that can be generated from the stream. </p>
    <p>This works via reading characters from the input source and comparing against the rules for the given lexemes
        until a match is found. When a match is found a token object is created and this is returned.</p>
    <p>&nbsp;</p>
    <p>The example below shows a token match for a comment and left bracket.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4258"
        mdtype="fences"># Handle comment line.
if self.current_char == '#':
    while self.current_char != '\n':
        self.advance()
    self.skip_newline()
    continue

# Handle open bracket token.
if self.current_char == '(':
    token = Token(LBRACKET, '', self.line, self.line_pos)
    self.advance()
    return token
</pre>
    <p>The case for handling comments ignores the subsequent characters in the source code until a newline character is
        reached. Upon hitting a newline this is skipped and then the lexer continues as usual. As for the left bracket,
        if this character is recognized within the stream, a token representing this is created and returned. The lexer
        method <code>self.advance()</code> simply moves the pointer for the current character to the next within the
        source.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n4261' class='md-header-anchor '></a>Tokenization of Program</h5>
    <p>Using the program derived from the earlier example used within the grammar derivation, here is how the output
        token stream for that program would look.</p>
    <p>&nbsp;</p>
    <p>Program source code:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n4265"
        mdtype="fences"># Program that executes every half hour sand send a warning email if coop
# temperature gets too high.

EVERY 00:30 DO
	IF coop_temperature &gt; 35.0 THEN
		send_email("ds576@kent.ac.uk", "Subject", "Hot!")
	END_IF
END_EVERY
</pre>
    <p>&nbsp;</p>
    <p>Lexical analyzer output:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n4268"
        mdtype="fences" style="break-inside: unset;">{type: EVERY, value: None, line: 2, pos: 10}
{type: TIME, value: '00:30', line: 2, pos: 16}
{type: DO, value: None, line: 2, pos: 19}
{type: IF, value: None, line: 3, pos: 8}
{type: READING, value: 'coop_temperature', line: 3, pos: 25}
{type: OPERATOR, value: '&gt;', line: 3, pos: 27}
{type: NUMBER, value: 35.0, line: 3, pos: 32}
{type: THEN, value: None, line: 3, pos: 37}
{type: ACTION, value: 'send_email', line: 4, pos: 17}
{type: LBRACKET, value: '(', line: 4, pos: 17}
{type: QUOTATION, value: '"', line: 4, pos: 18}
{type: EMAIL_ADDRESS, value: 'ds576@kent.ac.uk', line: 4, pos: 35}
{type: QUOTATION, value: '"', line: 4, pos: 35}
{type: COMMA, value: ',', line: 4, pos: 36}
{type: QUOTATION, value: '"', line: 4, pos: 38}
{type: STRING, value: 'Subject', line: 4, pos: 46}
{type: QUOTATION, value: '"', line: 4, pos: 46}
{type: COMMA, value: ',', line: 4, pos: 47}
{type: QUOTATION, value: '"', line: 4, pos: 49}
{type: STRING, value: 'Hot!', line: 4, pos: 54}
{type: QUOTATION, value: '"', line: 4, pos: 54}
{type: RBRACKET, value: ')', line: 4, pos: 55}
{type: END_IF, value: None, line: 5, pos: 12}
{type: END_EVERY, value: None, line: 6, pos: 14}
{type: EOF, value: None, line: 7, pos: 1}
</pre>
    <p><em>N.B. The above output is the defined standard string representation of token objects.</em></p>
    <p>&nbsp;</p>
    <h4><a name='header-n4271' class='md-header-anchor '></a>Internal Representation</h4>
    <p>Now that we have formed a token stream from the elements that build the grammar, we now need to look into how we
        can implement the required functionality in Python. Within our system this is the purpose of the internal
        representation, a way to express our program as a structure of nested objects; these objects will represent the
        different constructs and data types within our language.</p>
    <p>This solution was proposed by <a href='#header-n482'>Scott Owens</a> during a brief chat about how we could
        implement a domain specific language within Python. He mentioned that if you are looking to generate just an
        output set, it would be simple to implement each component of the language as an object. In this arrangement, if
        all constructs had an execute function, they could resolve to a set of potential actions. This set of actions
        could subsequently be returned to the caller and executed.</p>
    <p>&nbsp;</p>
    <p><img src='images/language/internal_representation.PNG' alt='Internal representation dir structure'
            referrerPolicy='no-referrer' /></p>
    <center><i>Internal representation modules from source code</i></center>
    <p>Within our language the design of these objects are quite simple. Each type has fixed behavior and outside of
        conditional statements few have variable behavior.</p>
    <p>&nbsp;</p>
    <p><strong>Actions, Readings &amp; Events</strong></p>
    <p>All actions within the system are expressed as a subclass of the abstract class <code>ActionIR</code>. Each child
        is a data structure for it&#39;s respective type and required parameters.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4281"
        mdtype="fences" style="break-inside: unset;">class ActionIR:
    """
    Abstract class for intermediate representation of system actions.
    @Author: Damon M. Sweeney
    @Version: 15-02-2019
    """
    def __init__(self, action):
        self.log = Logger()
        self.action_type = action

class OpenDoor(ActionIR):
    def __init__(self):
        super().__init__(Action.COOP_DOOR_OPEN)
        
class SendSMS(ActionIR):
    def __init__(self, number, message):
        super().__init__(Action.SEND_SMS)
        self.number = number
        self.message = message
</pre>
    <p>As can be seen from the snippet above both of the concrete classes, <code>OpenDoor</code> and
        <code>SendSMS</code>, have a given Action Enum type, and <code>SendSMS</code> has additional parameters; these
        additional parameters will help when we later execute the action.</p>
    <p>&nbsp;</p>
    <p>Similar to <code>Actions</code>, both <code>Readings</code> and <code>Events</code> are a similar setup. Each are
        a subclass of their abstract parent and both are merely data structures for wrapping their given Enum type.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4285"
        mdtype="fences" style="break-inside: unset;">class EventIR:
    """
    Abstract class for intermediate representation of system events.
    @Author: Damon M. Sweeney
    @Version: 15-02-2019
    """
    def __init__(self, event):
        self.log = Logger()
        self.event_type = event

class DoorOpening(EventIR):
    """Coop door opening event."""
    def __init__(self):
        super().__init__(Event.DOOR_OPENING)
</pre>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4286"
        mdtype="fences" style="break-inside: unset;">class ReadingIR:
    """
    Abstract class for intermediate representation of system readings.
    @Author: Damon M. Sweeney
    @Version: 15-02-2019
    """
    def __init__(self, reading):
        self.log = Logger()
        self.reading_type = reading

class CoopTemperature(ReadingIR):
    """Coop temperature reading."""

    def __init__(self):
        super().__init__(Reading.COOP_TEMPERATURE_STATUS)
</pre>
    <p>&nbsp;</p>
    <p><strong>Code block (Abstract class)</strong></p>
    <p><code>Codeblock</code> is the name given to the abstract parent class of all the constructs within the language.
        It has one abstract method <code>exec(self, environment)</code>, this method should implement the specific
        behavior of the construct and return a result. It takes one parameter, an environment that houses a dictionary
        of all current readings of the devices within the modular network.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4290"
        mdtype="fences" style="break-inside: unset;">class Codeblock(object):
    """
    Abstract base class required for codeblock objects.
    @Author: Damon M. Sweeney
    @Version: 14-02-2019
    This class outlines the 'must have' functionality of any codeblock
    within the ChickenLang language.
    """

    @abc.abstractmethod
    def __init__(self):
        raise NotImplementedError

    @abc.abstractmethod
    def exec(self, environment):
        """Implements the functionality of the codeblock.
        Requires an 'environment' variable containing the current system state."""
        raise NotImplementedError
</pre>
    <p>&nbsp;</p>
    <p><strong>At, On &amp; Every</strong></p>
    <p><code>At</code>, <code>On</code> and <code>Every</code> are the top level constructs that make up a program
        within the language. <code>At</code> constructs execute at a specific time of the day, <code>Every</code> at a
        fixed period and <code>On</code> at the realization of a given event. Like before a simple data structure is
        used to represent each of these. </p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4294"
        mdtype="fences" style="break-inside: unset;">class At(Codeblock):
    """
    'At' top level event codeblock implementation.
    @Author: Damon M. Sweeney
    @Version: 14-02-2019
    This module implements the functionality of an 'At' event.
    These types of event occur at a specific time of the day.
    """

    def __init__(self, time, body):
        self.log = Logger()
        self.time = time
        self.body = body

    def exec(self, environment):
        """Executes the body of the 'at' codeblock.
        Triggering of this event is handled by the language controller."""

        self.log.debug("Executing 'At' codeblock: {0}.".format(self.body))
        actions = self.body.exec(environment)
        return actions
</pre>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4295"
        mdtype="fences" style="break-inside: unset;">class On(Codeblock):
    """
    'On' top level event codeblock implementation.
    @Author: Damon M. Sweeney
    @Version: 14-02-2019
    This module implements the functionality of an 'On' event.
    This codeblock occurs when a specific event happens within the system.
    """

    def __init__(self, event, body):
        self.log = Logger()
        self.event = event
        self.body = body

    def exec(self, environment):
        """Executes the body of the 'on' codeblock.
        Triggering of this event is caused by a device event in the system."""

        self.log.debug("Executing 'On' codeblock: {0}.".format(self.body))
        actions = self.body.exec(environment)
        return actions
</pre>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4296"
        mdtype="fences" style="break-inside: unset;">class Every(Codeblock):
    """
    'Every' top level event codeblock implementation.
    @Author: Damon M. Sweeney
    @Version: 14-02-2019
    This module implements the functionality of an 'Every' event.
    These types of event occur at a constant defined interval of time.
    """

    def __init__(self, time, body):
        self.log = Logger()
        self.time = time
        self.body = body

    def exec(self, environment):
        """Executes the body of the 'every' codeblock.
        Triggering of this event is handled by the language controller."""

        self.log.debug("Executing 'Every' codeblock: {0}.".format(self.body))
        actions = self.body.exec(environment)
        return actions
</pre>
    <p>&nbsp;</p>
    <p><strong>Body</strong></p>
    <p>The <code>body</code> class implements the inner contents of an <code>On</code>, <code>At</code>,
        <code>Every</code> or <code>If</code> construct. A <code>Body</code> can hold a list of children, and these
        children may be of type <code>Action</code> or <code>Conditional</code>. This allows arbitrarily nested
        conditions. The <code>exec(self, environment)</code> method of the <code>Body</code> is where the functionality
        lies.</p>
    <p>When executed the list of stored constructs is executed and a list of outputs generated and returned.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4301"
        mdtype="fences" style="break-inside: unset;">def exec(self, environment):
    """Iterates over the list of encompassed code executing each step."""
    self.log.debug("Executing 'body' codeblock: {0}.".format(self.steps))

    # Iterate over body generating list of output actions.
    actions = []
    for codeblock in self.steps:
        # If an atomic action add to output.
        if issubclass(type(codeblock), ActionIR):
            actions.append(codeblock)

        # If not atomic execute codeblock.
        else:
            result = codeblock.exec(environment)
            actions.extend(result) if result != None else None

    # Return the output set of actions from the 'Body'.
    return actions
</pre>
    <p>&nbsp;</p>
    <p><strong>Conditional</strong></p>
    <p>A <code>Conditional</code> statement has a <code>conditions</code> object in which must be satisfied if the body
        is to be executed. A <code>conditions</code> object is constructed of multiple <code>condition</code> separated
        by <code>AND</code> or <code>OR</code>. Each of these <code>condition</code> is a comparison of a
        <code>Reading</code> against the value defined by the user. The <code>Reading</code> is replaced with the
        corresponding value from the environment. </p>
    <p>In the current implementation multiple <code>condition</code> are applied from left to right. For example, the
        statement <code>(True &amp; False | False)</code>, is equivalent to <code>((True &amp; False) | False)</code>.
    </p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4306"
        mdtype="fences" style="break-inside: unset;">class Conditional(Codeblock):
    """
    Language 'Conditional' implementation.
    @Author: Damon M. Sweeney
    @Version: 14-02-2019
    This class implements the functionality of a  conditional statement.
    """

    def __init__(self, conditions, body):
        self.log = Logger()
        self.conditions = conditions
        self.body = body

    def exec(self, environment):
        """Executes the conditional codeblock.
        If the conditions evaluate to true the body is executed."""
        if self.conditions.exec(environment):
            return self.body.exec(environment)
</pre>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4307"
        mdtype="fences" style="break-inside: unset;">class Conditions(Codeblock):

	# ...

    def exec(self, environment):
        """Executes the set of conditions, resolving to a boolean True or False.
        Condition precedence is left to right."""

        for cond in self.conditions:
            if isinstance(cond, Condition):
                self.temp_condition = cond.exec(environment)
            elif cond == AND:
                self.temp_condition = self.temp_condition and self.conditions.pop(0).exec(environment)
            elif cond == OR:
                self.temp_condition = self.temp_condition or self.conditions.pop(0).exec(environment)

        return self.temp_condition
</pre>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4308"
        mdtype="fences" style="break-inside: unset;">class Condition(Codeblock):

    # ...
    
    def __init__(self, reading, operator, value):
        self.log = Logger()
        self.reading = reading
        self.operator = operator
        self.value = value


    def exec(self, environment):
        """Executes the condition, resolving to a True or False."""

        # Obtain the reading from the execution environment and
        # derive result of conditional operation and return the value.
        reading_value = environment[self.reading.reading_type]
        try:
            if self.operator == '&lt;':
                res = reading_value &lt; self.value
            elif self.operator == '&gt;':
                res = reading_value &gt; self.value
            elif self.operator == '&lt;=':
                res = reading_value &lt;= self.value
            elif self.operator == '&gt;=':
                res = reading_value &gt;= self.value
            elif self.operator == '=':
                res = reading_value == self.value
            else:
                res = False
        except Exception as e:
            res = False

        return res
</pre>
    <p>&nbsp;</p>
    <h4><a name='header-n4310' class='md-header-anchor '></a>Interpreter</h4>
    <p>Now that we have produced an internal representation on how to structure the users program we need to convert the
        token stream produced by the lexical analyzer into this form. This is done by the <a href='code/modules/hub_code/language/interpreter.py'>Interpreter</a>
        module. </p>
    <p>The responsibility of this module is to read the consecutive stream of tokens and convert them into corresponding
        objects from the internal representation. </p>
    <p>For example the following stream of tokens would be converted into an <code>SendEmail</code> action object.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n4314"
        mdtype="fences" style="break-inside: unset;"># Put through the language interpreter returns object of type SendEmail.
# This object has three fields: email, subject, message.

{type: ACTION, value: 'send_email', line: 4, pos: 17}
{type: LBRACKET, value: '(', line: 4, pos: 17}
{type: QUOTATION, value: '"', line: 4, pos: 18}
{type: EMAIL_ADDRESS, value: 'ds576@kent.ac.uk', line: 4, pos: 35}
{type: QUOTATION, value: '"', line: 4, pos: 35}
{type: COMMA, value: ',', line: 4, pos: 36}
{type: QUOTATION, value: '"', line: 4, pos: 38}
{type: STRING, value: 'Subject', line: 4, pos: 46}
{type: QUOTATION, value: '"', line: 4, pos: 46}
{type: COMMA, value: ',', line: 4, pos: 47}
{type: QUOTATION, value: '"', line: 4, pos: 49}
{type: STRING, value: 'Hot!', line: 4, pos: 54}
</pre>
    <p>&nbsp;</p>
    <p>Given a stream of tokens, calling <code>load_program()</code> on the Interpreter yields a return list of
        <code>At</code>, <code>On</code> and <code>Every</code> top level construct objects. These objects contain their
        body in which is recursively built, for this reason the output is built from bottom up.</p>
    <p>The interpreter looks for a given set of tokens within the stream to build given constructs, after viewing a
        given token it is consumed the next is moved onto. </p>
    <p>&nbsp;</p>
    <p>Below is the function for creating a <code>SendSMS</code> object from the stream, along with the implementation
        of the method <code>consume(token_type)</code>.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4320"
        mdtype="fences" style="break-inside: unset;"># Create a SendSMS action object from stream.
def action_send_sms(self):
    # Check for parameter field opening
    self.consume(LBRACKET)

    # Obtain number parameter
    self.consume(QUOTATION)
    number = self.current_token
    self.consume(PHONE_NUMBER)
    self.consume(QUOTATION)
    self.consume(COMMA)

    # Obtain message paramter
    self.consume(QUOTATION)
    message = self.current_token
    self.consume(STRING)
    self.consume(QUOTATION)

    # Check for parameter field closing
    self.consume(RBRACKET)

    return SendSMS(number.getValue(), message.getValue())
</pre>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4321"
        mdtype="fences"># Compare current token with expected passed token type.
# If they match 'consume' the current token and assign the next token.
def consume(self, token_type):
    if self.current_token.type == token_type:
        self.current_token = self.lexer.get_next_token()
    else:
        self.error()
</pre>
    <p>&nbsp;</p>
    <p>Once the entire tokens stream has been parsed into the internal representation and the list of top level
        constructs returned then the users program is ready to be setup for execution.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n4325' class='md-header-anchor '></a>Internal Representation Execution</h4>
    <p>Now that we have generated the internal representation of the user program and can call <code>exec</code> on a
        given top level construct to get an output list of actions, we need to look into how we are going to schedule
        execution.</p>
    <p>As said before <code>On</code> constructs execute on an event, <code>At</code> at a given time of the day, and
        <code>Every</code> at a fixed interval. We know that for <code>On</code> constructs the events within the
        modular network are going to be thrown from connected devices and as such we need a means of receiving these,
        alternatively for the <code>At</code> and <code>Every</code> construct we simply need to schedule the time at
        which they should execute.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n4329' class='md-header-anchor '></a>Catching Events</h5>
    <p>As Events will be thrown from devices within the network these must be passed to the module handling the
        language, the language controller.</p>
    <p>Upon receiving an event the language controller will look at the list of event triggered constructs and check for
        a match in event type. If the Event of the construct matches, then the body will be executed and a list of
        output actions generated and returned.</p>
    <p>&nbsp;</p>
    <p>The code for executing the corresponding constructs can be seen below.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4334"
        mdtype="fences" style="break-inside: unset;"># Handles a received event and executes the corresponding code.

async def handle_event(self, event):
    """Notify the language controller of a sensor event."""

    self.log.info("Event raised, executing related 'On' codeblocks.")

    # Check event is a member of 'Event' enum.
    if not isinstance(event, Event):
        self.log.error("Event raised not recognised: {}".format(event))
        return

    # Iterate over event triggered events executing those required.
    for codeblock in self.on_trigger:
        if codeblock.event.event_type == event:
            self.loop.create_task(self.execute_codeblock(codeblock))
</pre>
    <p>&nbsp;</p>
    <h5><a name='header-n4336' class='md-header-anchor '></a>Scheduling Timed Execution</h5>
    <p>Timed events for the <code>At</code> and <code>Every</code> constructs have similar execution triggers; they both
        execute code dependent on time. <code>Every</code> constructs occur at a user defined period starting
        immediately, whereas <code>At</code> constructs happen from next occurrence of the given time, and then
        subsequently every twenty-four hours.</p>
    <p>For this reason a timer class was created, <a href='code/modules/hub_code/language/time_scheduler.py'><code>TimeScheduler</code></a>. This class allows these
        events to be scheduled and a callback to their execution set for when the timer elapses. </p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4339"
        mdtype="fences" style="break-inside: unset;"># The time scheduler class allows tasks to be scheduled daily or at a fixed interval.

class TimeScheduler:
    """
    Time Scheduler.
    @Author: Damon M. Sweeney
    @Version: 14-02-2019
    This module allows a module to register a callback at a specific time.
    """

    def __init__(self):
        # ...

    async def clear(self):
        # ...

    async def register_daily(self, time, callback, code_ir):
        # ...

    async def register_every(self, period, callback, code_ir):
		# ...
        
</pre>
    <p>&nbsp;</p>
    <h5><a name='header-n4341' class='md-header-anchor '></a>Execution Function</h5>
    <p>The final piece to creating the language of the system was to build a method that converted the arbitrary
        internal representation <code>Action</code> into the occurrence of actual output.</p>
    <p>To do this a simple execute method was created that given a construct, generates its list of action outputs, and
        performs function calls to the corresponding functions present on the main controller of the hub.</p>
    <p>The implementation of this function can be seen below.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n4345"
        mdtype="fences" style="break-inside: unset;"># Execute a given construct and handle the set of returned actions.

async def execute_codeblock(self, codeblock):
    """Execute a given codeblock and perform the set of output actions."""

    environment = self.hub.reading_env
    for action in codeblock.exec(environment):

        if isinstance(action, OpenDoor):
            self.log.info("Executing programmed open coop door action.")
            self.loop.create_task(self.hub.action_open_door())

        elif isinstance(action, CloseDoor):
            self.log.info("Executing programmed close coop door action.")
            self.loop.create_task(self.hub.action_close_door())

        elif isinstance(action, SendSMS):
            self.log.info("Executing programmed send SMS action.")
            self.loop.create_task(
                self.hub.action_send_sms(action.number, action.message)
            )

        elif isinstance(action, SendEmail):
            self.log.info("Executing programmed send email action.")
            self.loop.create_task(
                self.hub.action_send_email(action.email, action.subject, action.msg)
            )

        else:
            self.log.error("Action not found: {}.".format(action))
            
</pre>
    <p>&nbsp;</p>
    <h3><a name='header-n4347' class='md-header-anchor '></a>Known Issues</h3>
    <p>Below are various issues that we have noticed with the current implementation of the domain specific language.
    </p>
    <p>&nbsp;</p>
    <h5><a name='header-n4350' class='md-header-anchor '></a>Precedence of Conditions</h5>
    <p>As it stands in the current implementation of conditionals the user is unable to dictate the precedence of
        different conditions due to the lack of bracketing support. Though with the current potential set of readings
        that can be compared this does not cause much loss to expressiveness if the language were to expand may become a
        bigger problem.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n4353' class='md-header-anchor '></a>Refactor Validation from Interpreter to Readings </h5>
    <p>At present the validation for given conditional statements occurs within the Interpreter module. It would be
        ideal to refactor this into a separate module or the Readings subclasses themselves as to improve the ease of
        adding new device types to the language and to better encapsulate functionality.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n4356' class='md-header-anchor '></a>Future Work</h3>
    <p>As with all products there is room to expand and advance, below are a few thoughts we had when it come to how we
        would progress the language further.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n4359' class='md-header-anchor '></a>Update Implementation to Support Snippets</h5>
    <p>Though the source file of the code being executed may have as many components as the user sees necessary, a
        limitation of the current system is that only a single source file can be active at once. Ideally it would be
        nice to provide the user the capability to be able to hot swap individual segments of code in and out. This
        feature would allow the user user to generate a collection of individual snippets that all perform distinct
        tasks and then hop between those active within a few clicks on the website.</p>
    <p>&nbsp;</p>
    <h5><a name='header-n4362' class='md-header-anchor '></a>Simplify Separator Tokens</h5>
    <p>Another big improvement to the language would be to remove the explicit separator characters. As it stands each
        construct has an opening tag and a corresponding close of the form &#39;END_X&#39;. Removing this would make the
        language much more readable and much closer to English language to write. As it stands we see two solutions to
        how this could be done. The first is the pythonic method of using indentation to dictate the level of nesting,
        the second solution the Java approach of having a single separator character like &#39;}&#39;.</p>
    <p>&nbsp;</p>
    <h2><a name='header-n4366' class='md-header-anchor '></a>Visualisation</h2>
    <h3><a name='header-n4368' class='md-header-anchor '></a>Web Server</h3>
    <p>To provide a means for the user to access data provided by the modular network, we&#39;ve created a web interface
        to display this. This interface not only shows the current data, but historical records alongside logs from the
        hub itself. This also allows verified users to send commands to the door module and provides role based access
        control to the system settings. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n4371' class='md-header-anchor '></a>Research</h4>
    <p>After doing some initial research into web frameworks, we opted to use Angular on the client side, and Express.js
        on server side. </p>
    <p>We also looked into full stack frameworks such as Laravel and ASP.NET and client-side frameworks such as ReactJS.
    </p>
    <p>Angular, written using TypeScript, provides a lot of out of the box functionality, examples which include Ajax
        requests use the <code>@angular/http library</code> and routing use the <code>@angular/router</code> library
        whereas React has a lot more flexibility. When it was decided that we were going to incorporate Material Design
        into our user interface, it was found that both of these frameworks have access to a Material UI library. </p>
    <p>Research was conducted into the ASP.NET MVC framework, a common framework developed by Microsoft. However, whilst
        this framework was powerful, it contains a large overhead if building small web applications. </p>
    <p>Laravel is a framework written in PHP. From research, it was found that PHP has several problems with language
        design and core implementations with a handful of security issues. An example can be seen in this simple
        extract:</p>
    <p>&nbsp;</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="php" contenteditable="false" cid="n4378"
        mdtype="fences">&lt;?php
    if (strcmp($_POST['password'], 'sekret') == 0) {
        echo "Welcome, authorized user!\n";
    } else {
        echo "Go away, imposter.\n";
    }
?&gt;
</pre>
    <p>&nbsp;</p>
    <p>The above snippet is open to attack with the following commands:</p>
    <p>&nbsp;</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n4382"
        mdtype="fences">$ curl -d password=sekret http://...
Welcome, authorized user!
$ curl -d password=wrong http://...
Go away, imposter.
$ curl -d password[]=wrong http://...
Welcome, authorized user!
</pre>
    <p>&nbsp;</p>
    <p>This change was made to <code>strcmp</code> in PHP 5.3 and was not mentioned in any release logs. <a
            href='https://www.quora.com/Why-is-PHP-hated-by-so-many-developers'>Source</a></p>
    <p>&nbsp;</p>
    <p>The decision was made to use Angular as it provides a lot of out of the box functionality. As the work for this
        website was undertaken by one member of the group, there will be less overhead using out of the box
        functionality than researching more libraries to use. The member of the group undertaking this section, Joanna,
        also had past experience with this framework from her placement year.</p>
    <p>Express.js was chosen as the server-side framework due to it being one of the most popular frameworks on NPM
        alongside being lightweight, minimal and flexible.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n4389' class='md-header-anchor '></a>Angular 7</h4>
    <p>Angular operates on a component based architecture, and as such, it was easy to reuse components already made,
        such as the below card component. </p>
    <p>&nbsp;</p>
    <p>This is the component class code, written in TypeScript. The main point to note is the selector, which is named
        &#39;card&#39; in this instance. This means this component can be displayed in another by adding
        <code>&lt;card&gt;&lt;/card&gt;</code> into that component&#39;s HTML. </p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="typescript" contenteditable="false" cid="n4393"
        mdtype="fences" style="break-inside: unset;">/**
 * Component for individual cards to display sensor data
 * from the Chicken Coop.
 * 
 * @author Joanna Zhang
 * @version 19-01-2019
 */
import { Component, Input, OnDestroy } from '@angular/core';
import { Card } from '../../models/data';
import { UpdateService } from '../../services/update.service'
import { Subscription, timer } from 'rxjs'

@Component({
  selector: 'card',
  templateUrl: './card.component.html',
  styleUrls: ['./card.component.less']
})
export class CardComponent implements OnDestroy {
  // Data input passed in from parent - CardSectionComponent
  @Input() data: Card
  /* Display or not display last updated */
  @Input() noTime: Boolean
  live = true

  updating: boolean = false

  /* Section for unsubscribing from Subscriptions to avoid
  memory leaks */
  subscription: Subscription = new Subscription()

  constructor(private updateService: UpdateService ){}

  /**
  * Update data for this specific card.
  * @param input the name of the sensor
  */
  onClick(input: string) : void {
    let sensor = input.split(" ")[0].toLowerCase();
    this.updating = true
    // Add the subscription to the update service, so it can be destroyed
    // to avoid memory leaks.
    this.subscription.add(this.updateService.updateSensor(sensor).subscribe(res =&gt; {
      /// On return value, update the fields.
      this.data.value = res.data
      this.data.time = new Date()
      this.updating = false
    }))
  }

  ngOnDestroy() : void {
    this.subscription.unsubscribe();
  }
}

</pre>
    <p>&nbsp;</p>
    <p>The code below shows the component&#39;s template in HTML. As you can see, there are a variety of different
        syntaxes. There is moustache syntax for displaying data from the component onto the DOM <code>{{}}</code>, and
        directives such as <code>*ngIf</code>. </p>
    <p>&nbsp;</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="html" contenteditable="false" cid="n4397"
        mdtype="fences" style="break-inside: unset;">&lt;!-- Use the Material Card component to render this card --&gt;
&lt;mat-card class="card"&gt;
    &lt;mat-card-content&gt;
      &lt;!-- Render the icon, passing in the name of the data type to CardIconComponent --&gt;
      &lt;div&gt;
        &lt;card-icon [type]="data.name"&gt;&lt;/card-icon&gt;
      &lt;/div&gt;
      &lt;!-- Name of the data for clarity --&gt;
      &lt;mat-card-subtitle class="text-right"&gt;{{data.name}}&lt;/mat-card-subtitle&gt;
      &lt;!-- Display the actual value --&gt;
        &lt;mat-card-title&gt;
        &lt;div class="data text-right"&gt;
          &lt;span class="value"&gt;{{data.value}}&lt;/span&gt;
            &lt;!-- Display the unit --&gt;
            &lt;span *ngIf="data.name == 'Temperature'"&gt;&lt;span class="unit"&gt;°C&lt;/span&gt;&lt;/span&gt;
            &lt;span *ngIf="data.name == 'Humidity'"&gt;&lt;span class="unit"&gt;%&lt;/span&gt;&lt;/span&gt;
            &lt;span *ngIf="data.name == 'Dust Density'"&gt;&lt;span class="unit"&gt;μg/m³&lt;/span&gt;&lt;/span&gt;
            &lt;span *ngIf="data.name == 'Pressure'"&gt;&lt;span class="unit"&gt;mBar&lt;/span&gt;&lt;/span&gt;
          &lt;/div&gt;
        &lt;/mat-card-title&gt;

        &lt;hr&gt;
        &lt;!-- Let the user know when it was last updated --&gt;
        &lt;mat-card-subtitle *ngIf="!noTime"&gt; 
          &lt;span *ngIf="data.name != 'Water Level'"&gt; 
          &lt;i *ngIf="!updating" (click)="onClick(data.name)"class="fas fa-sync-alt"&gt;&lt;/i&gt; 
          &lt;i *ngIf="updating" class="fas fa-spinner fa-spin"&gt;&lt;/i&gt; 
        &lt;/span&gt; 
          
          Last updated: {{data.time | timeago:live }}&lt;/mat-card-subtitle&gt;
        &lt;div *ngIf="noTime"&gt;&lt;/div&gt;
    &lt;/mat-card-content&gt;
  &lt;/mat-card&gt;
</pre>
    <p>&nbsp;</p>
    <p>The styles for this component is written in LESS:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="less" contenteditable="false" cid="n4400"
        mdtype="fences" style="break-inside: unset;">.door, .container {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
}

.door-control {
    width: 630px;
    height: 180px;

    .fa-spinner, .fa-check-circle {
        color: #4caf50;
    }

    .error {
        color: #f44336;
    }
}

card-section{
    display: contents;
}

@media (max-width: 992px) { 
    .door-control {
        width: 290px;
        height:auto;
    }
 }
</pre>
    <p>&nbsp;</p>
    <p>This component can now be displayed in another component by referencing the selector as mentioned above. For
        example, this piece of code is used in the parent component - CardSection.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="html" contenteditable="false" cid="n4403"
        mdtype="fences">&lt;card *ngFor="let card of list?.data" [data]="card" class="m-4 pt-1"&gt;
&lt;/card&gt;
</pre>
    <p>This loops through the array named &quot;list.data&quot; and passes the value to the card component. </p>
    <p>&nbsp;</p>
    <p>In the TS section, call was made to <code>this.updateService.updateSensor(sensor)</code>. The code in the update
        class contains:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="typescript" contenteditable="false" cid="n4407"
        mdtype="fences" style="break-inside: unset;">/**
 * Service to register users
 * 
 * @author Joanna Zhang, Damon Sweeney
 * @version 10-03-2019
 */
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { environment } from '../../environments/environment'
import { Observable } from 'rxjs';
import { Update } from '../models/data'

@Injectable({
    providedIn: 'root',
})
export class UpdateService {
    env = environment

    constructor(private http: HttpClient) { }

    /**
     * Force up to get new values from sensor
     * @param sensor String of sensor name
     */
    updateSensor(sensor: string): Observable&lt;Update&gt; {
        return this.http.get&lt;Update&gt;(`${this.env.apiUrl}/update/${sensor}`)
    }
}
</pre>
    <p>A service, in our case, is a class which fetches data from an external resource. In the above example, the
        service is retrieving data from the <code>/update/</code> endpoint found on the Express.js server. </p>
    <p>&nbsp;</p>
    <p>Please click <a href="code/visualisation/">here</a> to see the source code. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n4412' class='md-header-anchor '></a>Express.js</h4>
    <p>The express application acts as a middle man between the frontend Angular application and the database and hub.
        In the above service example, we see that a call has been made to the <code>/update</code> endpoint. In the main
        entry point of the Express.js server, we need to add a route for this endpoint. The below code says the
        <code>update</code> endpoint uses the Update controllers.</p>
    <p><code>app.use(&#39;/update&#39;, require(&#39;./update/update.controller&#39;))</code> </p>
    <p>&nbsp;</p>
    <p>In update controller, all routes are defined, therefore to update temperature, the endpoint would be
        <code>/update/temperature</code>:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n4417"
        mdtype="fences">router.get('/temperature', authorize(), updateTemperature)
router.get('/humidity', authorize(), updateHumidity)
router.get('/dust', authorize(), updateDust)
router.get('/pressure', authorize(), updatePressure)
router.get('/egg', authorize(), updateEgg)
router.get('/door', authorize(), updateDoor)
</pre>
    <p>&nbsp;</p>
    <p>The function <code>updateTemperature</code> is then called:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n4420"
        mdtype="fences">async function updateTemperature(req, res, next){
    updateService.update("temperature").then(result =&gt; {res.json(result)})
        .catch(err =&gt; next(err))
}
</pre>
    <p>which in turn calls <code>update(sensor)</code>in <code>update.service.js</code> which makes an update request to
        the hub and returns back the value.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n4423' class='md-header-anchor '></a>User Interface Design</h3>
    <p>&nbsp;</p>
    <p>For the User Interface design of the web frontend, we have elected to use common design principles and ideologies
        to provide a functional and aesthetic experience. </p>
    <p>We considered a fully fledged approach of iterative design using a combination of the ‘Five sketches’ method,
        generating low fidelity designs and testing these against the system user. However, we decided not to pursue
        this route due to the logistical difficulty of arranging paper prototyping sessions with the client, alongside
        the small size of our project team.</p>
    <p>We used a combination of common design heuristics as well as a tested design ideology to drive the UI of our
        system. The considerations we will make when designing our UI are outlined later in this document.</p>
    <p>In brief we aim to abide by the heuristics outlined by Jakob Nielsen &amp; Rolf Molich to steer our UI towards
        high usability, the Gestalt principles of design to aid user discoverability and a material design theme to
        provide user familiarity.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n4430' class='md-header-anchor '></a>Iteration 1 (Research)</h4>
    <h5><a name='header-n4432' class='md-header-anchor '></a>Jakob Nielsen Usability Heuristics</h5>
    <p>When developing our UI we will keep the below design heuristics in mind to help build an interface that provides
        a strong level of usability minimizing the burden on the user. We will strive to aid the user in avoiding
        erroneous states, clearly detail system errors and how to recover and ensure that the system status is always
        clearly visible. </p>
    <p>&nbsp;</p>
    <p><strong>Usability Heuristics:</strong></p>
    <ol start=''>
        <li>
            <p><strong>Visibility of system status</strong></p>
            <p>The system should always keep users informed about what is going on, through appropriate feedback within
                reasonable time.</p>
            <p>&nbsp;</p>
        </li>
        <li>
            <p><strong>Match between system and the real world</strong></p>
            <p>The system should speak the users’ language, with words, phrases and concepts familiar to the user.</p>
            <p>&nbsp;</p>
        </li>
        <li>
            <p><strong>User control and freedom</strong></p>
            <p>Users often make mistakes provide a simplistic means for them to return from an erroneous state.</p>
            <p>&nbsp;</p>
        </li>
        <li>
            <p><strong>Consistency and standards</strong></p>
            <p>Avoid conflicting and confusing use of terminology and actions.</p>
            <p>&nbsp;</p>
        </li>
        <li>
            <p><strong>Error prevention</strong></p>
            <p>Design with consideration of common errors in mind, aim to build a system in which restricts a user from
                entering this erroneous state.</p>
            <p>&nbsp;</p>
        </li>
        <li>
            <p><strong>Recognition rather than recall</strong></p>
            <p>Minimize the memory load burden on the user by making actions accessible and obvious. </p>
            <p>&nbsp;</p>
        </li>
        <li>
            <p><strong>Flexibility and efficiency of use</strong></p>
            <p>Provide accelerators that allow proficient users to perform tasks quickly.</p>
            <p>&nbsp;</p>
        </li>
        <li>
            <p><strong>Aesthetic and minimalist design</strong></p>
            <p>Aim to keep dialogues succinct and on topic to avoid diminishing the relative visibility of
                functionality.</p>
            <p>&nbsp;</p>
        </li>
        <li>
            <p><strong>Help users, recognise, diagnose and recover from errors</strong></p>
            <p>Error messages should be expressed in plain language, provide a focused description of the problem as
                well as common steps to solve it.</p>
            <p>&nbsp;</p>
        </li>
        <li>
            <p><strong>Help and documentation</strong></p>
            <p>Provide documentation to the user should the case arise that they are having issues using the system they
                are immediately able to lookup and resolve their problem.</p>
        </li>
    </ol>
    <p>&nbsp;</p>
    <h5><a name='header-n4477' class='md-header-anchor '></a>Gestalt Principles of Design</h5>
    <p>The Gestalt principles of design are built around the psychological phenomena that humans consider a group of
        objects as a sum of parts before individually. This thought pattern can be exploited to assist in increasing
        discoverability and usability of an interface by grouping, connecting or distancing related and unrelated
        elements. </p>
    <p>For the scope of UI design some of the principles have been omitted from the list below as they largely lend
        themselves better to illustration design. The two omitted are ‘Figure/ground’ and ‘Symmetry and Order’.</p>
    <p>&nbsp;</p>
    <p><strong>Design principles:</strong></p>
    <ol start=''>
        <li>
            <p><strong>Similarity</strong></p>
            <p>Design elements that have a high commonality of features, be it colour, size or structure are often
                considered to be related. This can be used to make the user mentally group alike elements decreasing the
                burden of discovering features. The grouped objects should share similar behaviour as not to break the
                users expectation.</p>
            <p>It should be noted that this notion can also be exploited in reverse, using an anomalous element to
                direct attention towards it.</p>
            <p>&nbsp;</p>
        </li>
        <li>
            <p><strong>Continuation</strong></p>
            <p>The idea behind continuation is that the users tend to follow directed elements until another object is
                encountered. This can be utilised to direct the user on how to ‘read’ the page, how they should mentally
                parse what they are seeing. </p>
            <p>Taking advantage of this can help to ensure that the user receives the information being conveyed in the
                intended order.</p>
            <p>&nbsp;</p>
        </li>
        <li>
            <p><strong>Closure</strong></p>
            <p>Closure is the act of the brain comprehending a broken image as a whole, this is often exploited in
                graphics design to simplify elements whilst maintaining the ability convey what the graphic is or
                represents. </p>
            <p>&nbsp;</p>
        </li>
        <li>
            <p><strong>Proximity</strong></p>
            <p>Proximity is the act of grouping elements close to one another implying some association between them;
                the strongest form of proximity is overlap, where one object partially overlaps another or even fully
                encloses it. </p>
            <p>This can be used to combine singular elements into a collection that are considered as one or help to
                reiterate a relationship between a set of common elements.</p>
        </li>
    </ol>
    <p>&nbsp;</p>
    <h5><a name='header-n4502' class='md-header-anchor '></a>Material Design</h5>
    <p>Material Design is a design principle created by Google to provide continuity in design across both mobile and
        web. From their website, the principle is described as:</p>
    <blockquote>
        <p>Material is an adaptable system of guidelines, components, and tools that support the best practices of user
            interface design. Backed by open-source code, Material streamlines collaboration between designers and
            developers, and helps teams quickly build beautiful products.</p>
    </blockquote>
    <p>&nbsp;</p>
    <p>Material Design operates on a fresh &quot;ink-and-pen&quot; approach. By using components such as card and paper,
        the style hopes to portray information clearly using elements that represent real-world objects. The principle
        is by imitating the real physical world, users&#39; cognitive load will reduce by increasing predictability and
        reducing ambiguity.</p>
    <p>&nbsp;</p>
    <p>We initially did some research into Material Design interfaces, looking at the main ideas and components which we
        could incorporate into our system.</p>
    <p>&nbsp;</p>
    <p><img src='images/visual/research1.jpg' alt='researching design' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p><a href='https://material-ui.com/static/images/themes.jpg' target='_blank'
            class='url'>https://material-ui.com/static/images/themes.jpg</a></p>
    <p>The above design stood out as one of the better ways to display live current data due to the simplicity in the
        card design. The text at the bottom of the cards were user friendly, displaying time in a &#39;timeago&#39;
        format, alongside the bold colours and icons for the type of card. </p>
    <p>&nbsp;</p>
    <p><img src='images/visual/research2.jpg' alt='researching design' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p><a href='https://i.pinimg.com/originals/50/40/43/5040435b8d25e5c32f20eed1192cbe05.png' target='_blank'
            class='url'>https://i.pinimg.com/originals/50/40/43/5040435b8d25e5c32f20eed1192cbe05.png</a></p>
    <p>&nbsp;</p>
    <p>In the above example, the sidebar stood out as it was simplistic but there was a clear separation between the
        user image and name and the links to different sections that are clickable. The icons next to the links add a
        nice touch, however, the dark colour background was not desirable due to the low contrast between the white/grey
        text and icons and the background itself.</p>
    <p>&nbsp;</p>
    <p>In our design, we have opted to separate the &quot;system&quot; user from the regular users, isolating the
        functionality that may break the use of the chicken door to the &quot;system&quot; account.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n4524' class='md-header-anchor '></a>Iteration 2 (Mockups)</h4>
    <p>After conducting some research, some sketches of the initial design were drawn up on Procreate. </p>
    <p>&nbsp;</p>
    <h6><a name='header-n4527' class='md-header-anchor '></a>Main Dashboard Page</h6>
    <p>&nbsp;</p>
    <p><img src='images/visual/main_dashboard.png' alt='sketch of main dashboard page' referrerPolicy='no-referrer' />
    </p>
    <p>&nbsp;</p>
    <p>The temperatue, humidity, dust etc. cards were well received, however, the main door control section goes against
        the design of material cards. Due to time constraints, we started to implement the bottom card section and
        designed some other ideas for the door control later on.</p>
    <p>&nbsp;</p>
    <h6><a name='header-n4533' class='md-header-anchor '></a>Login Page</h6>
    <p>&nbsp;</p>
    <p><img src='images/visual/login_design.png' alt='sketch of login page' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The login page was designed with simplicity in mind, with the main focus being on the login button. This page
        should provide feedback if a user has unsuccessfully inputted their password following Jakob Nielsen usability
        heuristics. </p>
    <p>&nbsp;</p>
    <h6><a name='header-n4539' class='md-header-anchor '></a>History Page</h6>
    <p>&nbsp;</p>
    <p><img src='images/visual/historical_data.png' alt='sketch of history page' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>It was decided early on that the graphs displaying the historical data should sit on cards to separate the types
        of data being displayed. As we did not know which graphing library we were going to use, the sketch of the
        historical data page was brief.</p>
    <p>&nbsp;</p>
    <p>After these initial sketch ups were completed, work was done to implement these designs in the code.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n4547' class='md-header-anchor '></a>Iteration 2</h4>
    <p>The initial design for the main page is as follows:</p>
    <p>&nbsp;</p>
    <p><img src='images/visual/main_page1.png' alt='first version of main page' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>Compared to our initial sketch, the bottom display data section has not changed much as it was well received.
        However a design for the door display was created with a visual to aid the owner to if the door is open or
        closed. In hindsight, this design was a bad choice - current Info doesn&#39;t contain information that is
        &#39;current&#39;, and the graphic detracts from the data supplied on either side, therefore the upper section
        needed a complete redesign.</p>
    <p>&nbsp;</p>
    <p><img src='images/visual/sys_admin1.png' alt='first version of system page' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>An initial version of the system page was created, it was difficult to design a system which contained a large
        text area consisting of the interpreted language code, alongside a small textbox for postal code. With feedback
        from our supervisor, we felt it was better if the code area was separated out into a new tab, and only data
        pertaining to system settings should be in the settings page. </p>
    <p>&nbsp;</p>
    <p><img src='images/visual/login.png' alt='first version of login' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The login page was created with guidance from our sketch. Not much of the structure has changed apart from the
        buttons, and the top bar was removed. This is to make the main card and the login button the centre of
        attention.</p>
    <p><img src='images/visual/register.png' alt='first version of login' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The registration page followed the same outline as the login page and displaying error messages when user input
        is wrong. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n4566' class='md-header-anchor '></a>Iteration 3</h4>
    <p><img src='images/visual/main_page2.png' alt='second version of main page' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The main page went through another iteration, with the data in the previous &#39;current info&#39; and &#39;door
        info&#39; separated out into the same style cards. The main door control card is in a jumbotron as we were
        unsure how to display the door data and control buttons. After discussion within the group, a conclusion was
        made where the jumbotron will be replaced with a double width card. </p>
    <p>&nbsp;</p>
    <p><img src='images/visual/history1.png' alt='first version of history page' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The initial history page only contained graphs for monitoring data, with the colour of each graph corresponding
        to the icons on the main page. It was brought to our attention by Dan that there existed visualizations such as
        the one below. These provide a better view of the door state, therefore we set to integrate this graph into the
        door state for the next iteration.</p>
    <p>&nbsp;</p>
    <p><img src='images/visual/history_graph.png' alt='timeline approach to displaying on off switches'
            referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p><a href='https://www.home-assistant.io/images/lovelace/lovelace_history_graph.png' target='_blank'
            class='url'>https://www.home-assistant.io/images/lovelace/lovelace_history_graph.png</a></p>
    <p>&nbsp;</p>
    <p><img src='images/visual/settings1.png' alt='first version of settings' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The first revision of the settings page consisted of three cards in a line displaying the multiple functions a
        user can partake. Unfortunately this had the issue where if the email list increased in length, the other cards
        will look disproportionate. Dan suggested we combine these three cards into one as they all have the same
        purpose - change user settings, separating them out into three goes against Material Design principles. </p>
    <p>&nbsp;</p>
    <p>In the previous iteration, Dan suggested we separate out the code and system settings into two pages. The
        following were the result of this suggestion.</p>
    <p>&nbsp;</p>
    <p><img src='images/visual/code1.png' alt='first version of code page' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>By separating out the code into its own section, it was cleaner to add more functionality to the existing code
        editor. A tab system was added so the user can manage multiple snippets of code. These snippets can be managed
        individually, such as being deleted or setting the code to be active and running on the hub. </p>
    <p>&nbsp;</p>
    <p><img src='images/visual/sys_settings1.png' alt='first version of system settings' referrerPolicy='no-referrer' />
    </p>
    <p>&nbsp;</p>
    <p>As the code section was moved out of the system settings page, the main settings page seemed empty. To counteract
        this, how the user inputs their location has changed. Instead of inputting their new postcode, the user can
        click their location on the map and save buttons have been provided to confirm this change. The user inputted
        door control times are also available to be changed, following the same design as the main cards on the
        dashboard. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n4593' class='md-header-anchor '></a>Iteration 4</h4>
    <p><img src='images/visual/logs.png' alt='first and final log version' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>In iteration 4, we implented the display of logs from the hub. This page used monospace fonts that resemble fonts
        in old terminals. As this page only contained text, there was not much to change and this was left as is.
        Improvements could be made in the future to colour code key words to aid the user in reading the logs.</p>
    <p>&nbsp;</p>
    <p><img src='images/visual/history2.png' alt='second version of history page' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>This next version of the historical data page contains a timeline displaying the door state. By using google
        charts, users can hover over a section to see how long the door has been in that certain state for. </p>
    <p>&nbsp;</p>
    <p><img src='images/visual/main_page3.png' alt='third version of main page' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The door control card has been refactored to be of two cards with, with data displaying the state of the door.
        There is also an action button that the use can press to control the door. Once clicked, this button will show a
        spinner, notifying the user that the command is executing. Even so this card is done, the layout of the cards
        still look off, so this will be tweaked in the next iteration.</p>
    <p>&nbsp;</p>
    <p><img src='images/visual/settings2.png' alt='final version of settings page' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>With advice from our supervisor, the settings cards have been merged into one owing to the reasons described in
        the previous iteration. This makes the page look a lot cleaner. Any deletion of an email and the user will be
        prompted with a dialog confirming this action. The user can click on the &quot;Upload Picture&quot; box to
        select an image, or it&#39;s also possible to drag and drop an image to this section too.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n4610' class='md-header-anchor '></a>Iteration 5</h4>
    <p><img src='images/visual/history_final.png' alt='final version of historical data' referrerPolicy='no-referrer' />
    </p>
    <p>&nbsp;</p>
    <p>We quickly realised that the water data can be displayed with a timeline graph as well. The above image shows it
        being implemented. Also, as shown below, a user can hover over these graphs and read the precise value and time.
    </p>
    <p>&nbsp;</p>
    <p><img src='images/visual/friendly_time.png' alt='hover over line graph pop up' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p><img src='images/visual/history_hover.png' alt='hover over timeline pop up' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p><img src='images/visual/main_page_final.png' alt='second version of main page' referrerPolicy='no-referrer' />
    </p>
    <p>&nbsp;</p>
    <p>In this final iteration for the main page, the cards are ordered one after each other rather than being
        separated. In the future, if time allowed, a new feature could be added so the user can drag and drop to move
        the cards into the order of their liking. The above picture shows a snapshot of the spinner after clicking on
        the &#39;close door&#39; button.</p>
    <p>&nbsp;</p>
    <p><img src='images/visual/sys_settings3.png' alt='final version of system settings' referrerPolicy='no-referrer' />
    </p>
    <p>&nbsp;</p>
    <p>The system settings page has been updated with cards displaying the IP address of the hub, alongside the ability
        to change the system account&#39;s password. Improvements could be made whereby the password changer could
        redirect the user to a separate page only containing this functionality to make functionality clearer. The user
        is able to clear the current automation time.</p>
    <p>&nbsp;</p>
    <p><img src='images/visual/sys_settings2.png' alt='system settings with clock popup' referrerPolicy='no-referrer' />
    </p>
    <p>&nbsp;</p>
    <p>Time is always a tricky datatype to work with, however, we&#39;ve simplified this for the user as when any of the
        time fields are clicked, a popup consisting of a clock appears, which the user can select the time on there.
    </p>
    <p>&nbsp;</p>
    <p><img src='images/visual/sys_settings4.png' alt='system settings with clock popup' referrerPolicy='no-referrer' />
    </p>
    <p>&nbsp;</p>
    <p>When automation is off, the user is notified with red text.</p>
    <p>&nbsp;</p>
    <p><img src='images/visual/code2.png' alt='final version of code page' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The code page has been slightly updated with the ability for the user to name their individual code snippets.
        Also the add button is now level with tab. </p>
    <p>&nbsp;</p>
    <p><img src='images/visual/code_alert.png' alt='code popup' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The user will be asked to confirm if they want to send the code to the hub. They will also be prompted when
        delete is pressed as this is irreversible. </p>
    <p>&nbsp;</p>
    <p><img src='images/visual/code_broken.png' alt='broken code error' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>Any code that doesn&#39;t compile when being sent to the hub will return an error message describing the syntax
        error. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n4649' class='md-header-anchor '></a>Iteration 6</h4>
    <p><img src='images/visual/wizard.png' alt='first and final version of wizard' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>To aid the user in first time setup, we&#39;ve created a wizard which prompts for the IP of the main hub, a new
        password for the system user and their location. As this uses the Stepper Material Component, not many design
        changes needed to be done. </p>
    <p>The user can easily see which step they are on and can jump between previous ones by pressing the back button, or
        clicking on the edit button next to the previous step. If there is an error between proceeding to the next step,
        the user will be notified. </p>
    <p>We&#39;ve also provided some basic instructions on how to manage users and write our domain specific language.
    </p>
    <p>&nbsp;</p>
    <p><img src='images/visual/user_mgt.png' alt='first and final version of wizard' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The user management page only displays the data that a system admin is concerned about. The system admin can
        easily change any of these fields with a simple click. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n4660' class='md-header-anchor '></a>Final Iteration</h4>
    <p>Throughout these iterations, we have made this interface mobile friendly as well. However, a final iteration was
        made through this project to catch any non-responsive elements. The below shows the website displayed on a
        mobile.</p>
    <h5><a name='header-n4662' class='md-header-anchor '></a>User</h5>
    <center></center>
    <p><img src="images/visual/mobile/main.png" alt="main page" style="height:50%;width:50%;"></p>
    <p>&nbsp;</p>
    <p><img src="images/visual/mobile/main2.png" alt="main page" style="height:50%;width:50%;"></p>
    <p>&nbsp;</p>
    <p><img src="images/visual/mobile/historical1.png" alt="historical on mobile" style="height:50%;width:50%;"></p>
    <p>&nbsp;</p>
    <p><img src="images/visual/mobile/historical2.png" alt="historical on mobile" style="height:50%;width:50%;"></p>
    <p>&nbsp;</p>
    <p><img src="images/visual/mobile/user_settings.png" alt="user settings on mobile" style="height:50%;width:50%;">
    </p>
    <p>&nbsp;</p>
    <p><img src="images/visual/mobile/sidebar.png" alt="sidebar" style="height:50%;width:50%;"></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <h5>System</h5>
    <p>&nbsp;</p>
    <p><img src="images/visual/mobile/system_settings.png" alt="system setttings on mobile"
            style="height:50%;width:50%;"></p>
    <p>&nbsp;</p>
    <p><img src="images/visual/mobile/user_management.png" alt="user management on mobile"
            style="height:50%;width:50%;"></p>
    <p>&nbsp;</p>
    <p><img src="images/visual/mobile/language_tab.png" alt="language interface on mobile"
            style="height:50%;width:50%;"></p>
    <p>&nbsp;</p>
    <h5>Misc.</h5>
    <p>&nbsp;</p>
    <p><img src="images/visual/mobile/login.png" alt="login on mobile" style="height:50%;width:50%;"></p>
    <p>&nbsp;</p>
    <p><img src="images/visual/mobile/register.png" alt="register on mobile" style="height:50%;width:50%;"></p>
    <p>&nbsp;</p>
    <p>
        </center>
    </p>
    <p>&nbsp;</p>
    <p>The above have been achieved using the in built Material UI libraries who already have mobile support, or using
        flexbox or Bootstrap Grid. Any other elements that do not utilize these have been made responsive by using CSS
        media queries.</p>
    <p>&nbsp;</p>
    <h3><a name='header-n4695' class='md-header-anchor '></a>Historical Data</h3>
    <p>As seen in the previous UI design section, we needed to provide a way for our users to view historical data from
        the modular network in a user friendly way.</p>
    <p>Owing to this, we conducted research into the graphing libraries available to us. After exploring potential
        options, we opted to use Chart.js as our graphing library as though the chart types were limited, it supported
        the main ones we needed. It is also open source with easy to read documentation, providing many examples.</p>
    <p>The other graphing library we used is Google Charts. Google Charts has the ability to display timeline graphs
        which are used for the water and door state.</p>
    <p>There were wrapper libraries for Angular built around these charting libraries which we used to help speed up
        development. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n4701' class='md-header-anchor '></a>Line Graphs</h4>
    <p>&nbsp;</p>
    <p><img src='images/visual/friendly_time.png' alt='researching design' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>Line graphs were used to display monitoring data which returned variable values. For example, temperature,
        humidity. </p>
    <p>&nbsp;</p>
    <p>For each of these data types, the below code was created to aggregate the data into the data structure pertaining
        to the library. </p>
    <p>&nbsp;</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="typescript" contenteditable="false" cid="n4709"
        mdtype="fences" style="break-inside: unset;">public dustData: Array&lt;any&gt; = [
    { data: [], label: 'Dust / ug/m3' }
]
public dustLabels: Array&lt;any&gt; = []

public dustColors: Array&lt;any&gt; = [
    {
        backgroundColor: 'rgba(38, 166, 154, 0.45)',
        borderColor: 'rgba(38, 166, 154, 0.65)',
        pointBackgroundColor: 'rgba(148,159,177,1)',
        pointBorderColor: '#fff',
        pointHoverBackgroundColor: '#fff',
        pointHoverBorderColor: 'rgba(148,159,177,0.8)'
    }
]
</pre>
    <p>&nbsp;</p>
    <p>In this below code, we grab the data from the service and format it to work with the graphing library.</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="typescript" contenteditable="false" cid="n4712"
        mdtype="fences" style="break-inside: unset;">this.subscription.add(this.dataService.getDustValues(10).subscribe(x =&gt; {
    x.data.forEach(element =&gt; {
        this.dustData[0].data.push(element.value),
            this.dustLabels.push((new Date(element.date)))
    })

    // Needed to auto update chart for dynamic datasets
    // Trick: Reassign to the exposed dataset property into your
    // component so it triggers change detection
    // https://github.com/valor-software/ng2-charts/issues/959#issuecomment-367171535
    this.dustData[0].data.reverse()
    this.dustLabels.reverse()
    this.dustData = Object.assign([], this.dustData);
}))
</pre>
    <p>&nbsp;</p>
    <p>To be displayed on the DOM. <code>canvas</code> is the selector for the library, <code>[datasets]</code>,
        <code>[labels]</code> and other elements in square brackets are the input field names for this component and the
        values in the <code>&quot;&quot;</code> are the fields from the current components passed to the chart
        component. </p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="html" contenteditable="false" cid="n4715"
        mdtype="fences">&lt;mat-card class="card"&gt;
    &lt;mat-card-title&gt;Dust&lt;/mat-card-title&gt;
    &lt;div style="display: block;"&gt;
        &lt;canvas height="200%" baseChart [datasets]="dustData" [labels]="dustLabels" [options]="lineChartOptions"
                [colors]="dustColors" [legend]="lineChartLegend" [chartType]="lineChartType"&gt;&lt;/canvas&gt;
    &lt;/div&gt;
&lt;/mat-card&gt;
</pre>
    <p>&nbsp;</p>
    <h4><a name='header-n4717' class='md-header-anchor '></a>Timeline graphs</h4>
    <p>Timeline graphs were added to the web interface as a better way of displaying data with predictable states. For
        example, the water sensor can only be true or false and the door can be &quot;open&quot;, &quot;closed&quot; or
        &quot;error&quot;.</p>
    <p>&nbsp;</p>
    <p><img src='images/visual/history_hover.png' alt='timeline graphs' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The below code show data being retrieved from the service and formatted to meet the requirements for the Google
        Charts library. </p>
    <p>&nbsp;</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="typescript" contenteditable="false" cid="n4724"
        mdtype="fences" style="break-inside: unset;">this.subscription.add(this.dataService.getWaterValues(10).subscribe(res =&gt; {

    let pastDate
    let pastVal
    for (var iter in res.data) {
        let data = res.data[iter]

        if (!pastDate) {
            pastDate = data.date
            pastVal = data.value ? "present" : "low"
        } else {
            if(pastVal !== data.value.toString()){
                let addData = ['Water', pastVal, this.df(new Date(pastDate)), 
                               this.df(new Date(data.date))]
                this.waterData.push(addData)
                pastDate = data.date
                pastVal = data.value ? "present" : "low"
            }
        }
    }
    let addData = ['Water', pastVal, this.df(new Date(pastDate)), this.df(new Date())]
    this.doorData.push(addData)
    this.doorData = Object.assign([], this.waterData)
}
))
</pre>
    <p>&nbsp;</p>
    <p>The code for the page can be found <a
            href="code/visualisation/angular/smart-chickens/src/app/components/historical/historical.component.ts">here</a>.
    </p>

    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <h3><a name='header-n4729' class='md-header-anchor '></a>Role Based Authorization</h3>
    <p>We opted to have role based access control to limit the users who are able to access the web interface. By
        creating two separate types of user, &quot;System&quot; and &quot;User&quot;, we were able to limit access to
        critical functions such as the programmable interface. The User role also has two separate types - the ones who
        have access to door control and the ones who do not. This can all be changed by the System account. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n4732' class='md-header-anchor '></a>JSON Web Tokens</h4>
    <p>JSON Web Tokens, also known as JWT, are a standard for generating access tokens that contains information such as
        if a user is logged in as admin. </p>
    <p>In our Express.js server, when the login endpoint is hit, we check if the credentials are correct. Once they are
        confirmed to be correct, we create a token using the username and role, and signing it with a shared secret.
        This information is then returned to the front end. </p>
    <p>&nbsp;</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="js" contenteditable="false" cid="n4736"
        mdtype="fences">const token = jwt.sign({sub: user.rows[0].username, 
                       role: user.rows[0].admin ? Role.Admin : Role.User}, 
                       config.secret)
return {
    userObj,
    token
}
</pre>
    <p>&nbsp;</p>
    <p>The user object is then stored inside a <code>BehaviourSubject</code> in the authentication service. In any
        request to the server, the token will be added to the Authorization header, done in the JwtInterceptor to be
        authenticated on the server side. </p>
    <p>&nbsp;</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n4740"
        mdtype="fences">intercept(req: HttpRequest&lt;any&gt;, next: HttpHandler): Observable&lt;HttpEvent&lt;any&gt;&gt; {
    let currentUser = this.authenticationService.currentUserVal
    if (currentUser &amp;&amp; currentUser.token) {
        req = req.clone({
            setHeaders: {
                Authorization: `Bearer ${currentUser.token}`
            }
        })
    }
	return next.handle(req)
}
</pre>
    <p>&nbsp;</p>
    <p>Server side, routes that require authentication have another callback function. For example:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n4743"
        mdtype="fences">router.get('/getLocation', authorize(), getLocation)
router.post('/updateLocation', authorize(Role.Admin), updateLocation)
</pre>
    <p>&nbsp;</p>
    <p>In the first example, the <code>authorize()</code> function will only call <code>next()</code> to proceed to the
        <code>getLocation()</code> method when the user is successfully logged in as any type of user. In contrast, the
        user accessing the <code>/updateLocation</code> endpoint has to have a role of admin, otherwise an authorized
        status code of 401 will be returned. </p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n4746"
        mdtype="fences" style="break-inside: unset;">function authorize(roles = []) {

    if (typeof roles === 'string') {
        roles = [roles]
    }

    return [
        // Authenticates users using JWT, 
        // if the token is valid, req.user will be set in the JSON object
        expressJwt({ secret }),  

        // authorize based on user role
        (req, res, next) =&gt; {
            if (roles.length &amp;&amp; !roles.includes(req.user.role)) {   
                // Unauthorized, return error
                return res.status(401).json({ message: 'Unauthorized' })
            }

            // authentication and authorization successful
            next()
        }
    ]
}
// NB: this code is adapated to work in our system from: 
// http://jasonwatmore.com/post/2018/11/28/nodejs-role-based-authorization-tutorial-with-example-api
</pre>
    <p>&nbsp;</p>
    <p>When the front end receives an authorized error, the user will be forcefully logged out due to the
        ErrorInterceptor intercepting this response before it can be processed.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n4750' class='md-header-anchor '></a>Guards</h4>
    <p>Guards in Angular make sure that a user can only navigate to a page under certain conditions. By specifying in
        the Angular routes which pages need which guard, you can control access to these pages. For example, the login
        page has a guard to only allow users that are not logged in access to the page. </p>
    <p>The routes are as follows:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="typescript" contenteditable="false" cid="n4753"
        mdtype="fences" style="break-inside: unset;">const routes: Routes = [
  {path: '', redirectTo: 'setup', pathMatch: 'full'},
  {path: 'setup', component: SetupComponent, canActivate:[SetupGuard]},
  {path: 'login', component: LoginComponent, canActivate:[LoginGuard]},
  {path: 'register', component: RegistrationComponent, canActivate:[LoginGuard]},
  {path: 'user', component: SideBarComponent, canActivate:[AuthGuard],
    children: [
      ...
    ]},
  {path: 'system', component: AdminSideBarComponent, canActivate:[AdminGuard],
    children: [
      ...
    ]},
  { path: '**', redirectTo: 'user'}
]
</pre>
    <p>&nbsp;</p>
    <p>LoginGuard:</p>
    <pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="typescript" contenteditable="false" cid="n4756"
        mdtype="fences" style="break-inside: unset;">export class LoginGuard implements CanActivate {

    constructor(private router: Router, 
                 private authenticationService: AuthenticationService) { }

    /**
     * Redirect user to dashboard if already logged in
     * @param route route
     * @param state state
     */
    canActivate(route: ActivatedRouteSnapshot, state: RouterStateSnapshot) : boolean {
        console.log("login guard")
        if (localStorage.getItem('currentUser')) {
            const currentUser = this.authenticationService.currentUserVal
            if(currentUser.userObj.role === Role.Admin){
                // User is logged in as System admin. Redirect to main page. 
                this.router.navigate(['/system'], 
                                     { queryParams: { returnUrl: state.url }})
                return false
            }
            // User is logged in. Redirect to main page. 
            this.router.navigate(['/user/dashboard'], 
                                 { queryParams: { returnUrl: state.url }})
            return false
        }
        // Can navigate to login page - return true.
        return true
    }
}
</pre>
    <p>&nbsp;</p>
    <p>The above code returns true when the user is not logged in, forbidding logged in users to see the login page. A
        user who is logged in will simple be redirected to the main dashboard page. </p>
    <p>For the other guards, please see <a href="code/visualisation/angular/smart-chickens/src/app/guards/">here</a>.
    </p>
    <p>&nbsp;</p>
    <h3><a name='header-n4761' class='md-header-anchor '></a>Language Interface</h3>
    <p>We have provided a web interface which only System admins can use to communicate with and update the domain
        specific language running on the hub. </p>
    <p>&nbsp;</p>
    <p><img src='images/visual/code2.png' alt='final version of code page' referrerPolicy='no-referrer' /></p>
    <p>&nbsp;</p>
    <p>The interface for this is structured with a parent and child component. The parent component, LanguageComponent,
        is responsible for managing the list of code snippets utilizing <code>mat-tab</code> found in the Angular
        Material library.</p>
    <p>The child, CodeEditorComponent, is responsible for displaying the selected code snippet using CodeMirror as the
        text editor. </p>
    <p>&nbsp;</p>
    <p>The user has the option to </p>
    <ol start=''>
        <li>save the code</li>
        <li>delete the code</li>
        <li>save and send the code to the hub</li>
        <li>save and delete from hub</li>
    </ol>
    <p>&nbsp;</p>
    <p>The backend provides APIs which aid this process. </p>
    <p>&nbsp;</p>
    <p><strong>GET /code/getSourceCode</strong></p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>HTTP Status Code</th>
                    <th>Response</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>200</td>
                    <td><code>[{id, name, code, date_created, last_modified, is_active},...]</code></td>
                </tr>
                <tr>
                    <td>400</td>
                    <td><code>{ message: &#39;Unable to get source code&#39; }</code></td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>Retrieves a list of code objects.</p>
    <p>&nbsp;</p>
    <p><strong>POST /code/updateSourceCode</strong></p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>HTTP Status Code</th>
                    <th>Response</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>200</td>
                    <td><code>true</code></td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>This endpoint simply updates the code in the database.</p>
    <p>&nbsp;</p>
    <p><strong>POST /code/toggleActiveCode</strong></p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>HTTP Status Code</th>
                    <th>Response</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>200</td>
                    <td><code>{compiles: true | false, message: &quot;&quot;, saved: true | false }</code></td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>This endpoint is used to toggle if the code is active or not. This initially calls the endpoint on the hub
        <code>code/check</code> to see if the code is syntactically correct. Once confirmed, a check is made to see if
        the code needs to be set to be inactive or active. If the code needs to be set as active, the function will
        disable the previously enabled code to set this one to be active. This function will then call the hub to
        refresh the list of active code.</p>
    <p>&nbsp;</p>
    <p><strong>POST /code/saveNewCode</strong></p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>HTTP Status Code</th>
                    <th>Response</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>200</td>
                    <td><code>true</code></td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>This endpoint simply inserts code into the database.</p>
    <p>&nbsp;</p>
    <p><strong>DELETE /deleteCode/:codeId</strong></p>
    <figure>
        <table>
            <thead>
                <tr>
                    <th>HTTP Status Code</th>
                    <th>Response</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>200</td>
                    <td><code>true</code></td>
                </tr>
            </tbody>
        </table>
    </figure>
    <p>This endpoint will remove the code with the specified ID from the database.</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <h3><a name='header-n4837' class='md-header-anchor '></a>Future Work</h3>
    <p>Due to time constraints in the project, there are extra features we would like to implement if time allowed. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n4840' class='md-header-anchor '></a>User customizable interface</h4>
    <p>We built this web interface with the idea in mind that users can drag and drop the cards on the dashboard to
        reorganise or remove cards to their liking. Historical data cards could also be added by the user to the main
        page, focusing the user on the readings they want to see. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n4843' class='md-header-anchor '></a>Integrate emails</h4>
    <p>Instead of only relying on the programmable language to send emails and SMS, it could be made so that the user
        can set up their own alerts on the web interface. </p>
    <p>&nbsp;</p>
    <h4><a name='header-n4846' class='md-header-anchor '></a>Specify time period</h4>
    <p>When viewing data from the historical tab, or the logs, data is only shown for a set past period. It would be
        better if the user can specify the time period to view.</p>
    <p>&nbsp;</p>
    <h4><a name='header-n4849' class='md-header-anchor '></a>In App notifications</h4>
    <p>It was brought up during a discussion that we could implement in-app notifications. Using guidelines for
        temperature and dust levels for example, notifications could be implemented when any of these values are out of
        bounds. Water can also send an in app notification if levels are low.</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    </div>
</body>

</html>